/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.3.6 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, https://github.com/requirejs/requirejs/blob/master/LICENSE
 */var requirejs,require,define;(function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var a;for(a=0;a<e.length&&!(e[a]&&t(e[a],a,e));a+=1);}}function eachReverse(e,t){if(e){var a;for(a=e.length-1;-1<a&&!(e[a]&&t(e[a],a,e));a-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){for(var a in e)if(hasProp(e,a)&&t(e[a],a))break}function mixin(e,t,a,i){return t&&eachProp(t,function(t,n){(a||!hasProp(e,n))&&(!i||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[n]=t:(!e[n]&&(e[n]={}),mixin(e[n],t,a,i)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(t,a,i,n){var s=new Error(a+"\nhttps://requirejs.org/docs/errors.html#"+t);return s.requireType=t,s.requireModules=n,i&&(s.originalError=i),s}function newContext(e){function t(e){var t,a;for(t=0;t<e.length;t++)if(a=e[t],"."===a)e.splice(t,1),t-=1;else if(".."===a)if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;else 0<t&&(e.splice(t-1,2),t-=2)}function a(e,a,n){var s=a&&a.split("/"),o=f.map,d=o&&o["*"],c,r,l,p,u,m,g,h,v,A,b,x;if(e&&(e=e.split("/"),g=e.length-1,f.nodeIdCompat&&jsSuffixRegExp.test(e[g])&&(e[g]=e[g].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&s&&(x=s.slice(0,s.length-1),e=x.concat(e)),t(e),e=e.join("/")),n&&o&&(s||d)){l=e.split("/");outerLoop:for(p=l.length;0<p;p-=1){if(m=l.slice(0,p).join("/"),s)for(u=s.length;0<u;u-=1)if(r=getOwn(o,s.slice(0,u).join("/")),r&&(r=getOwn(r,m),r)){h=r,v=p;break outerLoop}!A&&d&&getOwn(d,m)&&(A=getOwn(d,m),b=p)}!h&&A&&(h=A,v=b),h&&(l.splice(0,v,h),e=l.join("/"))}return c=getOwn(f.pkgs,e),c?c:e}function i(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===R.contextName)return t.parentNode.removeChild(t),!0})}function n(e){var t=getOwn(f.paths,e);if(t&&isArray(t)&&1<t.length)return t.shift(),R.require.undef(e),R.makeRequire(null,{skipMap:!0})([e]),!0}function s(e){var t=e?e.indexOf("!"):-1,a;return-1<t&&(a=e.substring(0,t),e=e.substring(t+1,e.length)),[a,e]}function o(e,t,i,n){var o=null,d=t?t.name:null,c=e,r=!0,l="",p,u,m,g;return e||(r=!1,e="_@r"+(T+=1)),g=s(e),o=g[0],e=g[1],o&&(o=a(o,d,n),u=getOwn(S,o)),e&&(o?i?l=e:u&&u.normalize?l=u.normalize(e,function(e){return a(e,d,n)}):l=-1===e.indexOf("!")?a(e,d,n):e:(l=a(e,d,n),g=s(l),o=g[0],l=g[1],i=!0,p=R.nameToUrl(l))),m=!o||u||i?"":"_unnormalized"+(I+=1),{prefix:o,name:l,parentMap:t,unnormalized:!!m,url:p,originalName:c,isDefine:r,id:(o?o+"!"+l:l)+m}}function d(e){var t=e.id,a=getOwn(b,t);return a||(a=b[t]=new R.Module(e)),a}function c(e,t,a){var i=e.id,n=getOwn(b,i);hasProp(S,i)&&(!n||n.defineEmitComplete)?"defined"===t&&a(S[i]):(n=d(e),n.error&&"error"===t?a(n.error):n.on(t,a))}function r(e,t){var a=e.requireModules,i=!1;t?t(e):(each(a,function(t){var a=getOwn(b,t);a&&(a.error=e,a.events.error&&(i=!0,a.emit("error",e)))}),!i&&req.onError(e))}function l(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(R.defQueueMap[t]=!0),C.push(e)}),globalDefQueue=[])}function p(e){delete b[e],delete x[e]}function u(e,t,a){var i=e.map.id;e.error?e.emit("error",e.error):(t[i]=!0,each(e.depMaps,function(n,s){var i=n.id,o=getOwn(b,i);!o||e.depMatched[s]||a[i]||(getOwn(t,i)?(e.defineDep(s,S[i]),e.check()):u(o,t,a))}),a[i]=!0)}function m(){var e=1e3*f.waitSeconds,t=e&&R.startTime+e<new Date().getTime(),a=[],s=[],o=!1,d=!0,c,l;if(!M)return M=!0,eachProp(x,function(e){var c=e.map,r=c.id;if(e.enabled&&(c.isDefine||s.push(e),!e.error))if(!e.inited&&t)n(r)?(l=!0,o=!0):(a.push(r),i(r));else if(!e.inited&&e.fetched&&c.isDefine&&(o=!0,!c.prefix))return d=!1}),t&&a.length?(c=makeError("timeout","Load timeout for modules: ",null,a),c.contextName=R.contextName,r(c)):void(d&&each(s,function(e){u(e,{},{})}),(!t||l)&&o&&(isBrowser||isWebWorker)&&!j&&(j=setTimeout(function(){j=0,m()},50)),M=!1)}function g(e){hasProp(S,e[0])||d(o(e[0],null,!0)).init(e[1],e[2])}function h(e,t,a,i){e.detachEvent&&!isOpera?i&&e.detachEvent(i,t):e.removeEventListener(a,t,!1)}function v(e){var t=e.currentTarget||e.srcElement;return h(t,R.onScriptLoad,"load","onreadystatechange"),h(t,R.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function A(){var e;for(l();C.length;){if(e=C.shift(),null===e[0])return r(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));g(e)}R.defQueueMap={}}var f={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},b={},x={},w={},C=[],S={},k={},E={},T=1,I=1,M,N,R,O,j;return O={require:function(e){return e.require?e.require:e.require=R.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?S[e.map.id]=e.exports:e.exports=S[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(f.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},N=function(e){this.events=getOwn(w,e.id)||{},this.map=e,this.shim=getOwn(f.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},N.prototype={init:function(e,t,a,i){i=i||{},this.inited||(this.factory=t,a?this.on("error",a):this.events.error&&(a=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=a,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,R.startTime=new Date().getTime();var e=this.map;return this.shim?void R.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;k[e]||(k[e]=!0,R.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e=this.map.id,t=this.depExports,a=this.exports,i=this.factory,n,s;if(!this.inited)hasProp(R.defQueueMap,e)||this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,1>this.depCount&&!this.defined){if(isFunction(i)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{a=R.execCb(e,i,t,a)}catch(t){n=t}else a=R.execCb(e,i,t,a);if(this.map.isDefine&&void 0===a&&(s=this.module,s?a=s.exports:this.usingExports&&(a=this.exports)),n)return n.requireMap=this.map,n.requireModules=this.map.isDefine?[this.map.id]:null,n.requireType=this.map.isDefine?"define":"require",r(this.error=n)}else a=i;if(this.exports=a,this.map.isDefine&&!this.ignore&&(S[e]=a,req.onResourceLoad)){var o=[];each(this.depMaps,function(e){o.push(e.normalizedMap||e)}),req.onResourceLoad(R,this.map,o)}p(e),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}},callPlugin:function(){var e=this.map,t=e.id,i=o(e.prefix);this.depMaps.push(i),c(i,"defined",bind(this,function(i){var n=getOwn(E,this.map.id),s=this.map.name,l=this.map.parentMap?this.map.parentMap.name:null,u=R.makeRequire(e.parentMap,{enableBuildCallback:!0}),m,g,h;return this.map.unnormalized?(i.normalize&&(s=i.normalize(s,function(e){return a(e,l,!0)})||""),g=o(e.prefix+"!"+s,this.map.parentMap,!0),c(g,"defined",bind(this,function(e){this.map.normalizedMap=g,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),h=getOwn(b,g.id),void(h&&(this.depMaps.push(g),this.events.error&&h.on("error",bind(this,function(e){this.emit("error",e)})),h.enable()))):n?(this.map.url=R.nameToUrl(n),void this.load()):void(m=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),m.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(b,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&p(e.map.id)}),r(e)}),m.fromText=bind(this,function(a,i){var n=e.name,s=o(n),c=useInteractive;i&&(a=i),c&&(useInteractive=!1),d(s),hasProp(f.config,t)&&(f.config[n]=f.config[t]);try{req.exec(a)}catch(a){return r(makeError("fromtexteval","fromText eval for "+t+" failed: "+a,a,[t]))}c&&(useInteractive=!0),this.depMaps.push(s),R.completeLoad(n),u([n],m)}),i.load(e.name,u,m,f))})),R.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){x[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var a,i,n;if("string"==typeof e){if(e=o(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,n=getOwn(O,e.id),n)return void(this.depExports[t]=n(this));this.depCount+=1,c(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?c(e,"error",bind(this,this.errback)):this.events.error&&c(e,"error",bind(this,function(e){this.emit("error",e)}))}a=e.id,i=b[a],hasProp(O,a)||!i||i.enabled||R.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(b,e.id);t&&!t.enabled&&R.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var a=this.events[e];a||(a=this.events[e]=[]),a.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},R={config:f,contextName:e,registry:b,defined:S,urlFetched:k,defQueue:C,defQueueMap:{},Module:N,makeModuleMap:o,nextTick:req.nextTick,onError:r,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,a){return(-1===a.indexOf("?")?"?":"&")+t}}var a=f.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(!f[t]&&(f[t]={}),mixin(f[t],e,!0,!0)):f[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(E[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=R.makeShimExports(e)),a[t]=e}),f.shim=a),e.packages&&each(e.packages,function(e){var t,a;e="string"==typeof e?{name:e}:e,a=e.name,t=e.location,t&&(f.paths[a]=e.location),f.pkgs[a]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(b,function(e,t){e.inited||e.map.unnormalized||(e.map=o(t,null,!0))}),(e.deps||e.callback)&&R.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}},makeRequire:function(t,n){function s(a,i,c){var l,p,u;return(n.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof a)?isFunction(i)?r(makeError("requireargs","Invalid require call"),c):t&&hasProp(O,a)?O[a](b[t.id]):req.get?req.get(R,a,t,s):(p=o(a,t,!1,!0),l=p.id,hasProp(S,l)?S[l]:r(makeError("notloaded","Module name \""+l+"\" has not been loaded yet for context: "+e+(t?"":". Use require([])")))):(A(),R.nextTick(function(){A(),u=d(o(null,t)),u.skipMap=n.skipMap,u.init(a,i,c,{enabled:!0}),m()}),s)}return n=n||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var i=e.lastIndexOf("."),n=e.split("/")[0],s;return-1!==i&&(!("."===n||".."===n)||1<i)&&(s=e.substring(i,e.length),e=e.substring(0,i)),R.nameToUrl(a(e,t&&t.id,!0),s,!0)},defined:function(e){return hasProp(S,o(e,t,!1,!0).id)},specified:function(e){return e=o(e,t,!1,!0).id,hasProp(S,e)||hasProp(b,e)}}),t||(s.undef=function(e){l();var a=o(e,t,!0),n=getOwn(b,e);n.undefed=!0,i(e),delete S[e],delete k[a.url],delete w[e],eachReverse(C,function(t,a){t[0]===e&&C.splice(a,1)}),delete R.defQueueMap[e],n&&(n.events.defined&&(w[e]=n.events),p(e))}),s},enable:function(e){var t=getOwn(b,e.id);t&&d(e).enable()},completeLoad:function(e){var t=getOwn(f.shim,e)||{},a=t.exports,i,s,o;for(l();C.length;){if(s=C.shift(),null===s[0]){if(s[0]=e,i)break;i=!0}else s[0]===e&&(i=!0);g(s)}if(R.defQueueMap={},o=getOwn(b,e),!i&&!hasProp(S,e)&&o&&!o.inited){if(f.enforceDefine&&(!a||!getGlobal(a)))return n(e)?void 0:r(makeError("nodefine","No define call for "+e,null,[e]));g([e,t.deps||[],t.exportsFn])}m()},nameToUrl:function(e,t,a){var n=getOwn(f.pkgs,e),s,o,d,c,r,l,p;if(n&&(e=n),p=getOwn(E,e),p)return R.nameToUrl(p,t,a);if(req.jsExtRegExp.test(e))r=e+(t||"");else{for(s=f.paths,o=e.split("/"),d=o.length;0<d;d-=1)if(c=o.slice(0,d).join("/"),l=getOwn(s,c),l){isArray(l)&&(l=l[0]),o.splice(0,d,l);break}r=o.join("/"),r+=t||(/^data\:|^blob\:|\?/.test(r)||a?"":".js"),r=("/"===r.charAt(0)||r.match(/^[\w\+\.\-]+:/)?"":f.baseUrl)+r}return f.urlArgs&&!/^blob\:/.test(r)?r+f.urlArgs(e,r):r},load:function(e,t){req.load(R,e,t)},execCb:function(e,t,a,i){return t.apply(i,a)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=v(e);R.completeLoad(t.id)}},onScriptError:function(e){var t=v(e);if(!n(t.id)){var a=[];return eachProp(b,function(e,i){0!==i.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===t.id)return a.push(i),!0})}),r(makeError("scripterror","Script error for \""+t.id+(a.length?"\", needed by: "+a.join(", "):"\""),e,[t.id]))}}},R.require=R.makeRequire(),R}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var version="2.3.6",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!!("undefined"!=typeof window&&"undefined"!=typeof navigator&&window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1,req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,a,i){var n="_",s,o;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=a,a=i):e=[]),o&&o.context&&(n=o.context),s=getOwn(contexts,n),s||(s=contexts[n]=req.s.newContext(n)),o&&s.configure(o),s.require(e,t,a)},req.config=function(e){return req(e)},req.nextTick="undefined"==typeof setTimeout?function(e){e()}:function(e){setTimeout(e,4)},require||(require=req),req.version="2.3.6",req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts._;return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e){var t=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return t.type=e.scriptType||"text/javascript",t.charset="utf-8",t.async=!0,t},req.load=function(t,a,i){var n=t&&t.config||{},s;if(isBrowser)return s=req.createNode(n,a,i),s.setAttribute("data-requirecontext",t.contextName),s.setAttribute("data-requiremodule",a),!s.attachEvent||s.attachEvent.toString&&0>s.attachEvent.toString().indexOf("[native code")||isOpera?(s.addEventListener("load",t.onScriptLoad,!1),s.addEventListener("error",t.onScriptError,!1)):(useInteractive=!0,s.attachEvent("onreadystatechange",t.onScriptLoad)),s.src=i,n.onNodeCreated&&n.onNodeCreated(s,n,a,i),currentlyAddingScript=s,baseElement?head.insertBefore(s,baseElement):head.appendChild(s),currentlyAddingScript=null,s;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),t.completeLoad(a)}catch(n){t.onError(makeError("importscripts","importScripts failed for "+a+" at "+i,n,[a]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"),dataMain)return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,a){var i,n;"string"!=typeof e&&(a=t,t=e,e=null),isArray(t)||(a=t,t=null),!t&&isFunction(a)&&(t=[],a.length&&(a.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,a){t.push(a)}),t=(1===a.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript(),i&&(!e&&(e=i.getAttribute("data-requiremodule")),n=contexts[i.getAttribute("data-requirecontext")])),n?(n.defQueue.push([e,t,a]),n.defQueueMap[e]=!0):globalDefQueue.push([e,t,a])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}})(this,"undefined"==typeof setTimeout?void 0:setTimeout),define("node_modules/requirejs/require.js",function(){}),function(){var n=Math.floor,s=Math.min,o=Math.max;function e(e){function t(t,a,i,n,s,o){for(;0<=s&&s<o;s+=e){var d=n?n[s]:s;i=a(i,t[d],d,t)}return i}return function(a,i,n,s){i=C(i,s,4);var o=!N(a)&&w.keys(a),d=(o||a).length,c=0<e?0:d-1;return 3>arguments.length&&(n=a[o?o[c]:c],c+=e),t(a,i,n,o,c,d)}}function t(e){return function(t,a,i){a=S(a,i);for(var n=M(t),s=0<e?0:n-1;0<=s&&s<n;s+=e)if(a(t[s],s,t))return s;return-1}}function a(e,t,a){return function(n,d,c){var r=0,l=M(n);if("number"==typeof c)0<e?r=0<=c?c:o(c+l,r):l=0<=c?s(c+1,l):c+l+1;else if(a&&c&&l)return c=a(n,d),n[c]===d?c:-1;if(d!==d)return c=t(m.call(n,r,l),w.isNaN),0<=c?c+r:-1;for(c=0<e?r:l-1;0<=c&&c<l;c+=e)if(n[c]===d)return c;return-1}}function i(e,t){var a=D.length,i=e.constructor,n=w.isFunction(i)&&i.prototype||l,s="constructor";for(w.has(e,s)&&!w.contains(t,s)&&t.push(s);a--;)s=D[a],s in e&&e[s]!==n[s]&&!w.contains(t,s)&&t.push(s)}var d=this,c=d._,r=Array.prototype,l=Object.prototype,p=Function.prototype,u=r.push,m=r.slice,g=l.toString,h=l.hasOwnProperty,v=Array.isArray,A=Object.keys,f=p.bind,b=Object.create,x=function(){},w=function(e){return e instanceof w?e:this instanceof w?void(this._wrapped=e):new w(e)};"undefined"==typeof exports?d._=w:("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w),w.VERSION="1.8.3";var C=function(e,t,a){if(void 0===t)return e;switch(null==a?3:a){case 1:return function(a){return e.call(t,a)};case 2:return function(a,i){return e.call(t,a,i)};case 3:return function(a,i,n){return e.call(t,a,i,n)};case 4:return function(a,i,n,s){return e.call(t,a,i,n,s)};}return function(){return e.apply(t,arguments)}},S=function(e,t,a){return null==e?w.identity:w.isFunction(e)?C(e,t,a):w.isObject(e)?w.matcher(e):w.property(e)};w.iteratee=function(e,t){return S(e,t,1/0)};var k=function(e,t){return function(a){var n=arguments.length;if(2>n||null==a)return a;for(var s=1;s<n;s++)for(var o=arguments[s],d=e(o),c=d.length,r=0,l;r<c;r++)l=d[r],t&&void 0!==a[l]||(a[l]=o[l]);return a}},E=function(e){if(!w.isObject(e))return{};if(b)return b(e);x.prototype=e;var t=new x;return x.prototype=null,t},T=function(e){return function(t){return null==t?void 0:t[e]}},I=Math.pow(2,53)-1,M=T("length"),N=function(e){var t=M(e);return"number"==typeof t&&0<=t&&t<=I};w.each=w.forEach=function(e,t,a){t=C(t,a);var n,s;if(N(e))for(n=0,s=e.length;n<s;n++)t(e[n],n,e);else{var o=w.keys(e);for(n=0,s=o.length;n<s;n++)t(e[o[n]],o[n],e)}return e},w.map=w.collect=function(e,t,a){t=S(t,a);for(var i=!N(e)&&w.keys(e),n=(i||e).length,s=Array(n),o=0,d;o<n;o++)d=i?i[o]:o,s[o]=t(e[d],d,e);return s},w.reduce=w.foldl=w.inject=e(1),w.reduceRight=w.foldr=e(-1),w.find=w.detect=function(e,t,a){var i;if(i=N(e)?w.findIndex(e,t,a):w.findKey(e,t,a),void 0!==i&&-1!==i)return e[i]},w.filter=w.select=function(e,t,a){var i=[];return t=S(t,a),w.each(e,function(e,a,n){t(e,a,n)&&i.push(e)}),i},w.reject=function(e,t,a){return w.filter(e,w.negate(S(t)),a)},w.every=w.all=function(e,t,a){t=S(t,a);for(var i=!N(e)&&w.keys(e),n=(i||e).length,s=0,o;s<n;s++)if(o=i?i[s]:s,!t(e[o],o,e))return!1;return!0},w.some=w.any=function(e,t,a){t=S(t,a);for(var i=!N(e)&&w.keys(e),n=(i||e).length,s=0,o;s<n;s++)if(o=i?i[s]:s,t(e[o],o,e))return!0;return!1},w.contains=w.includes=w.include=function(e,t,a,i){return N(e)||(e=w.values(e)),("number"!=typeof a||i)&&(a=0),0<=w.indexOf(e,t,a)},w.invoke=function(e,t){var a=m.call(arguments,2),i=w.isFunction(t);return w.map(e,function(e){var n=i?t:e[t];return null==n?n:n.apply(e,a)})},w.pluck=function(e,t){return w.map(e,w.property(t))},w.where=function(e,t){return w.filter(e,w.matcher(t))},w.findWhere=function(e,t){return w.find(e,w.matcher(t))},w.max=function(e,t,a){var n=-Infinity,s=-Infinity,o,d;if(null==t&&null!=e){e=N(e)?e:w.values(e);for(var c=0,r=e.length;c<r;c++)o=e[c],o>n&&(n=o)}else t=S(t,a),w.each(e,function(e,a,i){d=t(e,a,i),(d>s||d===-Infinity&&n===-Infinity)&&(n=e,s=d)});return n},w.min=function(e,t,a){var n=1/0,s=1/0,o,d;if(null==t&&null!=e){e=N(e)?e:w.values(e);for(var c=0,r=e.length;c<r;c++)o=e[c],o<n&&(n=o)}else t=S(t,a),w.each(e,function(e,a,i){d=t(e,a,i),(d<s||d===1/0&&n===1/0)&&(n=e,s=d)});return n},w.shuffle=function(e){for(var t=N(e)?e:w.values(e),a=t.length,i=Array(a),n=0,s;n<a;n++)s=w.random(0,n),s!==n&&(i[n]=i[s]),i[s]=t[n];return i},w.sample=function(e,t,a){return null==t||a?(N(e)||(e=w.values(e)),e[w.random(e.length-1)]):w.shuffle(e).slice(0,o(0,t))},w.sortBy=function(e,t,a){return t=S(t,a),w.pluck(w.map(e,function(e,a,i){return{value:e,index:a,criteria:t(e,a,i)}}).sort(function(e,t){var i=e.criteria,a=t.criteria;if(i!==a){if(i>a||void 0===i)return 1;if(i<a||void 0===a)return-1}return e.index-t.index}),"value")};var R=function(e){return function(t,a,i){var n={};return a=S(a,i),w.each(t,function(i,s){var o=a(i,s,t);e(n,i,o)}),n}};w.groupBy=R(function(e,t,a){w.has(e,a)?e[a].push(t):e[a]=[t]}),w.indexBy=R(function(e,t,a){e[a]=t}),w.countBy=R(function(e,t,a){w.has(e,a)?e[a]++:e[a]=1}),w.toArray=function(e){return e?w.isArray(e)?m.call(e):N(e)?w.map(e,w.identity):w.values(e):[]},w.size=function(e){return null==e?0:N(e)?e.length:w.keys(e).length},w.partition=function(e,t,a){t=S(t,a);var i=[],n=[];return w.each(e,function(e,a,s){(t(e,a,s)?i:n).push(e)}),[i,n]},w.first=w.head=w.take=function(e,t,a){return null==e?void 0:null==t||a?e[0]:w.initial(e,e.length-t)},w.initial=function(e,t,a){return m.call(e,0,o(0,e.length-(null==t||a?1:t)))},w.last=function(e,t,a){return null==e?void 0:null==t||a?e[e.length-1]:w.rest(e,o(0,e.length-t))},w.rest=w.tail=w.drop=function(e,t,a){return m.call(e,null==t||a?1:t)},w.compact=function(e){return w.filter(e,w.identity)};var O=function(e,t,a,n){for(var s=[],o=0,d=n||0,c=M(e),r;d<c;d++)if(r=e[d],N(r)&&(w.isArray(r)||w.isArguments(r))){t||(r=O(r,t,a));var l=0,p=r.length;for(s.length+=p;l<p;)s[o++]=r[l++]}else a||(s[o++]=r);return s};w.flatten=function(e,t){return O(e,t,!1)},w.without=function(e){return w.difference(e,m.call(arguments,1))},w.uniq=w.unique=function(e,t,a,n){w.isBoolean(t)||(n=a,a=t,t=!1),null!=a&&(a=S(a,n));for(var s=[],o=[],d=0,c=M(e);d<c;d++){var r=e[d],l=a?a(r,d,e):r;t?((!d||o!==l)&&s.push(r),o=l):a?!w.contains(o,l)&&(o.push(l),s.push(r)):!w.contains(s,r)&&s.push(r)}return s},w.union=function(){return w.uniq(O(arguments,!0,!0))},w.intersection=function(e){for(var t=[],a=arguments.length,n=0,s=M(e),o;n<s;n++)if(o=e[n],!w.contains(t,o)){for(var d=1;d<a&&!!w.contains(arguments[d],o);d++);d===a&&t.push(o)}return t},w.difference=function(e){var t=O(arguments,!0,!0,1);return w.filter(e,function(e){return!w.contains(t,e)})},w.zip=function(){return w.unzip(arguments)},w.unzip=function(e){for(var t=e&&w.max(e,M).length||0,a=Array(t),i=0;i<t;i++)a[i]=w.pluck(e,i);return a},w.object=function(e,t){for(var a={},n=0,s=M(e);n<s;n++)t?a[e[n]]=t[n]:a[e[n][0]]=e[n][1];return a},w.findIndex=t(1),w.findLastIndex=t(-1),w.sortedIndex=function(e,t,a,i){a=S(a,i,1);for(var s=a(t),o=0,d=M(e);o<d;){var c=n((o+d)/2);a(e[c])<s?o=c+1:d=c}return o},w.indexOf=a(1,w.findIndex,w.sortedIndex),w.lastIndexOf=a(-1,w.findLastIndex),w.range=function(e,t,a){null==t&&(t=e||0,e=0),a=a||1;for(var i=o(Math.ceil((t-e)/a),0),n=Array(i),s=0;s<i;s++,e+=a)n[s]=e;return n};var j=function(e,t,a,i,n){if(!(i instanceof t))return e.apply(a,n);var s=E(e.prototype),o=e.apply(s,n);return w.isObject(o)?o:s};w.bind=function(e,t){if(f&&e.bind===f)return f.apply(e,m.call(arguments,1));if(!w.isFunction(e))throw new TypeError("Bind must be called on a function");var a=m.call(arguments,2),i=function(){return j(e,i,t,this,a.concat(m.call(arguments)))};return i},w.partial=function(e){var t=m.call(arguments,1),a=function(){for(var n=0,s=t.length,o=Array(s),d=0;d<s;d++)o[d]=t[d]===w?arguments[n++]:t[d];for(;n<arguments.length;)o.push(arguments[n++]);return j(e,a,this,this,o)};return a},w.bindAll=function(e){var t=arguments.length,a,n;if(1>=t)throw new Error("bindAll must be passed function names");for(a=1;a<t;a++)n=arguments[a],e[n]=w.bind(e[n],e);return e},w.memoize=function(e,t){var a=function(i){var n=a.cache,s=""+(t?t.apply(this,arguments):i);return w.has(n,s)||(n[s]=e.apply(this,arguments)),n[s]};return a.cache={},a},w.delay=function(e,t){var a=m.call(arguments,2);return setTimeout(function(){return e.apply(null,a)},t)},w.defer=w.partial(w.delay,w,1),w.throttle=function(e,t,a){var i=null,n=0,s,o,d;a||(a={});var c=function(){n=!1===a.leading?0:w.now(),i=null,d=e.apply(s,o),i||(s=o=null)};return function(){var r=w.now();n||!1!==a.leading||(n=r);var l=t-(r-n);return s=this,o=arguments,0>=l||l>t?(i&&(clearTimeout(i),i=null),n=r,d=e.apply(s,o),!i&&(s=o=null)):!i&&!1!==a.trailing&&(i=setTimeout(c,l)),d}},w.debounce=function(e,t,a){var i=function(){var r=w.now()-d;r<t&&0<=r?n=setTimeout(i,t-r):(n=null,!a&&(c=e.apply(o,s),!n&&(o=s=null)))},n,s,o,d,c;return function(){o=this,s=arguments,d=w.now();var r=a&&!n;return n||(n=setTimeout(i,t)),r&&(c=e.apply(o,s),o=s=null),c}},w.wrap=function(e,t){return w.partial(t,e)},w.negate=function(e){return function(){return!e.apply(this,arguments)}},w.compose=function(){var e=arguments,t=e.length-1;return function(){for(var a=t,n=e[t].apply(this,arguments);a--;)n=e[a].call(this,n);return n}},w.after=function(e,t){return function(){if(1>--e)return t.apply(this,arguments)}},w.before=function(e,t){var a;return function(){return 0<--e&&(a=t.apply(this,arguments)),1>=e&&(t=null),a}},w.once=w.partial(w.before,2);var P=!{toString:null}.propertyIsEnumerable("toString"),D=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];w.keys=function(e){if(!w.isObject(e))return[];if(A)return A(e);var t=[];for(var a in e)w.has(e,a)&&t.push(a);return P&&i(e,t),t},w.allKeys=function(e){if(!w.isObject(e))return[];var t=[];for(var a in e)t.push(a);return P&&i(e,t),t},w.values=function(e){for(var t=w.keys(e),a=t.length,n=Array(a),s=0;s<a;s++)n[s]=e[t[s]];return n},w.mapObject=function(e,t,a){t=S(t,a);for(var i=w.keys(e),n=i.length,s={},o=0,d;o<n;o++)d=i[o],s[d]=t(e[d],d,e);return s},w.pairs=function(e){for(var t=w.keys(e),a=t.length,n=Array(a),s=0;s<a;s++)n[s]=[t[s],e[t[s]]];return n},w.invert=function(e){for(var t={},a=w.keys(e),n=0,s=a.length;n<s;n++)t[e[a[n]]]=a[n];return t},w.functions=w.methods=function(e){var t=[];for(var a in e)w.isFunction(e[a])&&t.push(a);return t.sort()},w.extend=k(w.allKeys),w.extendOwn=w.assign=k(w.keys),w.findKey=function(e,t,a){t=S(t,a);for(var n=w.keys(e),s=0,o=n.length,d;s<o;s++)if(d=n[s],t(e[d],d,e))return d},w.pick=function(e,t,a){var n={},s=e,o,d;if(null==s)return n;w.isFunction(t)?(d=w.allKeys(s),o=C(t,a)):(d=O(arguments,!1,!1,1),o=function(e,t,a){return t in a},s=Object(s));for(var c=0,r=d.length;c<r;c++){var l=d[c],p=s[l];o(p,l,s)&&(n[l]=p)}return n},w.omit=function(e,t,a){if(w.isFunction(t))t=w.negate(t);else{var i=w.map(O(arguments,!1,!1,1),String);t=function(e,t){return!w.contains(i,t)}}return w.pick(e,t,a)},w.defaults=k(w.allKeys,!0),w.create=function(e,t){var a=E(e);return t&&w.extendOwn(a,t),a},w.clone=function(e){return w.isObject(e)?w.isArray(e)?e.slice():w.extend({},e):e},w.tap=function(e,t){return t(e),e},w.isMatch=function(e,t){var a=w.keys(t),n=a.length;if(null==e)return!n;for(var s=Object(e),o=0,d;o<n;o++)if(d=a[o],t[d]!==s[d]||!(d in s))return!1;return!0};var B=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof w&&(e=e._wrapped),t instanceof w&&(t=t._wrapped);var s=g.call(e);if(s!==g.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e==+e?0==+e?1/+e==1/t:+e==+t:+t!=+t;case"[object Date]":case"[object Boolean]":return+e==+t;}var o="[object Array]"===s;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var d=e.constructor,c=t.constructor;if(d!==c&&!(w.isFunction(d)&&d instanceof d&&w.isFunction(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}i=i||[],n=n||[];for(var r=i.length;r--;)if(i[r]===e)return n[r]===t;if(i.push(e),n.push(t),o){if(r=e.length,r!==t.length)return!1;for(;r--;)if(!B(e[r],t[r],i,n))return!1}else{var l=w.keys(e),p;if(r=l.length,w.keys(t).length!==r)return!1;for(;r--;)if(p=l[r],!(w.has(t,p)&&B(e[p],t[p],i,n)))return!1}return i.pop(),n.pop(),!0};w.isEqual=function(e,t){return B(e,t)},w.isEmpty=function(e){return!(null!=e)||(N(e)&&(w.isArray(e)||w.isString(e)||w.isArguments(e))?0===e.length:0===w.keys(e).length)},w.isElement=function(e){return!!(e&&1===e.nodeType)},w.isArray=v||function(e){return"[object Array]"===g.call(e)},w.isObject=function(e){var t=typeof e;return"function"==t||"object"===t&&!!e},w.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){w["is"+e]=function(t){return g.call(t)==="[object "+e+"]"}}),w.isArguments(arguments)||(w.isArguments=function(e){return w.has(e,"callee")}),"function"!=typeof /./&&"object"!=typeof Int8Array&&(w.isFunction=function(e){return"function"==typeof e||!1}),w.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},w.isNaN=function(e){return w.isNumber(e)&&e!==+e},w.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===g.call(e)},w.isNull=function(e){return null===e},w.isUndefined=function(e){return void 0===e},w.has=function(e,t){return null!=e&&h.call(e,t)},w.noConflict=function(){return d._=c,this},w.identity=function(e){return e},w.constant=function(e){return function(){return e}},w.noop=function(){},w.property=T,w.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},w.matcher=w.matches=function(e){return e=w.extendOwn({},e),function(t){return w.isMatch(t,e)}},w.times=function(e,t,a){var n=Array(o(0,e));t=C(t,a,1);for(var s=0;s<e;s++)n[s]=t(s);return n},w.random=function(e,t){return null==t&&(t=e,e=0),e+n(Math.random()*(t-e+1))},w.now=Date.now||function(){return new Date().getTime()};var L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},V=w.invert(L),H=function(e){var t=function(t){return e[t]},a="(?:"+w.keys(e).join("|")+")",i=RegExp(a),n=RegExp(a,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(n,t):e}};w.escape=H(L),w.unescape=H(V),w.result=function(e,t,a){var i=null==e?void 0:e[t];return void 0===i&&(i=a),w.isFunction(i)?i.call(e):i};var q=0;w.uniqueId=function(e){var t=++q+"";return e?e+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,U={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},G=function(e){return"\\"+U[e]};w.template=function(e,t,a){!t&&a&&(t=a),t=w.defaults({},t,w.templateSettings);var i=RegExp([(t.escape||F).source,(t.interpolate||F).source,(t.evaluate||F).source].join("|")+"|$","g"),n=0,s="__p+='";e.replace(i,function(t,a,i,o,d){return s+=e.slice(n,d).replace(/\\|'|\r|\n|\u2028|\u2029/g,G),n=d+t.length,a?s+="'+\n((__t=("+a+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(t){throw t.source=s,t}var d=function(e){return o.call(this,e,w)},c=t.variable||"obj";return d.source="function("+c+"){\n"+s+"}",d},w.chain=function(e){var t=w(e);return t._chain=!0,t};var z=function(e,t){return e._chain?w(t).chain():t};w.mixin=function(e){w.each(w.functions(e),function(t){var a=w[t]=e[t];w.prototype[t]=function(){var e=[this._wrapped];return u.apply(e,arguments),z(this,a.apply(w,e))}})},w.mixin(w),w.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];w.prototype[e]=function(){var a=this._wrapped;return t.apply(a,arguments),("shift"===e||"splice"===e)&&0===a.length&&delete a[0],z(this,a)}}),w.each(["concat","join","slice"],function(e){var t=r[e];w.prototype[e]=function(){return z(this,t.apply(this._wrapped,arguments))}}),w.prototype.value=function(){return this._wrapped},w.prototype.valueOf=w.prototype.toJSON=w.prototype.value,w.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return w})}.call(this),function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"==typeof window?this:window,function(e,t){var te=Math.cos,ae=Math.PI,ie=String.fromCharCode,ne=Math.max;function a(e,t){t=t||oe;var a=t.createElement("script");a.text=e,t.head.appendChild(a).parentNode.removeChild(a)}function n(e){var t=!!e&&"length"in e&&e.length,a=_e.type(e);return!("function"===a||_e.isWindow(e))&&("array"===a||0===t||"number"==typeof t&&0<t&&t-1 in e)}function s(e,t,a){if(_e.isFunction(t))return _e.grep(e,function(e,n){return!!t.call(e,n,e)!==a});if(t.nodeType)return _e.grep(e,function(e){return e===t!==a});if("string"==typeof t){if(ke.test(t))return _e.filter(t,e,a);t=_e.filter(t,e)}return _e.grep(e,function(e){return-1<pe.call(t,e)!==a&&1===e.nodeType})}function o(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function d(e){var t={};return _e.each(e.match(Me)||[],function(e,a){t[a]=!0}),t}function c(e){return e}function r(e){throw e}function l(e,t,a){var i;try{e&&_e.isFunction(i=e.promise)?i.call(e).done(t).fail(a):e&&_e.isFunction(i=e.then)?i.call(e,t,a):t.call(void 0,e)}catch(e){a.call(void 0,e)}}function p(){oe.removeEventListener("DOMContentLoaded",p),e.removeEventListener("load",p),_e.ready()}function u(){this.expando=_e.expando+u.uid++}function m(e,t,a){var i;if(void 0===a&&1===e.nodeType)if(i="data-"+t.replace(Be,"-$&").toLowerCase(),a=e.getAttribute(i),"string"==typeof a){try{a="true"===a||"false"!==a&&("null"===a?null:+a+""===a?+a:De.test(a)?JSON.parse(a):a)}catch(t){}Pe.set(e,t,a)}else a=void 0;return a}function g(e,t,a,i){var n=1,s=20,o=i?function(){return i.cur()}:function(){return _e.css(e,t,"")},d=o(),c=a&&a[3]||(_e.cssNumber[t]?"":"px"),r=(_e.cssNumber[t]||"px"!==c&&+d)&&$e.exec(_e.css(e,t)),l;if(r&&r[3]!==c){c=c||r[3],a=a||[],r=+d||1;do n=n||".5",r/=n,_e.style(e,t,r+c);while(n!==(n=o()/d)&&1!==n&&--s)}return a&&(r=+r||+d||0,l=a[1]?r+(a[1]+1)*a[2]:+a[2],i&&(i.unit=c,i.start=r,i.end=l)),l}function h(e){var t=e.ownerDocument,a=e.nodeName,i=Fe[a],n;return i?i:(n=t.body.appendChild(t.createElement(a)),i=_e.css(n,"display"),n.parentNode.removeChild(n),"none"===i&&(i="block"),Fe[a]=i,i)}function v(e,t){for(var a=[],i=0,n=e.length,s,o;i<n;i++)(o=e[i],!!o.style)&&(s=o.style.display,t?("none"===s&&(a[i]=je.get(o,"display")||null,!a[i]&&(o.style.display="")),""===o.style.display&&He(o)&&(a[i]=h(o))):"none"!==s&&(a[i]="none",je.set(o,"display",s)));for(i=0;i<n;i++)null!=a[i]&&(e[i].style.display=a[i]);return e}function A(e,t){var a="undefined"==typeof e.getElementsByTagName?"undefined"==typeof e.querySelectorAll?[]:e.querySelectorAll(t||"*"):e.getElementsByTagName(t||"*");return void 0===t||t&&_e.nodeName(e,t)?_e.merge([e],a):a}function f(e,t){for(var a=0,n=e.length;a<n;a++)je.set(e[a],"globalEval",!t||je.get(t[a],"globalEval"))}function b(e,t,a,n,s){for(var o=t.createDocumentFragment(),d=[],c=0,r=e.length,l,p,u,m,g,h;c<r;c++)if(l=e[c],l||0===l)if("object"===_e.type(l))_e.merge(d,l.nodeType?[l]:l);else if(!We.test(l))d.push(t.createTextNode(l));else{for(p=p||o.appendChild(t.createElement("div")),u=(Ge.exec(l)||["",""])[1].toLowerCase(),m=Ye[u]||Ye._default,p.innerHTML=m[1]+_e.htmlPrefilter(l)+m[2],h=m[0];h--;)p=p.lastChild;_e.merge(d,p.childNodes),p=o.firstChild,p.textContent=""}for(o.textContent="",c=0;l=d[c++];){if(n&&-1<_e.inArray(l,n)){s&&s.push(l);continue}if(g=_e.contains(l.ownerDocument,l),p=A(o.appendChild(l),"script"),g&&f(p),a)for(h=0;l=p[h++];)ze.test(l.type||"")&&a.push(l)}return o}function x(){return!0}function w(){return!1}function C(){try{return oe.activeElement}catch(e){}}function S(e,t,a,i,n,s){var o,d;if("object"==typeof t){for(d in"string"!=typeof a&&(i=i||a,a=void 0),t)S(e,d,a,i,t[d],s);return e}if(null==i&&null==n?(n=a,i=a=void 0):null==n&&("string"==typeof a?(n=i,i=void 0):(n=i,i=a,a=void 0)),!1===n)n=w;else if(!n)return e;return 1===s&&(o=n,n=function(e){return _e().off(e),o.apply(this,arguments)},n.guid=o.guid||(o.guid=_e.guid++)),e.each(function(){_e.event.add(this,t,n,i,a)})}function i(e,t){return _e.nodeName(e,"table")&&_e.nodeName(11===t.nodeType?t.firstChild:t,"tr")?e.getElementsByTagName("tbody")[0]||e:e}function k(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function E(e){var t=Ze.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function T(e,t){var a,n,s,o,d,c,r,p;if(1===t.nodeType){if(je.hasData(e)&&(o=je.access(e),d=je.set(t,o),p=o.events,p))for(s in delete d.handle,d.events={},p)for(a=0,n=p[s].length;a<n;a++)_e.event.add(t,s,p[s][a]);Pe.hasData(e)&&(c=Pe.access(e),r=_e.extend({},c),Pe.set(t,r))}}function I(e,t){var a=t.nodeName.toLowerCase();"input"===a&&Ue.test(e.type)?t.checked=e.checked:("input"===a||"textarea"===a)&&(t.defaultValue=e.defaultValue)}function M(e,t,n,s){t=re.apply([],t);var o=0,d=e.length,c=t[0],r=_e.isFunction(c),l,p,u,m,g,h;if(r||1<d&&"string"==typeof c&&!Ae.checkClone&&Je.test(c))return e.each(function(a){var i=e.eq(a);r&&(t[0]=c.call(this,a,i.html())),M(i,t,n,s)});if(d&&(l=b(t,e[0].ownerDocument,!1,e,s),p=l.firstChild,1===l.childNodes.length&&(l=p),p||s)){for(u=_e.map(A(l,"script"),k),m=u.length;o<d;o++)g=l,o!==d-1&&(g=_e.clone(g,!0,!0),m&&_e.merge(u,A(g,"script"))),n.call(e[o],g,o);if(m)for(h=u[u.length-1].ownerDocument,_e.map(u,E),o=0;o<m;o++)g=u[o],ze.test(g.type||"")&&!je.access(g,"globalEval")&&_e.contains(h,g)&&(g.src?_e._evalUrl&&_e._evalUrl(g.src):a(g.textContent.replace(Ke,""),h))}return e}function N(e,t,a){for(var n=t?_e.filter(t,e):e,s=0,o;null!=(o=n[s]);s++)a||1!==o.nodeType||_e.cleanData(A(o)),o.parentNode&&(a&&_e.contains(o.ownerDocument,o)&&f(A(o,"script")),o.parentNode.removeChild(o));return e}function R(e,t,a){var i=e.style,n,s,o,d;return a=a||at(e),a&&(d=a.getPropertyValue(t)||a[t],""===d&&!_e.contains(e.ownerDocument,e)&&(d=_e.style(e,t)),!Ae.pixelMarginRight()&&tt.test(d)&&et.test(t)&&(n=i.width,s=i.minWidth,o=i.maxWidth,i.minWidth=i.maxWidth=i.width=d,d=a.width,i.width=n,i.minWidth=s,i.maxWidth=o)),void 0===d?d:d+""}function O(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function j(e){if(e in ot)return e;for(var t=e[0].toUpperCase()+e.slice(1),a=st.length;a--;)if(e=st[a]+t,e in ot)return e}function P(e,t,a){var i=$e.exec(t);return i?ne(0,i[2]-(a||0))+(i[3]||"px"):t}function D(e,t,a,n,s){for(var o=a===(n?"border":"content")?4:"width"===t?1:0,d=0;4>o;o+=2)"margin"===a&&(d+=_e.css(e,a+Ve[o],!0,s)),n?("content"===a&&(d-=_e.css(e,"padding"+Ve[o],!0,s)),"margin"!==a&&(d-=_e.css(e,"border"+Ve[o]+"Width",!0,s))):(d+=_e.css(e,"padding"+Ve[o],!0,s),"padding"!==a&&(d+=_e.css(e,"border"+Ve[o]+"Width",!0,s)));return d}function B(e,t,a){var i=!0,n=at(e),s="border-box"===_e.css(e,"boxSizing",!1,n),o;if(e.getClientRects().length&&(o=e.getBoundingClientRect()[t]),0>=o||null==o){if(o=R(e,t,n),(0>o||null==o)&&(o=e.style[t]),tt.test(o))return o;i=s&&(Ae.boxSizingReliable()||o===e.style[t]),o=parseFloat(o)||0}return o+D(e,t,a||(s?"border":"content"),i,n)+"px"}function L(e,t,a,i,n){return new L.prototype.init(e,t,a,i,n)}function V(){rt&&(e.requestAnimationFrame(V),_e.fx.tick())}function H(){return e.setTimeout(function(){ct=void 0}),ct=_e.now()}function q(e,t){var a=0,n={height:e},s;for(t=t?1:0;4>a;a+=2-t)s=Ve[a],n["margin"+s]=n["padding"+s]=e;return t&&(n.opacity=n.width=e),n}function F(e,t,a){for(var i=(z.tweeners[t]||[]).concat(z.tweeners["*"]),n=0,s=i.length,o;n<s;n++)if(o=i[n].call(a,t,e))return o}function U(e,t,a){var i="width"in t||"height"in t,n=this,s={},o=e.style,d=e.nodeType&&He(e),c=je.get(e,"fxshow"),r,l,p,u,m,g,h,A;for(r in a.queue||(u=_e._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,m=u.empty.fire,u.empty.fire=function(){u.unqueued||m()}),u.unqueued++,n.always(function(){n.always(function(){u.unqueued--,_e.queue(e,"fx").length||u.empty.fire()})})),t)if(l=t[r],dt.test(l)){if(delete t[r],p=p||"toggle"===l,l===(d?"hide":"show"))if("show"===l&&c&&void 0!==c[r])d=!0;else continue;s[r]=c&&c[r]||_e.style(e,r)}if(g=!_e.isEmptyObject(t),g||!_e.isEmptyObject(s))for(r in i&&1===e.nodeType&&(a.overflow=[o.overflow,o.overflowX,o.overflowY],h=c&&c.display,null==h&&(h=je.get(e,"display")),A=_e.css(e,"display"),"none"===A&&(h?A=h:(v([e],!0),h=e.style.display||h,A=_e.css(e,"display"),v([e]))),("inline"===A||"inline-block"===A&&null!=h)&&"none"===_e.css(e,"float")&&(!g&&(n.done(function(){o.display=h}),null==h&&(A=o.display,h="none"===A?"":A)),o.display="inline-block")),a.overflow&&(o.overflow="hidden",n.always(function(){o.overflow=a.overflow[0],o.overflowX=a.overflow[1],o.overflowY=a.overflow[2]})),g=!1,s)g||(c?"hidden"in c&&(d=c.hidden):c=je.access(e,"fxshow",{display:h}),p&&(c.hidden=!d),d&&v([e],!0),n.done(function(){for(r in d||v([e]),je.remove(e,"fxshow"),s)_e.style(e,r,s[r])})),g=F(d?c[r]:0,r,n),r in c||(c[r]=g.start,d&&(g.end=g.start,g.start=0))}function G(e,t){var a,i,n,s,o;for(a in e)if(i=_e.camelCase(a),n=t[i],s=e[a],_e.isArray(s)&&(n=s[1],s=e[a]=s[0]),a!==i&&(e[i]=s,delete e[a]),o=_e.cssHooks[i],o&&"expand"in o)for(a in s=o.expand(s),delete e[i],s)a in e||(e[a]=s[a],t[a]=n);else t[i]=n}function z(e,t,a){var i=0,n=z.prefilters.length,s=_e.Deferred().always(function(){delete o.elem}),o=function(){if(l)return!1;for(var t=ct||H(),a=ne(0,d.startTime+d.duration-t),i=a/d.duration||0,n=1-i,o=0,c=d.tweens.length;o<c;o++)d.tweens[o].run(n);return s.notifyWith(e,[d,n,a]),1>n&&c?a:(s.resolveWith(e,[d]),!1)},d=s.promise({elem:e,props:_e.extend({},t),opts:_e.extend(!0,{specialEasing:{},easing:_e.easing._default},a),originalProperties:t,originalOptions:a,startTime:ct||H(),duration:a.duration,tweens:[],createTween:function(t,a){var i=_e.Tween(e,d.opts,t,a,d.opts.specialEasing[t]||d.opts.easing);return d.tweens.push(i),i},stop:function(t){var a=0,i=t?d.tweens.length:0;if(l)return this;for(l=!0;a<i;a++)d.tweens[a].run(1);return t?(s.notifyWith(e,[d,1,0]),s.resolveWith(e,[d,t])):s.rejectWith(e,[d,t]),this}}),c=d.props,r,l;for(G(c,d.opts.specialEasing);i<n;i++)if(r=z.prefilters[i].call(d,e,c,d.opts),r)return _e.isFunction(r.stop)&&(_e._queueHooks(d.elem,d.opts.queue).stop=_e.proxy(r.stop,r)),r;return _e.map(c,F,d),_e.isFunction(d.opts.start)&&d.opts.start.call(e,d),_e.fx.timer(_e.extend(o,{elem:e,anim:d,queue:d.opts.queue})),d.progress(d.opts.progress).done(d.opts.done,d.opts.complete).fail(d.opts.fail).always(d.opts.always)}function Y(e){return e.getAttribute&&e.getAttribute("class")||""}function W(e,t,a,n){if(_e.isArray(t))_e.each(t,function(t,i){a||At.test(e)?n(e,i):W(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,a,n)});else if(!a&&"object"===_e.type(t))for(var s in t)W(e+"["+s+"]",t[s],a,n);else n(e,t)}function Q(e){return function(t,a){"string"!=typeof t&&(a=t,t="*");var n=0,s=t.toLowerCase().match(Me)||[],o;if(_e.isFunction(a))for(;o=s[n++];)"+"===o[0]?(o=o.slice(1)||"*",(e[o]=e[o]||[]).unshift(a)):(e[o]=e[o]||[]).push(a)}}function X(e,t,a,i){function n(d){var c;return s[d]=!0,_e.each(e[d]||[],function(e,d){var r=d(t,a,i);return"string"!=typeof r||o||s[r]?o?!(c=r):void 0:(t.dataTypes.unshift(r),n(r),!1)}),c}var s={},o=e===bt;return n(t.dataTypes[0])||!s["*"]&&n("*")}function J(e,t){var a=_e.ajaxSettings.flatOptions||{},i,n;for(i in t)void 0!==t[i]&&((a[i]?e:n||(n={}))[i]=t[i]);return n&&_e.extend(!0,e,n),e}function Z(e,t,a){for(var i=e.contents,n=e.dataTypes,s,o,d,c;"*"===n[0];)n.shift(),void 0===s&&(s=e.mimeType||t.getResponseHeader("Content-Type"));if(s)for(o in i)if(i[o]&&i[o].test(s)){n.unshift(o);break}if(n[0]in a)d=n[0];else{for(o in a){if(!n[0]||e.converters[o+" "+n[0]]){d=o;break}c||(c=o)}d=d||c}return d?(d!==n[0]&&n.unshift(d),a[d]):void 0}function K(e,t,a,i){var n={},s=e.dataTypes.slice(),o,d,c,r,l;if(s[1])for(c in e.converters)n[c.toLowerCase()]=e.converters[c];for(d=s.shift();d;)if(e.responseFields[d]&&(a[e.responseFields[d]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=d,d=s.shift(),d)if("*"===d)d=l;else if("*"!==l&&l!==d){if(c=n[l+" "+d]||n["* "+d],!c)for(o in n)if(r=o.split(" "),r[1]===d&&(c=n[l+" "+r[0]]||n["* "+r[0]],c)){!0===c?c=n[o]:!0!==n[o]&&(d=r[0],s.unshift(r[1]));break}if(!0!==c)if(c&&e.throws)t=c(t);else try{t=c(t)}catch(t){return{state:"parsererror",error:c?t:"No conversion from "+l+" to "+d}}}return{state:"success",data:t}}function ee(e){return _e.isWindow(e)?e:9===e.nodeType&&e.defaultView}var se=[],oe=e.document,de=Object.getPrototypeOf,ce=se.slice,re=se.concat,le=se.push,pe=se.indexOf,ue={},me=ue.toString,ge=ue.hasOwnProperty,he=ge.toString,ve=he.call(Object),Ae={},fe="3.0.0",_e=function(e,t){return new _e.fn.init(e,t)},be=function(e,t){return t.toUpperCase()};_e.fn=_e.prototype={jquery:fe,constructor:_e,length:0,toArray:function(){return ce.call(this)},get:function(e){return null==e?ce.call(this):0>e?this[e+this.length]:this[e]},pushStack:function(e){var t=_e.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return _e.each(this,e)},map:function(e){return this.pushStack(_e.map(this,function(t,a){return e.call(t,a,t)}))},slice:function(){return this.pushStack(ce.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,a=+e+(0>e?t:0);return this.pushStack(0<=a&&a<t?[this[a]]:[])},end:function(){return this.prevObject||this.constructor()},push:le,sort:se.sort,splice:se.splice},_e.extend=_e.fn.extend=function(){var e=arguments[0]||{},t=1,a=arguments.length,n=!1,s,o,d,c,r,l;for("boolean"==typeof e&&(n=e,e=arguments[t]||{},t++),"object"==typeof e||_e.isFunction(e)||(e={}),t===a&&(e=this,t--);t<a;t++)if(null!=(s=arguments[t]))for(o in s)(d=e[o],c=s[o],e!==c)&&(n&&c&&(_e.isPlainObject(c)||(r=_e.isArray(c)))?(r?(r=!1,l=d&&_e.isArray(d)?d:[]):l=d&&_e.isPlainObject(d)?d:{},e[o]=_e.extend(n,l,c)):void 0!==c&&(e[o]=c));return e},_e.extend({expando:"jQuery"+(fe+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===_e.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=_e.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,a;return!!(e&&"[object Object]"===me.call(e))&&((t=de(e),!!!t)||(a=ge.call(t,"constructor")&&t.constructor,"function"==typeof a&&he.call(a)===ve))},isEmptyObject:function(e){for(var t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?ue[me.call(e)]||"object":typeof e},globalEval:function(e){a(e)},camelCase:function(e){return e.replace(/^-ms-/,"ms-").replace(/-([a-z])/g,be)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var a=0,s;if(n(e))for(s=e.length;a<s&&!1!==t.call(e[a],a,e[a]);a++);else for(a in e)if(!1===t.call(e[a],a,e[a]))break;return e},trim:function(e){return null==e?"":(e+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},makeArray:function(e,t){var a=t||[];return null!=e&&(n(Object(e))?_e.merge(a,"string"==typeof e?[e]:e):le.call(a,e)),a},inArray:function(e,t,a){return null==t?-1:pe.call(t,e,a)},merge:function(e,t){for(var a=+t.length,n=0,s=e.length;n<a;n++)e[s++]=t[n];return e.length=s,e},grep:function(e,t,a){for(var n=[],s=0,o=e.length,d;s<o;s++)d=!t(e[s],s),d!==!a&&n.push(e[s]);return n},map:function(e,t,a){var s=0,o=[],d,c;if(n(e))for(d=e.length;s<d;s++)c=t(e[s],s,a),null!=c&&o.push(c);else for(s in e)c=t(e[s],s,a),null!=c&&o.push(c);return re.apply([],o)},guid:1,proxy:function(e,t){var a,i,n;if("string"==typeof t&&(a=e[t],t=e,e=a),!!_e.isFunction(e))return i=ce.call(arguments,2),n=function(){return e.apply(t||this,i.concat(ce.call(arguments)))},n.guid=e.guid=e.guid||_e.guid++,n},now:Date.now,support:Ae}),"function"==typeof Symbol&&(_e.fn[Symbol.iterator]=se[Symbol.iterator]),_e.each(["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error","Symbol"],function(e,t){ue["[object "+t+"]"]=t.toLowerCase()});var ye=/*!
 * Sizzle CSS Selector Engine v2.3.0
 * https://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-01-04
 */function(e){function t(e,t,a,n){var s=t&&t.ownerDocument,o=t?t.nodeType:9,d,c,r,l,p,h,v;if(a=a||[],"string"!=typeof e||!e||1!==o&&9!==o&&11!==o)return a;if(!n&&((t?t.ownerDocument||t:S)!==le&&re(t),t=t||le,ue)){if(11!==o&&(p=F.exec(e)))if(!(d=p[1])){if(p[2])return D.apply(a,t.getElementsByTagName(e)),a;if((d=p[3])&&Z.getElementsByClassName&&t.getElementsByClassName)return D.apply(a,t.getElementsByClassName(d)),a}else if(9===o){if(!(r=t.getElementById(d)))return a;if(r.id===d)return a.push(r),a}else if(s&&(r=s.getElementById(d))&&ve(t,r)&&r.id===d)return a.push(r),a;if(Z.qsa&&!M[e+" "]&&(!me||!me.test(e))){if(1!==o)s=t,v=e;else if("object"!==t.nodeName.toLowerCase()){for((l=t.getAttribute("id"))?l=l.replace(Y,W):t.setAttribute("id",l=C),h=ae(e),c=h.length;c--;)h[c]="#"+l+" "+g(h[c]);v=h.join(","),s=U.test(e)&&u(t.parentNode)||t}if(v)try{return D.apply(a,s.querySelectorAll(v)),a}catch(e){}finally{l===C&&t.removeAttribute("id")}}}return se(e.replace(V,"$1"),t,a,n)}function a(){function e(a,i){return t.push(a+" ")>K.cacheLength&&delete e[t.shift()],e[a+" "]=i}var t=[];return e}function n(e){return e[C]=!0,e}function s(e){var t=le.createElement("fieldset");try{return!!e(t)}catch(t){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var a=e.split("|"),n=a.length;n--;)K.attrHandle[a[n]]=t}function d(e,t){var a=t&&e,i=a&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(i)return i;if(a)for(;a=a.nextSibling;)if(a===t)return-1;return e?1:-1}function c(e){return function(t){var a=t.nodeName.toLowerCase();return"input"===a&&t.type===e}}function r(e){return function(t){var a=t.nodeName.toLowerCase();return("input"===a||"button"===a)&&t.type===e}}function l(e){return function(t){return"label"in t&&t.disabled===e||"form"in t&&t.disabled===e||"form"in t&&!1===t.disabled&&(t.isDisabled===e||t.isDisabled!==!e&&("label"in t||!X(t))!==e)}}function p(e){return n(function(t){return t=+t,n(function(a,n){for(var s=e([],a.length,t),o=s.length,d;o--;)a[d=s[o]]&&(a[d]=!(n[d]=a[d]))})})}function u(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function m(){}function g(e){for(var t=0,a=e.length,n="";t<a;t++)n+=e[t].value;return n}function h(e,t,a){var i=t.dir,n=t.next,s=n||i,o=a&&"parentNode"===s,d=E++;return t.first?function(t,a,n){for(;t=t[i];)if(1===t.nodeType||o)return e(t,a,n)}:function(t,a,c){var r=[k,d],l,p,u;if(c){for(;t=t[i];)if((1===t.nodeType||o)&&e(t,a,c))return!0;}else for(;t=t[i];)if(1===t.nodeType||o)if(u=t[C]||(t[C]={}),p=u[t.uniqueID]||(u[t.uniqueID]={}),n&&n===t.nodeName.toLowerCase())t=t[i]||t;else{if((l=p[s])&&l[0]===k&&l[1]===d)return r[2]=l[2];if(p[s]=r,r[2]=e(t,a,c))return!0}}}function v(e){return 1<e.length?function(t,a,n){for(var s=e.length;s--;)if(!e[s](t,a,n))return!1;return!0}:e[0]}function A(e,a,n){for(var s=0,o=a.length;s<o;s++)t(e,a[s],n);return n}function f(e,t,a,n,s){for(var o=[],d=0,c=e.length,r;d<c;d++)(r=e[d])&&(!a||a(r,n,s))&&(o.push(r),null!=t&&t.push(d));return o}function b(e,t,a,s,o,d){return s&&!s[C]&&(s=b(s)),o&&!o[C]&&(o=b(o,d)),n(function(n,d,c,r){var l=[],p=[],u=d.length,m=n||A(t||"*",c.nodeType?[c]:c,[]),g=e&&(n||!t)?f(m,l,e,c,r):m,h=a?o||(n?e:u||s)?[]:d:g,v,b,x;if(a&&a(g,h,c,r),s)for(v=f(h,p),s(v,[],c,r),b=v.length;b--;)(x=v[b])&&(h[p[b]]=!(g[p[b]]=x));if(!n)h=f(h===d?h.splice(u,h.length):h),o?o(null,d,h,r):D.apply(d,h);else if(o||e){if(o){for(v=[],b=h.length;b--;)(x=h[b])&&v.push(g[b]=x);o(null,h=[],v,r)}for(b=h.length;b--;)(x=h[b])&&-1<(v=o?L(n,x):l[b])&&(n[v]=!(d[v]=x))}})}function x(e){for(var t=e.length,a=K.relative[e[0].type],n=a||K.relative[" "],s=a?1:0,o=h(function(e){return e===r},n,!0),d=h(function(e){return-1<L(r,e)},n,!0),c=[function(e,t,i){var n=!a&&(i||t!==oe)||((r=t).nodeType?o(e,t,i):d(e,t,i));return r=null,n}],r,l,p;s<t;s++)if(l=K.relative[e[s].type])c=[h(v(c),l)];else{if(l=K.filter[e[s].type].apply(null,e[s].matches),l[C]){for(p=++s;p<t&&!K.relative[e[p].type];p++);return b(1<s&&v(c),1<s&&g(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(V,"$1"),l,s<p&&x(e.slice(s,p)),p<t&&x(e=e.slice(p)),p<t&&g(e))}c.push(l)}return v(c)}function w(e,a){var s=0<a.length,o=0<e.length,d=function(n,d,c,r,l){var p=0,u="0",m=n&&[],g=[],h=oe,v=n||o&&K.find.TAG("*",l),A=k+=null==h?1:Math.random()||.1,b=v.length,x,w,C;for(l&&(oe=d===le||d||l);u!==b&&null!=(x=v[u]);u++){if(o&&x){for(w=0,d||x.ownerDocument===le||(re(x),c=!ue);C=e[w++];)if(C(x,d||le,c)){r.push(x);break}l&&(k=A)}s&&((x=!C&&x)&&p--,n&&m.push(x))}if(p+=u,s&&u!==p){for(w=0;C=a[w++];)C(m,g,d,c);if(n){if(0<p)for(;u--;)m[u]||g[u]||(g[u]=j.call(r));g=f(g)}D.apply(r,g),l&&!n&&0<g.length&&1<p+a.length&&t.uniqueSort(r)}return l&&(k=A,oe=h),m};return s?n(d):d}var C="sizzle"+1*new Date,S=e.document,k=0,E=0,T=a(),I=a(),M=a(),N=function(e,t){return e===t&&(ce=!0),0},R={}.hasOwnProperty,O=[],j=O.pop,P=O.push,D=O.push,B=O.slice,L=function(e,t){for(var a=0,n=e.length;a<n;a++)if(e[a]===t)return a;return-1},V=/^[\x20\t\r\n\f]+|((?:^|[^\\])(?:\\.)*)[\x20\t\r\n\f]+$/g,H={ID:/^#((?:\\.|[\w-]|[^\0-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\0-\xa0])+)/,TAG:/^((?:\\.|[\w-]|[^\0-\xa0])+|[*])/,ATTR:/^\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\0-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\0-\xa0])+))|)[\x20\t\r\n\f]*\]/,PSEUDO:/^:((?:\\.|[\w-]|[^\0-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\0-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\0-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/,CHILD:/^:(only|first|last|nth|nth-last)-(child|of-type)(?:\([\x20\t\r\n\f]*(even|odd|(([+-]|)(\d*)n|)[\x20\t\r\n\f]*(?:([+-]|)[\x20\t\r\n\f]*(\d+)|))[\x20\t\r\n\f]*\)|)/i,bool:/^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$/i,needsContext:/^[\x20\t\r\n\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i},q=/^[^{]+\{\s*\[native \w/,F=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,U=/[+~]/,G=/\\([\da-f]{1,6}[\x20\t\r\n\f]?|([\x20\t\r\n\f])|.)/ig,z=function(e,t,a){var i="0x"+t-65536;return i!=i||a?t:0>i?ie(i+65536):ie(55296|i>>10,56320|1023&i)},Y=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g,W=function(e,t){return t?"\0"===e?"\uFFFD":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},Q=function(){re()},X=h(function(e){return!0===e.disabled},{dir:"parentNode",next:"legend"}),J,Z,K,ee,te,ae,ne,se,oe,de,ce,re,le,pe,ue,me,ge,he,ve;try{D.apply(O=B.call(S.childNodes),S.childNodes),O[S.childNodes.length].nodeType}catch(t){D={apply:O.length?function(e,t){P.apply(e,B.call(t))}:function(e,t){for(var a=e.length,n=0;e[a++]=t[n++];);e.length=a-1}}}for(J in Z=t.support={},te=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},re=t.setDocument=function(e){var t=e?e.ownerDocument||e:S,a,i;return t!==le&&9===t.nodeType&&t.documentElement?(le=t,pe=le.documentElement,ue=!te(le),S!==le&&(i=le.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",Q,!1):i.attachEvent&&i.attachEvent("onunload",Q)),Z.attributes=s(function(e){return e.className="i",!e.getAttribute("className")}),Z.getElementsByTagName=s(function(e){return e.appendChild(le.createComment("")),!e.getElementsByTagName("*").length}),Z.getElementsByClassName=q.test(le.getElementsByClassName),Z.getById=s(function(e){return pe.appendChild(e).id=C,!le.getElementsByName||!le.getElementsByName(C).length}),Z.getById?(K.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&ue){var a=t.getElementById(e);return a?[a]:[]}},K.filter.ID=function(e){var t=e.replace(G,z);return function(e){return e.getAttribute("id")===t}}):(delete K.find.ID,K.filter.ID=function(e){var t=e.replace(G,z);return function(e){var a="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return a&&a.value===t}}),K.find.TAG=Z.getElementsByTagName?function(e,t){return"undefined"==typeof t.getElementsByTagName?Z.qsa?t.querySelectorAll(e):void 0:t.getElementsByTagName(e)}:function(e,t){var a=[],n=0,s=t.getElementsByTagName(e),o;if("*"===e){for(;o=s[n++];)1===o.nodeType&&a.push(o);return a}return s},K.find.CLASS=Z.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&ue)return t.getElementsByClassName(e)},ge=[],me=[],(Z.qsa=q.test(le.querySelectorAll))&&(s(function(e){pe.appendChild(e).innerHTML="<a id='"+C+"'></a><select id='"+C+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&me.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll("[selected]").length||me.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)"),e.querySelectorAll("[id~="+C+"-]").length||me.push("~="),e.querySelectorAll(":checked").length||me.push(":checked"),e.querySelectorAll("a#"+C+"+*").length||me.push(".#.+[+~]")}),s(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=le.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&me.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&me.push(":enabled",":disabled"),pe.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&me.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),me.push(",.*:")})),(Z.matchesSelector=q.test(he=pe.matches||pe.webkitMatchesSelector||pe.mozMatchesSelector||pe.oMatchesSelector||pe.msMatchesSelector))&&s(function(e){Z.disconnectedMatch=he.call(e,"*"),he.call(e,"[s!='']:x"),ge.push("!=",":((?:\\\\.|[\\w-]|[^\0-\\xa0])+)(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\0-\\xa0])+)(?:[\\x20\\t\\r\\n\\f]*([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|((?:\\\\.|[\\w-]|[^\0-\\xa0])+))|)[\\x20\\t\\r\\n\\f]*\\])*)|.*)\\)|)")}),me=me.length&&new RegExp(me.join("|")),ge=ge.length&&new RegExp(ge.join("|")),a=q.test(pe.compareDocumentPosition),ve=a||q.test(pe.contains)?function(e,t){var a=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!!(i&&1===i.nodeType&&(a.contains?a.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},N=a?function(e,t){if(e===t)return ce=!0,0;var a=!e.compareDocumentPosition-!t.compareDocumentPosition;return a?a:(a=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&a||!Z.sortDetached&&t.compareDocumentPosition(e)===a?e===le||e.ownerDocument===S&&ve(S,e)?-1:t===le||t.ownerDocument===S&&ve(S,t)?1:de?L(de,e)-L(de,t):0:4&a?-1:1)}:function(e,t){if(e===t)return ce=!0,0;var a=0,n=e.parentNode,s=t.parentNode,o=[e],c=[t],r;if(!n||!s)return e===le?-1:t===le?1:n?-1:s?1:de?L(de,e)-L(de,t):0;if(n===s)return d(e,t);for(r=e;r=r.parentNode;)o.unshift(r);for(r=t;r=r.parentNode;)c.unshift(r);for(;o[a]===c[a];)a++;return a?d(o[a],c[a]):o[a]===S?-1:c[a]===S?1:0},le):le},t.matches=function(e,a){return t(e,null,null,a)},t.matchesSelector=function(e,a){if((e.ownerDocument||e)!==le&&re(e),a=a.replace(/=[\x20\t\r\n\f]*([^\]'"]*?)[\x20\t\r\n\f]*\]/g,"='$1']"),Z.matchesSelector&&ue&&!M[a+" "]&&(!ge||!ge.test(a))&&(!me||!me.test(a)))try{var i=he.call(e,a);if(i||Z.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(t){}return 0<t(a,le,null,[e]).length},t.contains=function(e,t){return(e.ownerDocument||e)!==le&&re(e),ve(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==le&&re(e);var a=K.attrHandle[t.toLowerCase()],i=a&&R.call(K.attrHandle,t.toLowerCase())?a(e,t,!ue):void 0;return void 0===i?Z.attributes||!ue?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null:i},t.escape=function(e){return(e+"").replace(Y,W)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t=[],a=0,n=0,s;if(ce=!Z.detectDuplicates,de=!Z.sortStable&&e.slice(0),e.sort(N),ce){for(;s=e[n++];)s===e[n]&&(a=t.push(n));for(;a--;)e.splice(t[a],1)}return de=null,e},ee=t.getText=function(e){var t="",a=0,n=e.nodeType,s;if(!n)for(;s=e[a++];)t+=ee(s);else if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)t+=ee(e)}else if(3===n||4===n)return e.nodeValue;return t},K=t.selectors={cacheLength:50,createPseudo:n,match:H,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(G,z),e[3]=(e[3]||e[4]||e[5]||"").replace(G,z),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(!e[3]&&t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t=!e[6]&&e[2],a;return H.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":t&&/:((?:\\.|[\w-]|[^\0-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\0-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\0-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/.test(t)&&(a=ae(t,!0))&&(a=t.indexOf(")",t.length-a)-t.length)&&(e[0]=e[0].slice(0,a),e[2]=t.slice(0,a)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(G,z).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"([\\x20\\t\\r\\n\\f]|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,a,i){return function(n){var s=t.attr(n,e);return null==s?"!="===a:!a||(s+="","="===a?s===i:"!="===a?s!==i:"^="===a?i&&0===s.indexOf(i):"*="===a?i&&-1<s.indexOf(i):"$="===a?i&&s.slice(-i.length)===i:"~="===a?-1<(" "+s.replace(/[\x20\t\r\n\f]+/g," ")+" ").indexOf(i):"|="==a&&(s===i||s.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,a,i,n){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),d="of-type"===t;return 1===i&&0===n?function(e){return!!e.parentNode}:function(t,a,c){var r=s===o?"previousSibling":"nextSibling",l=t.parentNode,p=d&&t.nodeName.toLowerCase(),u=!c&&!d,m=!1,g,h,v,A,f,b;if(l){if(s){for(;r;){for(A=t;A=A[r];)if(d?A.nodeName.toLowerCase()===p:1===A.nodeType)return!1;b=r="only"===e&&!b&&"nextSibling"}return!0}if(b=[o?l.firstChild:l.lastChild],o&&u){for(A=l,v=A[C]||(A[C]={}),h=v[A.uniqueID]||(v[A.uniqueID]={}),g=h[e]||[],f=g[0]===k&&g[1],m=f&&g[2],A=f&&l.childNodes[f];A=++f&&A&&A[r]||(m=f=0)||b.pop();)if(1===A.nodeType&&++m&&A===t){h[e]=[k,f,m];break}}else if(u&&(A=t,v=A[C]||(A[C]={}),h=v[A.uniqueID]||(v[A.uniqueID]={}),g=h[e]||[],f=g[0]===k&&g[1],m=f),!1===m)for(;(A=++f&&A&&A[r]||(m=f=0)||b.pop())&&!((d?A.nodeName.toLowerCase()===p:1===A.nodeType)&&++m&&(u&&(v=A[C]||(A[C]={}),h=v[A.uniqueID]||(v[A.uniqueID]={}),h[e]=[k,m]),A===t)););return m-=n,m===i||0==m%i&&0<=m/i}}},PSEUDO:function(e,a){var s=K.pseudos[e]||K.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e),i;return s[C]?s(a):1<s.length?(i=[e,e,"",a],K.setFilters.hasOwnProperty(e.toLowerCase())?n(function(e,t){for(var n=s(e,a),o=n.length,d;o--;)d=L(e,n[o]),e[d]=!(t[d]=n[o])}):function(e){return s(e,0,i)}):s}},pseudos:{not:n(function(e){var t=[],a=[],s=ne(e.replace(V,"$1"));return s[C]?n(function(e,t,a,n){for(var o=s(e,null,n,[]),d=e.length,c;d--;)(c=o[d])&&(e[d]=!(t[d]=c))}):function(e,i,n){return t[0]=e,s(t,null,n,a),t[0]=null,!a.pop()}}),has:n(function(e){return function(a){return 0<t(e,a).length}}),contains:n(function(e){return e=e.replace(G,z),function(t){return-1<(t.textContent||t.innerText||ee(t)).indexOf(e)}}),lang:n(function(e){return /^(?:\\.|[\w-]|[^\0-\xa0])+$/.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(G,z).toLowerCase(),function(t){var a;do if(a=ue?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return a=a.toLowerCase(),a===e||0===a.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var a=e.location&&e.location.hash;return a&&a.slice(1)===t.id},root:function(e){return e===pe},focus:function(e){return e===le.activeElement&&(!le.hasFocus||le.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:l(!1),disabled:l(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(6>e.nodeType)return!1;return!0},parent:function(e){return!K.pseudos.empty(e)},header:function(e){return /^h\d$/i.test(e.nodeName)},input:function(e){return /^(?:input|select|textarea|button)$/i.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:p(function(){return[0]}),last:p(function(e,t){return[t-1]}),eq:p(function(e,t,a){return[0>a?a+t:a]}),even:p(function(e,t){for(var a=0;a<t;a+=2)e.push(a);return e}),odd:p(function(e,t){for(var a=1;a<t;a+=2)e.push(a);return e}),lt:p(function(e,t,a){for(var n=0>a?a+t:a;0<=--n;)e.push(n);return e}),gt:p(function(e,t,a){for(var n=0>a?a+t:a;++n<t;)e.push(n);return e})}},K.pseudos.nth=K.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})K.pseudos[J]=c(J);for(J in{submit:!0,reset:!0})K.pseudos[J]=r(J);return m.prototype=K.filters=K.pseudos,K.setFilters=new m,ae=t.tokenize=function(e,a){var i=I[e+" "],n,s,o,d,c,r,l;if(i)return a?0:i.slice(0);for(c=e,r=[],l=K.preFilter;c;){for(d in(!n||(s=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/.exec(c)))&&(s&&(c=c.slice(s[0].length)||c),r.push(o=[])),n=!1,(s=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/.exec(c))&&(n=s.shift(),o.push({value:n,type:s[0].replace(V," ")}),c=c.slice(n.length)),K.filter)(s=H[d].exec(c))&&(!l[d]||(s=l[d](s)))&&(n=s.shift(),o.push({value:n,type:d,matches:s}),c=c.slice(n.length));if(!n)break}return a?c.length:c?t.error(e):I(e,r).slice(0)},ne=t.compile=function(e,t){var a=[],n=[],s=M[e+" "],o;if(!s){for(t||(t=ae(e)),o=t.length;o--;)s=x(t[o]),s[C]?a.push(s):n.push(s);s=M(e,w(n,a)),s.selector=e}return s},se=t.select=function(e,t,a,n){var s="function"==typeof e&&e,o=!n&&ae(e=s.selector||e),d,c,r,l,p;if(a=a||[],1===o.length){if(c=o[0]=o[0].slice(0),2<c.length&&"ID"===(r=c[0]).type&&Z.getById&&9===t.nodeType&&ue&&K.relative[c[1].type]){if(t=(K.find.ID(r.matches[0].replace(G,z),t)||[])[0],!t)return a;s&&(t=t.parentNode),e=e.slice(c.shift().value.length)}for(d=H.needsContext.test(e)?0:c.length;d--&&(r=c[d],!K.relative[l=r.type]);)if((p=K.find[l])&&(n=p(r.matches[0].replace(G,z),U.test(c[0].type)&&u(t.parentNode)||t))){if(c.splice(d,1),e=n.length&&g(c),!e)return D.apply(a,n),a;break}}return(s||ne(e,o))(n,t,!ue,a,!t||U.test(e)&&u(t.parentNode)||t),a},Z.sortStable=C.split("").sort(N).join("")===C,Z.detectDuplicates=!!ce,re(),Z.sortDetached=s(function(e){return 1&e.compareDocumentPosition(le.createElement("fieldset"))}),s(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,a){if(!a)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),Z.attributes&&s(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,a){if(!a&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),s(function(e){return null==e.getAttribute("disabled")})||o("checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",function(e,t,a){var i;if(!a)return!0===e[t]?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);_e.find=ye,_e.expr=ye.selectors,_e.expr[":"]=_e.expr.pseudos,_e.uniqueSort=_e.unique=ye.uniqueSort,_e.text=ye.getText,_e.isXMLDoc=ye.isXML,_e.contains=ye.contains,_e.escapeSelector=ye.escape;var xe=function(e,t,a){for(var i=[];(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(void 0!==a&&_e(e).is(a))break;i.push(e)}return i},we=function(e,t){for(var a=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&a.push(e);return a},Ce=_e.expr.match.needsContext,Se=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,ke=/^.[^:#\[\.,]*$/;_e.filter=function(e,t,a){var i=t[0];return a&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?_e.find.matchesSelector(i,e)?[i]:[]:_e.find.matches(e,_e.grep(t,function(e){return 1===e.nodeType}))},_e.fn.extend({find:function(e){var t=this.length,a=this,n,s;if("string"!=typeof e)return this.pushStack(_e(e).filter(function(){for(n=0;n<t;n++)if(_e.contains(a[n],this))return!0}));for(s=this.pushStack([]),n=0;n<t;n++)_e.find(e,a[n],s);return 1<t?_e.uniqueSort(s):s},filter:function(e){return this.pushStack(s(this,e||[],!1))},not:function(e){return this.pushStack(s(this,e||[],!0))},is:function(e){return!!s(this,"string"==typeof e&&Ce.test(e)?_e(e):e||[],!1).length}});var Ee=_e.fn.init=function(e,t,a){var i,n;if(!e)return this;if(a=a||Te,"string"==typeof e){if(i="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/.exec(e),i&&(i[1]||!t)){if(i[1]){if(t=t instanceof _e?t[0]:t,_e.merge(this,_e.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:oe,!0)),Se.test(i[1])&&_e.isPlainObject(t))for(i in t)_e.isFunction(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return n=oe.getElementById(i[2]),n&&(this[0]=n,this.length=1),this}return!t||t.jquery?(t||a).find(e):this.constructor(t).find(e)}return e.nodeType?(this[0]=e,this.length=1,this):_e.isFunction(e)?void 0===a.ready?e(_e):a.ready(e):_e.makeArray(e,this)},Te;Ee.prototype=_e.fn,Te=_e(oe);var Ie={children:!0,contents:!0,next:!0,prev:!0};_e.fn.extend({has:function(e){var t=_e(e,this),a=t.length;return this.filter(function(){for(var e=0;e<a;e++)if(_e.contains(this,t[e]))return!0})},closest:function(e,t){var a=0,n=this.length,s=[],o="string"!=typeof e&&_e(e),d;if(!Ce.test(e))for(;a<n;a++)for(d=this[a];d&&d!==t;d=d.parentNode)if(11>d.nodeType&&(o?-1<o.index(d):1===d.nodeType&&_e.find.matchesSelector(d,e))){s.push(d);break}return this.pushStack(1<s.length?_e.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?pe.call(_e(e),this[0]):pe.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(_e.uniqueSort(_e.merge(this.get(),_e(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),_e.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return xe(e,"parentNode")},parentsUntil:function(e,t,a){return xe(e,"parentNode",a)},next:function(e){return o(e,"nextSibling")},prev:function(e){return o(e,"previousSibling")},nextAll:function(e){return xe(e,"nextSibling")},prevAll:function(e){return xe(e,"previousSibling")},nextUntil:function(e,t,a){return xe(e,"nextSibling",a)},prevUntil:function(e,t,a){return xe(e,"previousSibling",a)},siblings:function(e){return we((e.parentNode||{}).firstChild,e)},children:function(e){return we(e.firstChild)},contents:function(e){return e.contentDocument||_e.merge([],e.childNodes)}},function(e,t){_e.fn[e]=function(a,i){var n=_e.map(this,t,a);return"Until"!==e.slice(-5)&&(i=a),i&&"string"==typeof i&&(n=_e.filter(i,n)),1<this.length&&(!Ie[e]&&_e.uniqueSort(n),/^(?:parents|prev(?:Until|All))/.test(e)&&n.reverse()),this.pushStack(n)}});var Me=/\S+/g;_e.Callbacks=function(e){e="string"==typeof e?d(e):_e.extend({},e);var t=[],a=[],i=-1,n=function(){for(l=e.once,r=o=!0;a.length;i=-1)for(c=a.shift();++i<t.length;)!1===t[i].apply(c[0],c[1])&&e.stopOnFalse&&(i=t.length,c=!1);e.memory||(c=!1),o=!1,l&&(c?t=[]:t="")},s={add:function(){return t&&(c&&!o&&(i=t.length-1,a.push(c)),function a(i){_e.each(i,function(i,n){_e.isFunction(n)?(!e.unique||!s.has(n))&&t.push(n):n&&n.length&&"string"!==_e.type(n)&&a(n)})}(arguments),c&&!o&&n()),this},remove:function(){return _e.each(arguments,function(e,a){for(var n;-1<(n=_e.inArray(a,t,n));)t.splice(n,1),n<=i&&i--}),this},has:function(e){return e?-1<_e.inArray(e,t):0<t.length},empty:function(){return t&&(t=[]),this},disable:function(){return l=a=[],t=c="",this},disabled:function(){return!t},lock:function(){return l=a=[],c||o||(t=c=""),this},locked:function(){return!!l},fireWith:function(e,t){return l||(t=t||[],t=[e,t.slice?t.slice():t],a.push(t),!o&&n()),this},fire:function(){return s.fireWith(this,arguments),this},fired:function(){return!!r}},o,c,r,l;return s},_e.extend({Deferred:function(t){var a=[["notify","progress",_e.Callbacks("memory"),_e.Callbacks("memory"),2],["resolve","done",_e.Callbacks("once memory"),_e.Callbacks("once memory"),0,"resolved"],["reject","fail",_e.Callbacks("once memory"),_e.Callbacks("once memory"),1,"rejected"]],i="pending",n={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return n.then(null,e)},pipe:function(){var e=arguments;return _e.Deferred(function(t){_e.each(a,function(a,i){var n=_e.isFunction(e[i[4]])&&e[i[4]];s[i[1]](function(){var e=n&&n.apply(this,arguments);e&&_e.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[i[0]+"With"](this,n?[e]:arguments)})}),e=null}).promise()},then:function(t,i,n){function s(t,a,i,n){return function(){var d=this,l=arguments,p=function(){var e,p;if(!(t<o)){if(e=i.apply(d,l),e===a.promise())throw new TypeError("Thenable self-resolution");p=e&&("object"==typeof e||"function"==typeof e)&&e.then,_e.isFunction(p)?n?p.call(e,s(o,a,c,n),s(o,a,r,n)):(o++,p.call(e,s(o,a,c,n),s(o,a,r,n),s(o,a,c,a.notifyWith))):(i!==c&&(d=void 0,l=[e]),(n||a.resolveWith)(d,l))}},u=n?p:function(){try{p()}catch(n){_e.Deferred.exceptionHook&&_e.Deferred.exceptionHook(n,u.stackTrace),t+1>=o&&(i!==r&&(d=void 0,l=[n]),a.rejectWith(d,l))}};t?u():(_e.Deferred.getStackHook&&(u.stackTrace=_e.Deferred.getStackHook()),e.setTimeout(u))}}var o=0;return _e.Deferred(function(e){a[0][3].add(s(0,e,_e.isFunction(n)?n:c,e.notifyWith)),a[1][3].add(s(0,e,_e.isFunction(t)?t:c)),a[2][3].add(s(0,e,_e.isFunction(i)?i:r))}).promise()},promise:function(e){return null==e?n:_e.extend(e,n)}},s={};return _e.each(a,function(e,t){var o=t[2],d=t[5];n[t[1]]=o.add,d&&o.add(function(){i=d},a[3-e][2].disable,a[0][2].lock),o.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=o.fireWith}),n.promise(s),t&&t.call(s,s),s},when:function(e){var t=arguments.length,a=t,n=Array(a),s=ce.call(arguments),o=_e.Deferred(),d=function(e){return function(a){n[e]=this,s[e]=1<arguments.length?ce.call(arguments):a,--t||o.resolveWith(n,s)}};if(1>=t&&(l(e,o.done(d(a)).resolve,o.reject),"pending"===o.state()||_e.isFunction(s[a]&&s[a].then)))return o.then();for(;a--;)l(s[a],d(a),o.reject);return o.promise()}});_e.Deferred.exceptionHook=function(t,a){e.console&&e.console.warn&&t&&/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,a)};var Ne=_e.Deferred();_e.fn.ready=function(e){return Ne.then(e),this},_e.extend({isReady:!1,readyWait:1,holdReady:function(e){e?_e.readyWait++:_e.ready(!0)},ready:function(e){(!0===e?! --_e.readyWait:!_e.isReady)&&(_e.isReady=!0,!0!==e&&0<--_e.readyWait||Ne.resolveWith(oe,[_e]))}}),_e.ready.then=Ne.then,"complete"!==oe.readyState&&("loading"===oe.readyState||oe.documentElement.doScroll)?(oe.addEventListener("DOMContentLoaded",p),e.addEventListener("load",p)):e.setTimeout(_e.ready);var Re=function(e,t,a,n,s,o,d){var c=0,r=e.length,l=null==a;if("object"===_e.type(a))for(c in s=!0,a)Re(e,t,c,a[c],!0,o,d);else if(void 0!==n&&(s=!0,_e.isFunction(n)||(d=!0),l&&(d?(t.call(e,n),t=null):(l=t,t=function(e,t,a){return l.call(_e(e),a)})),t))for(;c<r;c++)t(e[c],a,d?n:n.call(e[c],c,t(e[c],a)));return s?e:l?t.call(e):r?t(e[0],a):o},Oe=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};u.uid=1,u.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Oe(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,a){var i=this.cache(e),n;if("string"==typeof t)i[_e.camelCase(t)]=a;else for(n in t)i[_e.camelCase(n)]=t[n];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][_e.camelCase(t)]},access:function(e,t,a){return void 0===t||t&&"string"==typeof t&&void 0===a?this.get(e,t):(this.set(e,t,a),void 0===a?t:a)},remove:function(e,t){var a=e[this.expando],n;if(void 0!==a){if(void 0!==t)for(_e.isArray(t)?t=t.map(_e.camelCase):(t=_e.camelCase(t),t=(t in a)?[t]:t.match(Me)||[]),n=t.length;n--;)delete a[t[n]];(void 0===t||_e.isEmptyObject(a))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!_e.isEmptyObject(t)}};var je=new u,Pe=new u,De=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Be=/[A-Z]/g;_e.extend({hasData:function(e){return Pe.hasData(e)||je.hasData(e)},data:function(e,t,a){return Pe.access(e,t,a)},removeData:function(e,t){Pe.remove(e,t)},_data:function(e,t,a){return je.access(e,t,a)},_removeData:function(e,t){je.remove(e,t)}}),_e.fn.extend({data:function(e,t){var a=this[0],n=a&&a.attributes,s,o,d;if(void 0===e){if(this.length&&(d=Pe.get(a),1===a.nodeType&&!je.get(a,"hasDataAttrs"))){for(s=n.length;s--;)n[s]&&(o=n[s].name,0===o.indexOf("data-")&&(o=_e.camelCase(o.slice(5)),m(a,o,d[o])));je.set(a,"hasDataAttrs",!0)}return d}return"object"==typeof e?this.each(function(){Pe.set(this,e)}):Re(this,function(t){var i;return a&&void 0===t?(i=Pe.get(a,e),void 0!==i)?i:(i=m(a,e),void 0===i?void 0:i):void this.each(function(){Pe.set(this,e,t)})},null,t,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Pe.remove(this,e)})}}),_e.extend({queue:function(e,t,a){var i;if(e)return t=(t||"fx")+"queue",i=je.get(e,t),a&&(!i||_e.isArray(a)?i=je.access(e,t,_e.makeArray(a)):i.push(a)),i||[]},dequeue:function(e,t){t=t||"fx";var a=_e.queue(e,t),i=a.length,n=a.shift(),s=_e._queueHooks(e,t),o=function(){_e.dequeue(e,t)};"inprogress"===n&&(n=a.shift(),i--),n&&("fx"===t&&a.unshift("inprogress"),delete s.stop,n.call(e,o,s)),!i&&s&&s.empty.fire()},_queueHooks:function(e,t){var a=t+"queueHooks";return je.get(e,a)||je.access(e,a,{empty:_e.Callbacks("once memory").add(function(){je.remove(e,[t+"queue",a])})})}}),_e.fn.extend({queue:function(e,t){var a=2;return"string"!=typeof e&&(t=e,e="fx",a--),arguments.length<a?_e.queue(this[0],e):void 0===t?this:this.each(function(){var a=_e.queue(this,e,t);_e._queueHooks(this,e),"fx"===e&&"inprogress"!==a[0]&&_e.dequeue(this,e)})},dequeue:function(e){return this.each(function(){_e.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var a=1,n=_e.Deferred(),s=this,o=this.length,d=function(){--a||n.resolveWith(s,[s])},c;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)c=je.get(s[o],e+"queueHooks"),c&&c.empty&&(a++,c.empty.add(d));return d(),n.promise(t)}});var Le=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,$e=new RegExp("^(?:([+-])=|)("+Le+")([a-z%]*)$","i"),Ve=["Top","Right","Bottom","Left"],He=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&_e.contains(e.ownerDocument,e)&&"none"===_e.css(e,"display")},qe=function(e,t,a,i){var n={},s,o;for(o in t)n[o]=e.style[o],e.style[o]=t[o];for(o in s=a.apply(e,i||[]),t)e.style[o]=n[o];return s},Fe={};_e.fn.extend({show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){He(this)?_e(this).show():_e(this).hide()})}});var Ue=/^(?:checkbox|radio)$/i,Ge=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,ze=/^$|\/(?:java|ecma)script/i,Ye={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ye.optgroup=Ye.option,Ye.tbody=Ye.tfoot=Ye.colgroup=Ye.caption=Ye.thead,Ye.th=Ye.td;var We=/<|&#?\w+;/;(function(){var e=oe.createDocumentFragment(),t=e.appendChild(oe.createElement("div")),a=oe.createElement("input");a.setAttribute("type","radio"),a.setAttribute("checked","checked"),a.setAttribute("name","t"),t.appendChild(a),Ae.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",Ae.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue})();var Qe=oe.documentElement,Xe=/^([^.]*)(?:\.(.+)|)/;_e.event={global:{},add:function(a,i,n,s,o){var d=je.get(a),c,r,l,p,u,e,m,g,h,v,A;if(d)for(n.handler&&(c=n,n=c.handler,o=c.selector),o&&_e.find.matchesSelector(Qe,o),n.guid||(n.guid=_e.guid++),(p=d.events)||(p=d.events={}),(r=d.handle)||(r=d.handle=function(t){return"undefined"!=typeof _e&&_e.event.triggered!==t.type?_e.event.dispatch.apply(a,arguments):void 0}),i=(i||"").match(Me)||[""],u=i.length;u--;)(l=Xe.exec(i[u])||[],h=A=l[1],v=(l[2]||"").split(".").sort(),!!h)&&(m=_e.event.special[h]||{},h=(o?m.delegateType:m.bindType)||h,m=_e.event.special[h]||{},e=_e.extend({type:h,origType:A,data:s,handler:n,guid:n.guid,selector:o,needsContext:o&&_e.expr.match.needsContext.test(o),namespace:v.join(".")},c),(g=p[h])||(g=p[h]=[],g.delegateCount=0,(!m.setup||!1===m.setup.call(a,s,v,r))&&a.addEventListener&&a.addEventListener(h,r)),m.add&&(m.add.call(a,e),!e.handler.guid&&(e.handler.guid=n.guid)),o?g.splice(g.delegateCount++,0,e):g.push(e),_e.event.global[h]=!0)},remove:function(e,a,i,n,s){var o=je.hasData(e)&&je.get(e),d,c,r,l,p,u,m,g,h,v,A;if(o&&(l=o.events)){for(a=(a||"").match(Me)||[""],p=a.length;p--;){if(r=Xe.exec(a[p])||[],h=A=r[1],v=(r[2]||"").split(".").sort(),!h){for(h in l)_e.event.remove(e,h+a[p],i,n,!0);continue}for(m=_e.event.special[h]||{},h=(n?m.delegateType:m.bindType)||h,g=l[h]||[],r=r[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),c=d=g.length;d--;)u=g[d],(s||A===u.origType)&&(!i||i.guid===u.guid)&&(!r||r.test(u.namespace))&&(!n||n===u.selector||"**"===n&&u.selector)&&(g.splice(d,1),u.selector&&g.delegateCount--,m.remove&&m.remove.call(e,u));c&&!g.length&&((!m.teardown||!1===m.teardown.call(e,v,o.handle))&&_e.removeEvent(e,h,o.handle),delete l[h])}_e.isEmptyObject(l)&&je.remove(e,"handle events")}},dispatch:function(e){var t=_e.event.fix(e),a=Array(arguments.length),n=(je.get(this,"events")||{})[t.type]||[],s=_e.event.special[t.type]||{},o,d,c,r,l,p;for(a[0]=t,o=1;o<arguments.length;o++)a[o]=arguments[o];if(t.delegateTarget=this,!(s.preDispatch&&!1===s.preDispatch.call(this,t))){for(p=_e.event.handlers.call(this,t,n),o=0;(r=p[o++])&&!t.isPropagationStopped();)for(t.currentTarget=r.elem,d=0;(l=r.handlers[d++])&&!t.isImmediatePropagationStopped();)(!t.rnamespace||t.rnamespace.test(l.namespace))&&(t.handleObj=l,t.data=l.data,c=((_e.event.special[l.origType]||{}).handle||l.handler).apply(r.elem,a),void 0!==c&&!1===(t.result=c)&&(t.preventDefault(),t.stopPropagation()));return s.postDispatch&&s.postDispatch.call(this,t),t.result}},handlers:function(e,t){var a=[],n=t.delegateCount,s=e.target,o,d,c,r;if(n&&s.nodeType&&("click"!==e.type||isNaN(e.button)||1>e.button))for(;s!==this;s=s.parentNode||this)if(1===s.nodeType&&(!0!==s.disabled||"click"!==e.type)){for(d=[],o=0;o<n;o++)r=t[o],c=r.selector+" ",void 0===d[c]&&(d[c]=r.needsContext?-1<_e(c,this).index(s):_e.find(c,this,null,[s]).length),d[c]&&d.push(r);d.length&&a.push({elem:s,handlers:d})}return n<t.length&&a.push({elem:this,handlers:t.slice(n)}),a},addProp:function(e,t){Object.defineProperty(_e.Event.prototype,e,{enumerable:!0,configurable:!0,get:_e.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[_e.expando]?e:new _e.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==C()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===C()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&_e.nodeName(this,"input"))return this.click(),!1},_default:function(e){return _e.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},_e.removeEvent=function(e,t,a){e.removeEventListener&&e.removeEventListener(t,a)},_e.Event=function(e,t){return this instanceof _e.Event?void(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?x:w,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&_e.extend(this,t),this.timeStamp=e&&e.timeStamp||_e.now(),this[_e.expando]=!0):new _e.Event(e,t)},_e.Event.prototype={constructor:_e.Event,isDefaultPrevented:w,isPropagationStopped:w,isImmediatePropagationStopped:w,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=x,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=x,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=x,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},_e.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&/^key/.test(e.type)?null==e.charCode?e.keyCode:e.charCode:!e.which&&void 0!==t&&/^(?:mouse|pointer|contextmenu|drag|drop)|click/.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},_e.event.addProp),_e.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){_e.event.special[e]={delegateType:t,bindType:t,handle:function(e){var a=this,i=e.relatedTarget,n=e.handleObj,s;return i&&(i===a||_e.contains(a,i))||(e.type=n.origType,s=n.handler.apply(this,arguments),e.type=t),s}}}),_e.fn.extend({on:function(e,t,a,i){return S(this,e,t,a,i)},one:function(e,t,a,i){return S(this,e,t,a,i,1)},off:function(e,t,a){var i,n;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,_e(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return(!1===t||"function"==typeof t)&&(a=t,t=void 0),!1===a&&(a=w),this.each(function(){_e.event.remove(this,e,a,t)})}});var Je=/checked\s*(?:[^=]|=\s*.checked.)/i,Ze=/^true\/(.*)/,Ke=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;_e.extend({htmlPrefilter:function(e){return e.replace(/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,"<$1></$2>")},clone:function(e,t,a){var n=e.cloneNode(!0),s=_e.contains(e.ownerDocument,e),o,d,c,r;if(!Ae.noCloneChecked&&(1===e.nodeType||11===e.nodeType)&&!_e.isXMLDoc(e))for(r=A(n),c=A(e),(o=0,d=c.length);o<d;o++)I(c[o],r[o]);if(t)if(a)for(c=c||A(e),r=r||A(n),(o=0,d=c.length);o<d;o++)T(c[o],r[o]);else T(e,n);return r=A(n,"script"),0<r.length&&f(r,!s&&A(e,"script")),n},cleanData:function(e){for(var t=_e.event.special,a=0,n,s,o;void 0!==(s=e[a]);a++)if(Oe(s)){if(n=s[je.expando]){if(n.events)for(o in n.events)t[o]?_e.event.remove(s,o):_e.removeEvent(s,o,n.handle);s[je.expando]=void 0}s[Pe.expando]&&(s[Pe.expando]=void 0)}}}),_e.fn.extend({detach:function(e){return N(this,e,!0)},remove:function(e){return N(this,e)},text:function(e){return Re(this,function(e){return void 0===e?_e.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return M(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=i(this,e);t.appendChild(e)}})},prepend:function(){return M(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=i(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return M(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return M(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e=0,t;null!=(t=this[e]);e++)1===t.nodeType&&(_e.cleanData(A(t,!1)),t.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return _e.clone(this,e,t)})},html:function(e){return Re(this,function(e){var t=this[0]||{},a=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!/<script|<style|<link/i.test(e)&&!Ye[(Ge.exec(e)||["",""])[1].toLowerCase()]){e=_e.htmlPrefilter(e);try{for(;a<n;a++)t=this[a]||{},1===t.nodeType&&(_e.cleanData(A(t,!1)),t.innerHTML=e);t=0}catch(t){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return M(this,arguments,function(t){var a=this.parentNode;0>_e.inArray(this,e)&&(_e.cleanData(A(this)),a&&a.replaceChild(t,this))},e)}}),_e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){_e.fn[e]=function(e){for(var a=[],n=_e(e),s=n.length-1,o=0,d;o<=s;o++)d=o===s?this:this.clone(!0),_e(n[o])[t](d),le.apply(a,d.get());return this.pushStack(a)}});var et=/^margin/,tt=new RegExp("^("+Le+")(?!px)[a-z%]+$","i"),at=function(t){var a=t.ownerDocument.defaultView;return a&&a.opener||(a=e),a.getComputedStyle(t)};(function(){function t(){if(i){i.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",i.innerHTML="",Qe.appendChild(a);var t=e.getComputedStyle(i);n="1%"!==t.top,d="2px"===t.marginLeft,s="4px"===t.width,i.style.marginRight="50%",o="4px"===t.marginRight,Qe.removeChild(a),i=null}}var a=oe.createElement("div"),i=oe.createElement("div"),n,s,o,d;i.style&&(i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",Ae.clearCloneStyle="content-box"===i.style.backgroundClip,a.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",a.appendChild(i),_e.extend(Ae,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return t(),s},pixelMarginRight:function(){return t(),o},reliableMarginLeft:function(){return t(),d}}))})();var it={position:"absolute",visibility:"hidden",display:"block"},nt={letterSpacing:"0",fontWeight:"400"},st=["Webkit","Moz","ms"],ot=oe.createElement("div").style;_e.extend({cssHooks:{opacity:{get:function(e,t){if(t){var a=R(e,"opacity");return""===a?"1":a}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,a,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n=_e.camelCase(t),s=e.style,o,d,c;if(t=_e.cssProps[n]||(_e.cssProps[n]=j(n)||n),c=_e.cssHooks[t]||_e.cssHooks[n],void 0!==a){if(d=typeof a,"string"===d&&(o=$e.exec(a))&&o[1]&&(a=g(e,t,o),d="number"),null==a||a!==a)return;"number"===d&&(a+=o&&o[3]||(_e.cssNumber[n]?"":"px")),Ae.clearCloneStyle||""!==a||0!==t.indexOf("background")||(s[t]="inherit"),c&&"set"in c&&void 0===(a=c.set(e,a,i))||(s[t]=a)}else return c&&"get"in c&&void 0!==(o=c.get(e,!1,i))?o:s[t]}},css:function(e,t,a,i){var n=_e.camelCase(t),s,o,d;return t=_e.cssProps[n]||(_e.cssProps[n]=j(n)||n),d=_e.cssHooks[t]||_e.cssHooks[n],d&&"get"in d&&(s=d.get(e,!0,a)),void 0===s&&(s=R(e,t,i)),"normal"===s&&t in nt&&(s=nt[t]),""===a||a?(o=parseFloat(s),!0===a||isFinite(o)?o||0:s):s}}),_e.each(["height","width"],function(e,t){_e.cssHooks[t]={get:function(e,a,i){if(a)return!/^(none|table(?!-c[ea]).+)/.test(_e.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?B(e,t,i):qe(e,it,function(){return B(e,t,i)})},set:function(e,a,i){var n=i&&at(e),s=i&&D(e,t,i,"border-box"===_e.css(e,"boxSizing",!1,n),n),o;return s&&(o=$e.exec(a))&&"px"!==(o[3]||"px")&&(e.style[t]=a,a=_e.css(e,t)),P(e,a,s)}}}),_e.cssHooks.marginLeft=O(Ae.reliableMarginLeft,function(e,t){if(t)return(parseFloat(R(e,"marginLeft"))||e.getBoundingClientRect().left-qe(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),_e.each({margin:"",padding:"",border:"Width"},function(e,t){_e.cssHooks[e+t]={expand:function(a){for(var n=0,s={},o="string"==typeof a?a.split(" "):[a];4>n;n++)s[e+Ve[n]+t]=o[n]||o[n-2]||o[0];return s}},et.test(e)||(_e.cssHooks[e+t].set=P)}),_e.fn.extend({css:function(e,t){return Re(this,function(e,t,a){var n={},s=0,o,d;if(_e.isArray(t)){for(o=at(e),d=t.length;s<d;s++)n[t[s]]=_e.css(e,t[s],!1,o);return n}return void 0===a?_e.css(e,t):_e.style(e,t,a)},e,t,1<arguments.length)}}),_e.Tween=L,L.prototype={constructor:L,init:function(e,t,a,i,n,s){this.elem=e,this.prop=a,this.easing=n||_e.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=s||(_e.cssNumber[a]?"":"px")},cur:function(){var e=L.propHooks[this.prop];return e&&e.get?e.get(this):L.propHooks._default.get(this)},run:function(e){var t=L.propHooks[this.prop],a;return this.pos=this.options.duration?a=_e.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):a=e,this.now=(this.end-this.start)*a+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),t&&t.set?t.set(this):L.propHooks._default.set(this),this}},L.prototype.init.prototype=L.prototype,L.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=_e.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){_e.fx.step[e.prop]?_e.fx.step[e.prop](e):1===e.elem.nodeType&&(null!=e.elem.style[_e.cssProps[e.prop]]||_e.cssHooks[e.prop])?_e.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},L.propHooks.scrollTop=L.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},_e.easing={linear:function(e){return e},swing:function(e){return .5-te(e*ae)/2},_default:"swing"},_e.fx=L.prototype.init,_e.fx.step={};var dt=/^(?:toggle|show|hide)$/,ct,rt;_e.Animation=_e.extend(z,{tweeners:{"*":[function(e,t){var a=this.createTween(e,t);return g(a.elem,e,$e.exec(t),a),a}]},tweener:function(e,t){_e.isFunction(e)?(t=e,e=["*"]):e=e.match(Me);for(var a=0,i=e.length,n;a<i;a++)n=e[a],z.tweeners[n]=z.tweeners[n]||[],z.tweeners[n].unshift(t)},prefilters:[U],prefilter:function(e,t){t?z.prefilters.unshift(e):z.prefilters.push(e)}}),_e.speed=function(e,t,a){var i=e&&"object"==typeof e?_e.extend({},e):{complete:a||!a&&t||_e.isFunction(e)&&e,duration:e,easing:a&&t||t&&!_e.isFunction(t)&&t};return i.duration=_e.fx.off||oe.hidden?0:"number"==typeof i.duration?i.duration:i.duration in _e.fx.speeds?_e.fx.speeds[i.duration]:_e.fx.speeds._default,(null==i.queue||!0===i.queue)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){_e.isFunction(i.old)&&i.old.call(this),i.queue&&_e.dequeue(this,i.queue)},i},_e.fn.extend({fadeTo:function(e,t,a,i){return this.filter(He).css("opacity",0).show().end().animate({opacity:t},e,a,i)},animate:function(e,t,a,i){var n=_e.isEmptyObject(e),s=_e.speed(t,a,i),o=function(){var t=z(this,_e.extend({},e),s);(n||je.get(this,"finish"))&&t.stop(!0)};return o.finish=o,n||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(e,t,a){var i=function(e){var t=e.stop;delete e.stop,t(a)};return"string"!=typeof e&&(a=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=_e.timers,o=je.get(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&/queueHooks$/.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(null==e||s[n].queue===e)&&(s[n].anim.stop(a),t=!1,s.splice(n,1));(t||!a)&&_e.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t=je.get(this),a=t[e+"queue"],i=t[e+"queueHooks"],n=_e.timers,s=a?a.length:0,o;for(t.finish=!0,_e.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),o=n.length;o--;)n[o].elem===this&&n[o].queue===e&&(n[o].anim.stop(!0),n.splice(o,1));for(o=0;o<s;o++)a[o]&&a[o].finish&&a[o].finish.call(this);delete t.finish})}}),_e.each(["toggle","show","hide"],function(e,t){var a=_e.fn[t];_e.fn[t]=function(e,i,n){return null==e||"boolean"==typeof e?a.apply(this,arguments):this.animate(q(t,!0),e,i,n)}}),_e.each({slideDown:q("show"),slideUp:q("hide"),slideToggle:q("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){_e.fn[e]=function(e,a,i){return this.animate(t,e,a,i)}}),_e.timers=[],_e.fx.tick=function(){var e=0,t=_e.timers,a;for(ct=_e.now();e<t.length;e++)a=t[e],a()||t[e]!==a||t.splice(e--,1);t.length||_e.fx.stop(),ct=void 0},_e.fx.timer=function(e){_e.timers.push(e),e()?_e.fx.start():_e.timers.pop()},_e.fx.interval=13,_e.fx.start=function(){rt||(rt=e.requestAnimationFrame?e.requestAnimationFrame(V):e.setInterval(_e.fx.tick,_e.fx.interval))},_e.fx.stop=function(){e.cancelAnimationFrame?e.cancelAnimationFrame(rt):e.clearInterval(rt),rt=null},_e.fx.speeds={slow:600,fast:200,_default:400},_e.fn.delay=function(t,a){return t=_e.fx?_e.fx.speeds[t]||t:t,a=a||"fx",this.queue(a,function(a,i){var n=e.setTimeout(a,t);i.stop=function(){e.clearTimeout(n)}})},function(){var e=oe.createElement("input"),t=oe.createElement("select"),a=t.appendChild(oe.createElement("option"));e.type="checkbox",Ae.checkOn=""!==e.value,Ae.optSelected=a.selected,e=oe.createElement("input"),e.value="t",e.type="radio",Ae.radioValue="t"===e.value}();var lt=_e.expr.attrHandle,pt;_e.fn.extend({attr:function(e,t){return Re(this,_e.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){_e.removeAttr(this,e)})}}),_e.extend({attr:function(e,t,a){var i=e.nodeType,n,s;if(3!==i&&8!==i&&2!==i)return"undefined"==typeof e.getAttribute?_e.prop(e,t,a):(1===i&&_e.isXMLDoc(e)||(s=_e.attrHooks[t.toLowerCase()]||(_e.expr.match.bool.test(t)?pt:void 0)),void 0!==a)?null===a?void _e.removeAttr(e,t):s&&"set"in s&&void 0!==(n=s.set(e,a,t))?n:(e.setAttribute(t,a+""),a):s&&"get"in s&&null!==(n=s.get(e,t))?n:(n=_e.find.attr(e,t),null==n?void 0:n)},attrHooks:{type:{set:function(e,t){if(!Ae.radioValue&&"radio"===t&&_e.nodeName(e,"input")){var a=e.value;return e.setAttribute("type",t),a&&(e.value=a),t}}}},removeAttr:function(e,t){var a=0,n=t&&t.match(Me),s;if(n&&1===e.nodeType)for(;s=n[a++];)e.removeAttribute(s)}}),pt={set:function(e,t,a){return!1===t?_e.removeAttr(e,a):e.setAttribute(a,a),a}},_e.each(_e.expr.match.bool.source.match(/\w+/g),function(e,t){var a=lt[t]||_e.find.attr;lt[t]=function(e,t,i){var n=t.toLowerCase(),s,o;return i||(o=lt[n],lt[n]=s,s=null==a(e,t,i)?null:n,lt[n]=o),s}});_e.fn.extend({prop:function(e,t){return Re(this,_e.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[_e.propFix[e]||e]})}}),_e.extend({prop:function(e,t,a){var i=e.nodeType,n,s;if(3!==i&&8!==i&&2!==i)return 1===i&&_e.isXMLDoc(e)||(t=_e.propFix[t]||t,s=_e.propHooks[t]),void 0===a?s&&"get"in s&&null!==(n=s.get(e,t))?n:e[t]:s&&"set"in s&&void 0!==(n=s.set(e,a,t))?n:e[t]=a},propHooks:{tabIndex:{get:function(e){var t=_e.find.attr(e,"tabindex");return t?parseInt(t,10):/^(?:input|select|textarea|button)$/i.test(e.nodeName)||/^(?:a|area)$/i.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),Ae.optSelected||(_e.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),_e.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){_e.propFix[this.toLowerCase()]=this});var ut=/[\t\r\n\f]/g;_e.fn.extend({addClass:function(e){var t=0,a,n,s,o,d,c,r;if(_e.isFunction(e))return this.each(function(t){_e(this).addClass(e.call(this,t,Y(this)))});if("string"==typeof e&&e)for(a=e.match(Me)||[];n=this[t++];)if(o=Y(n),s=1===n.nodeType&&(" "+o+" ").replace(ut," "),s){for(c=0;d=a[c++];)0>s.indexOf(" "+d+" ")&&(s+=d+" ");r=_e.trim(s),o!==r&&n.setAttribute("class",r)}return this},removeClass:function(e){var t=0,a,n,s,o,d,c,r;if(_e.isFunction(e))return this.each(function(t){_e(this).removeClass(e.call(this,t,Y(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(a=e.match(Me)||[];n=this[t++];)if(o=Y(n),s=1===n.nodeType&&(" "+o+" ").replace(ut," "),s){for(c=0;d=a[c++];)for(;-1<s.indexOf(" "+d+" ");)s=s.replace(" "+d+" "," ");r=_e.trim(s),o!==r&&n.setAttribute("class",r)}return this},toggleClass:function(e,t){var a=typeof e;return"boolean"==typeof t&&"string"===a?t?this.addClass(e):this.removeClass(e):_e.isFunction(e)?this.each(function(a){_e(this).toggleClass(e.call(this,a,Y(this),t),t)}):this.each(function(){var t,n,s,o;if("string"===a)for(n=0,s=_e(this),o=e.match(Me)||[];t=o[n++];)s.hasClass(t)?s.removeClass(t):s.addClass(t);else(void 0===e||"boolean"===a)&&(t=Y(this),t&&je.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":je.get(this,"__className__")||""))})},hasClass:function(e){var t=0,a,n;for(a=" "+e+" ";n=this[t++];)if(1===n.nodeType&&-1<(" "+Y(n)+" ").replace(ut," ").indexOf(a))return!0;return!1}});_e.fn.extend({val:function(e){var t=this[0],a,i,n;return arguments.length?(n=_e.isFunction(e),this.each(function(t){var i;1!==this.nodeType||(i=n?e.call(this,t,_e(this).val()):e,null==i?i="":"number"==typeof i?i+="":_e.isArray(i)&&(i=_e.map(i,function(e){return null==e?"":e+""})),a=_e.valHooks[this.type]||_e.valHooks[this.nodeName.toLowerCase()],(!a||!("set"in a)||void 0===a.set(this,i,"value"))&&(this.value=i))})):t?(a=_e.valHooks[t.type]||_e.valHooks[t.nodeName.toLowerCase()],a&&"get"in a&&void 0!==(i=a.get(t,"value")))?i:(i=t.value,"string"==typeof i?i.replace(/\r/g,""):null==i?"":i):void 0}}),_e.extend({valHooks:{option:{get:function(e){var t=_e.find.attr(e,"value");return null==t?_e.trim(_e.text(e)).replace(/[\x20\t\r\n\f]+/g," "):t}},select:{get:function(e){for(var t=e.options,a=e.selectedIndex,n="select-one"===e.type,s=n?null:[],o=n?a+1:t.length,d=0>a?o:n?a:0,c,r;d<o;d++)if(r=t[d],(r.selected||d===a)&&!r.disabled&&(!r.parentNode.disabled||!_e.nodeName(r.parentNode,"optgroup"))){if(c=_e(r).val(),n)return c;s.push(c)}return s},set:function(e,t){for(var a=e.options,n=_e.makeArray(t),s=a.length,o,d;s--;)d=a[s],(d.selected=-1<_e.inArray(_e.valHooks.option.get(d),n))&&(o=!0);return o||(e.selectedIndex=-1),n}}}}),_e.each(["radio","checkbox"],function(){_e.valHooks[this]={set:function(e,t){if(_e.isArray(t))return e.checked=-1<_e.inArray(_e(e).val(),t)}},Ae.checkOn||(_e.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var mt=/^(?:focusinfocus|focusoutblur)$/;_e.extend(_e.event,{trigger:function(t,a,n,s){var o=[n||oe],d=ge.call(t,"type")?t.type:t,c=ge.call(t,"namespace")?t.namespace.split("."):[],r,l,p,u,m,g,h;if((l=p=n=n||oe,3!==n.nodeType&&8!==n.nodeType)&&!mt.test(d+_e.event.triggered)&&(-1<d.indexOf(".")&&(c=d.split("."),d=c.shift(),c.sort()),m=0>d.indexOf(":")&&"on"+d,t=t[_e.expando]?t:new _e.Event(d,"object"==typeof t&&t),t.isTrigger=s?2:3,t.namespace=c.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+c.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),a=null==a?[t]:_e.makeArray(a,[t]),h=_e.event.special[d]||{},s||!h.trigger||!1!==h.trigger.apply(n,a))){if(!s&&!h.noBubble&&!_e.isWindow(n)){for(u=h.delegateType||d,mt.test(u+d)||(l=l.parentNode);l;l=l.parentNode)o.push(l),p=l;p===(n.ownerDocument||oe)&&o.push(p.defaultView||p.parentWindow||e)}for(r=0;(l=o[r++])&&!t.isPropagationStopped();)t.type=1<r?u:h.bindType||d,g=(je.get(l,"events")||{})[t.type]&&je.get(l,"handle"),g&&g.apply(l,a),g=m&&l[m],g&&g.apply&&Oe(l)&&(t.result=g.apply(l,a),!1===t.result&&t.preventDefault());return t.type=d,s||t.isDefaultPrevented()||h._default&&!1!==h._default.apply(o.pop(),a)||!Oe(n)||!m||!_e.isFunction(n[d])||_e.isWindow(n)||(p=n[m],p&&(n[m]=null),_e.event.triggered=d,n[d](),_e.event.triggered=void 0,p&&(n[m]=p)),t.result}},simulate:function(t,a,i){var n=_e.extend(new _e.Event,i,{type:t,isSimulated:!0});_e.event.trigger(n,null,a)}}),_e.fn.extend({trigger:function(e,t){return this.each(function(){_e.event.trigger(e,t,this)})},triggerHandler:function(e,t){var a=this[0];if(a)return _e.event.trigger(e,t,a,!0)}}),_e.each(["blur","focus","focusin","focusout","resize","scroll","click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","change","select","submit","keydown","keypress","keyup","contextmenu"],function(e,t){_e.fn[t]=function(e,a){return 0<arguments.length?this.on(t,null,e,a):this.trigger(t)}}),_e.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),Ae.focusin="onfocusin"in e,Ae.focusin||_e.each({focus:"focusin",blur:"focusout"},function(e,t){var a=function(e){_e.event.simulate(t,e.target,_e.event.fix(e))};_e.event.special[t]={setup:function(){var i=this.ownerDocument||this,n=je.access(i,t);n||i.addEventListener(e,a,!0),je.access(i,t,(n||0)+1)},teardown:function(){var i=this.ownerDocument||this,n=je.access(i,t)-1;n?je.access(i,t,n):(i.removeEventListener(e,a,!0),je.remove(i,t))}}});var gt=e.location,ht=_e.now(),vt=/\?/;_e.parseXML=function(t){var a;if(!t||"string"!=typeof t)return null;try{a=new e.DOMParser().parseFromString(t,"text/xml")}catch(t){a=void 0}return(!a||a.getElementsByTagName("parsererror").length)&&_e.error("Invalid XML: "+t),a};var At=/\[\]$/,ft=/\r?\n/g;_e.param=function(e,t){var a=[],i=function(e,t){var i=_e.isFunction(t)?t():t;a[a.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)},n;if(_e.isArray(e)||e.jquery&&!_e.isPlainObject(e))_e.each(e,function(){i(this.name,this.value)});else for(n in e)W(n,e[n],t,i);return a.join("&")},_e.fn.extend({serialize:function(){return _e.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=_e.prop(this,"elements");return e?_e.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!_e(this).is(":disabled")&&/^(?:input|select|textarea|keygen)/i.test(this.nodeName)&&!/^(?:submit|button|image|reset|file)$/i.test(e)&&(this.checked||!Ue.test(e))}).map(function(e,t){var a=_e(this).val();return null==a?null:_e.isArray(a)?_e.map(a,function(e){return{name:t.name,value:e.replace(ft,"\r\n")}}):{name:t.name,value:a.replace(ft,"\r\n")}}).get()}});var _t={},bt={},yt="*/".concat("*"),xt=oe.createElement("a");xt.href=gt.href,_e.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(gt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":"*/*",text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":_e.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?J(J(e,_e.ajaxSettings),t):J(_e.ajaxSettings,e)},ajaxPrefilter:Q(_t),ajaxTransport:Q(bt),ajax:function(t,a){function n(t,a,i,n){var p=a,u,m,f,x,S;w||(w=!0,b&&e.clearTimeout(b),h=void 0,A=n||"",g.readyState=0<t?4:0,u=200<=t&&300>t||304===t,i&&(x=Z(o,g,i)),x=K(o,x,g,u),u?(o.ifModified&&(S=g.getResponseHeader("Last-Modified"),S&&(_e.lastModified[v]=S),S=g.getResponseHeader("etag"),S&&(_e.etag[v]=S)),204===t||"HEAD"===o.type?p="nocontent":304===t?p="notmodified":(p=x.state,m=x.data,f=x.error,u=!f)):(f=p,(t||!p)&&(p="error",0>t&&(t=0))),g.status=t,g.statusText=(a||p)+"",u?c.resolveWith(s,[m,p,g]):c.rejectWith(s,[g,p,f]),g.statusCode(l),l=void 0,C&&d.trigger(u?"ajaxSuccess":"ajaxError",[g,o,u?m:f]),r.fireWith(s,[g,p]),C&&(d.trigger("ajaxComplete",[g,o]),! --_e.active&&_e.event.trigger("ajaxStop")))}"object"==typeof t&&(a=t,t=void 0),a=a||{};var o=_e.ajaxSetup({},a),s=o.context||o,d=o.context&&(s.nodeType||s.jquery)?_e(s):_e.event,c=_e.Deferred(),r=_e.Callbacks("once memory"),l=o.statusCode||{},p={},u={},m="canceled",g={readyState:0,getResponseHeader:function(e){var t;if(w){if(!f)for(f={};t=/^(.*?):[ \t]*([^\r\n]*)$/mg.exec(A);)f[t[1].toLowerCase()]=t[2];t=f[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return w?A:null},setRequestHeader:function(e,t){return null==w&&(e=u[e.toLowerCase()]=u[e.toLowerCase()]||e,p[e]=t),this},overrideMimeType:function(e){return null==w&&(o.mimeType=e),this},statusCode:function(e){if(e)if(w)g.always(e[g.status]);else for(var t in e)l[t]=[l[t],e[t]];return this},abort:function(e){var t=e||m;return h&&h.abort(t),n(0,t),this}},h,v,A,f,b,x,w,C,S,k;if(c.promise(g),o.url=((t||o.url||gt.href)+"").replace(/^\/\//,gt.protocol+"//"),o.type=a.method||a.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(Me)||[""],null==o.crossDomain){x=oe.createElement("a");try{x.href=o.url,x.href=x.href,o.crossDomain=xt.protocol+"//"+xt.host!=x.protocol+"//"+x.host}catch(t){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=_e.param(o.data,o.traditional)),X(_t,o,a,g),w)return g;for(S in C=_e.event&&o.global,C&&0==_e.active++&&_e.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!/^(?:GET|HEAD)$/.test(o.type),v=o.url.replace(/#.*$/,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(/%20/g,"+")):(k=o.url.slice(v.length),o.data&&(v+=(vt.test(v)?"&":"?")+o.data,delete o.data),!1===o.cache&&(v=v.replace(/([?&])_=[^&]*/,""),k=(vt.test(v)?"&":"?")+"_="+ht++ +k),o.url=v+k),o.ifModified&&(_e.lastModified[v]&&g.setRequestHeader("If-Modified-Since",_e.lastModified[v]),_e.etag[v]&&g.setRequestHeader("If-None-Match",_e.etag[v])),(o.data&&o.hasContent&&!1!==o.contentType||a.contentType)&&g.setRequestHeader("Content-Type",o.contentType),g.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"===o.dataTypes[0]?"":", */*; q=0.01"):o.accepts["*"]),o.headers)g.setRequestHeader(S,o.headers[S]);if(o.beforeSend&&(!1===o.beforeSend.call(s,g,o)||w))return g.abort();if(m="abort",r.add(o.complete),g.done(o.success),g.fail(o.error),h=X(bt,o,a,g),!h)n(-1,"No Transport");else{if(g.readyState=1,C&&d.trigger("ajaxSend",[g,o]),w)return g;o.async&&0<o.timeout&&(b=e.setTimeout(function(){g.abort("timeout")},o.timeout));try{w=!1,h.send(p,n)}catch(t){if(w)throw t;n(-1,t)}}return g},getJSON:function(e,t,a){return _e.get(e,t,a,"json")},getScript:function(e,t){return _e.get(e,void 0,t,"script")}}),_e.each(["get","post"],function(e,t){_e[t]=function(e,a,i,n){return _e.isFunction(a)&&(n=n||i,i=a,a=void 0),_e.ajax(_e.extend({url:e,type:t,dataType:n,data:a,success:i},_e.isPlainObject(e)&&e))}}),_e._evalUrl=function(e){return _e.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},_e.fn.extend({wrapAll:function(e){var t;return this[0]&&(_e.isFunction(e)&&(e=e.call(this[0])),t=_e(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return _e.isFunction(e)?this.each(function(t){_e(this).wrapInner(e.call(this,t))}):this.each(function(){var t=_e(this),a=t.contents();a.length?a.wrapAll(e):t.append(e)})},wrap:function(e){var t=_e.isFunction(e);return this.each(function(a){_e(this).wrapAll(t?e.call(this,a):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){_e(this).replaceWith(this.childNodes)}),this}}),_e.expr.pseudos.hidden=function(e){return!_e.expr.pseudos.visible(e)},_e.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},_e.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(t){}};var wt={0:200,1223:204},Ct=_e.ajaxSettings.xhr();Ae.cors=!!Ct&&"withCredentials"in Ct,Ae.ajax=Ct=!!Ct,_e.ajaxTransport(function(t){var a,n;if(Ae.cors||Ct&&!t.crossDomain)return{send:function(s,o){var d=t.xhr(),c;if(d.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(c in t.xhrFields)d[c]=t.xhrFields[c];for(c in t.mimeType&&d.overrideMimeType&&d.overrideMimeType(t.mimeType),t.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest"),s)d.setRequestHeader(c,s[c]);a=function(e){return function(){a&&(a=n=d.onload=d.onerror=d.onabort=d.onreadystatechange=null,"abort"===e?d.abort():"error"===e?"number"==typeof d.status?o(d.status,d.statusText):o(0,"error"):o(wt[d.status]||d.status,d.statusText,"text"!==(d.responseType||"text")||"string"!=typeof d.responseText?{binary:d.response}:{text:d.responseText},d.getAllResponseHeaders()))}},d.onload=a(),n=d.onerror=a("error"),void 0===d.onabort?d.onreadystatechange=function(){4===d.readyState&&e.setTimeout(function(){a&&n()})}:d.onabort=n,a=a("abort");try{d.send(t.hasContent&&t.data||null)}catch(t){if(a)throw t}},abort:function(){a&&a()}}}),_e.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),_e.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return _e.globalEval(e),e}}}),_e.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),_e.ajaxTransport("script",function(e){if(e.crossDomain){var t,a;return{send:function(i,n){t=_e("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",a=function(e){t.remove(),a=null,e&&n("error"===e.type?404:200,e.type)}),oe.head.appendChild(t[0])},abort:function(){a&&a()}}}});var St=[],kt=/(=)\?(?=&|$)|\?\?/;_e.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=St.pop()||_e.expando+"_"+ht++;return this[e]=!0,e}}),_e.ajaxPrefilter("json jsonp",function(t,a,i){var n=!1!==t.jsonp&&(kt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&kt.test(t.data)&&"data"),s,o,d;if(n||"jsonp"===t.dataTypes[0])return s=t.jsonpCallback=_e.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,n?t[n]=t[n].replace(kt,"$1"+s):!1!==t.jsonp&&(t.url+=(vt.test(t.url)?"&":"?")+t.jsonp+"="+s),t.converters["script json"]=function(){return d||_e.error(s+" was not called"),d[0]},t.dataTypes[0]="json",o=e[s],e[s]=function(){d=arguments},i.always(function(){void 0===o?_e(e).removeProp(s):e[s]=o,t[s]&&(t.jsonpCallback=a.jsonpCallback,St.push(s)),d&&_e.isFunction(o)&&o(d[0]),d=o=void 0}),"script"}),Ae.createHTMLDocument=function(){var e=oe.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),_e.parseHTML=function(e,t,a){if("string"!=typeof e)return[];"boolean"==typeof t&&(a=t,t=!1);var i,n,s;return(t||(Ae.createHTMLDocument?(t=oe.implementation.createHTMLDocument(""),i=t.createElement("base"),i.href=oe.location.href,t.head.appendChild(i)):t=oe),n=Se.exec(e),s=!a&&[],n)?[t.createElement(n[1])]:(n=b([e],t,s),s&&s.length&&_e(s).remove(),_e.merge([],n.childNodes))},_e.fn.load=function(e,t,a){var i=this,n=e.indexOf(" "),s,o,d;return-1<n&&(s=_e.trim(e.slice(n)),e=e.slice(0,n)),_e.isFunction(t)?(a=t,t=void 0):t&&"object"==typeof t&&(o="POST"),0<i.length&&_e.ajax({url:e,type:o||"GET",dataType:"html",data:t}).done(function(e){d=arguments,i.html(s?_e("<div>").append(_e.parseHTML(e)).find(s):e)}).always(a&&function(e,t){i.each(function(){a.apply(this,d||[e.responseText,t,e])})}),this},_e.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){_e.fn[t]=function(e){return this.on(t,e)}}),_e.expr.pseudos.animated=function(e){return _e.grep(_e.timers,function(t){return e===t.elem}).length},_e.offset={setOffset:function(e,t,a){var i=_e.css(e,"position"),n=_e(e),s={},o,d,c,r,l,p,u;"static"===i&&(e.style.position="relative"),l=n.offset(),c=_e.css(e,"top"),p=_e.css(e,"left"),u=("absolute"===i||"fixed"===i)&&-1<(c+p).indexOf("auto"),u?(o=n.position(),r=o.top,d=o.left):(r=parseFloat(c)||0,d=parseFloat(p)||0),_e.isFunction(t)&&(t=t.call(e,a,_e.extend({},l))),null!=t.top&&(s.top=t.top-l.top+r),null!=t.left&&(s.left=t.left-l.left+d),"using"in t?t.using.call(e,s):n.css(s)}},_e.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){_e.offset.setOffset(this,e,t)});var t=this[0],a,i,n,s;if(t)return t.getClientRects().length?(n=t.getBoundingClientRect(),n.width||n.height?(s=t.ownerDocument,i=ee(s),a=s.documentElement,{top:n.top+i.pageYOffset-a.clientTop,left:n.left+i.pageXOffset-a.clientLeft}):n):{top:0,left:0}},position:function(){if(this[0]){var e=this[0],t={top:0,left:0},a,i;return"fixed"===_e.css(e,"position")?i=e.getBoundingClientRect():(a=this.offsetParent(),i=this.offset(),!_e.nodeName(a[0],"html")&&(t=a.offset()),t={top:t.top+_e.css(a[0],"borderTopWidth",!0),left:t.left+_e.css(a[0],"borderLeftWidth",!0)}),{top:i.top-t.top-_e.css(e,"marginTop",!0),left:i.left-t.left-_e.css(e,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===_e.css(e,"position");)e=e.offsetParent;return e||Qe})}}),_e.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var a="pageYOffset"===t;_e.fn[e]=function(i){return Re(this,function(e,i,n){var s=ee(e);return void 0===n?s?s[t]:e[i]:void(s?s.scrollTo(a?s.pageXOffset:n,a?n:s.pageYOffset):e[i]=n)},e,i,arguments.length)}}),_e.each(["top","left"],function(e,t){_e.cssHooks[t]=O(Ae.pixelPosition,function(e,a){if(a)return a=R(e,t),tt.test(a)?_e(e).position()[t]+"px":a})}),_e.each({Height:"height",Width:"width"},function(e,t){_e.each({padding:"inner"+e,content:t,"":"outer"+e},function(a,i){_e.fn[i]=function(n,s){var o=arguments.length&&(a||"boolean"!=typeof n),d=a||(!0===n||!0===s?"margin":"border");return Re(this,function(t,a,n){var s;return _e.isWindow(t)?0===i.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,ne(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===n?_e.css(t,a,d):_e.style(t,a,n,d)},t,o?n:void 0,o)}})}),_e.fn.extend({bind:function(e,t,a){return this.on(e,null,t,a)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,a,i){return this.on(t,e,a,i)},undelegate:function(e,t,a){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",a)}}),_e.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return _e});var Et=e.jQuery,Tt=e.$;return _e.noConflict=function(t){return e.$===_e&&(e.$=Tt),t&&e.jQuery===_e&&(e.jQuery=Et),_e},t||(e.jQuery=e.$=_e),_e}),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(a,i,n){t.Backbone=e(t,n,a,i)});else if("undefined"!=typeof exports){var a=require("underscore"),i;try{i=require("jquery")}catch(t){}e(t,exports,a,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,a,i){var n=Math.max,s=e.Backbone,o=Array.prototype.slice;t.VERSION="1.3.3",t.$=i,t.noConflict=function(){return e.Backbone=s,this},t.emulateHTTP=!1,t.emulateJSON=!1;var d=function(e,t,i){return 1===e?function(){return a[t](this[i])}:2===e?function(e){return a[t](this[i],e)}:3===e?function(e,n){return a[t](this[i],r(e,this),n)}:4===e?function(e,n,s){return a[t](this[i],r(e,this),n,s)}:function(){var e=o.call(arguments);return e.unshift(this[i]),a[t].apply(a,e)}},c=function(e,t,i){a.each(t,function(t,n){a[n]&&(e.prototype[n]=d(t,n,i))})},r=function(e,t){return a.isFunction(e)?e:a.isObject(e)&&!t._isModel(e)?l(e):a.isString(e)?function(t){return t.get(e)}:e},l=function(e){var t=a.matches(e);return function(e){return t(e.attributes)}},p=t.Events={},u=/\s+/,m=function(e,t,n,s,o){var d=0,c;if(n&&"object"==typeof n)for(void 0!==s&&("context"in o)&&void 0===o.context&&(o.context=s),c=a.keys(n);d<c.length;d++)t=m(e,t,c[d],n[c[d]],o);else if(n&&u.test(n))for(c=n.split(u);d<c.length;d++)t=e(t,c[d],s,o);else t=e(t,n,s,o);return t};p.on=function(e,t,a){return g(this,e,t,a)};var g=function(e,t,a,i,n){if(e._events=m(h,e._events||{},t,a,{context:i,ctx:e,listening:n}),n){var s=e._listeners||(e._listeners={});s[n.id]=n}return e};p.listenTo=function(e,t,i){if(!e)return this;var n=e._listenId||(e._listenId=a.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=s[n];if(!o){var d=this._listenId||(this._listenId=a.uniqueId("l"));o=s[n]={obj:e,objId:n,id:d,listeningTo:s,count:0}}return g(e,t,i,this,o),this};var h=function(e,t,a,i){if(a){var n=e[t]||(e[t]=[]),s=i.context,o=i.ctx,d=i.listening;d&&d.count++,n.push({callback:a,context:s,ctx:s||o,listening:d})}return e};p.off=function(e,t,a){return this._events?(this._events=m(v,this._events,e,t,{context:a,listeners:this._listeners}),this):this},p.stopListening=function(e,t,n){var s=this._listeningTo;if(!s)return this;for(var o=e?[e._listenId]:a.keys(s),d=0,c;d<o.length&&(c=s[o[d]],!!c);d++)c.obj.off(t,n,this);return this};var v=function(e,t,n,s){if(e){var o=0,d=s.context,c=s.listeners,r;if(!t&&!n&&!d){for(var l=a.keys(c);o<l.length;o++)r=c[l[o]],delete c[r.id],delete r.listeningTo[r.objId];return}for(var p=t?[t]:a.keys(e);o<p.length;o++){t=p[o];var u=e[t];if(!u)break;for(var m=[],g=0,h;g<u.length;g++)h=u[g],n&&n!==h.callback&&n!==h.callback._callback||d&&d!==h.context?m.push(h):(r=h.listening,r&&0==--r.count&&(delete c[r.id],delete r.listeningTo[r.objId]));m.length?e[t]=m:delete e[t]}return e}};p.once=function(e,t,i){var n=m(A,{},e,t,a.bind(this.off,this));return"string"==typeof e&&null==i&&(t=void 0),this.on(n,t,i)},p.listenToOnce=function(e,t,i){var n=m(A,{},t,i,a.bind(this.stopListening,this,e));return this.listenTo(e,n)};var A=function(e,t,i,n){if(i){var s=e[t]=a.once(function(){n(t,s),i.apply(this,arguments)});s._callback=i}return e};p.trigger=function(e){if(!this._events)return this;for(var t=n(0,arguments.length-1),a=Array(t),s=0;s<t;s++)a[s]=arguments[s+1];return m(f,this._events,e,void 0,a),this};var f=function(e,t,a,i){if(e){var n=e[t],s=e.all;n&&s&&(s=s.slice()),n&&b(n,i),s&&b(s,[t].concat(i))}return e},b=function(e,t){var a=-1,n=e.length,s=t[0],o=t[1],d=t[2],c;switch(t.length){case 0:for(;++a<n;)(c=e[a]).callback.call(c.ctx);return;case 1:for(;++a<n;)(c=e[a]).callback.call(c.ctx,s);return;case 2:for(;++a<n;)(c=e[a]).callback.call(c.ctx,s,o);return;case 3:for(;++a<n;)(c=e[a]).callback.call(c.ctx,s,o,d);return;default:for(;++a<n;)(c=e[a]).callback.apply(c.ctx,t);}};p.bind=p.on,p.unbind=p.off,a.extend(t,p);var x=t.Model=function(e,t){var i=e||{};t||(t={}),this.cid=a.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{});var n=a.result(this,"defaults");i=a.defaults(a.extend({},n,i),n),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};a.extend(x.prototype,p,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return a.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!a.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var s;if("object"==typeof e?(s=e,n=t):(s={})[e]=t,n||(n={}),!this._validate(s,n))return!1;var o=n.unset,d=n.silent,c=[],r=this._changing;this._changing=!0,r||(this._previousAttributes=a.clone(this.attributes),this.changed={});var l=this.attributes,p=this.changed,u=this._previousAttributes;for(var m in s)t=s[m],a.isEqual(l[m],t)||c.push(m),a.isEqual(u[m],t)?delete p[m]:p[m]=t,o?delete l[m]:l[m]=t;if(this.idAttribute in s&&(this.id=this.get(this.idAttribute)),!d){c.length&&(this._pending=n);for(var g=0;g<c.length;g++)this.trigger("change:"+c[g],this,l[c[g]],n)}if(r)return this;if(!d)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,a.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,a.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!a.isEmpty(this.changed):a.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&a.clone(this.changed);var t=this._changing?this._previousAttributes:this.attributes,i={};for(var n in e){var s=e[n];a.isEqual(t[n],s)||(i[n]=s)}return!!a.size(i)&&i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(e){e=a.extend({parse:!0},e);var t=this,i=e.success;return e.success=function(a){var n=e.parse?t.parse(a,e):a;return!!t.set(n,e)&&void(i&&i.call(e.context,t,a,e),t.trigger("sync",t,a,e))},O(this,e),this.sync("read",this,e)},save:function(e,t,i){var n;null==e||"object"==typeof e?(n=e,i=t):(n={})[e]=t,i=a.extend({validate:!0,parse:!0},i);var s=i.wait;if(n&&!s){if(!this.set(n,i))return!1;}else if(!this._validate(n,i))return!1;var o=this,d=i.success,c=this.attributes;i.success=function(e){o.attributes=c;var t=i.parse?o.parse(e,i):e;return s&&(t=a.extend({},n,t)),(!t||o.set(t,i))&&void(d&&d.call(i.context,o,e,i),o.trigger("sync",o,e,i))},O(this,i),n&&s&&(this.attributes=a.extend({},c,n));var r=this.isNew()?"create":i.patch?"patch":"update";"patch"!=r||i.attrs||(i.attrs=n);var l=this.sync(r,this,i);return this.attributes=c,l},destroy:function(e){e=e?a.clone(e):{};var t=this,i=e.success,n=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(a){n&&s(),i&&i.call(e.context,t,a,e),t.isNew()||t.trigger("sync",t,a,e)};var o=!1;return this.isNew()?a.defer(e.success):(O(this,e),o=this.sync("delete",this,e)),n||s(),o},url:function(){var e=a.result(this,"urlRoot")||a.result(this.collection,"url")||R();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},a.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=a.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,a.extend(t,{validationError:i})),!1)}});c(x,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var w=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,a.extend({silent:!0},t))},C={add:!0,remove:!0,merge:!0},S={add:!0,remove:!1},k=function(e,t,a){a=Math.min(n(a,0),e.length);var s=Array(e.length-a),o=t.length,d;for(d=0;d<s.length;d++)s[d]=e[d+a];for(d=0;d<o;d++)e[d+a]=t[d];for(d=0;d<s.length;d++)e[d+o+a]=s[d]};a.extend(w.prototype,p,{model:x,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,a.extend({merge:!1},t,S))},remove:function(e,t){t=a.extend({},t);var i=!a.isArray(e);e=i?[e]:e.slice();var n=this._removeModels(e,t);return!t.silent&&n.length&&(t.changes={added:[],merged:[],removed:n},this.trigger("update",this,t)),i?n[0]:n},set:function(e,t){if(null!=e){t=a.extend({},C,t),t.parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!a.isArray(e);e=n?[e]:e.slice();var s=t.at;null!=s&&(s=+s),s>this.length&&(s=this.length),0>s&&(s+=this.length+1);var o=[],d=[],c=[],r=[],l={},p=t.add,u=t.merge,m=t.remove,g=!1,h=this.comparator&&null==s&&!1!==t.sort,v=a.isString(this.comparator)?this.comparator:null,A,f;for(f=0;f<e.length;f++){A=e[f];var b=this.get(A);if(b){if(u&&A!==b){var x=this._isModel(A)?A.attributes:A;t.parse&&(x=b.parse(x,t)),b.set(x,t),c.push(b),h&&!g&&(g=b.hasChanged(v))}l[b.cid]||(l[b.cid]=!0,o.push(b)),e[f]=b}else p&&(A=e[f]=this._prepareModel(A,t),A&&(d.push(A),this._addReference(A,t),l[A.cid]=!0,o.push(A)))}if(m){for(f=0;f<this.length;f++)A=this.models[f],l[A.cid]||r.push(A);r.length&&this._removeModels(r,t)}var w=!1;if(o.length&&!h&&p&&m?(w=this.length!==o.length||a.some(this.models,function(e,t){return e!==o[t]}),this.models.length=0,k(this.models,o,0),this.length=this.models.length):d.length&&(h&&(g=!0),k(this.models,d,null==s?this.length:s),this.length=this.models.length),g&&this.sort({silent:!0}),!t.silent){for(f=0;f<d.length;f++)null!=s&&(t.index=s+f),A=d[f],A.trigger("add",A,this,t);(g||w)&&this.trigger("sort",this,t),(d.length||r.length||c.length)&&(t.changes={added:d,removed:r,merged:c},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?a.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,a.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,a.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,a.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return o.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e]||this._byId[this.modelId(e.attributes||e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return 0>e&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var i=t.length;return a.isFunction(t)&&(t=a.bind(t,this)),1===i||a.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){e=a.extend({parse:!0},e);var t=e.success,i=this;return e.success=function(a){var n=e.reset?"reset":"set";i[n](a,e),t&&t.call(e.context,i,a,e),i.trigger("sync",i,a,e)},O(this,e),this.sync("read",this,e)},create:function(e,t){t=t?a.clone(t):{};var i=t.wait;if(e=this._prepareModel(e,t),!e)return!1;i||this.add(e,t);var n=this,s=t.success;return t.success=function(e,t,a){i&&n.add(e,a),s&&s.call(a.context,e,t,a)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?a.clone(t):{},t.collection=this;var i=new this.model(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_removeModels:function(e,t){for(var a=[],n=0,s;n<e.length;n++)if(s=this.get(e[n]),s){var o=this.indexOf(s);this.models.splice(o,1),this.length--,delete this._byId[s.cid];var d=this.modelId(s.attributes);null!=d&&delete this._byId[d],t.silent||(t.index=o,s.trigger("remove",s,this,t)),a.push(s),this._removeReference(s,t)}return a},_isModel:function(e){return e instanceof x},_addReference:function(e){this._byId[e.cid]=e;var t=this.modelId(e.attributes);null!=t&&(this._byId[t]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e){delete this._byId[e.cid];var t=this.modelId(e.attributes);null!=t&&delete this._byId[t],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,a,i){if(t){if(("add"===e||"remove"===e)&&a!==this)return;if("destroy"===e&&this.remove(t,i),"change"===e){var n=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);n!==s&&(null!=n&&delete this._byId[n],null!=s&&(this._byId[s]=t))}}this.trigger.apply(this,arguments)}});c(w,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models");var E=t.View=function(e){this.cid=a.uniqueId("view"),a.extend(this,a.pick(e,T)),this._ensureElement(),this.initialize.apply(this,arguments)},T=["model","collection","el","id","attributes","className","tagName","events"];a.extend(E.prototype,p,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=a.result(this,"events")),!e)return this;for(var t in this.undelegateEvents(),e){var i=e[t];if(a.isFunction(i)||(i=this[i]),i){var n=t.match(/^(\S+)\s*(.*)$/);this.delegate(n[1],n[2],a.bind(i,this))}}return this},delegate:function(e,t,a){return this.$el.on(e+".delegateEvents"+this.cid,t,a),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,a){return this.$el.off(e+".delegateEvents"+this.cid,t,a),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(!this.el){var e=a.extend({},a.result(this,"attributes"));this.id&&(e.id=a.result(this,"id")),this.className&&(e["class"]=a.result(this,"className")),this.setElement(this._createElement(a.result(this,"tagName"))),this._setAttributes(e)}else this.setElement(a.result(this,"el"))},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,i,n){var s=I[e];a.defaults(n||(n={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};if(n.url||(o.url=a.result(i,"url")||R()),null==n.data&&i&&("create"===e||"update"===e||"patch"===e)&&(o.contentType="application/json",o.data=JSON.stringify(n.attrs||i.toJSON(n))),n.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),n.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",n.emulateJSON&&(o.data._method=s);var d=n.beforeSend;n.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",s),d)return d.apply(this,arguments)}}"GET"===o.type||n.emulateJSON||(o.processData=!1);var c=n.error;n.error=function(e,t,a){n.textStatus=t,n.errorThrown=a,c&&c.call(n.context,e,t,a)};var r=n.xhr=t.ajax(a.extend(o,n));return i.trigger("request",i,r,n),r};var I={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var M=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};a.extend(M.prototype,p,{initialize:function(){},route:function(e,i,n){a.isRegExp(e)||(e=this._routeToRegExp(e)),a.isFunction(i)&&(n=i,i=""),n||(n=this[i]);var s=this;return t.history.route(e,function(a){var o=s._extractParameters(e,a);!1!==s.execute(n,o,i)&&(s.trigger.apply(s,["route:"+i].concat(o)),s.trigger("route",i,o),t.history.trigger("route",s,i,o))}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,a){return t.history.navigate(e,a),this},_bindRoutes:function(){if(this.routes){this.routes=a.result(this,"routes");for(var e=a.keys(this.routes),t;null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(e){return e=e.replace(/[\-{}\[\]+?.,\\\^$|#\s]/g,"\\$&").replace(/\((.*?)\)/g,"(?:$1)?").replace(/(\(\?)?:\w+/g,function(e,t){return t?e:"([^/?]+)"}).replace(/\*\w+/g,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return a.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var N=t.History=function(){this.handlers=[],this.checkUrl=a.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)};N.started=!1,a.extend(N.prototype,p,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(this._usePushState||!this._wantsHashChange?e=this.getPath():e=this.getHash()),e.replace(/^[#\/]|\s+$/g,"")},start:function(e){if(N.started)throw new Error("Backbone.history has already been started");if(N.started=!0,this.options=a.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.history&&this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(/^\/+|\/+$/g,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,n=i.insertBefore(this.iframe,i.firstChild).contentWindow;n.document.open(),n.document.close(),n.location.hash="#"+this.fragment}var s=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),N.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e!==this.fragment&&void(this.iframe&&this.navigate(e),this.loadUrl())},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),a.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(e,t){if(!N.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var a=this.root;(""===e||"?"===e.charAt(0))&&(a=a.slice(0,-1)||"/");var i=a+e;if(e=this.decodeFragment(e.replace(/#.*$/,"")),this.fragment!==e){if(this.fragment=e,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var n=this.iframe.contentWindow;t.replace||(n.document.open(),n.document.close()),this._updateHash(n.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,a){if(a){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new N;x.extend=w.extend=M.extend=E.extend=N.extend=function(e,t){var i=this,n;return n=e&&a.has(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)},a.extend(n,i,t),n.prototype=a.create(i.prototype,e),n.prototype.constructor=n,n.__super__=i.prototype,n};var R=function(){throw new Error("A \"url\" property or function must be specified")},O=function(e,t){var a=t.error;t.error=function(i){a&&a.call(t.context,e,i,t),e.trigger("error",e,i,t)}};return t});(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("moment",t):e.moment=t()})(this,function(){'use strict';var Gt=Math.round,zt=Math.abs,Yt=Math.ceil,Wt=Math.floor,Qt=Math.pow,Xt=Math.min,Jt=Math.max;function e(){return Zt.apply(null,arguments)}function t(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function a(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function s(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;for(var t in e)if(n(e,t))return!1;return!0}function o(e){return void 0===e}function d(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function c(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function r(e,t){var a=[],n;for(n=0;n<e.length;++n)a.push(t(e[n],n));return a}function l(e,t){for(var a in t)n(t,a)&&(e[a]=t[a]);return n(t,"toString")&&(e.toString=t.toString),n(t,"valueOf")&&(e.valueOf=t.valueOf),e}function p(e,t,a,i){return We(e,t,a,i,!0).utc()}function u(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function g(e){return null==e._pf&&(e._pf=u()),e._pf}function h(e){if(null==e._isValid){var t=g(e),a=Kt.call(t.parsedDateParts,function(e){return null!=e}),i=!isNaN(e._d.getTime())&&0>t.overflow&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&a);if(e._strict&&(i=i&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null==Object.isFrozen||!Object.isFrozen(e))e._isValid=i;else return i}return e._isValid}function v(e){var t=p(NaN);return null==e?g(t).userInvalidated=!0:l(g(t),e),t}function A(e,t){var a,n,s;if(o(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),o(t._i)||(e._i=t._i),o(t._f)||(e._f=t._f),o(t._l)||(e._l=t._l),o(t._strict)||(e._strict=t._strict),o(t._tzm)||(e._tzm=t._tzm),o(t._isUTC)||(e._isUTC=t._isUTC),o(t._offset)||(e._offset=t._offset),o(t._pf)||(e._pf=g(t)),o(t._locale)||(e._locale=t._locale),0<ea.length)for(a=0;a<ea.length;a++)n=ea[a],s=t[n],o(s)||(e[n]=s);return e}function f(t){A(this,t),this._d=new Date(null==t._d?NaN:t._d.getTime()),this.isValid()||(this._d=new Date(NaN)),!1===ta&&(ta=!0,e.updateOffset(this),ta=!1)}function b(e){return e instanceof f||null!=e&&null!=e._isAMomentObject}function x(t){!1===e.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function w(t,a){var s=!0;return l(function(){if(null!=e.deprecationHandler&&e.deprecationHandler(null,t),s){var o=[],d,c,r;for(c=0;c<arguments.length;c++){if(d="","object"==typeof arguments[c]){for(r in d+="\n["+c+"] ",arguments[0])n(arguments[0],r)&&(d+=r+": "+arguments[0][r]+", ");d=d.slice(0,-2)}else d=arguments[c];o.push(d)}x(t+"\nArguments: "+Array.prototype.slice.call(o).join("")+"\n"+new Error().stack),s=!1}return a.apply(this,arguments)},a)}function C(t,a){null!=e.deprecationHandler&&e.deprecationHandler(t,a),aa[t]||(x(a),aa[t]=!0)}function S(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function k(e,t){var i=l({},e),s;for(s in t)n(t,s)&&(a(e[s])&&a(t[s])?(i[s]={},l(i[s],e[s]),l(i[s],t[s])):null==t[s]?delete i[s]:i[s]=t[s]);for(s in e)n(e,s)&&!n(t,s)&&a(e[s])&&(i[s]=l({},i[s]));return i}function E(e){null!=e&&this.set(e)}function T(e,t,a){var i=""+zt(e),n=t-i.length;return(0<=e?a?"+":"":"-")+Qt(10,Jt(0,n)).toString().substr(1)+i}function I(e,t,a,i){var n=i;"string"==typeof i&&(n=function(){return this[i]()}),e&&(da[e]=n),t&&(da[t[0]]=function(){return T(n.apply(this,arguments),t[1],t[2])}),a&&(da[a]=function(){return this.localeData().ordinal(n.apply(this,arguments),e)})}function M(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function N(e){var t=e.match(na),a,n;for(a=0,n=t.length;a<n;a++)t[a]=da[t[a]]?da[t[a]]:M(t[a]);return function(a){var s="",o;for(o=0;o<n;o++)s+=S(t[o])?t[o].call(a,e):t[o];return s}}function R(e,t){return e.isValid()?(t=O(t,e.localeData()),oa[t]=oa[t]||N(t),oa[t](e)):e.localeData().invalidDate()}function O(e,t){function a(e){return t.longDateFormat(e)||e}var n=5;for(sa.lastIndex=0;0<=n&&sa.test(e);)e=e.replace(sa,a),sa.lastIndex=0,n-=1;return e}function j(e,t){var a=e.toLowerCase();ca[a]=ca[a+"s"]=ca[t]=e}function P(e){return"string"==typeof e?ca[e]||ca[e.toLowerCase()]:void 0}function D(e){var t={},a,i;for(i in e)n(e,i)&&(a=P(i),a&&(t[a]=e[i]));return t}function B(e,t){ra[e]=t}function L(e){var t=[],a;for(a in e)n(e,a)&&t.push({unit:a,priority:ra[a]});return t.sort(function(e,t){return e.priority-t.priority}),t}function V(e){return 0==e%4&&0!=e%100||0==e%400}function H(e){return 0>e?Yt(e)||0:Wt(e)}function q(e){var t=+e,a=0;return 0!=t&&isFinite(t)&&(a=H(t)),a}function F(t,a){return function(i){return null==i?U(this,t):(G(this,t,i),e.updateOffset(this,a),this)}}function U(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function G(e,t,a){e.isValid()&&!isNaN(a)&&("FullYear"===t&&V(e.year())&&1===e.month()&&29===e.date()?(a=q(a),e._d["set"+(e._isUTC?"UTC":"")+t](a,e.month(),ee(a,e.month()))):e._d["set"+(e._isUTC?"UTC":"")+t](a))}function z(e,t,a){Sa[e]=S(t)?t:function(e){return e&&a?a:t}}function Y(e,t){return n(Sa,e)?Sa[e](t._strict,t._locale):new RegExp(W(e))}function W(e){return Q(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,a,i,n){return t||a||i||n}))}function Q(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function X(e,t){var a=t,n;for("string"==typeof e&&(e=[e]),d(t)&&(a=function(e,a){a[t]=q(e)}),n=0;n<e.length;n++)ka[e[n]]=a}function J(e,t){X(e,function(e,a,i,n){i._w=i._w||{},t(e,i._w,i,n)})}function Z(e,t,a){null!=t&&n(ka,e)&&ka[e](t,a._a,a,e)}function K(e,t){return(e%t+t)%t}function ee(e,t){if(isNaN(e)||isNaN(t))return NaN;var a=K(t,12);return e+=(t-a)/12,1===a?V(e)?29:28:31-a%7%2}function te(e,t,a){var n=e.toLocaleLowerCase(),s,o,d;if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;12>s;++s)d=p([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(d,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(d,"").toLocaleLowerCase();return a?"MMM"===t?(o=Oa.call(this._shortMonthsParse,n),-1===o?null:o):(o=Oa.call(this._longMonthsParse,n),-1===o?null:o):"MMM"===t?(o=Oa.call(this._shortMonthsParse,n),-1!==o)?o:(o=Oa.call(this._longMonthsParse,n),-1===o?null:o):(o=Oa.call(this._longMonthsParse,n),-1!==o)?o:(o=Oa.call(this._shortMonthsParse,n),-1===o?null:o)}function ae(e,t){var a;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=q(t);else if(t=e.localeData().monthsParse(t),!d(t))return e;return a=Xt(e.date(),ee(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,a),e}function ie(t){return null==t?U(this,"Month"):(ae(this,t),e.updateOffset(this,!0),this)}function ne(){function e(e,t){return t.length-e.length}var t=[],a=[],n=[],s,o;for(s=0;12>s;s++)o=p([2e3,s]),t.push(this.monthsShort(o,"")),a.push(this.months(o,"")),n.push(this.months(o,"")),n.push(this.monthsShort(o,""));for(t.sort(e),a.sort(e),n.sort(e),s=0;12>s;s++)t[s]=Q(t[s]),a[s]=Q(a[s]);for(s=0;24>s;s++)n[s]=Q(n[s]);this._monthsRegex=new RegExp("^("+n.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+t.join("|")+")","i")}function se(e){return V(e)?366:365}function oe(e,t,a,i,n,o,s){var d;return 100>e&&0<=e?(d=new Date(e+400,t,a,i,n,o,s),isFinite(d.getFullYear())&&d.setFullYear(e)):d=new Date(e,t,a,i,n,o,s),d}function de(e){var t,a;return 100>e&&0<=e?(a=Array.prototype.slice.call(arguments),a[0]=e+400,t=new Date(Date.UTC.apply(null,a)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function ce(e,t,a){var i=7+t-a,n=(7+de(e,0,i).getUTCDay()-t)%7;return-n+i-1}function re(e,t,a,i,n){var s=ce(e,i,n),o=1+7*(t-1)+(7+a-i)%7+s,d,c;return 0>=o?(d=e-1,c=se(d)+o):o>se(e)?(d=e+1,c=o-se(e)):(d=e,c=o),{year:d,dayOfYear:c}}function le(e,t,a){var i=ce(e.year(),t,a),n=Wt((e.dayOfYear()-i-1)/7)+1,s,o;return 1>n?(o=e.year()-1,s=n+pe(o,t,a)):n>pe(e.year(),t,a)?(s=n-pe(e.year(),t,a),o=e.year()+1):(o=e.year(),s=n),{week:s,year:o}}function pe(e,t,a){var i=ce(e,t,a),n=ce(e+1,t,a);return(se(e)-i+n)/7}function ue(e,t){return"string"==typeof e?isNaN(e)?(e=t.weekdaysParse(e),"number"==typeof e?e:null):parseInt(e,10):e}function me(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}function ge(e,t){return e.slice(t,7).concat(e.slice(0,t))}function he(e,t,a){var n=e.toLocaleLowerCase(),s,o,d;if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;7>s;++s)d=p([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(d,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(d,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(d,"").toLocaleLowerCase();return a?"dddd"===t?(o=Oa.call(this._weekdaysParse,n),-1===o?null:o):"ddd"===t?(o=Oa.call(this._shortWeekdaysParse,n),-1===o?null:o):(o=Oa.call(this._minWeekdaysParse,n),-1===o?null:o):"dddd"===t?(o=Oa.call(this._weekdaysParse,n),-1!==o)?o:(o=Oa.call(this._shortWeekdaysParse,n),-1!==o)?o:(o=Oa.call(this._minWeekdaysParse,n),-1===o?null:o):"ddd"===t?(o=Oa.call(this._shortWeekdaysParse,n),-1!==o)?o:(o=Oa.call(this._weekdaysParse,n),-1!==o)?o:(o=Oa.call(this._minWeekdaysParse,n),-1===o?null:o):(o=Oa.call(this._minWeekdaysParse,n),-1!==o)?o:(o=Oa.call(this._weekdaysParse,n),-1!==o)?o:(o=Oa.call(this._shortWeekdaysParse,n),-1===o?null:o)}function ve(){function e(e,t){return t.length-e.length}var t=[],a=[],n=[],s=[],o,d,c,r,l;for(o=0;7>o;o++)d=p([2e3,1]).day(o),c=Q(this.weekdaysMin(d,"")),r=Q(this.weekdaysShort(d,"")),l=Q(this.weekdays(d,"")),t.push(c),a.push(r),n.push(l),s.push(c),s.push(r),s.push(l);t.sort(e),a.sort(e),n.sort(e),s.sort(e),this._weekdaysRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+n.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+t.join("|")+")","i")}function Ae(){return this.hours()%12||12}function fe(e,t){I(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function _e(e,t){return t._meridiemParse}function be(e,t){var a=Xt(e.length,t.length),n;for(n=0;n<a;n+=1)if(e[n]!==t[n])return n;return a}function ye(e){return e?e.toLowerCase().replace("_","-"):e}function xe(e){for(var t=0,a,n,s,o;t<e.length;){for(o=ye(e[t]).split("-"),a=o.length,n=ye(e[t+1]),n=n?n.split("-"):null;0<a;){if(s=we(o.slice(0,a).join("-")),s)return s;if(n&&n.length>=a&&be(o,n)>=a-1)break;a--}t++}return Xa}function we(t){var a=null,i;if(void 0===Va[t]&&"undefined"!=typeof module&&module&&module.exports)try{a=Xa._abbr,i=require,i("./locale/"+t),Ce(a)}catch(a){Va[t]=null}return Va[t]}function Ce(e,t){var a;return e&&(a=o(t)?ke(e):Se(e,t),a?Xa=a:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),Xa._abbr}function Se(e,t){if(null!==t){var a=$a,i;if(t.abbr=e,null!=Va[e])C("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),a=Va[e]._config;else if(null!=t.parentLocale)if(null!=Va[t.parentLocale])a=Va[t.parentLocale]._config;else if(i=we(t.parentLocale),null!=i)a=i._config;else return Ha[t.parentLocale]||(Ha[t.parentLocale]=[]),Ha[t.parentLocale].push({name:e,config:t}),null;return Va[e]=new E(k(a,t)),Ha[e]&&Ha[e].forEach(function(e){Se(e.name,e.config)}),Ce(e),Va[e]}return delete Va[e],null}function ke(e){var a;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Xa;if(!t(e)){if(a=we(e),a)return a;e=[e]}return xe(e)}function Ee(){return ia(Va)}function Te(e){var t=e._a,a;return t&&-2===g(e).overflow&&(a=0>t[1]||11<t[1]?1:1>t[2]||t[2]>ee(t[0],t[1])?2:0>t[3]||24<t[3]||24===t[3]&&(0!==t[4]||0!==t[5]||0!==t[6])?3:0>t[4]||59<t[4]?4:0>t[5]||59<t[5]?5:0>t[6]||999<t[6]?6:-1,g(e)._overflowDayOfYear&&(0>a||2<a)&&(a=2),g(e)._overflowWeeks&&-1===a&&(a=7),g(e)._overflowWeekday&&-1===a&&(a=8),g(e).overflow=a),e}function Ie(e){var t=e._i,a=qa.exec(t)||Fa.exec(t),n,s,o,d,c,r;if(a){for(g(e).iso=!0,n=0,s=Ga.length;n<s;n++)if(Ga[n][1].exec(a[1])){d=Ga[n][0],o=!1!==Ga[n][2];break}if(null==d)return void(e._isValid=!1);if(a[3]){for(n=0,s=za.length;n<s;n++)if(za[n][1].exec(a[3])){c=(a[2]||" ")+za[n][0];break}if(null==c)return void(e._isValid=!1)}if(!o&&null!=c)return void(e._isValid=!1);if(a[4])if(Ua.exec(a[4]))r="Z";else return void(e._isValid=!1);e._f=d+(c||"")+(r||""),He(e)}else e._isValid=!1}function Me(e,t,a,i,n,s){var o=[Ne(e),ja.indexOf(t),parseInt(a,10),parseInt(i,10),parseInt(n,10)];return s&&o.push(parseInt(s,10)),o}function Ne(e){var t=parseInt(e,10);return 49>=t?2e3+t:999>=t?1900+t:t}function Re(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Oe(e,t,a){if(e){var i=Ba.indexOf(e),n=new Date(t[0],t[1],t[2]).getDay();if(i!==n)return g(a).weekdayMismatch=!0,a._isValid=!1,!1}return!0}function je(e,t,a){if(e)return Qa[e];if(t)return 0;var i=parseInt(a,10),n=i%100;return 60*((i-n)/100)+n}function Pe(e){var t=Wa.exec(Re(e._i)),a;if(t){if(a=Me(t[4],t[3],t[2],t[5],t[6],t[7]),!Oe(t[1],a,e))return;e._a=a,e._tzm=je(t[8],t[9],t[10]),e._d=de.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),g(e).rfc2822=!0}else e._isValid=!1}function De(t){var a=Ya.exec(t._i);if(null!==a)return void(t._d=new Date(+a[1]));if(Ie(t),!1===t._isValid)delete t._isValid;else return;if(Pe(t),!1===t._isValid)delete t._isValid;else return;t._strict?t._isValid=!1:e.createFromInputFallback(t)}function Be(e,t,a){return null==e?null==t?a:t:e}function Le(t){var a=new Date(e.now());return t._useUTC?[a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()]:[a.getFullYear(),a.getMonth(),a.getDate()]}function $e(e){var t=[],a,n,s,o,d;if(!e._d){for(s=Le(e),e._w&&null==e._a[2]&&null==e._a[1]&&Ve(e),null!=e._dayOfYear&&(d=Be(e._a[0],s[0]),(e._dayOfYear>se(d)||0===e._dayOfYear)&&(g(e)._overflowDayOfYear=!0),n=de(d,0,e._dayOfYear),e._a[1]=n.getUTCMonth(),e._a[2]=n.getUTCDate()),a=0;3>a&&null==e._a[a];++a)e._a[a]=t[a]=s[a];for(;7>a;a++)e._a[a]=t[a]=null==e._a[a]?2===a?1:0:e._a[a];24===e._a[3]&&0===e._a[4]&&0===e._a[5]&&0===e._a[6]&&(e._nextDay=!0,e._a[3]=0),e._d=(e._useUTC?de:oe).apply(null,t),o=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[3]=24),e._w&&"undefined"!=typeof e._w.d&&e._w.d!==o&&(g(e).weekdayMismatch=!0)}}function Ve(e){var t,a,i,n,s,o,d,c,r;t=e._w,null!=t.GG||null!=t.W||null!=t.E?(s=1,o=4,a=Be(t.GG,e._a[0],le(Qe(),1,4).year),i=Be(t.W,1),n=Be(t.E,1),(1>n||7<n)&&(c=!0)):(s=e._locale._week.dow,o=e._locale._week.doy,r=le(Qe(),s,o),a=Be(t.gg,e._a[0],r.year),i=Be(t.w,r.week),null==t.d?null==t.e?n=s:(n=t.e+s,(0>t.e||6<t.e)&&(c=!0)):(n=t.d,(0>n||6<n)&&(c=!0))),1>i||i>pe(a,s,o)?g(e)._overflowWeeks=!0:null==c?(d=re(a,i,n,s,o),e._a[0]=d.year,e._dayOfYear=d.dayOfYear):g(e)._overflowWeekday=!0}function He(t){if(t._f===e.ISO_8601)return void Ie(t);if(t._f===e.RFC_2822)return void Pe(t);t._a=[],g(t).empty=!0;var a=""+t._i,n=a.length,s=0,o,d,c,r,l,p;for(c=O(t._f,t._locale).match(na)||[],o=0;o<c.length;o++)r=c[o],d=(a.match(Y(r,t))||[])[0],d&&(l=a.substr(0,a.indexOf(d)),0<l.length&&g(t).unusedInput.push(l),a=a.slice(a.indexOf(d)+d.length),s+=d.length),da[r]?(d?g(t).empty=!1:g(t).unusedTokens.push(r),Z(r,d,t)):t._strict&&!d&&g(t).unusedTokens.push(r);g(t).charsLeftOver=n-s,0<a.length&&g(t).unusedInput.push(a),12>=t._a[3]&&!0===g(t).bigHour&&0<t._a[3]&&(g(t).bigHour=void 0),g(t).parsedDateParts=t._a.slice(0),g(t).meridiem=t._meridiem,t._a[3]=qe(t._locale,t._a[3],t._meridiem),p=g(t).era,null!==p&&(t._a[0]=t._locale.erasConvertYear(p,t._a[0])),$e(t),Te(t)}function qe(e,t,a){var i;return null==a?t:null==e.meridiemHour?null==e.isPM?t:(i=e.isPM(a),i&&12>t&&(t+=12),i||12!==t||(t=0),t):e.meridiemHour(t,a)}function Fe(e){var t=!1,a,n,s,o,d,c;if(0===e._f.length)return g(e).invalidFormat=!0,void(e._d=new Date(NaN));for(o=0;o<e._f.length;o++)d=0,c=!1,a=A({},e),null!=e._useUTC&&(a._useUTC=e._useUTC),a._f=e._f[o],He(a),h(a)&&(c=!0),d+=g(a).charsLeftOver,d+=10*g(a).unusedTokens.length,g(a).score=d,t?d<s&&(s=d,n=a):(null==s||d<s||c)&&(s=d,n=a,c&&(t=!0));l(e,n||a)}function Ue(e){if(!e._d){var t=D(e._i),a=void 0===t.day?t.date:t.day;e._a=r([t.year,t.month,a,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),$e(e)}}function Ge(e){var t=new f(Te(ze(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function ze(e){var a=e._i,i=e._f;return(e._locale=e._locale||ke(e._l),null===a||void 0===i&&""===a)?v({nullInput:!0}):("string"==typeof a&&(e._i=a=e._locale.preparse(a)),b(a))?new f(Te(a)):(c(a)?e._d=a:t(i)?Fe(e):i?He(e):Ye(e),h(e)||(e._d=null),e)}function Ye(i){var n=i._i;o(n)?i._d=new Date(e.now()):c(n)?i._d=new Date(n.valueOf()):"string"==typeof n?De(i):t(n)?(i._a=r(n.slice(0),function(e){return parseInt(e,10)}),$e(i)):a(n)?Ue(i):d(n)?i._d=new Date(n):e.createFromInputFallback(i)}function We(e,i,n,o,d){var r={};return(!0===i||!1===i)&&(o=i,i=void 0),(!0===n||!1===n)&&(o=n,n=void 0),(a(e)&&s(e)||t(e)&&0===e.length)&&(e=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=d,r._l=n,r._i=e,r._f=i,r._strict=o,Ge(r)}function Qe(e,t,a,i){return We(e,t,a,i,!1)}function Xe(e,a){var n,s;if(1===a.length&&t(a[0])&&(a=a[0]),!a.length)return Qe();for(n=a[0],s=1;s<a.length;++s)(!a[s].isValid()||a[s][e](n))&&(n=a[s]);return n}function Je(e){var t=!1,a,s;for(a in e)if(n(e,a)&&(-1===Oa.call(Ka,a)||null!=e[a]&&isNaN(e[a])))return!1;for(s=0;s<Ka.length;++s)if(e[Ka[s]]){if(t)return!1;parseFloat(e[Ka[s]])!==q(e[Ka[s]])&&(t=!0)}return!0}function Ze(e){var t=D(e),a=t.year||0,i=t.quarter||0,n=t.month||0,s=t.week||t.isoWeek||0,o=t.day||0,d=t.hour||0,c=t.minute||0,r=t.second||0,l=t.millisecond||0;this._isValid=Je(t),this._milliseconds=+l+1e3*r+6e4*c+60*(60*(1e3*d)),this._days=+o+7*s,this._months=+n+3*i+12*a,this._data={},this._locale=ke(),this._bubble()}function Ke(e){return e instanceof Ze}function et(e){return 0>e?-1*Gt(-1*e):Gt(e)}function tt(e,t,a){var n=Xt(e.length,t.length),s=zt(e.length-t.length),o=0,d;for(d=0;d<n;d++)(a&&e[d]!==t[d]||!a&&q(e[d])!==q(t[d]))&&o++;return o+s}function at(e,t){I(e,0,0,function(){var e=this.utcOffset(),a="+";return 0>e&&(e=-e,a="-"),a+T(~~(e/60),2)+t+T(~~e%60,2)})}function it(e,t){var a=(t||"").match(e),i,n,s;return null===a?null:(i=a[a.length-1]||[],n=(i+"").match(ei)||["-",0,0],s=+(60*n[1])+q(n[2]),0===s?0:"+"===n[0]?s:-s)}function nt(t,a){var i,n;return a._isUTC?(i=a.clone(),n=(b(t)||c(t)?t.valueOf():Qe(t).valueOf())-i.valueOf(),i._d.setTime(i._d.valueOf()+n),e.updateOffset(i,!1),i):Qe(t).local()}function st(e){return-Gt(e._d.getTimezoneOffset())}function ot(){return!!this.isValid()&&this._isUTC&&0===this._offset}function dt(e,t){var a=e,i=null,s,o,c;return Ke(e)?a={ms:e._milliseconds,d:e._days,M:e._months}:d(e)||!isNaN(+e)?(a={},t?a[t]=+e:a.milliseconds=+e):(i=ti.exec(e))?(s="-"===i[1]?-1:1,a={y:0,d:q(i[2])*s,h:q(i[3])*s,m:q(i[4])*s,s:q(i[5])*s,ms:q(et(1e3*i[6]))*s}):(i=ai.exec(e))?(s="-"===i[1]?-1:1,a={y:ct(i[2],s),M:ct(i[3],s),w:ct(i[4],s),d:ct(i[5],s),h:ct(i[6],s),m:ct(i[7],s),s:ct(i[8],s)}):null==a?a={}:"object"==typeof a&&("from"in a||"to"in a)&&(c=lt(Qe(a.from),Qe(a.to)),a={},a.ms=c.milliseconds,a.M=c.months),o=new Ze(a),Ke(e)&&n(e,"_locale")&&(o._locale=e._locale),Ke(e)&&n(e,"_isValid")&&(o._isValid=e._isValid),o}function ct(e,t){var a=e&&parseFloat(e.replace(",","."));return(isNaN(a)?0:a)*t}function rt(e,t){var a={};return a.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(a.months,"M").isAfter(t)&&--a.months,a.milliseconds=+t-+e.clone().add(a.months,"M"),a}function lt(e,t){var a;return e.isValid()&&t.isValid()?(t=nt(t,e),e.isBefore(t)?a=rt(e,t):(a=rt(t,e),a.milliseconds=-a.milliseconds,a.months=-a.months),a):{milliseconds:0,months:0}}function pt(e,t){return function(a,i){var n,s;return null===i||isNaN(+i)||(C(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),s=a,a=i,i=s),n=dt(a,i),ut(this,n,e),this}}function ut(t,a,i,n){var s=a._milliseconds,o=et(a._days),d=et(a._months);t.isValid()&&(n=null==n||n,d&&ae(t,U(t,"Month")+d*i),o&&G(t,"Date",U(t,"Date")+o*i),s&&t._d.setTime(t._d.valueOf()+s*i),n&&e.updateOffset(t,o||d))}function mt(e){return"string"==typeof e||e instanceof String}function gt(e){return b(e)||c(e)||mt(e)||d(e)||vt(e)||ht(e)||null===e||void 0===e}function ht(e){var t=a(e)&&!s(e),o=!1,d=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],c,r;for(c=0;c<d.length;c+=1)r=d[c],o=o||n(e,r);return t&&o}function vt(e){var a=t(e),i=!1;return a&&(i=0===e.filter(function(t){return!d(t)&&mt(e)}).length),a&&i}function At(e){var t=a(e)&&!s(e),o=!1,d=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],c,r;for(c=0;c<d.length;c+=1)r=d[c],o=o||n(e,r);return t&&o}function ft(e,t){if(e.date()<t.date())return-ft(t,e);var a=12*(t.year()-e.year())+(t.month()-e.month()),i=e.clone().add(a,"months"),n,s;return 0>t-i?(n=e.clone().add(a-1,"months"),s=(t-i)/(i-n)):(n=e.clone().add(a+1,"months"),s=(t-i)/(n-i)),-(a+s)||0}function _t(e){var t;return void 0===e?this._locale._abbr:(t=ke(e),null!=t&&(this._locale=t),this)}function bt(){return this._locale}function yt(e,t){return(e%t+t)%t}function xt(e,t,a){return 100>e&&0<=e?new Date(e+400,t,a)-12622780800000:new Date(e,t,a).valueOf()}function wt(e,t,a){return 100>e&&0<=e?Date.UTC(e+400,t,a)-12622780800000:Date.UTC(e,t,a)}function Ct(e,t){return t.erasAbbrRegex(e)}function St(){var e=[],t=[],a=[],n=[],s=this.eras(),o,d;for(o=0,d=s.length;o<d;++o)t.push(Q(s[o].name)),e.push(Q(s[o].abbr)),a.push(Q(s[o].narrow)),n.push(Q(s[o].name)),n.push(Q(s[o].abbr)),n.push(Q(s[o].narrow));this._erasRegex=new RegExp("^("+n.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+t.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+e.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+a.join("|")+")","i")}function kt(e,t){I(0,[e,e.length],0,t)}function Et(e,t,a,i,n){var s;return null==e?le(this,i,n).year:(s=pe(e,i,n),t>s&&(t=s),Tt.call(this,e,t,a,i,n))}function Tt(e,t,a,i,n){var s=re(e,t,a,i,n),o=de(s.year,0,s.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}function It(e,t){t[6]=q(1e3*("0."+e))}function Mt(e){return e}function Nt(e,t,a,i){var n=ke(),s=p().set(i,t);return n[a](s,e)}function Rt(e,t,a){if(d(e)&&(t=e,e=void 0),e=e||"",null!=t)return Nt(e,t,a,"month");var n=[],s;for(s=0;12>s;s++)n[s]=Nt(e,s,a,"month");return n}function Ot(e,t,a,n){"boolean"==typeof e?(d(t)&&(a=t,t=void 0),t=t||""):(t=e,a=t,e=!1,d(t)&&(a=t,t=void 0),t=t||"");var s=ke(),o=e?s._week.dow:0,c=[],r;if(null!=a)return Nt(t,(a+o)%7,n,"day");for(r=0;7>r;r++)c[r]=Nt(t,(r+o)%7,n,"day");return c}function jt(e,t,a,i){var n=dt(t,a);return e._milliseconds+=i*n._milliseconds,e._days+=i*n._days,e._months+=i*n._months,e._bubble()}function Pt(e){return 0>e?Wt(e):Yt(e)}function Dt(e){return 4800*e/146097}function Bt(e){return 146097*e/4800}function Lt(e){return function(){return this.as(e)}}function $t(e){return function(){return this.isValid()?this._data[e]:NaN}}function Vt(e,t,a,i,n){return n.relativeTime(t||1,!!a,e,i)}function Ht(e,t,i,n){var s=dt(e).abs(),o=Mi(s.as("s")),d=Mi(s.as("m")),c=Mi(s.as("h")),r=Mi(s.as("d")),l=Mi(s.as("M")),p=Mi(s.as("w")),u=Mi(s.as("y")),m=o<=i.ss&&["s",o]||o<i.s&&["ss",o]||1>=d&&["m"]||d<i.m&&["mm",d]||1>=c&&["h"]||c<i.h&&["hh",c]||1>=r&&["d"]||r<i.d&&["dd",r];return null!=i.w&&(m=m||1>=p&&["w"]||p<i.w&&["ww",p]),m=m||1>=l&&["M"]||l<i.M&&["MM",l]||1>=u&&["y"]||["yy",u],m[2]=t,m[3]=0<+e,m[4]=n,Vt.apply(null,m)}function qt(e){return void 0===e?Mi:"function"==typeof e&&(Mi=e,!0)}function Ft(e){return(0<e)-(0>e)||+e}function Ut(){if(!this.isValid())return this.localeData().invalidDate();var e=Ri(this._milliseconds)/1e3,t=Ri(this._days),a=Ri(this._months),i=this.asSeconds(),n,o,d,c,r,l,p,u;return i?(n=H(e/60),o=H(n/60),e%=60,n%=60,d=H(a/12),a%=12,c=e?e.toFixed(3).replace(/\.?0+$/,""):"",r=0>i?"-":"",l=Ft(this._months)===Ft(i)?"":"-",p=Ft(this._days)===Ft(i)?"":"-",u=Ft(this._milliseconds)===Ft(i)?"":"-",r+"P"+(d?l+d+"Y":"")+(a?l+a+"M":"")+(t?p+t+"D":"")+(o||n||e?"T":"")+(o?u+o+"H":"")+(n?u+n+"M":"")+(e?u+c+"S":"")):"P0D"}var Zt,Kt;Kt=Array.prototype.some?Array.prototype.some:function(e){var a=Object(this),t=a.length>>>0,n;for(n=0;n<t;n++)if(n in a&&e.call(this,a[n],n,a))return!0;return!1};var ea=e.momentProperties=[],ta=!1,aa={};e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;var ia=Object.keys?Object.keys:function(e){var t=[],a;for(a in e)n(e,a)&&t.push(a);return t};var na=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,sa=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,oa={},da={},ca={},ra={},la=/\d/,pa=/\d\d/,ua=/\d{3}/,ma=/\d{4}/,ga=/[+-]?\d{6}/,ha=/\d\d?/,va=/\d\d\d\d?/,Aa=/\d\d\d\d\d\d?/,fa=/\d{1,3}/,_a=/\d{1,4}/,ba=/[+-]?\d{1,6}/,ya=/\d+/,xa=/[+-]?\d+/,wa=/Z|[+-]\d\d(?::?\d\d)?/gi,Ca=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Sa;Sa={};var ka={},Ea=0,Ta=1,Ia=2,Ma=3,Na=4,Ra=5,Oa;Oa=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},I("M",["MM",2],"Mo",function(){return this.month()+1}),I("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),I("MMMM",0,0,function(e){return this.localeData().months(this,e)}),j("month","M"),B("month",8),z("M",ha),z("MM",ha,pa),z("MMM",function(e,t){return t.monthsShortRegex(e)}),z("MMMM",function(e,t){return t.monthsRegex(e)}),X(["M","MM"],function(e,t){t[Ta]=q(e)-1}),X(["MMM","MMMM"],function(e,t,a,i){var n=a._locale.monthsParse(e,i,a._strict);null==n?g(a).invalidMonth=e:t[Ta]=n});var ja=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Pa=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;I("Y",0,0,function(){var e=this.year();return 9999>=e?T(e,4):"+"+e}),I(0,["YY",2],0,function(){return this.year()%100}),I(0,["YYYY",4],0,"year"),I(0,["YYYYY",5],0,"year"),I(0,["YYYYYY",6,!0],0,"year"),j("year","y"),B("year",1),z("Y",xa),z("YY",ha,pa),z("YYYY",_a,ma),z("YYYYY",ba,ga),z("YYYYYY",ba,ga),X(["YYYYY","YYYYYY"],Ea),X("YYYY",function(t,a){a[Ea]=2===t.length?e.parseTwoDigitYear(t):q(t)}),X("YY",function(t,a){a[Ea]=e.parseTwoDigitYear(t)}),X("Y",function(e,t){t[Ea]=parseInt(e,10)}),e.parseTwoDigitYear=function(e){return q(e)+(68<q(e)?1900:2e3)};var Da=F("FullYear",!0);I("w",["ww",2],"wo","week"),I("W",["WW",2],"Wo","isoWeek"),j("week","w"),j("isoWeek","W"),B("week",5),B("isoWeek",5),z("w",ha),z("ww",ha,pa),z("W",ha),z("WW",ha,pa),J(["w","ww","W","WW"],function(e,t,a,i){t[i.substr(0,1)]=q(e)});I("d",0,"do","day"),I("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),I("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),I("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),I("e",0,0,"weekday"),I("E",0,0,"isoWeekday"),j("day","d"),j("weekday","e"),j("isoWeekday","E"),B("day",11),B("weekday",11),B("isoWeekday",11),z("d",ha),z("e",ha),z("E",ha),z("dd",function(e,t){return t.weekdaysMinRegex(e)}),z("ddd",function(e,t){return t.weekdaysShortRegex(e)}),z("dddd",function(e,t){return t.weekdaysRegex(e)}),J(["dd","ddd","dddd"],function(e,t,a,i){var n=a._locale.weekdaysParse(e,i,a._strict);null==n?g(a).invalidWeekday=e:t.d=n}),J(["d","e","E"],function(e,t,a,i){t[i]=q(e)});var Ba=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];I("H",["HH",2],0,"hour"),I("h",["hh",2],0,Ae),I("k",["kk",2],0,function(){return this.hours()||24}),I("hmm",0,0,function(){return""+Ae.apply(this)+T(this.minutes(),2)}),I("hmmss",0,0,function(){return""+Ae.apply(this)+T(this.minutes(),2)+T(this.seconds(),2)}),I("Hmm",0,0,function(){return""+this.hours()+T(this.minutes(),2)}),I("Hmmss",0,0,function(){return""+this.hours()+T(this.minutes(),2)+T(this.seconds(),2)}),fe("a",!0),fe("A",!1),j("hour","h"),B("hour",13),z("a",_e),z("A",_e),z("H",ha),z("h",ha),z("k",ha),z("HH",ha,pa),z("hh",ha,pa),z("kk",ha,pa),z("hmm",va),z("hmmss",Aa),z("Hmm",va),z("Hmmss",Aa),X(["H","HH"],Ma),X(["k","kk"],function(e,t){var a=q(e);t[Ma]=24===a?0:a}),X(["a","A"],function(e,t,a){a._isPm=a._locale.isPM(e),a._meridiem=e}),X(["h","hh"],function(e,t,a){t[Ma]=q(e),g(a).bigHour=!0}),X("hmm",function(e,t,a){var i=e.length-2;t[Ma]=q(e.substr(0,i)),t[Na]=q(e.substr(i)),g(a).bigHour=!0}),X("hmmss",function(e,t,a){var i=e.length-4,n=e.length-2;t[Ma]=q(e.substr(0,i)),t[Na]=q(e.substr(i,2)),t[Ra]=q(e.substr(n)),g(a).bigHour=!0}),X("Hmm",function(e,t){var a=e.length-2;t[Ma]=q(e.substr(0,a)),t[Na]=q(e.substr(a))}),X("Hmmss",function(e,t){var a=e.length-4,i=e.length-2;t[Ma]=q(e.substr(0,a)),t[Na]=q(e.substr(a,2)),t[Ra]=q(e.substr(i))});var La=F("Hours",!0),$a={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:ja,week:{dow:0,doy:6},weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekdaysShort:Ba,meridiemParse:/[ap]\.?m?\.?/i},Va={},Ha={},qa=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Fa=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ua=/Z|[+-]\d\d(?::?\d\d)?/,Ga=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],za=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Ya=/^\/?Date\((-?\d+)/i,Wa=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Qa={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480},Xa;e.createFromInputFallback=w("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),e.ISO_8601=function(){},e.RFC_2822=function(){};var Ja=w("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Qe.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:v()}),Za=w("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Qe.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:v()}),Ka=["year","quarter","month","week","day","hour","minute","second","millisecond"];at("Z",":"),at("ZZ",""),z("Z",wa),z("ZZ",wa),X(["Z","ZZ"],function(e,t,a){a._useUTC=!0,a._tzm=it(wa,e)});var ei=/([\+\-]|\d\d)/gi;e.updateOffset=function(){};var ti=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,ai=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;dt.fn=Ze.prototype,dt.invalid=function(){return dt(NaN)};var ii=pt(1,"add"),ni=pt(-1,"subtract");e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var si=w("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});I("N",0,0,"eraAbbr"),I("NN",0,0,"eraAbbr"),I("NNN",0,0,"eraAbbr"),I("NNNN",0,0,"eraName"),I("NNNNN",0,0,"eraNarrow"),I("y",["y",1],"yo","eraYear"),I("y",["yy",2],0,"eraYear"),I("y",["yyy",3],0,"eraYear"),I("y",["yyyy",4],0,"eraYear"),z("N",Ct),z("NN",Ct),z("NNN",Ct),z("NNNN",function(e,t){return t.erasNameRegex(e)}),z("NNNNN",function(e,t){return t.erasNarrowRegex(e)}),X(["N","NN","NNN","NNNN","NNNNN"],function(e,t,a,i){var n=a._locale.erasParse(e,i,a._strict);n?g(a).era=n:g(a).invalidEra=e}),z("y",ya),z("yy",ya),z("yyy",ya),z("yyyy",ya),z("yo",function(e,t){return t._eraYearOrdinalRegex||ya}),X(["y","yy","yyy","yyyy"],Ea),X(["yo"],function(e,t,a){var i;a._locale._eraYearOrdinalRegex&&(i=e.match(a._locale._eraYearOrdinalRegex)),t[Ea]=a._locale.eraYearOrdinalParse?a._locale.eraYearOrdinalParse(e,i):parseInt(e,10)}),I(0,["gg",2],0,function(){return this.weekYear()%100}),I(0,["GG",2],0,function(){return this.isoWeekYear()%100}),kt("gggg","weekYear"),kt("ggggg","weekYear"),kt("GGGG","isoWeekYear"),kt("GGGGG","isoWeekYear"),j("weekYear","gg"),j("isoWeekYear","GG"),B("weekYear",1),B("isoWeekYear",1),z("G",xa),z("g",xa),z("GG",ha,pa),z("gg",ha,pa),z("GGGG",_a,ma),z("gggg",_a,ma),z("GGGGG",ba,ga),z("ggggg",ba,ga),J(["gggg","ggggg","GGGG","GGGGG"],function(e,t,a,i){t[i.substr(0,2)]=q(e)}),J(["gg","GG"],function(t,a,i,n){a[n]=e.parseTwoDigitYear(t)}),I("Q",0,"Qo","quarter"),j("quarter","Q"),B("quarter",7),z("Q",la),X("Q",function(e,t){t[Ta]=3*(q(e)-1)}),I("D",["DD",2],"Do","date"),j("date","D"),B("date",9),z("D",ha),z("DD",ha,pa),z("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),X(["D","DD"],Ia),X("Do",function(e,t){t[Ia]=q(e.match(ha)[0])});var oi=F("Date",!0);I("DDD",["DDDD",3],"DDDo","dayOfYear"),j("dayOfYear","DDD"),B("dayOfYear",4),z("DDD",fa),z("DDDD",ua),X(["DDD","DDDD"],function(e,t,a){a._dayOfYear=q(e)}),I("m",["mm",2],0,"minute"),j("minute","m"),B("minute",14),z("m",ha),z("mm",ha,pa),X(["m","mm"],Na);var di=F("Minutes",!1);I("s",["ss",2],0,"second"),j("second","s"),B("second",15),z("s",ha),z("ss",ha,pa),X(["s","ss"],Ra);var ci=F("Seconds",!1);I("S",0,0,function(){return~~(this.millisecond()/100)}),I(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),I(0,["SSS",3],0,"millisecond"),I(0,["SSSS",4],0,function(){return 10*this.millisecond()}),I(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),I(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),I(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),I(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),I(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),j("millisecond","ms"),B("millisecond",16),z("S",fa,la),z("SS",fa,pa),z("SSS",fa,ua);var ri,li;for(ri="SSSS";9>=ri.length;ri+="S")z(ri,ya);for(ri="S";9>=ri.length;ri+="S")X(ri,It);li=F("Milliseconds",!1),I("z",0,0,"zoneAbbr"),I("zz",0,0,"zoneName");var pi=f.prototype;pi.add=ii,pi.calendar=function(t,a){1===arguments.length&&(gt(arguments[0])?(t=arguments[0],a=void 0):At(arguments[0])&&(a=arguments[0],t=void 0));var i=t||Qe(),n=nt(i,this).startOf("day"),s=e.calendarFormat(this,n)||"sameElse",o=a&&(S(a[s])?a[s].call(this,i):a[s]);return this.format(o||this.localeData().calendar(s,this,Qe(i)))},pi.clone=function(){return new f(this)},pi.diff=function(e,t,a){var i,n,s;return this.isValid()?(i=nt(e,this),!i.isValid())?NaN:(n=6e4*(i.utcOffset()-this.utcOffset()),t=P(t),(s="year"===t?ft(this,i)/12:"month"===t?ft(this,i):"quarter"===t?ft(this,i)/3:"second"===t?(this-i)/1e3:"minute"===t?(this-i)/6e4:"hour"===t?(this-i)/36e5:"day"===t?(this-i-n)/864e5:"week"===t?(this-i-n)/6048e5:this-i,a?s:H(s))):NaN},pi.endOf=function(t){var a,i;return(t=P(t),void 0===t||"millisecond"===t||!this.isValid())?this:(i=this._isUTC?wt:xt,"year"===t?a=i(this.year()+1,0,1)-1:"quarter"===t?a=i(this.year(),this.month()-this.month()%3+3,1)-1:"month"===t?a=i(this.year(),this.month()+1,1)-1:"week"===t?a=i(this.year(),this.month(),this.date()-this.weekday()+7)-1:"isoWeek"===t?a=i(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1:"day"===t||"date"===t?a=i(this.year(),this.month(),this.date()+1)-1:"hour"===t?(a=this._d.valueOf(),a+=3600000-yt(a+(this._isUTC?0:60000*this.utcOffset()),3600000)-1):"minute"===t?(a=this._d.valueOf(),a+=60000-yt(a,60000)-1):"second"===t?(a=this._d.valueOf(),a+=1000-yt(a,1000)-1):void 0,(this._d.setTime(a),e.updateOffset(this,!0),this))},pi.format=function(t){t||(t=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var a=R(this,t);return this.localeData().postformat(a)},pi.from=function(e,t){return this.isValid()&&(b(e)&&e.isValid()||Qe(e).isValid())?dt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},pi.fromNow=function(e){return this.from(Qe(),e)},pi.to=function(e,t){return this.isValid()&&(b(e)&&e.isValid()||Qe(e).isValid())?dt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},pi.toNow=function(e){return this.to(Qe(),e)},pi.get=function(e){return e=P(e),S(this[e])?this[e]():this},pi.invalidAt=function(){return g(this).overflow},pi.isAfter=function(e,t){var a=b(e)?e:Qe(e);return!!(this.isValid()&&a.isValid())&&(t=P(t)||"millisecond","millisecond"===t?this.valueOf()>a.valueOf():a.valueOf()<this.clone().startOf(t).valueOf())},pi.isBefore=function(e,t){var a=b(e)?e:Qe(e);return!!(this.isValid()&&a.isValid())&&(t=P(t)||"millisecond","millisecond"===t?this.valueOf()<a.valueOf():this.clone().endOf(t).valueOf()<a.valueOf())},pi.isBetween=function(e,t,a,i){var n=b(e)?e:Qe(e),s=b(t)?t:Qe(t);return!!(this.isValid()&&n.isValid()&&s.isValid())&&(i=i||"()",("("===i[0]?this.isAfter(n,a):!this.isBefore(n,a))&&(")"===i[1]?this.isBefore(s,a):!this.isAfter(s,a)))},pi.isSame=function(e,t){var a=b(e)?e:Qe(e),i;return!!(this.isValid()&&a.isValid())&&(t=P(t)||"millisecond","millisecond"===t?this.valueOf()===a.valueOf():(i=a.valueOf(),this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf()))},pi.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},pi.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},pi.isValid=function(){return h(this)},pi.lang=si,pi.locale=_t,pi.localeData=bt,pi.max=Za,pi.min=Ja,pi.parsingFlags=function(){return l({},g(this))},pi.set=function(e,t){if("object"==typeof e){e=D(e);var a=L(e),n;for(n=0;n<a.length;n++)this[a[n].unit](e[a[n].unit])}else if(e=P(e),S(this[e]))return this[e](t);return this},pi.startOf=function(t){var a,i;return(t=P(t),void 0===t||"millisecond"===t||!this.isValid())?this:(i=this._isUTC?wt:xt,"year"===t?a=i(this.year(),0,1):"quarter"===t?a=i(this.year(),this.month()-this.month()%3,1):"month"===t?a=i(this.year(),this.month(),1):"week"===t?a=i(this.year(),this.month(),this.date()-this.weekday()):"isoWeek"===t?a=i(this.year(),this.month(),this.date()-(this.isoWeekday()-1)):"day"===t||"date"===t?a=i(this.year(),this.month(),this.date()):"hour"===t?(a=this._d.valueOf(),a-=yt(a+(this._isUTC?0:60000*this.utcOffset()),3600000)):"minute"===t?(a=this._d.valueOf(),a-=yt(a,60000)):"second"===t?(a=this._d.valueOf(),a-=yt(a,1000)):void 0,(this._d.setTime(a),e.updateOffset(this,!0),this))},pi.subtract=ni,pi.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},pi.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},pi.toDate=function(){return new Date(this.valueOf())},pi.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,a=t?this.clone().utc():this;return 0>a.year()||9999<a.year()?R(a,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):S(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+1e3*(60*this.utcOffset())).toISOString().replace("Z",R(a,"Z")):R(a,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},pi.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="",a,i,n,s;return this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z"),a="["+e+"(\"]",i=0<=this.year()&&9999>=this.year()?"YYYY":"YYYYYY",n="-MM-DD[T]HH:mm:ss.SSS",s=t+"[\")]",this.format(a+i+n+s)},"undefined"!=typeof Symbol&&null!=Symbol.for&&(pi[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),pi.toJSON=function(){return this.isValid()?this.toISOString():null},pi.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},pi.unix=function(){return Wt(this.valueOf()/1e3)},pi.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},pi.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},pi.eraName=function(){var e=this.localeData().eras(),t,a,n;for(t=0,a=e.length;t<a;++t){if(n=this.startOf("day").valueOf(),e[t].since<=n&&n<=e[t].until)return e[t].name;if(e[t].until<=n&&n<=e[t].since)return e[t].name}return""},pi.eraNarrow=function(){var e=this.localeData().eras(),t,a,n;for(t=0,a=e.length;t<a;++t){if(n=this.startOf("day").valueOf(),e[t].since<=n&&n<=e[t].until)return e[t].narrow;if(e[t].until<=n&&n<=e[t].since)return e[t].narrow}return""},pi.eraAbbr=function(){var e=this.localeData().eras(),t,a,n;for(t=0,a=e.length;t<a;++t){if(n=this.startOf("day").valueOf(),e[t].since<=n&&n<=e[t].until)return e[t].abbr;if(e[t].until<=n&&n<=e[t].since)return e[t].abbr}return""},pi.eraYear=function(){var t=this.localeData().eras(),a,n,s,o;for(a=0,n=t.length;a<n;++a)if(s=t[a].since<=t[a].until?1:-1,o=this.startOf("day").valueOf(),t[a].since<=o&&o<=t[a].until||t[a].until<=o&&o<=t[a].since)return(this.year()-e(t[a].since).year())*s+t[a].offset;return this.year()},pi.year=Da,pi.isLeapYear=function(){return V(this.year())},pi.weekYear=function(e){return Et.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},pi.isoWeekYear=function(e){return Et.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},pi.quarter=pi.quarters=function(e){return null==e?Yt((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},pi.month=ie,pi.daysInMonth=function(){return ee(this.year(),this.month())},pi.week=pi.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},pi.isoWeek=pi.isoWeeks=function(e){var t=le(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},pi.weeksInYear=function(){var e=this.localeData()._week;return pe(this.year(),e.dow,e.doy)},pi.weeksInWeekYear=function(){var e=this.localeData()._week;return pe(this.weekYear(),e.dow,e.doy)},pi.isoWeeksInYear=function(){return pe(this.year(),1,4)},pi.isoWeeksInISOWeekYear=function(){return pe(this.isoWeekYear(),1,4)},pi.date=oi,pi.day=pi.days=function(e){if(!this.isValid())return null==e?NaN:this;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==e?t:(e=ue(e,this.localeData()),this.add(e-t,"d"))},pi.weekday=function(e){if(!this.isValid())return null==e?NaN:this;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},pi.isoWeekday=function(e){if(!this.isValid())return null==e?NaN:this;if(null!=e){var t=me(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7},pi.dayOfYear=function(e){var t=Gt((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},pi.hour=pi.hours=La,pi.minute=pi.minutes=di,pi.second=pi.seconds=ci,pi.millisecond=pi.milliseconds=li,pi.utcOffset=function(t,a,i){var n=this._offset||0,s;if(!this.isValid())return null==t?NaN:this;if(null!=t){if("string"!=typeof t)16>zt(t)&&!i&&(t*=60);else if(t=it(wa,t),null===t)return this;return!this._isUTC&&a&&(s=st(this)),this._offset=t,this._isUTC=!0,null!=s&&this.add(s,"m"),n!==t&&(!a||this._changeInProgress?ut(this,dt(t-n,"m"),1,!1):!this._changeInProgress&&(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?n:st(this)},pi.utc=function(e){return this.utcOffset(0,e)},pi.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(st(this),"m")),this},pi.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=it(/Z|[+-]\d\d:?\d\d/gi,this._i);null==e?this.utcOffset(0,!0):this.utcOffset(e)}return this},pi.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Qe(e).utcOffset():0,0==(this.utcOffset()-e)%60)},pi.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},pi.isLocal=function(){return!!this.isValid()&&!this._isUTC},pi.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},pi.isUtc=ot,pi.isUTC=ot,pi.zoneAbbr=function(){return this._isUTC?"UTC":""},pi.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},pi.dates=w("dates accessor is deprecated. Use date instead.",oi),pi.months=w("months accessor is deprecated. Use month instead",ie),pi.years=w("years accessor is deprecated. Use year instead",Da),pi.zone=w("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null==e?-this.utcOffset():("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this)}),pi.isDSTShifted=w("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!o(this._isDSTShifted))return this._isDSTShifted;var e={},t;return A(e,this),e=ze(e),e._a?(t=e._isUTC?p(e._a):Qe(e._a),this._isDSTShifted=this.isValid()&&0<tt(e._a,t.toArray())):this._isDSTShifted=!1,this._isDSTShifted});var ui=E.prototype;ui.calendar=function(e,t,a){var i=this._calendar[e]||this._calendar.sameElse;return S(i)?i.call(t,a):i},ui.longDateFormat=function(e){var t=this._longDateFormat[e],a=this._longDateFormat[e.toUpperCase()];return t||!a?t:(this._longDateFormat[e]=a.match(na).map(function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e}).join(""),this._longDateFormat[e])},ui.invalidDate=function(){return this._invalidDate},ui.ordinal=function(e){return this._ordinal.replace("%d",e)},ui.preparse=Mt,ui.postformat=Mt,ui.relativeTime=function(e,t,a,i){var n=this._relativeTime[a];return S(n)?n(e,t,a,i):n.replace(/%d/i,e)},ui.pastFuture=function(e,t){var a=this._relativeTime[0<e?"future":"past"];return S(a)?a(t):a.replace(/%s/i,t)},ui.set=function(e){var t,a;for(a in e)n(e,a)&&(t=e[a],S(t)?this[a]=t:this["_"+a]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},ui.eras=function(){var t=this._eras||ke("en")._eras,a,n,s;for(a=0,n=t.length;a<n;++a){switch(typeof t[a].since){case"string":s=e(t[a].since).startOf("day"),t[a].since=s.valueOf();}switch(typeof t[a].until){case"undefined":t[a].until=+Infinity;break;case"string":s=e(t[a].until).startOf("day").valueOf(),t[a].until=s.valueOf();}}return t},ui.erasParse=function(e,t,a){var n=this.eras(),s,o,d,c,r;for(e=e.toUpperCase(),s=0,o=n.length;s<o;++s)if(d=n[s].name.toUpperCase(),c=n[s].abbr.toUpperCase(),r=n[s].narrow.toUpperCase(),a)switch(t){case"N":case"NN":case"NNN":if(c===e)return n[s];break;case"NNNN":if(d===e)return n[s];break;case"NNNNN":if(r===e)return n[s];}else if(0<=[d,c,r].indexOf(e))return n[s]},ui.erasConvertYear=function(t,a){var i=t.since<=t.until?1:-1;return void 0===a?e(t.since).year():e(t.since).year()+(a-t.offset)*i},ui.erasAbbrRegex=function(e){return n(this,"_erasAbbrRegex")||St.call(this),e?this._erasAbbrRegex:this._erasRegex},ui.erasNameRegex=function(e){return n(this,"_erasNameRegex")||St.call(this),e?this._erasNameRegex:this._erasRegex},ui.erasNarrowRegex=function(e){return n(this,"_erasNarrowRegex")||St.call(this),e?this._erasNarrowRegex:this._erasRegex},ui.months=function(e,a){return e?t(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Pa).test(a)?"format":"standalone"][e.month()]:t(this._months)?this._months:this._months.standalone},ui.monthsShort=function(e,a){return e?t(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Pa.test(a)?"format":"standalone"][e.month()]:t(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},ui.monthsParse=function(e,t,a){var n,s,o;if(this._monthsParseExact)return te.call(this,e,t,a);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),n=0;12>n;n++){if(s=p([2e3,n]),a&&!this._longMonthsParse[n]&&(this._longMonthsParse[n]=new RegExp("^"+this.months(s,"").replace(".","")+"$","i"),this._shortMonthsParse[n]=new RegExp("^"+this.monthsShort(s,"").replace(".","")+"$","i")),a||this._monthsParse[n]||(o="^"+this.months(s,"")+"|^"+this.monthsShort(s,""),this._monthsParse[n]=new RegExp(o.replace(".",""),"i")),a&&"MMMM"===t&&this._longMonthsParse[n].test(e))return n;if(a&&"MMM"===t&&this._shortMonthsParse[n].test(e))return n;if(!a&&this._monthsParse[n].test(e))return n}},ui.monthsRegex=function(e){return this._monthsParseExact?(n(this,"_monthsRegex")||ne.call(this),e?this._monthsStrictRegex:this._monthsRegex):(n(this,"_monthsRegex")||(this._monthsRegex=Ca),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},ui.monthsShortRegex=function(e){return this._monthsParseExact?(n(this,"_monthsRegex")||ne.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(n(this,"_monthsShortRegex")||(this._monthsShortRegex=Ca),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},ui.week=function(e){return le(e,this._week.dow,this._week.doy).week},ui.firstDayOfYear=function(){return this._week.doy},ui.firstDayOfWeek=function(){return this._week.dow},ui.weekdays=function(e,a){var i=t(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(a)?"format":"standalone"];return!0===e?ge(i,this._week.dow):e?i[e.day()]:i},ui.weekdaysMin=function(e){return!0===e?ge(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},ui.weekdaysShort=function(e){return!0===e?ge(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},ui.weekdaysParse=function(e,t,a){var n,s,o;if(this._weekdaysParseExact)return he.call(this,e,t,a);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),n=0;7>n;n++){if(s=p([2e3,1]).day(n),a&&!this._fullWeekdaysParse[n]&&(this._fullWeekdaysParse[n]=new RegExp("^"+this.weekdays(s,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[n]=new RegExp("^"+this.weekdaysShort(s,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[n]=new RegExp("^"+this.weekdaysMin(s,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[n]||(o="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,""),this._weekdaysParse[n]=new RegExp(o.replace(".",""),"i")),a&&"dddd"===t&&this._fullWeekdaysParse[n].test(e))return n;if(a&&"ddd"===t&&this._shortWeekdaysParse[n].test(e))return n;if(a&&"dd"===t&&this._minWeekdaysParse[n].test(e))return n;if(!a&&this._weekdaysParse[n].test(e))return n}},ui.weekdaysRegex=function(e){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||ve.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(n(this,"_weekdaysRegex")||(this._weekdaysRegex=Ca),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},ui.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||ve.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(n(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Ca),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},ui.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||ve.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(n(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ca),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},ui.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},ui.meridiem=function(e,t,a){return 11<e?a?"pm":"PM":a?"am":"AM"},Ce("en",{eras:[{since:"0001-01-01",until:+Infinity,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-Infinity,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,a=1===q(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+a}}),e.lang=w("moment.lang is deprecated. Use moment.locale instead.",Ce),e.langData=w("moment.langData is deprecated. Use moment.localeData instead.",ke);var mi=zt,gi=Lt("ms"),hi=Lt("s"),vi=Lt("m"),Ai=Lt("h"),fi=Lt("d"),_i=Lt("w"),bi=Lt("M"),yi=Lt("Q"),xi=Lt("y"),wi=$t("milliseconds"),Ci=$t("seconds"),Si=$t("minutes"),ki=$t("hours"),Ei=$t("days"),Ti=$t("months"),Ii=$t("years"),Mi=Gt,Ni={ss:44,s:45,m:45,h:22,d:26,w:null,M:11},Ri=zt,Oi=Ze.prototype;return Oi.isValid=function(){return this._isValid},Oi.abs=function(){var e=this._data;return this._milliseconds=mi(this._milliseconds),this._days=mi(this._days),this._months=mi(this._months),e.milliseconds=mi(e.milliseconds),e.seconds=mi(e.seconds),e.minutes=mi(e.minutes),e.hours=mi(e.hours),e.months=mi(e.months),e.years=mi(e.years),this},Oi.add=function(e,t){return jt(this,e,t,1)},Oi.subtract=function(e,t){return jt(this,e,t,-1)},Oi.as=function(e){if(!this.isValid())return NaN;var t=this._milliseconds,a,i;if(e=P(e),"month"===e||"quarter"===e||"year"===e)switch(a=this._days+t/864e5,i=this._months+Dt(a),e){case"month":return i;case"quarter":return i/3;case"year":return i/12;}else switch(a=this._days+Gt(Bt(this._months)),e){case"week":return a/7+t/6048e5;case"day":return a+t/864e5;case"hour":return 24*a+t/36e5;case"minute":return 1440*a+t/6e4;case"second":return 86400*a+t/1e3;case"millisecond":return Wt(864e5*a)+t;default:throw new Error("Unknown unit "+e);}},Oi.asMilliseconds=gi,Oi.asSeconds=hi,Oi.asMinutes=vi,Oi.asHours=Ai,Oi.asDays=fi,Oi.asWeeks=_i,Oi.asMonths=bi,Oi.asQuarters=yi,Oi.asYears=xi,Oi.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*q(this._months/12):NaN},Oi._bubble=function(){var e=this._milliseconds,t=this._days,a=this._months,i=this._data,n,s,o,d,c;return 0<=e&&0<=t&&0<=a||0>=e&&0>=t&&0>=a||(e+=864e5*Pt(Bt(a)+t),t=0,a=0),i.milliseconds=e%1e3,n=H(e/1e3),i.seconds=n%60,s=H(n/60),i.minutes=s%60,o=H(s/60),i.hours=o%24,t+=H(o/24),c=H(Dt(t)),a+=c,t-=Pt(Bt(c)),d=H(a/12),a%=12,i.days=t,i.months=a,i.years=d,this},Oi.clone=function(){return dt(this)},Oi.get=function(e){return e=P(e),this.isValid()?this[e+"s"]():NaN},Oi.milliseconds=wi,Oi.seconds=Ci,Oi.minutes=Si,Oi.hours=ki,Oi.days=Ei,Oi.weeks=function(){return H(this.days()/7)},Oi.months=Ti,Oi.years=Ii,Oi.humanize=function(e,t){if(!this.isValid())return this.localeData().invalidDate();var a=!1,i=Ni,n,s;return"object"==typeof e&&(t=e,e=!1),"boolean"==typeof e&&(a=e),"object"==typeof t&&(i=Object.assign({},Ni,t),null!=t.s&&null==t.ss&&(i.ss=t.s-1)),n=this.localeData(),s=Ht(this,!a,i,n),a&&(s=n.pastFuture(+this,s)),n.postformat(s)},Oi.toISOString=Ut,Oi.toString=Ut,Oi.toJSON=Ut,Oi.locale=_t,Oi.localeData=bt,Oi.toIsoString=w("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ut),Oi.lang=si,I("X",0,0,"unix"),I("x",0,0,"valueOf"),z("x",xa),z("X",/[+-]?\d+(\.\d{1,3})?/),X("X",function(e,t,a){a._d=new Date(1e3*parseFloat(e))}),X("x",function(e,t,a){a._d=new Date(q(e))}),e.version="2.27.0",function(e){Zt=e}(Qe),e.fn=pi,e.min=function(){var e=[].slice.call(arguments,0);return Xe("isBefore",e)},e.max=function(){var e=[].slice.call(arguments,0);return Xe("isAfter",e)},e.now=function(){return Date.now?Date.now():+new Date},e.utc=p,e.unix=function(e){return Qe(1e3*e)},e.months=function(e,t){return Rt(e,t,"months")},e.isDate=c,e.locale=Ce,e.invalid=v,e.duration=dt,e.isMoment=b,e.weekdays=function(e,t,a){return Ot(e,t,a,"weekdays")},e.parseZone=function(){return Qe.apply(null,arguments).parseZone()},e.localeData=ke,e.isDuration=Ke,e.monthsShort=function(e,t){return Rt(e,t,"monthsShort")},e.weekdaysMin=function(e,t,a){return Ot(e,t,a,"weekdaysMin")},e.defineLocale=Se,e.updateLocale=function(e,t){if(null!=t){var a=$a,i,n;null!=Va[e]&&null!=Va[e].parentLocale?Va[e].set(k(Va[e]._config,t)):(n=we(e),null!=n&&(a=n._config),t=k(a,t),null==n&&(t.abbr=e),i=new E(t),i.parentLocale=Va[e],Va[e]=i),Ce(e)}else null!=Va[e]&&(null==Va[e].parentLocale?null!=Va[e]&&delete Va[e]:(Va[e]=Va[e].parentLocale,e===Ce()&&Ce(e)));return Va[e]},e.locales=Ee,e.weekdaysShort=function(e,t,a){return Ot(e,t,a,"weekdaysShort")},e.normalizeUnits=P,e.relativeTimeRounding=qt,e.relativeTimeThreshold=function(e,t){return void 0!==Ni[e]&&(void 0===t?Ni[e]:(Ni[e]=t,"s"===e&&(Ni.ss=t-1),!0))},e.calendarFormat=function(e,t){var a=e.diff(t,"days",!0);return-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse"},e.prototype=pi,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e}),function(e,t){"function"==typeof define&&define.amd?define("wavesurfer",[],function(){return e.WaveSurfer=t()}):"object"==typeof exports?module.exports=t():e.WaveSurfer=t()}(this,function(){var t=Math.round,a=Math.ceil,n=Math.floor,s=Math.min,o=Math.max,d={defaultParams:{audioContext:null,audioRate:1,autoCenter:!0,backend:"WebAudio",container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,progressColor:"#555",normalize:!1,renderer:"MultiCanvas",scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999"},init:function(e){if(this.params=d.util.extend({},this.defaultParams,e),this.container="string"==typeof e.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(this.mediaContainer=null==this.params.mediaContainer?this.container:"string"==typeof this.params.mediaContainer?document.querySelector(this.params.mediaContainer):this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");this.savedVolume=0,this.isMuted=!1,this.tmpEvents=[],this.currentAjax=null,this.createDrawer(),this.createBackend(),this.createPeakCache(),this.isDestroyed=!1},createDrawer:function(){var t=this;this.drawer=Object.create(d.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){t.drawBuffer(),t.drawer.progress(t.backend.getPlayedPercents())}),this.drawer.on("click",function(a,e){setTimeout(function(){t.seekTo(e)},0)}),this.drawer.on("scroll",function(a){t.params.partialRender&&t.drawBuffer(),t.fireEvent("scroll",a)})},createBackend:function(){var e=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||d.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement"),this.backend=Object.create(d[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){e.fireEvent("finish")}),this.backend.on("play",function(){e.fireEvent("play")}),this.backend.on("pause",function(){e.fireEvent("pause")}),this.backend.on("audioprocess",function(t){e.drawer.progress(e.backend.getPlayedPercents()),e.fireEvent("audioprocess",t)})},createPeakCache:function(){this.params.partialRender&&(this.peakCache=Object.create(d.PeakCache),this.peakCache.init())},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(e,t){this.fireEvent("interaction",this.play.bind(this,e,t)),this.backend.play(e,t)},pause:function(){this.backend.isPaused()||this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},isPlaying:function(){return!this.backend.isPaused()},skipBackward:function(e){this.skip(-e||-this.params.skipLength)},skipForward:function(e){this.skip(e||this.params.skipLength)},skip:function(e){var t=this.getCurrentTime()||0,a=this.getDuration()||1;t=o(0,s(a,t+(e||0))),this.seekAndCenter(t/a)},seekAndCenter:function(e){this.seekTo(e),this.drawer.recenter(e)},seekTo:function(e){this.fireEvent("interaction",this.seekTo.bind(this,e));var t=this.backend.isPaused();t||this.backend.pause();var a=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(e*this.getDuration()),this.drawer.progress(this.backend.getPlayedPercents()),t||this.backend.play(),this.params.scrollParent=a,this.fireEvent("seek",e)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(e){this.backend.setVolume(e)},getVolume:function(){return this.backend.getVolume()},setPlaybackRate:function(e){this.backend.setPlaybackRate(e)},getPlaybackRate:function(){return this.backend.getPlaybackRate()},toggleMute:function(){this.setMute(!this.isMuted)},setMute:function(e){e===this.isMuted||(e?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0):(this.backend.setVolume(this.savedVolume),this.isMuted=!1))},getMute:function(){return this.isMuted},getFilters:function(){return this.backend.filters||[]},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var e=t(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),a=this.drawer.getWidth(),n=e,o=this.drawer.getScrollX(),d=s(o+a,n);if(this.params.fillParent&&(!this.params.scrollParent||e<a)&&(n=a,o=0,d=n),this.params.partialRender)for(var c=this.peakCache.addRangeToPeakCache(n,o,d),r=0,l;r<c.length;r++)l=this.backend.getPeaks(n,c[r][0],c[r][1]),this.drawer.drawPeaks(l,n,c[r][0],c[r][1]);else{o=0,d=n;var l=this.backend.getPeaks(n,o,d);this.drawer.drawPeaks(l,n,o,d)}this.fireEvent("redraw",l,n)},zoom:function(e){this.params.minPxPerSec=e,this.params.scrollParent=!0,this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",e)},loadArrayBuffer:function(e){this.decodeArrayBuffer(e,function(e){this.isDestroyed||this.loadDecodedBuffer(e)}.bind(this))},loadDecodedBuffer:function(e){this.backend.load(e),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(e){var t=this,a=new FileReader;a.addEventListener("progress",function(a){t.onProgress(a)}),a.addEventListener("load",function(a){t.loadArrayBuffer(a.target.result)}),a.addEventListener("error",function(){t.fireEvent("error","Error reading file")}),a.readAsArrayBuffer(e),this.empty()},load:function(e,t,a){switch(this.empty(),this.params.backend){case"WebAudio":return this.loadBuffer(e,t);case"MediaElement":return this.loadMediaElement(e,t,a);}},loadBuffer:function(e,t){var a=function(t){return t&&this.tmpEvents.push(this.once("ready",t)),this.getArrayBuffer(e,this.loadArrayBuffer.bind(this))}.bind(this);return t?void(this.backend.setPeaks(t),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",a))):a()},loadMediaElement:function(e,t,a){var i=e;if("string"==typeof e)this.backend.load(i,this.mediaContainer,t,a);else{var n=e;this.backend.loadElt(n,t),i=n.src}this.tmpEvents.push(this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(e){this.fireEvent("error",e)}.bind(this))),t&&this.backend.setPeaks(t),(!t||this.params.forceDecode)&&this.backend.supportsWebAudio()&&this.getArrayBuffer(i,function(e){this.decodeArrayBuffer(e,function(e){this.backend.buffer=e,this.backend.setPeaks(null),this.drawBuffer(),this.fireEvent("waveform-ready")}.bind(this))}.bind(this))},decodeArrayBuffer:function(e,t){this.arraybuffer=e,this.backend.decodeArrayBuffer(e,function(a){this.isDestroyed||this.arraybuffer!=e||(t(a),this.arraybuffer=null)}.bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(e,t){var a=this,i=d.util.ajax({url:e,responseType:"arraybuffer"});return this.currentAjax=i,this.tmpEvents.push(i.on("progress",function(t){a.onProgress(t)}),i.on("success",function(e){t(e),a.currentAjax=null}),i.on("error",function(t){a.fireEvent("error","XHR error: "+t.target.statusText),a.currentAjax=null})),i},onProgress:function(a){if(a.lengthComputable)var e=a.loaded/a.total;else e=a.loaded/(a.loaded+1e6);this.fireEvent("loading",t(100*e),a.target)},exportPCM:function(e,a,i){e=e||1024,a=a||1e4,i=i||!1;var n=this.backend.getPeaks(e,a),s=[].map.call(n,function(e){return t(e*a)/a}),o=JSON.stringify(s);return i||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(o)),o},exportImage:function(e,t){return e||(e="image/png"),t||(t=1),this.drawer.getImage(e,t)},cancelAjax:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)},clearTmpEvents:function(){this.tmpEvents.forEach(function(t){t.un()})},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),this.backend.destroy(),this.drawer.destroy(),this.isDestroyed=!0}};return d.create=function(e){var t=Object.create(d);return t.init(e),t},d.util={extend:function(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){Object.keys(t).forEach(function(a){e[a]=t[a]})}),e},debounce:function(e,t,a){var i=function(){o=null,a||e.apply(s,n)},n,s,o;return function(){s=this,n=arguments;var d=a&&!o;clearTimeout(o),o=setTimeout(i,t),o||(o=setTimeout(i,t)),d&&e.apply(s,n)}},min:function(e){var t=+Infinity;for(var a in e)e[a]<t&&(t=e[a]);return t},max:function(e){var t=-Infinity;for(var a in e)e[a]>t&&(t=e[a]);return t},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(e){var t=Object.create(d.Observer),a=new XMLHttpRequest,i=!1;return a.open(e.method||"GET",e.url,!0),a.responseType=e.responseType||"json",a.addEventListener("progress",function(a){t.fireEvent("progress",a),a.lengthComputable&&a.loaded==a.total&&(i=!0)}),a.addEventListener("load",function(n){i||t.fireEvent("progress",n),t.fireEvent("load",n),200==a.status||206==a.status?t.fireEvent("success",a.response,n):t.fireEvent("error",n)}),a.addEventListener("error",function(a){t.fireEvent("error",a)}),a.send(),t.xhr=a,t}},d.Observer={on:function(e,t){this.handlers||(this.handlers={});var a=this.handlers[e];return a||(a=this.handlers[e]=[]),a.push(t),{name:e,callback:t,un:this.un.bind(this,e,t)}},un:function(e,t){if(this.handlers){var a=this.handlers[e];if(a)if(t)for(var n=a.length-1;0<=n;n--)a[n]==t&&a.splice(n,1);else a.length=0}},unAll:function(){this.handlers=null},once:function(e,t){var a=this,i=function(){t.apply(this,arguments),setTimeout(function(){a.un(e,i)},0)};return this.on(e,i)},fireEvent:function(e){if(this.handlers){var t=this.handlers[e],a=Array.prototype.slice.call(arguments,1);t&&t.forEach(function(e){e.apply(null,a)})}}},d.util.extend(d,d.Observer),d.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!!(window.AudioContext||window.webkitAudioContext)},getAudioContext:function(){return this.ac||(this.ac=new(window.AudioContext||window.webkitAudioContext)),this.ac},getOfflineAudioContext:function(e){return d.WebAudio.offlineAudioContext||(d.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),d.WebAudio.offlineAudioContext},init:function(e){this.params=e,this.ac=e.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.scheduledPause=null,this.states=[Object.create(d.WebAudio.state.playing),Object.create(d.WebAudio.state.paused),Object.create(d.WebAudio.state.finished)],this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(this.PAUSED_STATE),this.setPlaybackRate(this.params.audioRate),this.setLength(0)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(e){e&&e.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(e){this.state!==this.states[e]&&(this.state=this.states[e],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(e){this.disconnectFilters(),e&&e.length&&(this.filters=e,this.analyser.disconnect(),e.reduce(function(e,t){return e.connect(t),t},this.analyser).connect(this.gainNode))},createScriptNode:function(){this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(this.scriptBufferSize):this.ac.createJavaScriptNode(this.scriptBufferSize),this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var e=this;this.scriptNode.onaudioprocess=function(){var t=e.getCurrentTime();t>=e.getDuration()?(e.setState(e.FINISHED_STATE),e.fireEvent("pause")):t>=e.scheduledPause?e.pause():e.state===e.states[e.PLAYING_STATE]&&e.fireEvent("audioprocess",t)}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(e){this.gainNode.gain.value=e},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(e,t,a){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(e,function(e){t(e)}.bind(this),a)},setPeaks:function(e){this.peaks=e},setLength:function(e){if(!(this.mergedPeaks&&e==2*this.mergedPeaks.length-1+2)){this.splitPeaks=[],this.mergedPeaks=[];for(var t=this.buffer?this.buffer.numberOfChannels:1,a=0;a<t;a++)this.splitPeaks[a]=[],this.splitPeaks[a][2*(e-1)]=0,this.splitPeaks[a][2*(e-1)+1]=0;this.mergedPeaks[2*(e-1)]=0,this.mergedPeaks[2*(e-1)+1]=0}},getPeaks:function(e,t,a){if(this.peaks)return this.peaks;this.setLength(e);for(var n=this.buffer.length/e,s=this.buffer.numberOfChannels,o=0;o<s;o++)for(var d=this.splitPeaks[o],r=this.buffer.getChannelData(o),l=t;l<=a;l++){for(var p=~~(l*n),u=0,m=0,g=p,h;g<~~(p+n);g+=~~(n/10)||1)h=r[g],h>m&&(m=h),h<u&&(u=h);d[2*l]=m,d[2*l+1]=u,(0==o||m>this.mergedPeaks[2*l])&&(this.mergedPeaks[2*l]=m),(0==o||u<this.mergedPeaks[2*l+1])&&(this.mergedPeaks[2*l+1]=u)}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.audioContext||"function"!=typeof this.ac.close||this.ac.close()},load:function(e){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=e,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(e,t){if(this.buffer)return this.scheduledPause=null,null==e&&(e=this.getCurrentTime(),e>=this.getDuration()&&(e=0)),null==t&&(t=this.getDuration()),this.startPosition=e,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:e,end:t}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(e,t){if(this.buffer){this.createSource();var a=this.seekTo(e,t);e=a.start,t=a.end,this.scheduledPause=t,this.source.start(0,e,t-e),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(this.PLAYING_STATE),this.fireEvent("play")}},pause:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE),this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},getPlaybackRate:function(){return this.playbackRate},setPlaybackRate:function(e){e=e||1,this.isPaused()?this.playbackRate=e:(this.pause(),this.playbackRate=e,this.play())}},d.WebAudio.state={},d.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},d.WebAudio.state.paused={init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition}},d.WebAudio.state.finished={init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},d.util.extend(d.WebAudio,d.Observer),d.MediaElement=Object.create(d.WebAudio),d.util.extend(d.MediaElement,{init:function(e){this.params=e,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=e.mediaType.toLowerCase(),this.elementPosition=e.elementPosition,this.setPlaybackRate(this.params.audioRate),this.createTimer()},createTimer:function(){var e=this,t=function(){if(!e.isPaused()){e.fireEvent("audioprocess",e.getCurrentTime());var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame;a(t)}};this.on("play",t)},load:function(e,t,a,i){var n=this,s=document.createElement(this.mediaType);s.controls=this.params.mediaControls,s.autoplay=this.params.autoplay||!1,s.preload=null==i?"auto":i,s.src=e,s.style.width="100%";var o=t.querySelector(this.mediaType);o&&t.removeChild(o),t.appendChild(s),this._load(s,a)},loadElt:function(e,t){var a=this,i=e;i.controls=this.params.mediaControls,i.autoplay=this.params.autoplay||!1,this._load(i,t)},_load:function(e,t){var a=this;"function"==typeof e.load&&e.load(),e.addEventListener("error",function(){a.fireEvent("error","Error loading media element")}),e.addEventListener("canplay",function(){a.fireEvent("canplay")}),e.addEventListener("ended",function(){a.fireEvent("finish")}),this.media=e,this.peaks=t,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return!this.media||this.media.paused},getDuration:function(){var e=(this.buffer||this.media).duration;return e>=1/0&&(e=this.media.seekable.end(0)),e},getCurrentTime:function(){return this.media&&this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},setPlaybackRate:function(e){this.playbackRate=e||1,this.media.playbackRate=this.playbackRate},seekTo:function(e){null!=e&&(this.media.currentTime=e),this.clearPlayEnd()},play:function(e,t){this.seekTo(e),this.media.play(),t&&this.setPlayEnd(t),this.fireEvent("play")},pause:function(){this.media&&this.media.pause(),this.clearPlayEnd(),this.fireEvent("pause")},setPlayEnd:function(e){var t=this;this.onPlayEnd=function(a){a>=e&&(t.pause(),t.seekTo(e))},this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(e,t,a){return this.buffer?d.WebAudio.getPeaks.call(this,e,t,a):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(e){this.media.volume=e},destroy:function(){this.pause(),this.unAll(),this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),d.AudioElement=d.MediaElement,d.Drawer={init:function(e,t){this.container=e,this.params=t,this.width=0,this.height=t.height*this.params.pixelRatio,this.lastPos=0,this.initDrawer(t),this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(t,e){e||t.preventDefault();var a=t.targetTouches?t.targetTouches[0].clientX:t.clientX,i=this.wrapper.getBoundingClientRect(),n=this.width,s=this.getWidth(),o;return!this.params.fillParent&&n<s?(o=(a-i.left)*this.params.pixelRatio/n||0,1<o&&(o=1)):o=(a-i.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,o},setupWrapperEvents:function(){var t=this;this.wrapper.addEventListener("click",function(a){var e=t.wrapper.offsetHeight-t.wrapper.clientHeight;if(0!=e){var i=t.wrapper.getBoundingClientRect();if(a.clientY>=i.bottom-e)return}t.params.interact&&t.fireEvent("click",a,t.handleEvent(a))}),this.wrapper.addEventListener("scroll",function(a){t.fireEvent("scroll",a)})},drawPeaks:function(e,t,a,i){this.setWidth(t),this.params.barWidth?this.drawBars(e,0,a,i):this.drawWave(e,0,a,i)},style:function(e,t){return Object.keys(t).forEach(function(a){e.style[a]!==t[a]&&(e.style[a]=t[a])}),e},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(e){var t=this.wrapper.scrollWidth*e;this.recenterOnPosition(t,!0)},recenterOnPosition:function(e,t){var a=this.wrapper.scrollLeft,i=~~(this.wrapper.clientWidth/2),n=e-i,d=n-a,c=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=c){if(!t&&-i<=d&&d<i){d=o(-5,s(5,d)),n=a+d}n=o(0,s(c,n)),n!=a&&(this.wrapper.scrollLeft=n)}},getScrollX:function(){return t(this.wrapper.scrollLeft*this.params.pixelRatio)},getWidth:function(){return t(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(e){this.width==e||(this.width=e,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize())},setHeight:function(e){e==this.height||(this.height=e,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize())},progress:function(e){var a=1/this.params.pixelRatio,i=t(e*this.width)*a;if(i<this.lastPos||i-this.lastPos>=a){if(this.lastPos=i,this.params.scrollParent&&this.params.autoCenter){var n=~~(this.wrapper.scrollWidth*e);this.recenterOnPosition(n)}this.updateProgress(i)}},destroy:function(){this.unAll(),this.wrapper&&(this.container.removeChild(this.wrapper),this.wrapper=null)},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){}},d.util.extend(d.Drawer,d.Observer),d.Drawer.Canvas=Object.create(d.Drawer),d.util.extend(d.Drawer.Canvas,{createElements:function(){var e=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:0,top:0,bottom:0}));if(this.waveCc=e.getContext("2d"),this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.params.waveColor!=this.params.progressColor){var t=this.progressWave.appendChild(document.createElement("canvas"));this.progressCc=t.getContext("2d")}},updateSize:function(){var e=t(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width,this.waveCc.canvas.height=this.height,this.style(this.waveCc.canvas,{width:e+"px"}),this.style(this.progressWave,{display:"block"}),this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:e+"px"})),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawBars:function(e,a,s,c){var r=this;if(e[0]instanceof Array){var i=e;if(this.params.splitChannels)return this.setHeight(i.length*this.params.height*this.params.pixelRatio),void i.forEach(function(e,t){r.drawBars(e,t,s,c)});e=i[0]}var l=[].some.call(e,function(e){return 0>e}),p=1;l&&(p=2);var u=.5/this.params.pixelRatio,m=this.width,g=this.params.height*this.params.pixelRatio,v=g/2,A=e.length/p,f=this.params.barWidth*this.params.pixelRatio,b=o(this.params.pixelRatio,~~(f/2)),x=1;if(this.params.normalize){var w=d.util.max(e),C=d.util.min(e);x=-C>w?-C:w}var S=A/m;this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(o){if(o)for(var d=s/S;d<c/S;d+=f+b){var r=e[n(d*S*p)]||0,l=t(r/x*v);o.fillRect(d+u,v-l+(g*a||0),f+u,2*l)}},this)},drawWave:function(e,a,n,s){var o=this;if(e[0]instanceof Array){var c=e;if(this.params.splitChannels)return this.setHeight(c.length*this.params.height*this.params.pixelRatio),void c.forEach(function(e,t){o.drawWave(e,t,n,s)});e=c[0]}var r=[].some.call(e,function(e){return 0>e});if(!r){for(var l=[],p=0,u=e.length;p<u;p++)l[2*p]=e[p],l[2*p+1]=-e[p];e=l}var m=.5/this.params.pixelRatio,g=this.params.height*this.params.pixelRatio,v=g*a||0,A=g/2,f=~~(e.length/2),b=1;this.params.fillParent&&this.width!=f&&(b=this.width/f);var x=1;if(this.params.normalize){var w=d.util.max(e),C=d.util.min(e);x=-C>w?-C:w}this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(a){if(a){a.beginPath(),a.moveTo(n*b+m,A+v);for(var o=n,d;o<s;o++)d=t(e[2*o]/x*A),a.lineTo(o*b+m,A-d+v);for(var o=s-1,d;o>=n;o--)d=t(e[2*o+1]/x*A),a.lineTo(o*b+m,A-d+v);a.closePath(),a.fill(),a.fillRect(0,A+v-m,this.width,m)}},this)},updateProgress:function(e){this.style(this.progressWave,{width:e+"px"})},getImage:function(e,t){return this.waveCc.canvas.toDataURL(e,t)}}),d.Drawer.MultiCanvas=Object.create(d.Drawer),d.util.extend(d.Drawer.MultiCanvas,{initDrawer:function(e){if(this.maxCanvasWidth=null==e.maxCanvasWidth?4e3:e.maxCanvasWidth,this.maxCanvasElementWidth=t(this.maxCanvasWidth/this.params.pixelRatio),1>=this.maxCanvasWidth)throw"maxCanvasWidth must be greater than 1.";else if(1==this.maxCanvasWidth%2)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor,this.halfPixel=.5/this.params.pixelRatio,this.canvases=[]},createElements:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.addCanvas()},updateSize:function(){for(var e=t(this.width/this.params.pixelRatio),n=a(e/this.maxCanvasElementWidth);this.canvases.length<n;)this.addCanvas();for(;this.canvases.length>n;)this.removeCanvas();for(var s in this.canvases){var i=this.maxCanvasWidth+2*a(this.params.pixelRatio/2);s==this.canvases.length-1&&(i=this.width-this.maxCanvasWidth*(this.canvases.length-1)),this.updateDimensions(this.canvases[s],i,this.height),this.clearWaveForEntry(this.canvases[s])}},addCanvas:function(){var e={},t=this.maxCanvasElementWidth*this.canvases.length;e.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:t+"px",top:0,bottom:0})),e.waveCtx=e.wave.getContext("2d"),this.hasProgressCanvas&&(e.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:t+"px",top:0,bottom:0})),e.progressCtx=e.progress.getContext("2d")),this.canvases.push(e)},removeCanvas:function(){var e=this.canvases.pop();e.wave.parentElement.removeChild(e.wave),this.hasProgressCanvas&&e.progress.parentElement.removeChild(e.progress)},updateDimensions:function(e,a,i){var n=t(a/this.params.pixelRatio),s=t(this.width/this.params.pixelRatio);e.start=e.waveCtx.canvas.offsetLeft/s||0,e.end=e.start+n/s,e.waveCtx.canvas.width=a,e.waveCtx.canvas.height=i,this.style(e.waveCtx.canvas,{width:n+"px"}),this.style(this.progressWave,{display:"block"}),this.hasProgressCanvas&&(e.progressCtx.canvas.width=a,e.progressCtx.canvas.height=i,this.style(e.progressCtx.canvas,{width:n+"px"}))},clearWave:function(){for(var e in this.canvases)this.clearWaveForEntry(this.canvases[e])},clearWaveForEntry:function(e){e.waveCtx.clearRect(0,0,e.waveCtx.canvas.width,e.waveCtx.canvas.height),this.hasProgressCanvas&&e.progressCtx.clearRect(0,0,e.progressCtx.canvas.width,e.progressCtx.canvas.height)},drawBars:function(e,a,s,c){var r=this;if(e[0]instanceof Array){var l=e;if(this.params.splitChannels)return this.setHeight(l.length*this.params.height*this.params.pixelRatio),void l.forEach(function(e,t){r.drawBars(e,t,s,c)});e=l[0]}var p=[].some.call(e,function(e){return 0>e}),u=1;p&&(u=2);var m=this.width,g=this.params.height*this.params.pixelRatio,v=g/2,A=e.length/u,f=this.params.barWidth*this.params.pixelRatio,b=o(this.params.pixelRatio,~~(f/2)),x=1;if(this.params.normalize){var w=d.util.max(e),C=d.util.min(e);x=-C>w?-C:w}for(var S=A/m,k=s/S;k<c/S;k+=f+b){var E=e[n(k*S*u)]||0,T=t(E/x*v);this.fillRect(k+this.halfPixel,v-T+(g*a||0),f+this.halfPixel,2*T)}},drawWave:function(e,t,a,n){var s=this;if(e[0]instanceof Array){var o=e;if(this.params.splitChannels)return this.setHeight(o.length*this.params.height*this.params.pixelRatio),void o.forEach(function(e,t){s.drawWave(e,t,a,n)});e=o[0]}var c=[].some.call(e,function(e){return 0>e});if(!c){for(var r=[],l=0,p=e.length;l<p;l++)r[2*l]=e[l],r[2*l+1]=-e[l];e=r}var u=this.params.height*this.params.pixelRatio,m=u*t||0,g=u/2,h=1;if(this.params.normalize){var v=d.util.max(e),A=d.util.min(e);h=-A>v?-A:v}this.drawLine(e,h,g,m,a,n),this.fillRect(0,g+m-this.halfPixel,this.width,this.halfPixel)},drawLine:function(e,t,a,i,n,s){for(var o in this.canvases){var d=this.canvases[o];this.setFillStyles(d),this.drawLineToContext(d,d.waveCtx,e,t,a,i,n,s),this.drawLineToContext(d,d.progressCtx,e,t,a,i,n,s)}},drawLineToContext:function(e,a,n,d,c,r,l,p){if(a){var u=n.length/2,m=1;this.params.fillParent&&this.width!=u&&(m=this.width/u);var g=t(u*e.start),v=t(u*e.end);if(!(g>p||v<l)){var A=o(g,l),f=s(v,p);a.beginPath(),a.moveTo((A-g)*m+this.halfPixel,c+r);for(var b=A;b<f;b++){var x=n[2*b]||0,w=t(x/d*c);a.lineTo((b-g)*m+this.halfPixel,c-w+r)}for(var b=f-1;b>=A;b--){var x=n[2*b+1]||0,w=t(x/d*c);a.lineTo((b-g)*m+this.halfPixel,c-w+r)}a.closePath(),a.fill()}}},fillRect:function(e,t,d,c){for(var r=n(e/this.maxCanvasWidth),l=s(a((e+d)/this.maxCanvasWidth)+1,this.canvases.length),p=r;p<l;p++){var u=this.canvases[p],m=p*this.maxCanvasWidth,g={x1:o(e,p*this.maxCanvasWidth),y1:t,x2:s(e+d,p*this.maxCanvasWidth+u.waveCtx.canvas.width),y2:t+c};g.x1<g.x2&&(this.setFillStyles(u),this.fillRectToContext(u.waveCtx,g.x1-m,g.y1,g.x2-g.x1,g.y2-g.y1),this.fillRectToContext(u.progressCtx,g.x1-m,g.y1,g.x2-g.x1,g.y2-g.y1))}},fillRectToContext:function(e,t,a,i,n){e&&e.fillRect(t,a,i,n)},setFillStyles:function(e){e.waveCtx.fillStyle=this.params.waveColor,this.hasProgressCanvas&&(e.progressCtx.fillStyle=this.params.progressColor)},updateProgress:function(e){this.style(this.progressWave,{width:e+"px"})}}),d.PeakCache={init:function(){this.clearPeakCache()},clearPeakCache:function(){this.peakCacheRanges=[],this.peakCacheLength=-1},addRangeToPeakCache:function(e,t,a){e!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=e);for(var n=[],s=0;s<this.peakCacheRanges.length&&this.peakCacheRanges[s]<t;)s++;for(0==s%2&&n.push(t);s<this.peakCacheRanges.length&&this.peakCacheRanges[s]<=a;)n.push(this.peakCacheRanges[s]),s++;0==s%2&&n.push(a),n=n.filter(function(e,t,a){return 0==t?e!=a[t+1]:t==a.length-1?e!=a[t-1]:e!=a[t-1]&&e!=a[t+1]}),this.peakCacheRanges=this.peakCacheRanges.concat(n),this.peakCacheRanges=this.peakCacheRanges.sort(function(e,t){return e-t}).filter(function(e,t,a){return 0==t?e!=a[t+1]:t==a.length-1?e!=a[t-1]:e!=a[t-1]&&e!=a[t+1]});var o=[];for(s=0;s<n.length;s+=2)o.push([n[s],n[s+1]]);return o},getCacheRanges:function(){for(var e=[],t=0;t<this.peakCacheRanges.length;t+=2)e.push([this.peakCacheRanges[t],this.peakCacheRanges[t+1]]);return e}},function(){var e=function(){var e=document.querySelectorAll("wavesurfer");Array.prototype.forEach.call(e,function(e){var t=d.util.extend({container:e,backend:"MediaElement",mediaControls:!0},e.dataset);e.style.display="block";var a=d.create(t);if(e.dataset.peaks)var i=JSON.parse(e.dataset.peaks);a.load(e.dataset.url,i)})};"complete"===document.readyState?e():window.addEventListener("load",e)}(),d}),function(e){function t(e,t){const a=e.charCodeAt(t);if(Number.isNaN(a))throw new RangeError(`Index ${t} out of range for string "${e}"; please open an issue at https://github.com/Trott/slug/issues/new`);if(55296>a||57343<a)return[e.charAt(t),t];if(55296<=a&&56319>=a){if(e.length<=t+1)return[" ",t];const a=e.charCodeAt(t+1);return 56320>a||57343<a?[" ",t]:[e.charAt(t)+e.charAt(t+1),t+1]}if(0===t)return[" ",t];const i=e.charCodeAt(t-1);if(55296>i||56319<i)return[" ",t];throw new Error(`String "${e}" reaches code believed to be unreachable; please open an issue at https://github.com/Trott/slug/issues/new`)}function a(e,a){var s=i(e,a);if(""===s){let o="";for(let a=0,i;a<e.length;a++)[i,a]=t(e,a),o+=i;s=i(n(o),a)}return s}function i(e,t){if("string"!=typeof e)throw new Error(`slug() requires a string argument, received ${typeof e}`);"string"==typeof t&&(t={replacement:t}),t=t||{},t.mode=t.mode||a.defaults.mode;var n=a.defaults.modes[t.mode],o=["replacement","multicharmap","charmap","remove","lower"];for(let a=0,i=o.length,s;a<i;a++)s=o[a],t[s]=s in t?t[s]:n[s];const d=s[t.locale]||{};var c=[];for(const a in t.multicharmap)if(Object.prototype.hasOwnProperty.call(t.multicharmap,a)){var r=a.length;-1===c.indexOf(r)&&c.push(r)}var l="";for(let a=0,i=e.length,n;a<i;a++){n=e[a],c.some(function(i){var s=e.substr(a,i);return!!t.multicharmap[s]&&(a+=i-1,n=t.multicharmap[s],!0)})||(d[n]?n=d[n]:t.charmap[n]&&(n=t.charmap[n]));const i="rfc3986"===t.mode?/[^\w\s\-.~]/g:/[^A-Za-z0-9\s]/g;n=n.replace(t.replacement," "),n=n.replace(i,""),t.remove&&(n=n.replace(t.remove,"")),l+=n}return l=l.trim(),l=l.replace(/[-\s]+/g,t.replacement),l=l.replace(t.replacement+"$",""),t.lower&&(l=l.toLowerCase()),l}var n="undefined"==typeof window?function(e){return Buffer.from(e).toString("base64")}:function(e){return btoa(unescape(encodeURIComponent(e)))};const s={bg:{:"Y",:"y",X:"H",x:"h",:"Ts",:"ts",:"Sht",:"sht",:"A",:"a",:"Y",:"y"},sr:{:"dj",:"DJ"}};a.defaults={mode:"pretty"};const o={"<3":"love","&&":"and","||":"or","w/":"with",:"Fi",:"Ghi",:"Khi",:"Qi",:"ugDha",:"ugDhha",:"Yi",:"Za"};a.multicharmap=a.defaults.multicharmap=Object.assign({},o);const d={:"A",:"A",:"A",:"A",:"A",:"A",:"AE",:"C",:"E",:"E",:"E",:"E",:"I",:"I",:"I",:"I",:"D",:"N",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"U",:"U",:"U",:"U",:"U",:"Y",:"TH",:"ss",:"a",:"a",:"a",:"a",:"a",:"a",:"ae",:"c",:"e",:"e",:"e",:"e",:"i",:"i",:"i",:"i",:"d",:"n",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"u",:"u",:"u",:"u",:"u",:"y",:"th",:"y",:"SS",:"a",:"b",:"g",:"d",:"e",:"z",:"h",:"8",:"i",:"k",:"l",:"m",:"n",:"3",:"o",:"p",:"r",:"s",:"t",:"y",:"f",:"x",:"ps",:"w",:"a",:"e",:"i",:"o",:"y",:"h",:"w",:"s",:"i",:"y",:"y",:"i",:"A",:"B",:"G",:"D",:"E",:"Z",:"H",:"8",:"I",:"K",:"L",:"M",:"N",:"3",:"O",:"P",:"R",:"S",:"T",:"Y",:"F",:"X",:"PS",:"W",:"A",:"E",:"I",:"O",:"Y",:"H",:"W",:"I",:"Y",:"s",:"S",:"i",:"I",:"g",:"G",:"a",:"b",:"v",:"g",:"d",:"e",:"yo",:"zh",:"z",:"i",:"j",:"k",:"l",:"m",:"n",:"o",:"p",:"r",:"s",:"t",:"u",:"f",:"h",:"c",:"ch",:"sh",:"sh",:"u",:"y",:"",:"e",:"yu",:"ya",:"A",:"B",:"V",:"G",:"D",:"E",:"Yo",:"Zh",:"Z",:"I",:"J",:"K",:"L",:"M",:"N",:"O",:"P",:"R",:"S",:"T",:"U",:"F",:"H",:"C",:"Ch",:"Sh",:"Sh",:"U",:"Y",:"",:"E",:"Yu",:"Ya",:"Ye",:"I",:"Yi",:"G",:"ye",:"i",:"yi",:"g",:"c",:"d",:"e",:"n",:"r",:"s",:"t",:"u",:"z",:"C",:"D",:"E",:"N",:"R",:"S",:"T",:"U",:"Z",:"l",:"l",:"r",:"L",:"L",:"R",:"a",:"c",:"e",:"l",:"n",:"s",:"z",:"z",:"A",:"C",:"E",:"L",:"N",:"S",:"Z",:"Z",:"a",:"e",:"g",:"i",:"k",:"l",:"n",:"u",:"A",:"E",:"G",:"I",:"K",:"L",:"N",:"U",:"a",:"b",:"t",:"th",:"g",:"h",:"kh",:"d",:"th",:"r",:"z",:"s",:"sh",:"s",:"d",:"t",:"th",:"aa",:"gh",:"f",:"k",:"k",:"l",:"m",:"n",:"h",:"o",:"y",:"a",:"a",:"p",:"zh",:"g",:"ch",:"k",:"i",:"e",:"i",:"u",:"E",:"I",:"U",:"t",:"T",:"t",:"T",:"s",:"S",:"a",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"I",:"I",:"I",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"Y",:"Y",:"Y",:"Y",:"D",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"i",:"i",:"i",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"y",:"y",:"y",:"y",:"d",:"AE",:"ae",:"GH",:"gh",:"KH",:"kh",:"NG",:"ng",:"UE",:"ue",:"U",:"u",:"H",:"h",:"OE",:"oe",:"dj",:"j",:"lj",:"nj",:"c",:"dz",:"Dj",:"j",:"Lj",:"Nj",:"C",:"Dz",:"nj",:"lj",:"NJ",:"LJ",:"a",:"aa",:"e",:"ii",:"ei",:"ae",:"ai",:"i",:"o",:"oi",:"oii",:"uu",:"ou",:"u",:"B",:"Bha",:"Ca",:"Chha",:"Da",:"Dha",:"Fa",:"Ga",:"Gha",:"Ghi",:"Ha",:"Ja",:"Jha",:"Ka",:"Kha",:"Khi",:"L",:"Li",:"Li",:"Lii",:"Lii",:"Ma",:"Na",:"Na",:"Nia",:"Nae",:"Ni",:"oms",:"Pa",:"Qi",:"Ra",:"Ri",:"Ri",:"Ri",:"Sa",:"Sha",:"Shha",:"Ta",:"Ta",:"Tha",:"Tha",:"Tha",:"Thha",:"ugDha",:"ugDhha",:"Va",:"Ya",:"Yi",:"Za",:"e",:"E",:"a",:"b",:"g",:"d",:"e",:"v",:"z",:"t",:"i",:"k",:"l",:"m",:"n",:"o",:"p",:"zh",:"r",:"s",:"t",:"u",:"p",:"k",:"gh",:"q",:"sh",:"ch",:"ts",:"dz",:"ts",:"ch",:"kh",:"j",:"h","":"euro","":"cruzeiro","":"french franc","":"pound","":"lira","":"mill","":"naira","":"peseta","":"rupee","":"won","":"new shequel","":"dong","":"kip","":"tugrik","":"drachma","":"penny","":"peso","":"guarani","":"austral","":"hryvnia","":"cedi","":"cent","":"yen",:"yuan",:"yen","":"rial","":"ecu","":"currency","":"baht",$:"dollar","":"indian rupee","":"russian ruble","":"bitcoin","":"kazakhstani tenge","":"c",:"oe",:"OE","":"sum","":"r","":"d",:"f","":"tm","":"sm","":"...","":"o",:"o",:"a","":"delta","":"infinity","":"love","&":"and","|":"or","<":"less",">":"greater"};a.charmap=a.defaults.charmap=Object.assign({},d),a.reset=function(){a.defaults.modes.rfc3986.charmap=a.defaults.modes.pretty.charmap=a.charmap=a.defaults.charmap=Object.assign({},d),a.defaults.modes.rfc3986.multiCharmap=a.defaults.modes.pretty.multiCharmap=a.multicharmap=a.defaults.multicharmap=Object.assign({},o)},a.extend=function(e){Object.assign(a.charmap,e)},a.defaults.modes={rfc3986:{replacement:"-",remove:null,lower:!0,charmap:a.defaults.charmap,multicharmap:a.defaults.multicharmap},pretty:{replacement:"-",remove:/[.]/g,lower:!0,charmap:a.defaults.charmap,multicharmap:a.defaults.multicharmap}},"undefined"!=typeof define&&define.amd?define("slug",[],function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:e.slug=a}(this);(function(e){"function"==typeof define&&define.amd?define("magnific-popup",["jquery"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery||window.Zepto)})(function(t){var e=Math.min,a=function(){},i=!!window.jQuery,o=t(window),d=function(e,t){m.ev.on("mfp"+e+".mfp",t)},c=function(e,a,i,n){var s=document.createElement("div");return s.className="mfp-"+e,i&&(s.innerHTML=i),n?a&&a.appendChild(s):(s=t(s),a&&s.appendTo(a)),s},r=function(a,i){m.ev.triggerHandler("mfp"+a,i),m.st.callbacks&&(a=a.charAt(0).toLowerCase()+a.slice(1),m.st.callbacks[a]&&m.st.callbacks[a].apply(m,t.isArray(i)?i:[i]))},l=function(e){return e===f&&m.currTemplate.closeBtn||(m.currTemplate.closeBtn=t(m.st.closeMarkup.replace("%title%",m.st.tClose)),f=e),m.currTemplate.closeBtn},p=function(){t.magnificPopup.instance||(m=new a,m.init(),t.magnificPopup.instance=m)},u=function(){var e=document.createElement("p").style,t=["ms","O","Moz","Webkit"];if(void 0!==e.transition)return!0;for(;t.length;)if(t.pop()+"Transition"in e)return!0;return!1},m,g,h,v,A,f;a.prototype={constructor:a,init:function(){var e=navigator.appVersion;m.isLowIE=m.isIE8=document.all&&!document.addEventListener,m.isAndroid=/android/gi.test(e),m.isIOS=/iphone|ipad|ipod/gi.test(e),m.supportsTransition=u(),m.probablyMobile=m.isAndroid||m.isIOS||/(Opera Mini)|Kindle|webOS|BlackBerry|(Opera Mobi)|(Windows Phone)|IEMobile/i.test(navigator.userAgent),h=t(document),m.popupsCache={}},open:function(e){var a;if(!1===e.isObj){m.items=e.items.toArray(),m.index=0;var p=e.items,u;for(a=0;a<p.length;a++)if(u=p[a],u.parsed&&(u=u.el[0]),u===e.el[0]){m.index=a;break}}else m.items=t.isArray(e.items)?e.items:[e.items],m.index=e.index||0;if(m.isOpen)return void m.updateItemHTML();m.types=[],A="",m.ev=e.mainEl&&e.mainEl.length?e.mainEl.eq(0):h,e.key?(!m.popupsCache[e.key]&&(m.popupsCache[e.key]={}),m.currTemplate=m.popupsCache[e.key]):m.currTemplate={},m.st=t.extend(!0,{},t.magnificPopup.defaults,e),m.fixedContentPos="auto"===m.st.fixedContentPos?!m.probablyMobile:m.st.fixedContentPos,m.st.modal&&(m.st.closeOnContentClick=!1,m.st.closeOnBgClick=!1,m.st.showCloseBtn=!1,m.st.enableEscapeKey=!1),m.bgOverlay||(m.bgOverlay=c("bg").on("click.mfp",function(){m.close()}),m.wrap=c("wrap").attr("tabindex",-1).on("click.mfp",function(t){m._checkIfClose(t.target)&&m.close()}),m.container=c("container",m.wrap)),m.contentContainer=c("content"),m.st.preloader&&(m.preloader=c("preloader",m.container,m.st.tLoading));var g=t.magnificPopup.modules;for(a=0;a<g.length;a++){var v=g[a];v=v.charAt(0).toUpperCase()+v.slice(1),m["init"+v].call(m)}r("BeforeOpen"),m.st.showCloseBtn&&(m.st.closeBtnInside?(d("MarkupParse",function(t,e,a,i){a.close_replaceWith=l(i.type)}),A+=" mfp-close-btn-in"):m.wrap.append(l())),m.st.alignTop&&(A+=" mfp-align-top"),m.fixedContentPos?m.wrap.css({overflow:m.st.overflowY,overflowX:"hidden",overflowY:m.st.overflowY}):m.wrap.css({top:o.scrollTop(),position:"absolute"}),!1!==m.st.fixedBgPos&&("auto"!==m.st.fixedBgPos||m.fixedContentPos)||m.bgOverlay.css({height:h.height(),position:"absolute"}),m.st.enableEscapeKey&&h.on("keyup.mfp",function(t){27===t.keyCode&&m.close()}),o.on("resize.mfp",function(){m.updateSize()}),m.st.closeOnContentClick||(A+=" mfp-auto-cursor"),A&&m.wrap.addClass(A);var f=m.wH=o.height(),b={};if(m.fixedContentPos&&m._hasScrollBar(f)){var x=m._getScrollbarSize();x&&(b.marginRight=x)}m.fixedContentPos&&(m.isIE7?t("body, html").css("overflow","hidden"):b.overflow="hidden");var s=m.st.mainClass;return m.isIE7&&(s+=" mfp-ie7"),s&&m._addClassToMFP(s),m.updateItemHTML(),r("BuildControls"),t("html").css(b),m.bgOverlay.add(m.wrap).prependTo(m.st.prependTo||t(document.body)),m._lastFocusedEl=document.activeElement,setTimeout(function(){m.content?(m._addClassToMFP("mfp-ready"),m._setFocus()):m.bgOverlay.addClass("mfp-ready"),h.on("focusin.mfp",m._onFocusIn)},16),m.isOpen=!0,m.updateSize(f),r("Open"),e},close:function(){m.isOpen&&(r("BeforeClose"),m.isOpen=!1,m.st.removalDelay&&!m.isLowIE&&m.supportsTransition?(m._addClassToMFP("mfp-removing"),setTimeout(function(){m._close()},m.st.removalDelay)):m._close())},_close:function(){r("Close");var e="mfp-removing mfp-ready ";if(m.bgOverlay.detach(),m.wrap.detach(),m.container.empty(),m.st.mainClass&&(e+=m.st.mainClass+" "),m._removeClassFromMFP(e),m.fixedContentPos){var a={marginRight:""};m.isIE7?t("body, html").css("overflow",""):a.overflow="",t("html").css(a)}h.off("keyup.mfp focusin.mfp"),m.ev.off(".mfp"),m.wrap.attr("class","mfp-wrap").removeAttr("style"),m.bgOverlay.attr("class","mfp-bg"),m.container.attr("class","mfp-container"),m.st.showCloseBtn&&(!m.st.closeBtnInside||!0===m.currTemplate[m.currItem.type])&&m.currTemplate.closeBtn&&m.currTemplate.closeBtn.detach(),m.st.autoFocusLast&&m._lastFocusedEl&&t(m._lastFocusedEl).focus(),m.currItem=null,m.content=null,m.currTemplate=null,m.prevHeight=0,r("AfterClose")},updateSize:function(e){if(m.isIOS){var t=document.documentElement.clientWidth/window.innerWidth,a=window.innerHeight*t;m.wrap.css("height",a),m.wH=a}else m.wH=e||o.height();m.fixedContentPos||m.wrap.css("height",m.wH),r("Resize")},updateItemHTML:function(){var e=m.items[m.index];m.contentContainer.detach(),m.content&&m.content.detach(),e.parsed||(e=m.parseEl(m.index));var a=e.type;if(r("BeforeChange",[m.currItem?m.currItem.type:"",a]),m.currItem=e,!m.currTemplate[a]){var i=!!m.st[a]&&m.st[a].markup;r("FirstMarkupParse",i),m.currTemplate[a]=!i||t(i)}v&&v!==e.type&&m.container.removeClass("mfp-"+v+"-holder");var n=m["get"+a.charAt(0).toUpperCase()+a.slice(1)](e,m.currTemplate[a]);m.appendContent(n,a),e.preloaded=!0,r("Change",e),v=e.type,m.container.prepend(m.contentContainer),r("AfterChange")},appendContent:function(e,t){m.content=e,e?m.st.showCloseBtn&&m.st.closeBtnInside&&!0===m.currTemplate[t]?!m.content.find(".mfp-close").length&&m.content.append(l()):m.content=e:m.content="",r("BeforeAppend"),m.container.addClass("mfp-"+t+"-holder"),m.contentContainer.append(m.content)},parseEl:function(e){var a=m.items[e],n;if(a.tagName?a={el:t(a)}:(n=a.type,a={data:a,src:a.src}),a.el){for(var s=m.types,o=0;o<s.length;o++)if(a.el.hasClass("mfp-"+s[o])){n=s[o];break}a.src=a.el.attr("data-mfp-src"),a.src||(a.src=a.el.attr("href"))}return a.type=n||m.st.type||"inline",a.index=e,a.parsed=!0,m.items[e]=a,r("ElementParse",a),m.items[e]},addGroup:function(t,a){var i=function(i){i.mfpEl=this,m._openClick(i,t,a)};a||(a={});a.mainEl=t,a.items?(a.isObj=!0,t.off("click.magnificPopup").on("click.magnificPopup",i)):(a.isObj=!1,a.delegate?t.off("click.magnificPopup").on("click.magnificPopup",a.delegate,i):(a.items=t,t.off("click.magnificPopup").on("click.magnificPopup",i)))},_openClick:function(a,e,i){var n=i.midClick===void 0?t.magnificPopup.defaults.midClick:i.midClick;if(!(!n&&(2===a.which||a.ctrlKey||a.metaKey||a.altKey||a.shiftKey))){var s=void 0===i.disableOn?t.magnificPopup.defaults.disableOn:i.disableOn;if(s)if(t.isFunction(s)){if(!s.call(m))return!0;}else if(o.width()<s)return!0;a.type&&(a.preventDefault(),m.isOpen&&a.stopPropagation()),i.el=t(a.mfpEl),i.delegate&&(i.items=e.find(i.delegate)),m.open(i)}},updateStatus:function(e,t){if(m.preloader){g!==e&&m.container.removeClass("mfp-s-"+g),t||"loading"!==e||(t=m.st.tLoading);var a={status:e,text:t};r("UpdateStatus",a),e=a.status,t=a.text,m.preloader.html(t),m.preloader.find("a").on("click",function(t){t.stopImmediatePropagation()}),m.container.addClass("mfp-s-"+e),g=e}},_checkIfClose:function(e){if(!t(e).hasClass("mfp-prevent-close")){var a=m.st.closeOnContentClick,i=m.st.closeOnBgClick;if(a&&i)return!0;if(!m.content||t(e).hasClass("mfp-close")||m.preloader&&e===m.preloader[0])return!0;if(e!==m.content[0]&&!t.contains(m.content[0],e)){if(i&&t.contains(document,e))return!0;}else if(a)return!0;return!1}},_addClassToMFP:function(e){m.bgOverlay.addClass(e),m.wrap.addClass(e)},_removeClassFromMFP:function(e){this.bgOverlay.removeClass(e),m.wrap.removeClass(e)},_hasScrollBar:function(e){return(m.isIE7?h.height():document.body.scrollHeight)>(e||o.height())},_setFocus:function(){(m.st.focus?m.content.find(m.st.focus).eq(0):m.wrap).focus()},_onFocusIn:function(a){if(a.target!==m.wrap[0]&&!t.contains(m.wrap[0],a.target))return m._setFocus(),!1},_parseMarkup:function(e,a,i){var n;i.data&&(a=t.extend(i.data,a)),r("MarkupParse",[e,a,i]),t.each(a,function(a,i){if(void 0===i||!1===i)return!0;if(n=a.split("_"),1<n.length){var s=e.find(".mfp-"+n[0]);if(0<s.length){var o=n[1];"replaceWith"===o?s[0]!==i[0]&&s.replaceWith(i):"img"===o?s.is("img")?s.attr("src",i):s.replaceWith(t("<img>").attr("src",i).attr("class",s.attr("class"))):s.attr(n[1],i)}}else e.find(".mfp-"+a).html(i)})},_getScrollbarSize:function(){if(m.scrollbarSize===void 0){var e=document.createElement("div");e.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(e),m.scrollbarSize=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return m.scrollbarSize}},t.magnificPopup={instance:null,proto:a.prototype,modules:[],open:function(e,a){return p(),e=e?t.extend(!0,{},e):{},e.isObj=!0,e.index=a||0,this.instance.open(e)},close:function(){return t.magnificPopup.instance&&t.magnificPopup.instance.close()},registerModule:function(e,a){a.options&&(t.magnificPopup.defaults[e]=a.options),t.extend(this.proto,a.proto),this.modules.push(e)},defaults:{disableOn:0,key:null,midClick:!1,mainClass:"",preloader:!0,focus:"",closeOnContentClick:!1,closeOnBgClick:!0,closeBtnInside:!0,showCloseBtn:!0,enableEscapeKey:!0,modal:!1,alignTop:!1,removalDelay:0,prependTo:null,fixedContentPos:"auto",fixedBgPos:"auto",overflowY:"auto",closeMarkup:"<button title=\"%title%\" type=\"button\" class=\"mfp-close\">&#215;</button>",tClose:"Close (Esc)",tLoading:"Loading...",autoFocusLast:!0}},t.fn.magnificPopup=function(e){p();var a=t(this);if(!("string"==typeof e))e=t.extend(!0,{},e),i?a.data("magnificPopup",e):a[0].magnificPopup=e,m.addGroup(a,e);else if("open"===e){var n=i?a.data("magnificPopup"):a[0].magnificPopup,s=parseInt(arguments[1],10)||0,o;n.items?o=n.items[s]:(o=a,n.delegate&&(o=o.find(n.delegate)),o=o.eq(s)),m._openClick({mfpEl:o},a,n)}else m.isOpen&&m[e].apply(m,Array.prototype.slice.call(arguments,1));return a};var b=function(){C&&(w.after(C.addClass(x)).detach(),C=null)},x,w,C;t.magnificPopup.registerModule("inline",{options:{hiddenClass:"hide",markup:"",tNotFound:"Content not found"},proto:{initInline:function(){m.types.push("inline"),d("Close.inline",function(){b()})},getInline:function(e,a){if(b(),e.src){var i=m.st.inline,n=t(e.src);if(n.length){var s=n[0].parentNode;s&&s.tagName&&(!w&&(x=i.hiddenClass,w=c(x),x="mfp-"+x),C=n.after(w).detach().removeClass(x)),m.updateStatus("ready")}else m.updateStatus("error",i.tNotFound),n=t("<div>");return e.inlineElement=n,n}return m.updateStatus("ready"),m._parseMarkup(a,{},e),a}}});var S=function(){E&&t(document.body).removeClass(E)},k=function(){S(),m.req&&m.req.abort()},E;t.magnificPopup.registerModule("ajax",{options:{settings:null,cursor:"mfp-ajax-cur",tError:"<a href=\"%url%\">The content</a> could not be loaded."},proto:{initAjax:function(){m.types.push("ajax"),E=m.st.ajax.cursor,d("Close.ajax",k),d("BeforeChange.ajax",k)},getAjax:function(e){E&&t(document.body).addClass(E),m.updateStatus("loading");var a=t.extend({url:e.src,success:function(a,i,n){var s={data:a,xhr:n};r("ParseAjax",s),m.appendContent(t(s.data),"ajax"),e.finished=!0,S(),m._setFocus(),setTimeout(function(){m.wrap.addClass("mfp-ready")},16),m.updateStatus("ready"),r("AjaxContentAdded")},error:function(){S(),e.finished=e.loadError=!0,m.updateStatus("error",m.st.ajax.tError.replace("%url%",e.src))}},m.st.ajax.settings);return m.req=t.ajax(a),""}}});var T=function(e){if(e.data&&e.data.title!==void 0)return e.data.title;var a=m.st.image.titleSrc;if(a){if(t.isFunction(a))return a.call(m,e);if(e.el)return e.el.attr(a)||""}return""},I;t.magnificPopup.registerModule("image",{options:{markup:"<div class=\"mfp-figure\"><div class=\"mfp-close\"></div><figure><div class=\"mfp-img\"></div><figcaption><div class=\"mfp-bottom-bar\"><div class=\"mfp-title\"></div><div class=\"mfp-counter\"></div></div></figcaption></figure></div>",cursor:"mfp-zoom-out-cur",titleSrc:"title",verticalFit:!0,tError:"<a href=\"%url%\">The image</a> could not be loaded."},proto:{initImage:function(){var e=m.st.image;m.types.push("image"),d("Open.image",function(){"image"===m.currItem.type&&e.cursor&&t(document.body).addClass(e.cursor)}),d("Close.image",function(){e.cursor&&t(document.body).removeClass(e.cursor),o.off("resize.mfp")}),d("Resize.image",m.resizeImage),m.isLowIE&&d("AfterChange",m.resizeImage)},resizeImage:function(){var e=m.currItem;if(e&&e.img&&m.st.image.verticalFit){var t=0;m.isLowIE&&(t=parseInt(e.img.css("padding-top"),10)+parseInt(e.img.css("padding-bottom"),10)),e.img.css("max-height",m.wH-t)}},_onImageHasSize:function(e){e.img&&(e.hasSize=!0,I&&clearInterval(I),e.isCheckingImgSize=!1,r("ImageHasSize",e),e.imgHidden&&(m.content&&m.content.removeClass("mfp-loading"),e.imgHidden=!1))},findImageSize:function(e){var t=0,a=e.img[0],i=function(n){I&&clearInterval(I),I=setInterval(function(){return 0<a.naturalWidth?void m._onImageHasSize(e):void(200<t&&clearInterval(I),t++,3===t?i(10):40===t?i(50):100==t&&i(500))},n)};i(1)},getImage:function(e,a){var i=0,n=function(){e&&(e.img[0].complete?(e.img.off(".mfploader"),e===m.currItem&&(m._onImageHasSize(e),m.updateStatus("ready")),e.hasSize=!0,e.loaded=!0,r("ImageLoadComplete")):(i++,200>i?setTimeout(n,100):s()))},s=function(){e&&(e.img.off(".mfploader"),e===m.currItem&&(m._onImageHasSize(e),m.updateStatus("error",o.tError.replace("%url%",e.src))),e.hasSize=!0,e.loaded=!0,e.loadError=!0)},o=m.st.image,d=a.find(".mfp-img");if(d.length){var c=document.createElement("img");c.className="mfp-img",e.el&&e.el.find("img").length&&(c.alt=e.el.find("img").attr("alt")),e.img=t(c).on("load.mfploader",n).on("error.mfploader",s),c.src=e.src,d.is("img")&&(e.img=e.img.clone()),c=e.img[0],0<c.naturalWidth?e.hasSize=!0:!c.width&&(e.hasSize=!1)}return(m._parseMarkup(a,{title:T(e),img_replaceWith:e.img},e),m.resizeImage(),e.hasSize)?(I&&clearInterval(I),e.loadError?(a.addClass("mfp-loading"),m.updateStatus("error",o.tError.replace("%url%",e.src))):(a.removeClass("mfp-loading"),m.updateStatus("ready")),a):(m.updateStatus("loading"),e.loading=!0,e.hasSize||(e.imgHidden=!0,a.addClass("mfp-loading"),m.findImageSize(e)),a)}}});var M=function(){return void 0===N&&(N=void 0!==document.createElement("p").style.MozTransform),N},N;t.magnificPopup.registerModule("zoom",{options:{enabled:!1,easing:"ease-in-out",duration:300,opener:function(e){return e.is("img")?e:e.find("img")}},proto:{initZoom:function(){var e=m.st.zoom,t;if(e.enabled&&m.supportsTransition){var a=e.duration,i=function(t){var a=t.clone().removeAttr("style").removeAttr("class").addClass("mfp-animated-image"),i="all "+e.duration/1e3+"s "+e.easing,n={position:"fixed",zIndex:9999,left:0,top:0,"-webkit-backface-visibility":"hidden"};return n["-webkit-transition"]=n["-moz-transition"]=n["-o-transition"]=n.transition=i,a.css(n),a},n=function(){m.content.css("visibility","visible")},s,o;d("BuildControls.zoom",function(){if(m._allowZoom()){if(clearTimeout(s),m.content.css("visibility","hidden"),t=m._getItemToZoom(),!t)return void n();o=i(t),o.css(m._getOffset()),m.wrap.append(o),s=setTimeout(function(){o.css(m._getOffset(!0)),s=setTimeout(function(){n(),setTimeout(function(){o.remove(),t=o=null,r("ZoomAnimationEnded")},16)},a)},16)}}),d("BeforeClose.zoom",function(){if(m._allowZoom()){if(clearTimeout(s),m.st.removalDelay=a,!t){if(t=m._getItemToZoom(),!t)return;o=i(t)}o.css(m._getOffset(!0)),m.wrap.append(o),m.content.css("visibility","hidden"),setTimeout(function(){o.css(m._getOffset())},16)}}),d("Close.zoom",function(){m._allowZoom()&&(n(),o&&o.remove(),t=null)})}},_allowZoom:function(){return"image"===m.currItem.type},_getItemToZoom:function(){return!!m.currItem.hasSize&&m.currItem.img},_getOffset:function(e){var a=e?m.currItem.img:m.st.zoom.opener(m.currItem.el||m.currItem);var n=a.offset(),s=parseInt(a.css("padding-top"),10),o=parseInt(a.css("padding-bottom"),10);n.top-=t(window).scrollTop()-s;var d={width:a.width(),height:(i?a.innerHeight():a[0].offsetHeight)-o-s};return M()?d["-moz-transform"]=d.transform="translate("+n.left+"px,"+n.top+"px)":(d.left=n.left,d.top=n.top),d}}});var R=function(e){if(m.currTemplate.iframe){var t=m.currTemplate.iframe.find("iframe");t.length&&(!e&&(t[0].src="//about:blank"),m.isIE8&&t.css("display",e?"block":"none"))}};t.magnificPopup.registerModule("iframe",{options:{markup:"<div class=\"mfp-iframe-scaler\"><div class=\"mfp-close\"></div><iframe class=\"mfp-iframe\" src=\"//about:blank\" frameborder=\"0\" allowfullscreen></iframe></div>",srcAction:"iframe_src",patterns:{youtube:{index:"youtube.com",id:"v=",src:"//www.youtube.com/embed/%id%?autoplay=1"},vimeo:{index:"vimeo.com/",id:"/",src:"//player.vimeo.com/video/%id%?autoplay=1"},gmaps:{index:"//maps.google.",src:"%id%&output=embed"}}},proto:{initIframe:function(){m.types.push("iframe"),d("BeforeChange",function(t,e,a){e!==a&&(e==="iframe"?R():a==="iframe"&&R(!0))}),d("Close.iframe",function(){R()})},getIframe:function(e,a){var i=e.src,n=m.st.iframe;t.each(n.patterns,function(){if(-1<i.indexOf(this.index))return this.id&&("string"==typeof this.id?i=i.substr(i.lastIndexOf(this.id)+this.id.length,i.length):i=this.id.call(this,i)),i=this.src.replace("%id%",i),!1});var s={};return n.srcAction&&(s[n.srcAction]=i),m._parseMarkup(a,s,e),m.updateStatus("ready"),a}}});var O=function(e){var t=m.items.length;if(e>t-1)return e-t;return 0>e?t+e:e},j=function(e,t,a){return e.replace(/%curr%/gi,t+1).replace(/%total%/gi,a)};t.magnificPopup.registerModule("gallery",{options:{enabled:!1,arrowMarkup:"<button title=\"%title%\" type=\"button\" class=\"mfp-arrow mfp-arrow-%dir%\"></button>",preload:[0,2],navigateByImgClick:!0,arrows:!0,tPrev:"Previous (Left arrow key)",tNext:"Next (Right arrow key)",tCounter:"%curr% of %total%"},proto:{initGallery:function(){var a=m.st.gallery;return m.direction=!0,!!(a&&a.enabled)&&void(A+=" mfp-gallery",d("Open.mfp-gallery",function(){a.navigateByImgClick&&m.wrap.on("click.mfp-gallery",".mfp-img",function(){if(1<m.items.length)return m.next(),!1}),h.on("keydown.mfp-gallery",function(t){37===t.keyCode?m.prev():39===t.keyCode&&m.next()})}),d("UpdateStatus.mfp-gallery",function(t,e){e.text&&(e.text=j(e.text,m.currItem.index,m.items.length))}),d("MarkupParse.mfp-gallery",function(t,e,i,n){var s=m.items.length;i.counter=1<s?j(a.tCounter,n.index,s):""}),d("BuildControls.mfp-gallery",function(){if(1<m.items.length&&a.arrows&&!m.arrowLeft){var e=a.arrowMarkup,i=m.arrowLeft=t(e.replace(/%title%/gi,a.tPrev).replace(/%dir%/gi,"left")).addClass("mfp-prevent-close"),n=m.arrowRight=t(e.replace(/%title%/gi,a.tNext).replace(/%dir%/gi,"right")).addClass("mfp-prevent-close");i.click(function(){m.prev()}),n.click(function(){m.next()}),m.container.append(i.add(n))}}),d("Change.mfp-gallery",function(){m._preloadTimeout&&clearTimeout(m._preloadTimeout),m._preloadTimeout=setTimeout(function(){m.preloadNearbyImages(),m._preloadTimeout=null},16)}),d("Close.mfp-gallery",function(){h.off(".mfp-gallery"),m.wrap.off("click.mfp-gallery"),m.arrowRight=m.arrowLeft=null}))},next:function(){m.direction=!0,m.index=O(m.index+1),m.updateItemHTML()},prev:function(){m.direction=!1,m.index=O(m.index-1),m.updateItemHTML()},goTo:function(e){m.direction=e>=m.index,m.index=e,m.updateItemHTML()},preloadNearbyImages:function(){var t=m.st.gallery.preload,a=e(t[0],m.items.length),n=e(t[1],m.items.length),s;for(s=1;s<=(m.direction?n:a);s++)m._preloadItem(m.index+s);for(s=1;s<=(m.direction?a:n);s++)m._preloadItem(m.index-s)},_preloadItem:function(e){if(e=O(e),!m.items[e].preloaded){var a=m.items[e];a.parsed||(a=m.parseEl(e)),r("LazyLoad",a),"image"===a.type&&(a.img=t("<img class=\"mfp-img\" />").on("load.mfploader",function(){a.hasSize=!0}).on("error.mfploader",function(){a.hasSize=!0,a.loadError=!0,r("LazyLoadError",a)}).attr("src",a.src)),a.preloaded=!0}}}});t.magnificPopup.registerModule("retina",{options:{replaceSrc:function(e){return e.src.replace(/\.\w+$/,function(e){return"@2x"+e})},ratio:1},proto:{initRetina:function(){if(1<window.devicePixelRatio){var t=m.st.retina,a=t.ratio;a=isNaN(a)?a():a,1<a&&(d("ImageHasSize.retina",function(t,e){e.img.css({"max-width":e.img[0].naturalWidth/a,width:"100%"})}),d("ElementParse.retina",function(i,e){e.src=t.replaceSrc(e,a)}))}}}}),p()}),function(e,t){if("function"==typeof define&&define.amd)define("strophe",[],t);else{var a=t();e.Strophe=a.Strophe,e.$build=a.$build,e.$iq=a.$iq,e.$msg=a.$msg,e.$pres=a.$pres,e.SHA1=a.SHA1,e.MD5=a.MD5,e.b64_hmac_sha1=a.b64_hmac_sha1,e.b64_sha1=a.b64_sha1,e.str_hmac_sha1=a.str_hmac_sha1,e.str_sha1=a.str_sha1}}(this,function(){var e=Math.abs,t=String.fromCharCode,a=Math.ceil,n=Math.floor,s=Math.pow,o=Math.min,d,c,r;return function(e){function t(e,t){return f.call(e,t)}function a(e,t){var a=t&&t.split("/"),n=v.map,s=n&&n["*"]||{},o,d,c,r,l,p,u,m,g,h,A,f;if(e){for(e=e.split("/"),l=e.length-1,v.nodeIdCompat&&x.test(e[l])&&(e[l]=e[l].replace(x,"")),"."===e[0].charAt(0)&&a&&(f=a.slice(0,a.length-1),e=f.concat(e)),g=0;g<e.length;g++)if(A=e[g],"."===A)e.splice(g,1),g-=1;else if(".."===A)if(0===g||1===g&&".."===e[2]||".."===e[g-1])continue;else 0<g&&(e.splice(g-1,2),g-=2);e=e.join("/")}if((a||s)&&n){for(o=e.split("/"),g=o.length;0<g;g-=1){if(d=o.slice(0,g).join("/"),a)for(h=a.length;0<h;h-=1)if(c=n[a.slice(0,h).join("/")],c&&(c=c[d],c)){r=c,p=g;break}if(r)break;!u&&s&&s[d]&&(u=s[d],m=g)}!r&&u&&(r=u,p=m),r&&(o.splice(0,p,r),e=o.join("/"))}return e}function n(t,a){return function(){var i=b.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),C.apply(e,i.concat([t,a]))}}function s(e){return function(t){return a(t,e)}}function o(e){return function(t){g[e]=t}}function l(a){if(t(h,a)){var i=h[a];delete h[a],A[a]=!0,w.apply(e,i)}if(!t(g,a)&&!t(A,a))throw new Error("No "+a);return g[a]}function p(e){var t=e?e.indexOf("!"):-1,a;return-1<t&&(a=e.substring(0,t),e=e.substring(t+1,e.length)),[a,e]}function u(e){return e?p(e):[]}function m(e){return function(){return v&&v.config&&v.config[e]||{}}}var g={},h={},v={},A={},f=Object.prototype.hasOwnProperty,b=[].slice,x=/\.js$/,w,C,S,k;S=function(e,t){var i=p(e),n=i[0],o=t[1],d;return e=i[1],n&&(n=a(n,o),d=l(n)),n?d&&d.normalize?e=d.normalize(e,s(o)):e=a(e,o):(e=a(e,o),i=p(e),n=i[0],e=i[1],n&&(d=l(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:d}},k={require:function(e){return n(e)},exports:function(t){var a=g[t];return"undefined"==typeof a?g[t]={}:a},module:function(e){return{id:e,uri:"",exports:g[e],config:m(e)}}},w=function(a,s,d,c){var r=[],p=typeof d,m,v,f,b,x,w,C;if(c=c||a,w=u(c),"undefined"==p||"function"===p){for(s=!s.length&&d.length?["require","exports","module"]:s,x=0;x<s.length;x+=1)if(b=S(s[x],w),v=b.f,"require"===v)r[x]=k.require(a);else if("exports"===v)r[x]=k.exports(a),C=!0;else if("module"===v)m=r[x]=k.module(a);else if(t(g,v)||t(h,v)||t(A,v))r[x]=l(v);else if(b.p)b.p.load(b.n,n(c,!0),o(v),{}),r[x]=g[v];else throw new Error(a+" missing "+v);f=d?d.apply(g[a],r):void 0,a&&(m&&m.exports!==e&&m.exports!==g[a]?g[a]=m.exports:(f!==e||!C)&&(g[a]=f))}else a&&(g[a]=d)},d=c=C=function(t,a,i,n,s){if("string"==typeof t)return k[t]?k[t](a):l(S(t,u(a)).f);if(!t.splice){if(v=t,v.deps&&C(v.deps,v.callback),!a)return;a.splice?(t=a,a=i,i=null):t=e}return a=a||function(){},"function"==typeof i&&(i=n,n=s),n?w(e,t,a,i):setTimeout(function(){w(e,t,a,i)},4),C},C.config=function(e){return C(e)},d._defined=g,r=function(e,a,i){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");a.splice||(i=a,a=[]),t(g,e)||t(h,e)||(h[e]=[e,a,i])},r.amd={jQuery:!0}}(),r("node_modules/almond/almond.js",function(){}),function(e,t){return"function"==typeof r&&r.amd?void r("strophe-polyfill",[],function(){return t(e)}):t(e)}(this,function(e){Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,a=Array.prototype.slice,i=Array.prototype.concat,n=a.call(arguments,1);return function(){return t.apply(e?e:this,i.call(n,a.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,i=+arguments[1]||0;for(i=0>i?a(i):n(i),0>i&&(i+=t);i<t;i++)if(i in this&&this[i]===e)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var a,i;if(null===this)throw new TypeError(" this is null or not defined");var n=Object(this),s=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(a=t),i=0;i<s;){var o;i in n&&(o=n[i],e.call(a,o,i,n)),i++}});e.btoa||(e.btoa=function(e){var t="",a=0,n,s,o,d,c,r,l;do n=e.charCodeAt(a++),s=e.charCodeAt(a++),o=e.charCodeAt(a++),d=n>>2,c=(3&n)<<4|s>>4,r=(15&s)<<2|o>>6,l=63&o,isNaN(s)?(c=(3&n)<<4,r=l=64):isNaN(o)&&(l=64),t=t+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);while(a<e.length);return t}),e.atob||(e.atob=function(e){var a="",n=0,s,o,d,c,r,l,p;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(n++)),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(n++)),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(n++)),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e.charAt(n++)),s=c<<2|r>>4,o=(15&r)<<4|l>>2,d=(3&l)<<6|p,a+=t(s),64!==l&&(a+=t(o)),64!==p&&(a+=t(d));while(n<e.length);return a})}),function(e,t){"function"==typeof r&&r.amd?r("strophe-sha1",[],function(){return t()}):"object"==typeof exports?module.exports=t():e.SHA1=t()}(this,function(){function e(o,p){o[p>>5]|=128<<24-p%32,o[(p+64>>9<<4)+15]=p;var u=Array(80),m=1732584193,g=-271733879,h=-1732584194,v=271733878,A=-1009589776,f,x,w,C,S,k,E,T;for(f=0;f<o.length;f+=16){for(C=m,S=g,k=h,E=v,T=A,x=0;80>x;x++)u[x]=16>x?o[f+x]:l(u[x-3]^u[x-8]^u[x-14]^u[x-16],1),w=r(r(l(m,5),n(x,g,h,v)),r(r(A,u[x]),s(x))),A=v,v=h,h=l(g,30),g=m,m=w;m=r(m,C),g=r(g,S),h=r(h,k),v=r(v,E),A=r(A,T)}return[m,g,h,v,A]}function n(e,t,a,i){return 20>e?t&a|~t&i:40>e?t^a^i:60>e?t&a|t&i|a&i:t^a^i}function s(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function o(t,a){var n=p(t);16<n.length&&(n=e(n,8*t.length));for(var s=Array(16),o=Array(16),d=0;16>d;d++)s[d]=909522486^n[d],o[d]=1549556828^n[d];var c=e(s.concat(p(a)),512+8*a.length);return e(o.concat(c),672)}function r(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function l(e,t){return e<<t|e>>>32-t}function p(e){for(var t=[],a=0;a<8*e.length;a+=8)t[a>>5]|=(e.charCodeAt(a/8)&255)<<24-a%32;return t}function u(e){for(var a="",n=0;n<32*e.length;n+=8)a+=t(e[n>>5]>>>24-n%32&255);return a}function m(e){for(var t="",a=0,n,s;a<4*e.length;a+=3)for(n=(255&e[a>>2]>>8*(3-a%4))<<16|(255&e[a+1>>2]>>8*(3-(a+1)%4))<<8|255&e[a+2>>2]>>8*(3-(a+2)%4),s=0;4>s;s++)t+=8*a+6*s>32*e.length?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&n>>6*(3-s));return t}return{b64_hmac_sha1:function(e,t){return m(o(e,t))},b64_sha1:function(t){return m(e(p(t),8*t.length))},binb2str:u,core_hmac_sha1:o,str_hmac_sha1:function(e,t){return u(o(e,t))},str_sha1:function(t){return u(e(p(t),8*t.length))}}}),function(e,t){"function"==typeof r&&r.amd?r("strophe-md5",[],function(){return t()}):"object"==typeof exports?module.exports=t():e.MD5=t()}(this,function(){var e=function(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a},i=function(e,t){return e<<t|e>>>32-t},n=function(e){for(var t=[],a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t},o=function(e){for(var a="",n=0;n<32*e.length;n+=8)a+=t(255&e[n>>5]>>>n%32);return a},d=function(e){for(var t="0123456789abcdef",a="",n=0;n<4*e.length;n++)a+=t.charAt(15&e[n>>2]>>8*(n%4)+4)+t.charAt(15&e[n>>2]>>8*(n%4));return a},r=function(n,o,a,d,c,s){return e(i(e(e(o,n),e(d,s)),c),a)},l=function(e,a,i,n,o,d,s){return r(a&i|~a&n,e,a,o,d,s)},p=function(e,a,i,n,o,d,s){return r(a&n|i&~n,e,a,o,d,s)},u=function(e,a,i,n,o,d,s){return r(a^i^n,e,a,o,d,s)},m=function(e,a,i,n,o,d,s){return r(i^(a|~n),e,a,o,d,s)},g=function(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;for(var s=1732584193,o=-271733879,r=-1732584194,g=271733878,h=0,v,A,f,x;h<t.length;h+=16)v=s,A=o,f=r,x=g,s=l(s,o,r,g,t[h+0],7,-680876936),g=l(g,s,o,r,t[h+1],12,-389564586),r=l(r,g,s,o,t[h+2],17,606105819),o=l(o,r,g,s,t[h+3],22,-1044525330),s=l(s,o,r,g,t[h+4],7,-176418897),g=l(g,s,o,r,t[h+5],12,1200080426),r=l(r,g,s,o,t[h+6],17,-1473231341),o=l(o,r,g,s,t[h+7],22,-45705983),s=l(s,o,r,g,t[h+8],7,1770035416),g=l(g,s,o,r,t[h+9],12,-1958414417),r=l(r,g,s,o,t[h+10],17,-42063),o=l(o,r,g,s,t[h+11],22,-1990404162),s=l(s,o,r,g,t[h+12],7,1804603682),g=l(g,s,o,r,t[h+13],12,-40341101),r=l(r,g,s,o,t[h+14],17,-1502002290),o=l(o,r,g,s,t[h+15],22,1236535329),s=p(s,o,r,g,t[h+1],5,-165796510),g=p(g,s,o,r,t[h+6],9,-1069501632),r=p(r,g,s,o,t[h+11],14,643717713),o=p(o,r,g,s,t[h+0],20,-373897302),s=p(s,o,r,g,t[h+5],5,-701558691),g=p(g,s,o,r,t[h+10],9,38016083),r=p(r,g,s,o,t[h+15],14,-660478335),o=p(o,r,g,s,t[h+4],20,-405537848),s=p(s,o,r,g,t[h+9],5,568446438),g=p(g,s,o,r,t[h+14],9,-1019803690),r=p(r,g,s,o,t[h+3],14,-187363961),o=p(o,r,g,s,t[h+8],20,1163531501),s=p(s,o,r,g,t[h+13],5,-1444681467),g=p(g,s,o,r,t[h+2],9,-51403784),r=p(r,g,s,o,t[h+7],14,1735328473),o=p(o,r,g,s,t[h+12],20,-1926607734),s=u(s,o,r,g,t[h+5],4,-378558),g=u(g,s,o,r,t[h+8],11,-2022574463),r=u(r,g,s,o,t[h+11],16,1839030562),o=u(o,r,g,s,t[h+14],23,-35309556),s=u(s,o,r,g,t[h+1],4,-1530992060),g=u(g,s,o,r,t[h+4],11,1272893353),r=u(r,g,s,o,t[h+7],16,-155497632),o=u(o,r,g,s,t[h+10],23,-1094730640),s=u(s,o,r,g,t[h+13],4,681279174),g=u(g,s,o,r,t[h+0],11,-358537222),r=u(r,g,s,o,t[h+3],16,-722521979),o=u(o,r,g,s,t[h+6],23,76029189),s=u(s,o,r,g,t[h+9],4,-640364487),g=u(g,s,o,r,t[h+12],11,-421815835),r=u(r,g,s,o,t[h+15],16,530742520),o=u(o,r,g,s,t[h+2],23,-995338651),s=m(s,o,r,g,t[h+0],6,-198630844),g=m(g,s,o,r,t[h+7],10,1126891415),r=m(r,g,s,o,t[h+14],15,-1416354905),o=m(o,r,g,s,t[h+5],21,-57434055),s=m(s,o,r,g,t[h+12],6,1700485571),g=m(g,s,o,r,t[h+3],10,-1894986606),r=m(r,g,s,o,t[h+10],15,-1051523),o=m(o,r,g,s,t[h+1],21,-2054922799),s=m(s,o,r,g,t[h+8],6,1873313359),g=m(g,s,o,r,t[h+15],10,-30611744),r=m(r,g,s,o,t[h+6],15,-1560198380),o=m(o,r,g,s,t[h+13],21,1309151649),s=m(s,o,r,g,t[h+4],6,-145523070),g=m(g,s,o,r,t[h+11],10,-1120210379),r=m(r,g,s,o,t[h+2],15,718787259),o=m(o,r,g,s,t[h+9],21,-343485551),s=e(s,v),o=e(o,A),r=e(r,f),g=e(g,x);return[s,o,r,g]};return{hexdigest:function(e){return d(g(n(e),8*e.length))},hash:function(e){return o(g(n(e),8*e.length))}}}),function(e,t){"function"==typeof r&&r.amd?r("strophe-utils",[],function(){return t()}):"object"==typeof exports?module.exports=t():e.stropheUtils=t()}(this,function(){return{utf16to8:function(e){var a="",n=e.length,s,o;for(s=0;s<n;s++)o=e.charCodeAt(s),0<=o&&127>=o?a+=e.charAt(s):2047<o?(a+=t(224|15&o>>12),a+=t(128|63&o>>6),a+=t(128|63&o>>0)):(a+=t(192|31&o>>6),a+=t(128|63&o>>0));return a},addCookies:function(e){var t,a,i,n,s,o,d;for(t in e||{})s="",o="",d="",a=e[t],i="object"==typeof a,n=escape(unescape(i?a.value:a)),i&&(s=a.expires?";expires="+a.expires:"",o=a.domain?";domain="+a.domain:"",d=a.path?";path="+a.path:""),document.cookie=t+"="+n+s+o+d}}}),function(e,t){if("function"==typeof r&&r.amd)r("strophe-core",["strophe-sha1","strophe-md5","strophe-utils"],function(){return t.apply(this,arguments)});else if("object"==typeof exports)module.exports=t(c("./sha1"),c("./md5"),c("./utils"));else{var a=t(e.SHA1,e.MD5,e.stropheUtils);e.Strophe=a.Strophe,e.$build=a.$build,e.$iq=a.$iq,e.$msg=a.$msg,e.$pres=a.$pres,e.SHA1=a.SHA1,e.MD5=a.MD5,e.b64_hmac_sha1=a.SHA1.b64_hmac_sha1,e.b64_sha1=a.SHA1.b64_sha1,e.str_hmac_sha1=a.SHA1.str_hmac_sha1,e.str_sha1=a.SHA1.str_sha1}}(this,function(e,t,a){function n(e,t){return new c.Builder(e,t)}function s(e){return new c.Builder("message",e)}function o(e){return new c.Builder("iq",e)}function d(e){return new c.Builder("presence",e)}var c;return c={VERSION:"1.2.16",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<c.XHTML.tags.length;t++)if(e===c.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if("undefined"!=typeof c.XHTML.attributes[e]&&0<c.XHTML.attributes[e].length)for(var a=0;a<c.XHTML.attributes[e].length;a++)if(t===c.XHTML.attributes[e][a])return!0;return!1},validCSS:function(e){for(var t=0;t<c.XHTML.css.length;t++)if(e===c.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){c.NS[e]=t},forEachChild:function(e,t,a){var n,s;for(n=0;n<e.childNodes.length;n++)s=e.childNodes[n],s.nodeType===c.ElementType.NORMAL&&(!t||this.isTagEqual(s,t))&&a(s)},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&10>document.documentMode?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return c._xmlGenerator||(c._xmlGenerator=c._makeGenerator()),c._xmlGenerator},_getIEXmlDom:function(){for(var t=null,a=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],i=0;i<a.length&&null===t;i++)try{t=new ActiveXObject(a[i])}catch(a){t=null}return t},xmlElement:function(e){if(!e)return null;var t=c.xmlGenerator().createElement(e),n,s,o;for(n=1;n<arguments.length;n++){var d=arguments[n];if(d)if("string"==typeof d||"number"==typeof d)t.appendChild(c.xmlTextNode(d));else if("object"==typeof d&&"function"==typeof d.sort)for(s=0;s<d.length;s++){var r=d[s];"object"==typeof r&&"function"==typeof r.sort&&void 0!==r[1]&&null!==r[1]&&t.setAttribute(r[0],r[1])}else if("object"==typeof d)for(o in d)d.hasOwnProperty(o)&&void 0!==d[o]&&null!==d[o]&&t.setAttribute(o,d[o])}return t},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;"),e},xmlunescape:function(e){return e=e.replace(/\&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&apos;/g,"'"),e=e.replace(/&quot;/g,"\""),e},xmlTextNode:function(e){return c.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;if(DOMParser){var a=new DOMParser;t=a.parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===c.ElementType.TEXT&&(t+=e.nodeValue);for(var a=0;a<e.childNodes.length;a++)e.childNodes[a].nodeType===c.ElementType.TEXT&&(t+=e.childNodes[a].nodeValue);return c.xmlescape(t)},copyElement:function(e){var t,a;if(e.nodeType===c.ElementType.NORMAL){for(a=c.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)a.setAttribute(e.attributes[t].nodeName,e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)a.appendChild(c.copyElement(e.childNodes[t]))}else e.nodeType===c.ElementType.TEXT&&(a=c.xmlGenerator().createTextNode(e.nodeValue));return a},createHtml:function(e){var t,a,n,s,o,d,r,l,p,u,m;if(e.nodeType===c.ElementType.NORMAL){if(s=e.nodeName.toLowerCase(),c.XHTML.validTag(s))try{for(a=c.xmlElement(s),t=0;t<c.XHTML.attributes[s].length;t++)if(o=c.XHTML.attributes[s][t],d=e.getAttribute(o),"undefined"!=typeof d&&null!==d&&""!==d&&!1!==d&&0!==d)if("style"===o&&"object"==typeof d&&"undefined"!=typeof d.cssText&&(d=d.cssText),"style"===o){for(r=[],l=d.split(";"),n=0;n<l.length;n++)p=l[n].split(":"),u=p[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),c.XHTML.validCSS(u)&&(m=p[1].replace(/^\s*/,"").replace(/\s*$/,""),r.push(u+": "+m));0<r.length&&(d=r.join("; "),a.setAttribute(o,d))}else a.setAttribute(o,d);for(t=0;t<e.childNodes.length;t++)a.appendChild(c.createHtml(e.childNodes[t]))}catch(t){a=c.xmlTextNode("")}else for(a=c.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)a.appendChild(c.createHtml(e.childNodes[t]));}else if(e.nodeType===c.ElementType.FRAGMENT)for(a=c.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)a.appendChild(c.createHtml(e.childNodes[t]));else e.nodeType===c.ElementType.TEXT&&(a=c.xmlTextNode(e.nodeValue));return a},escapeNode:function(e){return"string"==typeof e?e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40"):e},unescapeNode:function(e){return"string"==typeof e?e.replace(/\\20/g," ").replace(/\\22/g,"\"").replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\"):e},getNodeFromJid:function(e){return 0>e.indexOf("@")?null:e.split("@")[0]},getDomainFromJid:function(e){var t=c.getBareJidFromJid(e);if(0>t.indexOf("@"))return t;var a=t.split("@");return a.splice(0,1),a.join("@")},getResourceFromJid:function(e){var t=e.split("/");return 2>t.length?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(t){"undefined"!=typeof t.stack&&c.fatal(t.stack),t.sourceURL?c.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?c.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message):c.fatal("error: "+t.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"==typeof window.console&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var a=e.nodeName,n,s;for(e.getAttribute("_realname")&&(a=e.getAttribute("_realname")),t="<"+a,n=0;n<e.attributes.length;n++)"_realname"!==e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName+"='"+c.xmlescape(e.attributes[n].value)+"'");if(0<e.childNodes.length){for(t+=">",n=0;n<e.childNodes.length;n++)switch(s=e.childNodes[n],s.nodeType){case c.ElementType.NORMAL:t+=c.serialize(s);break;case c.ElementType.TEXT:t+=c.xmlescape(s.nodeValue);break;case c.ElementType.CDATA:t+="<![CDATA["+s.nodeValue+"]]>";}t+="</"+a+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){c._connectionPlugins[e]=t}},c.Builder=function(e,t){("presence"===e||"message"===e||"iq"===e)&&(t&&!t.xmlns?t.xmlns=c.NS.CLIENT:!t&&(t={xmlns:c.NS.CLIENT})),this.nodeTree=c.xmlElement(e,t),this.node=this.nodeTree},c.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return c.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,a){var i=c.xmlElement(e,t,a);return this.node.appendChild(i),"string"!=typeof a&&"number"!=typeof a&&(this.node=i),this},cnode:function(e){var t=c.xmlGenerator(),a;try{a=void 0!==t.importNode}catch(t){a=!1}var i=a?t.importNode(e,!0):c.copyElement(e);return this.node.appendChild(i),this.node=i,this},t:function(e){var t=c.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var a=c.createHtml(t);0<a.childNodes.length;)this.node.appendChild(a.childNodes[0]);return this}},c.Handler=function(e,t,a,i,n,s,o){this.handler=e,this.ns=t,this.name=a,this.type=i,this.id=n,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(c.warn("The \"matchBare\" option is deprecated, use \"matchBareFromJid\" instead."),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.from=this.options.matchBareFromJid?s?c.getBareJidFromJid(s):null:s,this.user=!0},c.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=!1;if(!this.ns)return!0;var a=this;return c.forEachChild(e,null,function(e){a.getNamespace(e)===a.ns&&(t=!0)}),t=t||this.getNamespace(e)===this.ns,t},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=c.getBareJidFromJid(t));var a=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!c.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(a):a!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(t){throw c._handleError(t),t}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},c.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=new Date().getTime(),this.user=!0},c.TimedHandler.prototype={run:function(){return this.lastCalled=new Date().getTime(),this.handler()},reset:function(){this.lastCalled=new Date().getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},c.Connection=function(e,t){this.service=e,this.options=t||{};var i=this.options.protocol||"";for(var n in this._proto=0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===i.indexOf("ws")?new c.Websocket(this):new c.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),a.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(n)){var s=c._connectionPlugins[n],o=function(){};o.prototype=s,this[n]=new o,this[n].init(this)}},c.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),a="x"===e?t:8|3&t;return a.toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,a){this.protocolErrorHandlers[e][t]=a},connect:function(e,t,a,i,n,s,o){this.jid=e,this.authzid=c.getBareJidFromJid(this.jid),this.authcid=o||c.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=a,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=c.getDomainFromJid(this.jid),this._changeConnectStatus(c.Status.CONNECTING,null),this._proto._connect(i,n,s)},attach:function(e,t,a,i,n,s,o){if(this._proto instanceof c.Bosh)this._proto._attach(e,t,a,i,n,s,o);else throw{name:"StropheSessionError",message:"The \"attach\" method can only be used with a BOSH connection."}},restore:function(e,t,a,i,n){if(this._sessionCachingSupported())this._proto._restore(e,t,a,i,n);else throw{name:"StropheSessionError",message:"The \"restore\" method can only be used with a BOSH connection."}},_sessionCachingSupported:function(){if(this._proto instanceof c.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},nextValidRid:function(){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,a,i){var n=null,s=this;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof a){var d=this.addHandler(function(e){n&&s.deleteTimedHandler(n);var i=e.getAttribute("type");"error"===i?a&&a(e):t&&t(e)},null,"presence",null,o);i&&(n=this.addTimedHandler(i,function(){return s.deleteHandler(d),a&&a(null),!1}))}return this.send(e),o},sendIQ:function(e,t,a,i){var n=null,s=this;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof a){var d=this.addHandler(function(e){n&&s.deleteTimedHandler(n);var i=e.getAttribute("type");if("result"===i)t&&t(e);else if("error"===i)a&&a(e);else throw{name:"StropheError",message:"Got bad IQ type of "+i}},null,"iq",["error","result"],o);i&&(n=this.addTimedHandler(i,function(){return s.deleteHandler(d),a&&a(null),!1}))}return this.send(e),o},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(e,t){var a=new c.TimedHandler(e,t);return this.addTimeds.push(a),a},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,a,i,n,s,o){var d=new c.Handler(e,t,a,i,n,s,o);return this.addHandlers.push(d),d},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);0<=t&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},e=e||[c.SASLAnonymous,c.SASLExternal,c.SASLMD5,c.SASLOAuthBearer,c.SASLXOAuth2,c.SASLPlain,c.SASLSHA1],e.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(c.Status.DISCONNECTING,e),c.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=d({xmlns:c.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else c.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,a){for(var i in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(i)){var n=this[i];if(n.statusChanged)try{n.statusChanged(e,t)}catch(e){c.error(""+i+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(e,t,a)}catch(t){c._handleError(t),c.error("User connection callback caused an exception: "+t)}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),c.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(c.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){c.info("_dataRecv called");var a=this._proto._reqToData(e);if(null!==a){this.xmlInput!==c.Connection.prototype.xmlInput&&(a.nodeName===this._proto.strip&&a.childNodes.length?this.xmlInput(a.childNodes[0]):this.xmlInput(a)),this.rawInput!==c.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(c.serialize(a)));for(var n,s;0<this.removeHandlers.length;)s=this.removeHandlers.pop(),n=this.handlers.indexOf(s),0<=n&&this.handlers.splice(n,1);for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var o=a.getAttribute("type"),d,r;if(null!==o&&"terminate"===o)return this.disconnecting?void 0:(d=a.getAttribute("condition"),r=a.getElementsByTagName("conflict"),null===d?this._changeConnectStatus(c.Status.CONNFAIL,c.ErrorCondition.UNKOWN_REASON):("remote-stream-error"===d&&0<r.length&&(d="conflict"),this._changeConnectStatus(c.Status.CONNFAIL,d)),void this._doDisconnect(d));var l=this;c.forEachChild(a,null,function(e){var t,a;for(a=l.handlers,l.handlers=[],t=0;t<a.length;t++){var n=a[t];try{n.isMatch(e)&&(l.authenticated||!n.user)?n.run(e)&&l.handlers.push(n):l.handlers.push(n)}catch(t){c.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}},mechanisms:{},_connect_cb:function(e,t,a){c.info("_connect_cb was called"),this.connected=!0;var n;try{n=this._proto._reqToData(e)}catch(t){if("badformat"!==t)throw t;this._changeConnectStatus(c.Status.CONNFAIL,c.ErrorCondition.BAD_FORMAT),this._doDisconnect(c.ErrorCondition.BAD_FORMAT)}if(n){this.xmlInput!==c.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==c.Connection.prototype.rawInput&&(a?this.rawInput(a):this.rawInput(c.serialize(n)));var s=this._proto._connect_cb(n);if(s!==c.Status.CONNFAIL){var o;if(o=n.getElementsByTagNameNS?0<n.getElementsByTagNameNS(c.NS.STREAM,"features").length:0<n.getElementsByTagName("stream:features").length||0<n.getElementsByTagName("features").length,!o)return void this._proto._no_auth_received(t);var d=[],r=n.getElementsByTagName("mechanism"),l,p;if(0<r.length)for(l=0;l<r.length;l++)p=c.getText(r[l]),this.mechanisms[p]&&d.push(this.mechanisms[p]);return 0===d.length&&0===n.getElementsByTagName("auth").length?void this._proto._no_auth_received(t):void(!1!==this.do_authentication&&this.authenticate(d))}}},sortMechanismsByPriority:function(e){var t,a,n,s;for(t=0;t<e.length-1;++t){for(n=t,a=t+1;a<e.length;++a)e[a].prototype.priority>e[n].prototype.priority&&(n=a);n!==t&&(s=e[t],e[t]=e[n],e[n]=s)}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);var t=0,a=!1;for(t=0;t<e.length;++t)if(e[t].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[t],this._sasl_mechanism.onStart(this);var s=n("auth",{xmlns:c.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var o=this._sasl_mechanism.onChallenge(this,null);s.t(btoa(o))}this.send(s.tree()),a=!0;break}return a},_attemptLegacyAuth:function(){null===c.getNodeFromJid(this.jid)?(this._changeConnectStatus(c.Status.CONNFAIL,c.ErrorCondition.MISSING_JID_NODE),this.disconnect(c.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(c.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(o({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(c.getText(e)),a=this._sasl_mechanism.onChallenge(this,t),i=n("response",{xmlns:c.NS.SASL});return""!==a&&i.t(btoa(a)),this.send(i.tree()),!0},_auth1_cb:function(){var e=o({type:"set",id:"_auth_2"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return c.getResourceFromJid(this.jid)||(this.jid=c.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(c.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var t=atob(c.getText(e)),a=t.match(/([a-z]+)=([^,]+)(,|$)/),i;if("v"===a[1]&&(i=a[2]),i!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}c.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var n=[],s=function(e,t){for(;e.length;)this.deleteHandler(e.pop());return this._sasl_auth1_cb.bind(this)(t),!1};return n.push(this._addSysHandler(function(e){s.bind(this)(n,e)}.bind(this),null,"stream:features",null,null)),n.push(this._addSysHandler(function(e){s.bind(this)(n,e)}.bind(this),c.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;var t,a;for(t=0;t<e.childNodes.length;t++)a=e.childNodes[t],"bind"===a.nodeName&&(this.do_bind=!0),"session"===a.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var n=c.getResourceFromJid(this.jid);return n?this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).c("resource",{}).t(n).tree()):this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"===e.getAttribute("type")){c.info("SASL binding failed.");var t=e.getElementsByTagName("conflict"),a;return 0<t.length&&(a=c.ErrorCondition.CONFLICT),this._changeConnectStatus(c.Status.AUTHFAIL,a,e),!1}var i=e.getElementsByTagName("bind"),n;return 0<i.length?void(n=i[0].getElementsByTagName("jid"),0<n.length&&(this.jid=c.getText(n[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(o({type:"set",id:"_session_auth_2"}).c("session",{xmlns:c.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)))):(c.info("SASL binding failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null,e),!1)},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return c.info("Session creation failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(c.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(c.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var a=new c.TimedHandler(e,t);return a.user=!1,this.addTimeds.push(a),a},_addSysHandler:function(e,t,a,i,n){var s=new c.Handler(e,t,a,i,n);return s.user=!1,this.addHandlers.push(s),s},_onDisconnectTimeout:function(){return c.info("_onDisconnectTimeout was called"),this._changeConnectStatus(c.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,a,n;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;)t=this.removeTimeds.pop(),e=this.timedHandlers.indexOf(t),0<=e&&this.timedHandlers.splice(e,1);var s=new Date().getTime();for(n=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],(this.authenticated||!t.user)&&(a=t.lastCalled+t.period,0>=a-s?t.run()&&n.push(t):n.push(t));this.timedHandlers=n,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},c.SASLMechanism=function(e,t,a){this.name=e,this.isClientFirst=t,this.priority=a},c.SASLMechanism.prototype={test:function(){return!0},onStart:function(e){this._connection=e},onChallenge:function(){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},c.SASLAnonymous=function(){},c.SASLAnonymous.prototype=new c.SASLMechanism("ANONYMOUS",!1,20),c.SASLAnonymous.prototype.test=function(e){return null===e.authcid},c.SASLPlain=function(){},c.SASLPlain.prototype=new c.SASLMechanism("PLAIN",!0,50),c.SASLPlain.prototype.test=function(e){return null!==e.authcid},c.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,a.utf16to8(t)},c.SASLSHA1=function(){},c.SASLSHA1.prototype=new c.SASLMechanism("SCRAM-SHA-1",!0,70),c.SASLSHA1.prototype.test=function(e){return null!==e.authcid},c.SASLSHA1.prototype.onChallenge=function(i,n,s){var o=s||t.hexdigest(1234567890*Math.random()),d="n="+a.utf16to8(i.authcid);return d+=",r=",d+=o,i._sasl_data.cnonce=o,i._sasl_data["client-first-message-bare"]=d,d="n,,"+d,this.onChallenge=function(t,n){for(var s="c=biws,",o=t._sasl_data["client-first-message-bare"]+","+n+",",d=t._sasl_data.cnonce,c=/([a-z]+)=([^,]+)(,|$)/,r,l,p,u,m,g,h,v,A,f,b,x,w;n.match(c);)switch(w=n.match(c),n=n.replace(w[0],""),w[1]){case"r":r=w[2];break;case"s":l=w[2];break;case"i":p=w[2];}if(r.substr(0,d.length)!==d)return t._sasl_data={},t._sasl_failure_cb();for(s+="r="+r,o+=s,l=atob(l),l+="\0\0\0\x01",A=a.utf16to8(t.pass),u=g=e.core_hmac_sha1(A,l),h=1;h<p;h++){for(m=e.core_hmac_sha1(A,e.binb2str(g)),v=0;5>v;v++)u[v]^=m[v];g=m}for(u=e.binb2str(u),f=e.core_hmac_sha1(u,"Client Key"),b=e.str_hmac_sha1(u,"Server Key"),x=e.core_hmac_sha1(e.str_sha1(e.binb2str(f)),o),t._sasl_data["server-signature"]=e.b64_hmac_sha1(b,o),v=0;5>v;v++)f[v]^=x[v];return s+=",p="+btoa(e.binb2str(f)),s}.bind(this),d},c.SASLMD5=function(){},c.SASLMD5.prototype=new c.SASLMechanism("DIGEST-MD5",!1,60),c.SASLMD5.prototype.test=function(e){return null!==e.authcid},c.SASLMD5.prototype._quote=function(e){return"\""+e.replace(/\\/g,"\\\\").replace(/"/g,"\\\"")+"\""},c.SASLMD5.prototype.onChallenge=function(e,i,n){for(var s=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,o=n||t.hexdigest(""+1234567890*Math.random()),d="",c=null,r="",l;i.match(s);)switch(l=i.match(s),i=i.replace(l[0],""),l[2]=l[2].replace(/^"(.+)"$/,"$1"),l[1]){case"realm":d=l[2];break;case"nonce":r=l[2];break;case"qop":l[2];break;case"host":c=l[2];}var p=e.servtype+"/"+e.domain;null!==c&&(p=p+"/"+c);var u=a.utf16to8(e.authcid+":"+d+":"+this._connection.pass),m=t.hash(u)+":"+r+":"+o,g="AUTHENTICATE:"+p,h="";return h+="charset=utf-8,",h+="username="+this._quote(a.utf16to8(e.authcid))+",",h+="realm="+this._quote(d)+",",h+="nonce="+this._quote(r)+",",h+="nc=00000001,",h+="cnonce="+this._quote(o)+",",h+="digest-uri="+this._quote(p)+",",h+="response="+t.hexdigest(t.hexdigest(m)+":"+r+":00000001:"+o+":auth:"+t.hexdigest(g))+",",h+="qop=auth",this.onChallenge=function(){return""},h},c.SASLOAuthBearer=function(){},c.SASLOAuthBearer.prototype=new c.SASLMechanism("OAUTHBEARER",!0,40),c.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},c.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="\x01",t+="auth=Bearer ",t+=e.pass,t+="\x01",t+="\x01",a.utf16to8(t)},c.SASLExternal=function(){},c.SASLExternal.prototype=new c.SASLMechanism("EXTERNAL",!0,10),c.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},c.SASLXOAuth2=function(){},c.SASLXOAuth2.prototype=new c.SASLMechanism("X-OAUTH2",!0,30),c.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},c.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,a.utf16to8(t)},{Strophe:c,$build:n,$iq:o,$msg:s,$pres:d,SHA1:e,MD5:t,b64_hmac_sha1:e.b64_hmac_sha1,b64_sha1:e.b64_sha1,str_hmac_sha1:e.str_hmac_sha1,str_sha1:e.str_sha1}}),function(e,t){if("function"==typeof r&&r.amd)r("strophe-bosh",["strophe-core"],function(e){return t(e.Strophe,e.$build)});else if("object"==typeof exports){var a=c("./core");module.exports=t(a.Strophe,a.$build)}else return t(Strophe,$build)}(this,function(t,a){return t.Request=function(e,a,i,n){this.id=++t._requestId,this.xmlData=e,this.data=t.serialize(e),this.origFunc=a,this.func=a,this.rid=i,this.date=NaN,this.sends=n||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var e=new Date;return(e-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var e=new Date;return(e-this.dead)/1e3},this.xhr=this._newXHR()},t.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),t.error("responseXML: "+t.serialize(this.xhr.responseXML)),"parsererror";}else if(this.xhr.responseText)if(t.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),e=new DOMParser().parseFromString(this.xhr.responseText,"application/xml").documentElement,!e)throw new Error("Parsing produced null node");else if(e.querySelector("parsererror"))throw t.error("invalid response received: "+e.querySelector("parsererror").textContent),t.error("responseText: "+this.xhr.responseText),"badformat";return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},t.Bosh=function(e){this._conn=e,this.rid=n(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},t.Bosh.prototype={strip:null,_buildBody:function(){var e=a("body",{rid:this.rid++,xmlns:t.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=n(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,a,i){this.wait=e||this.wait,this.hold=a||this.hold,this.errors=0;var n=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":t.NS.BOSH});i&&n.attrs({route:i});var s=this._conn._connect_cb;this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,s.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,a,i,n,s,o,d){this._conn.jid=e,this.sid=a,this.rid=i,this._conn.connect_callback=n,this._conn.domain=t.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=s||this.wait,this.hold=o||this.hold,this.window=d||this.window,this._conn._changeConnectStatus(t.Status.ATTACHED,null)},_restore:function(e,a,i,n,s){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if("undefined"!=typeof o&&null!==o&&o.rid&&o.sid&&o.jid&&("undefined"==typeof e||null===e||t.getBareJidFromJid(o.jid)===t.getBareJidFromJid(e)||null===t.getNodeFromJid(e)&&t.getDomainFromJid(o.jid)===e))this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,a,i,n,s);else throw{name:"StropheSessionError",message:"_restore: no restoreable session."}},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var a=e.getAttribute("type"),i,n;if(null!==a&&"terminate"===a)return i=e.getAttribute("condition"),t.error("BOSH-Connection failed: "+i),n=e.getElementsByTagName("conflict"),null===i?this._conn._changeConnectStatus(t.Status.CONNFAIL,"unknown"):("remote-stream-error"===i&&0<n.length&&(i="conflict"),this._conn._changeConnectStatus(t.Status.CONNFAIL,i)),this._conn._doDisconnect(i),t.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var s=e.getAttribute("requests");s&&(this.window=parseInt(s,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var d=e.getAttribute("wait");d&&(this.wait=parseInt(d,10));var c=e.getAttribute("inactivity");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=n(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),a;a=this._conn.protocolErrorHandlers.HTTP[t],a&&a.call(this,t)},_hitError:function(e){this.errors++,t.warn("request errored, status: "+e+", number of errors: "+this.errors),4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){t.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var a=this._buildBody();this._requests.push(new t.Request(a.tree(),this._onRequestStateChange.bind(this,e),a.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var e;0<this._requests.length;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(t.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(2>this._requests.length&&0<e.length){for(var a=this._buildBody(),s=0;s<e.length;s++)null!==e[s]&&("restart"===e[s]?a.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":t.NS.BOSH}):a.cnode(e[s]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new t.Request(a.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),a.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(0<this._requests.length){var o=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>n(t.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),o>n(t.TIMEOUT*this.wait)&&(t.warn("Request "+this._requests[0].id+" timed out, over "+n(t.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,a){var i;if(4===e.xhr.readyState)try{i=e.xhr.status}catch(a){t.error("Caught an error while retrieving a request's status, reqStatus: "+i)}return"undefined"==typeof i&&(i="number"==typeof a?a:0),i},_onRequestStateChange:function(e,a){if(t.debug("request id "+a.id+"."+a.sends+" state changed to "+a.xhr.readyState),a.abort)return void(a.abort=!1);if(4===a.xhr.readyState){var i=this._getRequestStatus(a);if(this.lastResponseHeaders=a.xhr.getAllResponseHeaders(),this.disconnecting&&400<=i)return this._hitError(i),void this._callProtocolErrorHandlers(a);var s=0<i&&500>i,o=a.sends>this._conn.maxRetries;if((s||o)&&(this._removeRequest(a),t.debug("request id "+a.id+" should now be removed")),200===i){var d=this._requests[0]===a,c=this._requests[1]===a;(c||d&&0<this._requests.length&&this._requests[0].age()>n(t.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(+a.rid+1),t.debug("request id "+a.id+"."+a.sends+" got 200"),e(a),this.errors=0}else 0===i||400<=i&&600>i||12e3<=i?(t.error("request id "+a.id+"."+a.sends+" error "+i+" happened"),this._hitError(i),this._callProtocolErrorHandlers(a),400<=i&&500>i&&(this._conn._changeConnectStatus(t.Status.DISCONNECTING,null),this._conn._doDisconnect())):t.error("request id "+a.id+"."+a.sends+" error "+i+" happened");s||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(t.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var a=this,i=this._requests[e],d=this._getRequestStatus(i,-1);if(i.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var c=i.age(),r=!isNaN(c)&&c>n(t.TIMEOUT*this.wait),l=null!==i.dead&&i.timeDead()>n(t.SECONDARY_TIMEOUT*this.wait),p=4===i.xhr.readyState&&(1>d||500<=d);if((r||l||p)&&(l&&t.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),i.abort=!0,i.xhr.abort(),i.xhr.onreadystatechange=function(){},this._requests[e]=new t.Request(i.xmlData,i.origFunc,i.rid,i.sends),i=this._requests[e]),0===i.xhr.readyState){t.debug("request id "+i.id+"."+i.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";i.xhr.open("POST",this._conn.service,!this._conn.options.sync),"undefined"!=typeof i.xhr.setRequestHeader&&i.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(i.xhr.withCredentials=!0)}catch(e){return t.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(t.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var m=function(){if(i.date=new Date,a._conn.options.customHeaders){var e=a._conn.options.customHeaders;for(var t in e)e.hasOwnProperty(t)&&i.xhr.setRequestHeader(t,e[t])}i.xhr.send(i.data)};if(1<i.sends){var g=1e3*o(n(t.TIMEOUT*this.wait),s(i.sends,3));setTimeout(function(){m()},g)}else m();i.sends++,this._conn.xmlOutput!==t.Connection.prototype.xmlOutput&&(i.xmlData.nodeName===this.strip&&i.xmlData.childNodes.length?this._conn.xmlOutput(i.xmlData.childNodes[0]):this._conn.xmlOutput(i.xmlData)),this._conn.rawOutput!==t.Connection.prototype.rawOutput&&this._conn.rawOutput(i.data)}else t.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+i.xhr.readyState)},_removeRequest:function(e){t.debug("removing request");var a;for(a=this._requests.length-1;0<=a;a--)e===this._requests[a]&&this._requests.splice(a,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(t){if("parsererror"!==t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){t.info("_sendTerminate was called");var a=this._buildBody().attrs({type:"terminate"});e&&a.cnode(e.tree());var i=new t.Request(a.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),a.tree().getAttribute("rid"));this._requests.push(i),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?t.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):t.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&e(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},t}),function(e,t){if("function"==typeof r&&r.amd)r("strophe-websocket",["strophe-core"],function(e){return t(e.Strophe,e.$build)});else if("object"==typeof exports){var a=c("./core");module.exports=t(a.Strophe,a.$build)}else return t(Strophe,$build)}(this,function(t,a){return t.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var a="";a+="ws"===e.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",a+="://"+window.location.host,a+=0===t.indexOf("/")?t:window.location.pathname+t,e.service=a}},t.Websocket.prototype={_buildStream:function(){return a("open",{xmlns:t.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(a,n){var s;if(s=a.getElementsByTagNameNS?a.getElementsByTagNameNS(t.NS.STREAM,"error"):a.getElementsByTagName("stream:error"),0===s.length)return!1;for(var o=s[0],d="",c="",r=0,l;r<o.childNodes.length&&(l=o.childNodes[r],l.getAttribute("xmlns")==="urn:ietf:params:xml:ns:xmpp-streams");r++)"text"===l.nodeName?c=l.textContent:d=l.nodeName;var p="WebSocket stream error: ";return p+=d?d:"unknown",c&&(p+=" - "+c),t.error(p),this._conn._changeConnectStatus(n,d),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){var a=this._check_streamerror(e,t.Status.CONNFAIL);if(a)return t.Status.CONNFAIL},_handleStreamStart:function(e){var a=!1,i=e.getAttribute("xmlns");"string"==typeof i?i!==t.NS.FRAMING&&(a="Wrong xmlns in <open />: "+i):a="Missing xmlns in <open />";var n=e.getAttribute("version");return"string"==typeof n?"1.0"!=n&&(a="Wrong version in <open />: "+n):a="Missing version in <open />",!a||(this._conn._changeConnectStatus(t.Status.CONNFAIL,a),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var a=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===a)return;var i=new DOMParser().parseFromString(a,"text/xml").documentElement;this._conn.xmlInput(i),this._conn.rawInput(e.data),this._handleStreamStart(i)&&this._connect_cb(i)}else if(0===e.data.indexOf("<close ")){var n=new DOMParser().parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data);var s=n.getAttribute("see-other-uri");if(s){var o=this._conn.service,d=0<=o.indexOf("wss:")&&0<=s.indexOf("wss:")||0<=o.indexOf("ws:");d&&(this._conn._changeConnectStatus(t.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=s,this._connect())}else this._conn._changeConnectStatus(t.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var c=this._streamWrap(e.data),r=new DOMParser().parseFromString(c,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(r,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var i=a("close",{xmlns:t.NS.FRAMING});this._conn.xmlOutput(i.tree());var n=t.serialize(i);this._conn.rawOutput(n);try{this.socket.send(n)}catch(a){t.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){t.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(t){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(a){this._conn.connected&&!this._conn.disconnecting?(t.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):a&&1006===a.code&&!this._conn.connected&&this.socket?(t.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):t.info("Websocket closed")},_no_auth_received:function(e){t.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(t.Status.CONNFAIL,t.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){t.error("Websocket error "+e),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(0<e.length&&!this._conn.paused){for(var a=0;a<e.length;a++)if(null!==e[a]){var n,s;n="restart"===e[a]?this._buildStream().tree():e[a],s=t.serialize(n),this._conn.xmlOutput(n),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}},_onMessage:function(e){var a="<close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing\" />",i,n;if(e.data===a)return this._conn.rawInput(a),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0!==e.data.search("<open "))n=this._streamWrap(e.data),i=new DOMParser().parseFromString(n,"text/xml").documentElement;else if(i=new DOMParser().parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(i))return;return this._check_streamerror(i,t.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===i.firstChild.nodeName&&"unavailable"===i.firstChild.getAttribute("type")?(this._conn.xmlInput(i),void this._conn.rawInput(t.serialize(i))):void this._conn._dataRecv(i,e.data)},_onOpen:function(){t.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var a=t.serialize(e);this._conn.rawOutput(a),this.socket.send(a)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},t}),function(){if("function"==typeof r&&r.amd)r("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(e){return e});else if("object"==typeof exports){var e=c("./core");c("./bosh"),c("./websocket"),module.exports=e}}(this),c(["strophe-polyfill"]),c("strophe")});(function(e,t){"function"==typeof define&&define.amd?define("strophe.disco",["strophe"],function(e){return t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}):t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres)})(this,function(e,t,a){e.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],init:function(t){this._connection=t,this._identities=[],this._features=[],this._items=[],t.addHandler(this._onDiscoInfo.bind(this),e.NS.DISCO_INFO,"iq","get",null,null),t.addHandler(this._onDiscoItems.bind(this),e.NS.DISCO_ITEMS,"iq","get",null,null)},addIdentity:function(e,t,a,n){for(var s=0;s<this._identities.length;s++)if(this._identities[s].category==e&&this._identities[s].type==t&&this._identities[s].name==a&&this._identities[s].lang==n)return!1;return this._identities.push({category:e,type:t,name:a,lang:n}),!0},addFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]==e)return!1;return this._features.push(e),!0},removeFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]===e)return this._features.splice(t,1),!0;return!1},addItem:function(e,t,a,i){return(!a||i)&&(this._items.push({jid:e,name:t,node:a,call_back:i}),!0)},info:function(t,i,n,s,o){var d={xmlns:e.NS.DISCO_INFO};i&&(d.node=i);var c=a({from:this._connection.jid,to:t,type:"get"}).c("query",d);this._connection.sendIQ(c,n,s,o)},items:function(t,i,n,s,o){var d={xmlns:e.NS.DISCO_ITEMS};i&&(d.node=i);var c=a({from:this._connection.jid,to:t,type:"get"}).c("query",d);this._connection.sendIQ(c,n,s,o)},_buildIQResult:function(e,t){var i=e.getAttribute("id"),n=e.getAttribute("from"),s=a({type:"result",id:i});return null!==n&&s.attrs({to:n}),s.c("query",t)},_onDiscoInfo:function(t){var a=t.getElementsByTagName("query")[0].getAttribute("node"),n={xmlns:e.NS.DISCO_INFO},s;a&&(n.node=a);var o=this._buildIQResult(t,n);for(s=0;s<this._identities.length;s++)n={category:this._identities[s].category,type:this._identities[s].type},this._identities[s].name&&(n.name=this._identities[s].name),this._identities[s].lang&&(n["xml:lang"]=this._identities[s].lang),o.c("identity",n).up();for(s=0;s<this._features.length;s++)o.c("feature",{var:this._features[s]}).up();return this._connection.send(o.tree()),!0},_onDiscoItems:function(t){var a={xmlns:e.NS.DISCO_ITEMS},n=t.getElementsByTagName("query")[0].getAttribute("node"),s,o;if(n){for(a.node=n,s=[],o=0;o<this._items.length;o++)if(this._items[o].node==n){s=this._items[o].call_back(t);break}}else s=this._items;var d=this._buildIQResult(t,a);for(o=0;o<s.length;o++){var c={jid:s[o].jid};s[o].name&&(c.name=s[o].name),s[o].node&&(c.node=s[o].node),d.c("item",c).up()}return this._connection.send(d.tree()),!0}})}),function(e,t){"function"==typeof define&&define.amd?define("strophe.ping",["strophe"],function(e){return t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}):t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres)}(this,function(e,t,a){e.addConnectionPlugin("ping",{_c:null,init:function(t){this._c=t,e.addNamespace("PING","urn:xmpp:ping")},ping:function(t,i,n,s){var o=this._c.getUniqueId("ping"),d=a({type:"get",to:t,id:o}).c("ping",{xmlns:e.NS.PING});this._c.sendIQ(d,i,n,s)},pong:function(e){var t=e.getAttribute("from"),i=e.getAttribute("id"),n=a({type:"result",to:t,id:i});this._c.sendIQ(n)},addPingHandler:function(t){return this._c.addHandler(t,e.NS.PING,"iq","get")}})}),function(e,t){"function"==typeof define&&define.amd?define("strophe.rsm",["strophe"],function(e){return t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres),e}):t(e.Strophe,e.$build,e.$iq,e.$msg,e.$pres)}(this,function(e,t){e.addNamespace("RSM","http://jabber.org/protocol/rsm"),e.RSM=function(e){if(this.attribs=["max","first","last","after","before","index","count"],"undefined"!=typeof e.xml)this.fromXMLElement(e.xml);else for(var t=0,a;t<this.attribs.length;t++)a=this.attribs[t],this[a]=e[a]},e.RSM.prototype={toXML:function(){for(var a=t("set",{xmlns:e.NS.RSM}),i=0,n;i<this.attribs.length;i++)n=this.attribs[i],"undefined"!=typeof this[n]&&(a=a.c(n).t(this[n].toString()).up());return a.tree()},next:function(t){var a=new e.RSM({max:t,after:this.last});return a},previous:function(t){var a=new e.RSM({max:t,before:this.first});return a},fromXMLElement:function(t){for(var a=0;a<this.attribs.length;a++){var i=this.attribs[a],n=t.getElementsByTagName(i)[0];"undefined"!=typeof n&&null!==n&&(this[i]=e.getText(n),"first"==i&&(this.index=n.getAttribute("index")))}}}}),function(e,t){define("strophe.caps",["strophe","strophe.disco"],function(e){t(e.Strophe,e.SHA1,e.$build,e.$iq,e.$msg,e.$pres)})}(this,function(e,t,a,i,n,s){var o=t.b64_sha1;e.addConnectionPlugin("caps",function(){var t,n,d,c,r,l,p,u;return n=null,r=function(t){if(n=t,e.addNamespace("CAPS","http://jabber.org/protocol/caps"),void 0===n.disco)throw new Error("disco plugin required!");if(void 0===o)throw new Error("SHA-1 library required!");n.disco.addFeature(e.NS.CAPS),n.disco.addFeature(e.NS.DISCO_INFO)},t=function(e){return n.disco.addFeature(e)},p=function(e){return n.disco.removeFeature(e)},getPres=function(){return s().cnode(d())},u=function(){return n.send(s().cnode(d().tree()))},d=function(t){t||(t={});var i=t.node;return i||(0<n.disco._identities.length?i=n.disco._identities[0].name||"":i="strophejs"),a("c",{xmlns:e.NS.CAPS,hash:"sha-1",node:i,ver:c()})},l=function(e,t){return e.sort(function(e,a){return e[t]>a[t]?-1:1})},c=function(){var e,t,a,s,d,c,r,p,u,m,g,h,v,A,f,b;for(d=[],f=n.disco._identities,(u=0,h=f.length);u<h;u++)a=f[u],d.push(a);for(t=[],b=n.disco._features,(m=0,v=b.length);m<v;m++)c=b[m],t.push(c);for(r in e="",l(d,"category"),l(d,"type"),l(d,"lang"),d)s=d[r],e+=""+s.category+"/"+s.type+"/"+s.lang+"/"+s.name+"<";for(t.sort(),g=0,A=t.length;g<A;g++)p=t[g],e+=""+p+"<";return o(e)},{init:r,removeFeature:p,addFeature:t,sendPres:u,generateVerificationString:c,createCapsNode:d}}())}),function(e,t){define("strophe.pubsub",["strophe","strophe.disco"],function(e){t(e.Strophe,e.$build,e.$iq)})}(this,function(e,t,a){e.Builder.prototype.form=function(t,a){var n=this.node.appendChild(e.xmlElement("x",{xmlns:"jabber:x:data",type:"submit"}));for(var s in n.appendChild(e.xmlElement("field",{var:"FORM_TYPE",type:"hidden"})).appendChild(e.xmlElement("value")).appendChild(e.xmlTextNode(t)),a)n.appendChild(e.xmlElement("field",{var:s})).appendChild(e.xmlElement("value")).appendChild(e.xmlTextNode(a[s]));return this},e.Builder.prototype.list=function(t,a){for(var n=0;n<a.length;++n)this.c(t,a[n].attrs),this.node.appendChild(a[n].data.cloneNode?a[n].data.cloneNode(!0):e.xmlTextNode(a[n].data)),this.up();return this},e.Builder.prototype.children=function(e){var t,a;for(t in e)e.hasOwnProperty(t)&&(a=e[t],Array.isArray(a)?this.list(t,a):"string"==typeof a?this.c(t,{},a):"number"==typeof a?this.c(t,{},""+a):"object"==typeof a?this.c(t).children(a).up():this.c(t).up());return this},e.addConnectionPlugin("pubsub",{_connection:null,_autoService:!0,service:null,jid:null,handler:{},init:function(t){this._connection=t,e.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),e.addNamespace("PUBSUB_SUBSCRIBE_OPTIONS",e.NS.PUBSUB+"#subscribe_options"),e.addNamespace("PUBSUB_ERRORS",e.NS.PUBSUB+"#errors"),e.addNamespace("PUBSUB_EVENT",e.NS.PUBSUB+"#event"),e.addNamespace("PUBSUB_OWNER",e.NS.PUBSUB+"#owner"),e.addNamespace("PUBSUB_AUTO_CREATE",e.NS.PUBSUB+"#auto-create"),e.addNamespace("PUBSUB_PUBLISH_OPTIONS",e.NS.PUBSUB+"#publish-options"),e.addNamespace("PUBSUB_NODE_CONFIG",e.NS.PUBSUB+"#node_config"),e.addNamespace("PUBSUB_CREATE_AND_CONFIGURE",e.NS.PUBSUB+"#create-and-configure"),e.addNamespace("PUBSUB_SUBSCRIBE_AUTHORIZATION",e.NS.PUBSUB+"#subscribe_authorization"),e.addNamespace("PUBSUB_GET_PENDING",e.NS.PUBSUB+"#get-pending"),e.addNamespace("PUBSUB_MANAGE_SUBSCRIPTIONS",e.NS.PUBSUB+"#manage-subscriptions"),e.addNamespace("PUBSUB_META_DATA",e.NS.PUBSUB+"#meta-data"),e.addNamespace("ATOM","http://www.w3.org/2005/Atom"),t.disco&&t.disco.addFeature(e.NS.PUBSUB)},statusChanged:function(t){var a=this._connection;this._autoService&&t===e.Status.CONNECTED&&(this.service="pubsub."+e.getDomainFromJid(a.jid),this.jid=a.jid)},connect:function(e,t){var a=this._connection;t===void 0&&(t=e,e=void 0),this.jid=e||a.jid,this.service=t||null,this._autoService=!1},storeHandler:function(e,t){this.handler[e]||(this.handler[e]=[]),this.handler[e].push(t)},removeHandler:function(e){var t=this.handler[e];if(this.handler[e]=[],t&&0<t.length)for(var a=0,n=t.length;a<n;a++)this._connection.deleteHandler(t[a])},createNode:function(t,i,n){var s=this._connection,o=s.getUniqueId("pubsubcreatenode"),d=a({from:this.jid,to:this.service,type:"set",id:o}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("create",{node:t});return i&&d.up().c("configure").form(e.NS.PUBSUB_NODE_CONFIG,i),s.addHandler(n,null,"iq",null,o,null),s.send(d.tree()),o},deleteNode:function(t,i){var n=this._connection,s=n.getUniqueId("pubsubdeletenode"),o=a({from:this.jid,to:this.service,type:"set",id:s}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("delete",{node:t});return n.addHandler(i,null,"iq",null,s,null),n.send(o.tree()),s},discoverNodes:function(t,i,n){var s=a({from:this.jid,to:this.service,type:"get"}).c("query",{xmlns:e.NS.DISCO_ITEMS});return this._connection.sendIQ(s.tree(),t,i,n)},getConfig:function(t,i){var n=this._connection,s=n.getUniqueId("pubsubconfigurenode"),o=a({from:this.jid,to:this.service,type:"get",id:s}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("configure",{node:t});return n.addHandler(i,null,"iq",null,s,null),n.send(o.tree()),s},getDefaultNodeConfig:function(t){var i=this._connection,n=i.getUniqueId("pubsubdefaultnodeconfig"),s=a({from:this.jid,to:this.service,type:"get",id:n}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("default");return i.addHandler(t,null,"iq",null,n,null),i.send(s.tree()),n},subscribe:function(t,i,n,s,o,d){var c=this._connection,r=c.getUniqueId("subscribenode"),l=this.jid;d&&(l=e.getBareJidFromJid(l));var p=a({from:this.jid,to:this.service,type:"set",id:r}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("subscribe",{node:t,jid:l});i&&p.up().c("options").form(e.NS.PUBSUB_SUBSCRIBE_OPTIONS,i);var u=c.addHandler(n,null,"message",null,null,null);return this.storeHandler(t,u),c.sendIQ(p.tree(),s,o),r},unsubscribe:function(t,i,n,s,o){var d=this._connection,c=d.getUniqueId("pubsubunsubscribenode"),r=a({from:this.jid,to:this.service,type:"set",id:c}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("unsubscribe",{node:t,jid:i});return n&&r.attrs({subid:n}),d.sendIQ(r.tree(),s,o),this.removeHandler(t),c},publish:function(t,i,n){var s=this._connection,o=s.getUniqueId("pubsubpublishnode"),d=a({from:this.jid,to:this.service,type:"set",id:o}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("publish",{node:t,jid:this.jid}).list("item",i);return s.addHandler(n,null,"iq",null,o,null),s.send(d.tree()),o},items:function(t,i,n,s){var o=a({from:this.jid,to:this.service,type:"get"}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("items",{node:t});return this._connection.sendIQ(o.tree(),i,n,s)},getSubscriptions:function(t){var i=this._connection,n=i.getUniqueId("pubsubsubscriptions"),s=a({from:this.jid,to:this.service,type:"get",id:n}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("subscriptions");return i.addHandler(t,null,"iq",null,n,null),i.send(s.tree()),n},getNodeSubscriptions:function(t,i){var n=this._connection,s=n.getUniqueId("pubsubsubscriptions"),o=a({from:this.jid,to:this.service,type:"get",id:s}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("subscriptions",{node:t});return n.addHandler(i,null,"iq",null,s,null),n.send(o.tree()),s},getSubOptions:function(t,i,n){var s=this._connection,o=s.getUniqueId("pubsubsuboptions"),d=a({from:this.jid,to:this.service,type:"get",id:o}).c("pubsub",{xmlns:e.NS.PUBSUB}).c("options",{node:t,jid:this.jid});return i&&d.attrs({subid:i}),s.addHandler(n,null,"iq",null,o,null),s.send(d.tree()),o},getAffiliations:function(t,i){var n=this._connection,s=n.getUniqueId("pubsubaffiliations");"function"==typeof t&&(i=t,t=void 0);var o={},d={xmlns:e.NS.PUBSUB};t&&(o.node=t,d={xmlns:e.NS.PUBSUB_OWNER});var c=a({from:this.jid,to:this.service,type:"get",id:s}).c("pubsub",d).c("affiliations",o);return n.addHandler(i,null,"iq",null,s,null),n.send(c.tree()),s},setAffiliation:function(t,i,n,s){var o=this._connection,d=o.getUniqueId("pubsubaffiliations"),c=a({from:this.jid,to:this.service,type:"set",id:d}).c("pubsub",{xmlns:e.NS.PUBSUB_OWNER}).c("affiliations",{node:t}).c("affiliation",{jid:i,affiliation:n});return o.addHandler(s,null,"iq",null,d,null),o.send(c.tree()),d},publishAtom:function(a,n,s){Array.isArray(n)||(n=[n]);var o=[],d,c;for(d=0;d<n.length;d++)c=n[d],c.updated=c.updated||new Date().toISOString(),c.published&&c.published.toISOString&&(c.published=c.published.toISOString()),o.push({data:t("entry",{xmlns:e.NS.ATOM}).children(c).tree(),attrs:c.id?{id:c.id}:{}});return this.publish(a,o,s)}})}),function(e,t){define("backbone.localsync",["backbone","underscore"],function(e,a){return t(e,a)})}(this,function(t,a){try{localStorage.setItem("test",1),localStorage.removeItem("test"),t.useLocalStorage=!0}catch(a){Storage.prototype._getItem=Storage.prototype.getItem,Storage.prototype._setItem=Storage.prototype.setItem,Storage.prototype._removeItem=Storage.prototype.removeItem,Storage.prototype.getItem=function(){},Storage.prototype.setItem=function(){},Storage.prototype.removeItem=function(){},t.useLocalStorage=!1}var e=function(e){this.name=e;var t=localStorage.getItem(this.name);this.records=this.from_string(t,[])},i=function(e){this.version=e.version||1,this.name=e.name;var t=indexedDB.open(this.name,this.version);t.onupgradeneeded=function(){let e=t.result;this.createStore(e)}.bind(this),t.onsuccess=function(){this.db=t.result}.bind(this),this.createStore=function(t){t.createObjectStore(e.objStoreName,{keyPath:e.primKey})}};a.extend(i.prototype,{put:function(e,t,a){if(!this.db)return void(a&&a(!1));let i=this.db.transaction([e],"readwrite").objectStore(e),n=i.put(t);n.onsuccess=function(){a&&a(!0)}.bind(this),n.onerror=function(){a&&a(!1)}.bind(this)},get_all:function(e,t,i){if(!this.db)return void(i&&i(null));let n=this.db.transaction([e],"readonly").objectStore(e),s;s=a.isNull(t)?n.getAll():n.getAll(t),s.onsuccess=function(e){var t=e.target.result;t===void 0?i&&i(null):i&&i(t)}.bind(this)},get:function(e,t,a){if(!this.db)return void(a&&a(null));let i=this.db.transaction([e],"readonly").objectStore(e),n=i.get(t);n.onsuccess=function(e){var t=e.target.result;t===void 0?a&&a(null):a&&a(t)}.bind(this)},remove:function(e,t,a){if(!this.db)return void(a&&a(!1));let i=this.db.transaction([e],"readwrite").objectStore(e);var n=i.delete(t);n.onsuccess=function(){a&&a(!0)}.bind(this),n.onerror=function(){a&&a(!1)}.bind(this)},clear_database:function(e,t){if(!this.db)return void(t&&t(!1));let a=this.db.transaction([e],"readwrite").objectStore(e);var i=a.clear();i.onsuccess=function(){t&&t(!0)}.bind(this),i.onerror=function(){t&&t(!1)}.bind(this)}}),a.extend(e.prototype,{from_string:function(e,t){if(!e)return t;try{return JSON.parse(e)}catch(a){return t||{}}},to_string:function(e){try{return JSON.stringify(e)}catch(t){return""}},save:function(){this.records.length?localStorage.setItem(this.name,this.to_string(this.records)):localStorage.removeItem(this.name)},clear:function(){a.each(this.records,function(e){localStorage.removeItem(this._itemName(e))}.bind(this)),localStorage.removeItem(this.name)},create:function(e){localStorage.setItem(this._itemName(e.id),this.to_string(e)),this.records.push(e.id),this.save()},update:function(e){localStorage.setItem(this._itemName(e.id),this.to_string(e)),a.contains(this.records,e.id)||(this.records.push(e.id),this.save())},find:function(e){var t=localStorage.getItem(this._itemName(e.id));return this.from_string(t,{})},findAll:function(){return a.reduce(this.records,function(e,t){var a=localStorage.getItem(this._itemName(t));return a&&e.push(this.from_string(a,{})),e}.bind(this),[])},destroy:function(e){localStorage.removeItem(this._itemName(e.id));var t=this.records.indexOf(e.id);0<=t&&(this.records.splice(t,1),this.save())},_itemName:function(e){return this.name+"-"+e}}),t.sync=function(e,t,a){var i=t.storage||t.collection&&t.collection.storage;if(!i)return!1;var n;"read"===e?n=t.id?i.find(t):i.findAll():"create"===e?n=i.create(t):"update"===e?n=i.update(t):"delete"===e?n=i.destroy(t):void 0;n?a.success(n):a.error("Record not found")},t.ModelWithStorage=t.Model.extend({initialize:function(t,a){this.storage=new e(a.storage_name),"before"===a.fetch&&this.fetch(),this._initialize&&this._initialize(t,a),"after"===a.fetch&&this.fetch()},clearStorage:function(){this.storage.clear()}}),t.ModelWithDataBase=t.Model.extend({initialize:function(e,t){this.database=new i(t),this._initialize&&this._initialize(e,t)},clearDataBase:function(){this.database.clear()}}),t.CollectionWithStorage=t.Collection.extend({initialize:function(t,a){this.storage=new e(a.storage_name),this._initialize&&this._initialize(t,a)},clearStorage:function(){this.storage.clear()}})}),!function(){"use strict";function t(e){e?(f[0]=f[16]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=f[7]=f[8]=f[9]=f[10]=f[11]=f[12]=f[13]=f[14]=f[15]=0,this.blocks=f):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}var h="object"==typeof window?window:{},s=!h.JS_SHA1_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;s&&(h=global);var i=!h.JS_SHA1_NO_COMMON_JS&&"object"==typeof module&&module.exports,e="function"==typeof define&&define.amd,r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],o=[-2147483648,8388608,32768,128],n=[24,16,8,0],a=["hex","array","digest","arrayBuffer"],f=[],u=function(e){return function(a){return new t(!0).update(a)[e]()}},c=function(){var n=u("hex");s&&(n=p(n)),n.create=function(){return new t},n.update=function(e){return n.create().update(e)};for(var o=0,d;o<a.length;++o)d=a[o],n[d]=u(d);return n},p=function(t){var h=eval("require('crypto')"),s=eval("require('buffer').Buffer"),i=function(e){if("string"==typeof e)return h.createHash("sha1").update(e,"utf8").digest("hex");if(e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(void 0===e.length)return t(e);return h.createHash("sha1").update(new s(e)).digest("hex")};return i};t.prototype.update=function(d){if(!this.finalized){var c="string"!=typeof d;c&&d.constructor===h.ArrayBuffer&&(d=new Uint8Array(d));for(var s=0,l=d.length||0,o=this.blocks,a,p;s<l;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),c)for(p=this.start;s<l&&64>p;++s)o[p>>2]|=d[s]<<n[3&p++];else for(p=this.start;s<l&&64>p;++s)128>(a=d.charCodeAt(s))?o[p>>2]|=a<<n[3&p++]:2048>a?(o[p>>2]|=(192|a>>6)<<n[3&p++],o[p>>2]|=(128|63&a)<<n[3&p++]):55296>a||57344<=a?(o[p>>2]|=(224|a>>12)<<n[3&p++],o[p>>2]|=(128|63&a>>6)<<n[3&p++],o[p>>2]|=(128|63&a)<<n[3&p++]):(a=65536+((1023&a)<<10|1023&d.charCodeAt(++s)),o[p>>2]|=(240|a>>18)<<n[3&p++],o[p>>2]|=(128|63&a>>12)<<n[3&p++],o[p>>2]|=(128|63&a>>6)<<n[3&p++],o[p>>2]|=(128|63&a)<<n[3&p++]);this.lastByteIndex=p,this.bytes+=p-this.start,64<=p?(this.block=o[16],this.start=p-64,this.hash(),this.hashed=!0):this.start=p}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes%=4294967296),this}},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=o[3&t],this.block=e[16],56<=t&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},t.prototype.hash=function(){var a=this.h0,d=this.h1,c=this.h2,l=this.h3,p=this.h4,u=this.blocks,n,m;for(n=16;80>n;++n)m=u[n-3]^u[n-8]^u[n-14]^u[n-16],u[n]=m<<1|m>>>31;for(n=0;20>n;n+=5)a=(m=(d=(m=(c=(m=(l=(m=(p=(m=a<<5|a>>>27)+(d&c|~d&l)+p+1518500249+u[n]<<0)<<5|p>>>27)+(a&(d=d<<30|d>>>2)|~a&c)+l+1518500249+u[n+1]<<0)<<5|l>>>27)+(p&(a=a<<30|a>>>2)|~p&d)+c+1518500249+u[n+2]<<0)<<5|c>>>27)+(l&(p=p<<30|p>>>2)|~l&a)+d+1518500249+u[n+3]<<0)<<5|d>>>27)+(c&(l=l<<30|l>>>2)|~c&p)+a+1518500249+u[n+4]<<0,c=c<<30|c>>>2;for(;40>n;n+=5)a=(m=(d=(m=(c=(m=(l=(m=(p=(m=a<<5|a>>>27)+(d^c^l)+p+1859775393+u[n]<<0)<<5|p>>>27)+(a^(d=d<<30|d>>>2)^c)+l+1859775393+u[n+1]<<0)<<5|l>>>27)+(p^(a=a<<30|a>>>2)^d)+c+1859775393+u[n+2]<<0)<<5|c>>>27)+(l^(p=p<<30|p>>>2)^a)+d+1859775393+u[n+3]<<0)<<5|d>>>27)+(c^(l=l<<30|l>>>2)^p)+a+1859775393+u[n+4]<<0,c=c<<30|c>>>2;for(;60>n;n+=5)a=(m=(d=(m=(c=(m=(l=(m=(p=(m=a<<5|a>>>27)+(d&c|d&l|c&l)+p-1894007588+u[n]<<0)<<5|p>>>27)+(a&(d=d<<30|d>>>2)|a&c|d&c)+l-1894007588+u[n+1]<<0)<<5|l>>>27)+(p&(a=a<<30|a>>>2)|p&d|a&d)+c-1894007588+u[n+2]<<0)<<5|c>>>27)+(l&(p=p<<30|p>>>2)|l&a|p&a)+d-1894007588+u[n+3]<<0)<<5|d>>>27)+(c&(l=l<<30|l>>>2)|c&p|l&p)+a-1894007588+u[n+4]<<0,c=c<<30|c>>>2;for(;80>n;n+=5)a=(m=(d=(m=(c=(m=(l=(m=(p=(m=a<<5|a>>>27)+(d^c^l)+p-899497514+u[n]<<0)<<5|p>>>27)+(a^(d=d<<30|d>>>2)^c)+l-899497514+u[n+1]<<0)<<5|l>>>27)+(p^(a=a<<30|a>>>2)^d)+c-899497514+u[n+2]<<0)<<5|c>>>27)+(l^(p=p<<30|p>>>2)^a)+d-899497514+u[n+3]<<0)<<5|d>>>27)+(c^(l=l<<30|l>>>2)^p)+a-899497514+u[n+4]<<0,c=c<<30|c>>>2;this.h0=this.h0+a<<0,this.h1=this.h1+d<<0,this.h2=this.h2+c<<0,this.h3=this.h3+l<<0,this.h4=this.h4+p<<0},t.prototype.hex=function(){this.finalize();var a=this.h0,t=this.h1,n=this.h2,s=this.h3,i=this.h4;return r[15&a>>28]+r[15&a>>24]+r[15&a>>20]+r[15&a>>16]+r[15&a>>12]+r[15&a>>8]+r[15&a>>4]+r[15&a]+r[15&t>>28]+r[15&t>>24]+r[15&t>>20]+r[15&t>>16]+r[15&t>>12]+r[15&t>>8]+r[15&t>>4]+r[15&t]+r[15&n>>28]+r[15&n>>24]+r[15&n>>20]+r[15&n>>16]+r[15&n>>12]+r[15&n>>8]+r[15&n>>4]+r[15&n]+r[15&s>>28]+r[15&s>>24]+r[15&s>>20]+r[15&s>>16]+r[15&s>>12]+r[15&s>>8]+r[15&s>>4]+r[15&s]+r[15&i>>28]+r[15&i>>24]+r[15&i>>20]+r[15&i>>16]+r[15&i>>12]+r[15&i>>8]+r[15&i>>4]+r[15&i]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var a=this.h0,t=this.h1,n=this.h2,s=this.h3,i=this.h4;return[255&a>>24,255&a>>16,255&a>>8,255&a,255&t>>24,255&t>>16,255&t>>8,255&t,255&n>>24,255&n>>16,255&n>>8,255&n,255&s>>24,255&s>>16,255&s>>8,255&s,255&i>>24,255&i>>16,255&i>>8,255&i]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};var y=c();i?module.exports=y:(h.sha1=y,e&&define("sha1_hasher",[],function(){return y}))}(),!function(M,L,a,F){"use strict";var Ne=Math.abs;function Y(e,t,a){return setTimeout(p(e,a),t)}function d(e,t,a){return!!Array.isArray(e)&&(l(e,a[t],a),!0)}function l(t,a,i){if(t)if(t.forEach)t.forEach(a,i);else if(t.length!==F)for(n=0;n<t.length;)a.call(i,t[n],n,t),n++;else for(var n in t)t.hasOwnProperty(n)&&a.call(i,t[n],n,t)}function m(t,a,i){for(var n=Object.keys(a),e=0;e<n.length;)(!i||i&&t[n[e]]===F)&&(t[n[e]]=a[n[e]]),e++;return t}function n(e,t){return m(e,t,!0)}function o(t,a,i){var n=a.prototype,s;s=t.prototype=Object.create(n),s.constructor=t,s._super=n,i&&m(s,i)}function p(e,t){return function(){return e.apply(t,arguments)}}function k(e,t){return typeof e==f?e.apply(t?t[0]||F:F,t):e}function c(e,t){return e===F?t:e}function s(e,t,a){l(v(t),function(t){e.addEventListener(t,a,!1)})}function t(e,t,a){l(v(t),function(t){e.removeEventListener(t,a,!1)})}function r(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function u(e,t){return-1<e.indexOf(t)}function v(e){return e.trim().split(/\s+/g)}function x(e,t,a){if(e.indexOf&&!a)return e.indexOf(t);for(var i=0;i<e.length;){if(a&&e[i][a]==t||!a&&e[i]===t)return i;i++}return-1}function w(e){return Array.prototype.slice.call(e,0)}function q(t,i,a){for(var n=[],s=[],e=0,o;e<t.length;)o=i?t[e][i]:t[e],0>x(s,o)&&n.push(t[e]),s[e]=o,e++;return a&&(n=i?n.sort(function(e,t){return e[i]>t[i]}):n.sort()),n}function A(e,t){for(var a=t[0].toUpperCase()+t.slice(1),i=0,n,s;i<Re.length;){if(n=Re[i],s=n?n+a:t,s in e)return s;i++}return F}function b(){return i++}function D(e){var t=e.ownerDocument;return t.defaultView||t.parentWindow}function E(e,t){var a=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){k(e.options.enable,[e])&&a.handler(t)},this.init()}function B(e){var t=e.options.inputClass,a;return a=t?t:G?ce:H?pe:j?me:de,new a(e,z)}function z(t,a,i){var n=i.pointers.length,s=i.changedPointers.length,e=a&N&&0==n-s;i.isFirst=!!e,i.isFinal=!!(a&(P|Q)&&0==n-s),e&&(t.session={}),i.eventType=a,X(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function X(t,a){var n=t.session,s=a.pointers,o=s.length;n.firstInput||(n.firstInput=K(a)),1<o&&!n.firstMultiple?n.firstMultiple=K(a):1===o&&(n.firstMultiple=!1);var e=n.firstInput,d=n.firstMultiple,c=d?d.center:e.center,l=a.center=ee(s);a.timeStamp=Oe(),a.deltaTime=a.timeStamp-e.timeStamp,a.angle=ne(c,l),a.distance=ie(c,l),J(n,a),a.offsetDirection=ae(a.deltaX,a.deltaY),a.scale=d?oe(d.pointers,s):1,a.rotation=d?se(d.pointers,s):0,Z(n,a);var i=t.element;r(a.srcEvent.target,i)&&(i=a.srcEvent.target),a.target=i}function J(t,a){var i=a.center,n=t.offsetDelta||{},s=t.prevDelta||{},o=t.prevInput||{};(a.eventType===N||o.eventType===P)&&(s=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),a.deltaX=s.x+(i.x-n.x),a.deltaY=s.y+(i.y-n.y)}function Z(t,a){var i=t.lastInterval||a,n=a.timeStamp-i.timeStamp,e,s,o,d;if(a.eventType!=Q&&(n>I||i.velocity===F)){var c=i.deltaX-a.deltaX,r=i.deltaY-a.deltaY,l=te(n,c,r);s=l.x,o=l.y,e=h(l.x)>h(l.y)?l.x:l.y,d=ae(c,r),t.lastInterval=a}else e=i.velocity,s=i.velocityX,o=i.velocityY,d=i.direction;a.velocity=e,a.velocityX=s,a.velocityY=o,a.direction=d}function K(e){for(var t=[],a=0;a<e.pointers.length;)t[a]={clientX:g(e.pointers[a].clientX),clientY:g(e.pointers[a].clientY)},a++;return{timeStamp:Oe(),pointers:t,center:ee(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ee(t){var a=t.length;if(1===a)return{x:g(t[0].clientX),y:g(t[0].clientY)};for(var i=0,n=0,s=0;a>s;)i+=t[s].clientX,n+=t[s].clientY,s++;return{x:g(i/a),y:g(n/a)}}function te(e,t,a){return{x:t/e||0,y:a/e||0}}function ae(e,t){return e===t?R:h(e)>=h(t)?0<e?S:T:0<t?U:V}function ie(t,a,i){i||(i=W);var n=a[i[0]]-t[i[0]],s=a[i[1]]-t[i[1]];return Math.sqrt(n*n+s*s)}function ne(t,a,i){i||(i=W);var n=a[i[0]]-t[i[0]],s=a[i[1]]-t[i[1]];return 180*Math.atan2(s,n)/Math.PI}function se(e,t){return ne(t[1],t[0],je)-ne(e[1],e[0],je)}function oe(e,t){return ie(t[0],t[1],je)/ie(e[0],e[1],je)}function de(){this.evEl=De,this.evWin=Be,this.allow=!0,this.pressed=!1,E.apply(this,arguments)}function ce(){this.evEl=Ve,this.evWin=He,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function re(){this.evTarget=Fe,this.evWin=Ue,this.started=!1,E.apply(this,arguments)}function le(e,t){var a=w(e.touches),i=w(e.changedTouches);return t&(P|Q)&&(a=q(a.concat(i),"identifier",!0)),[a,i]}function pe(){this.evTarget=ze,this.targetIds={},E.apply(this,arguments)}function ue(t,a){var n=w(t.touches),s=this.targetIds;if(a&(N|O)&&1===n.length)return s[n[0].identifier]=!0,[n,n];var o=w(t.changedTouches),d=[],c=this.target,i,l;if(l=n.filter(function(e){return r(e.target,c)}),a===N)for(i=0;i<l.length;)s[l[i].identifier]=!0,i++;for(i=0;i<o.length;)s[o[i].identifier]&&d.push(o[i]),a&(P|Q)&&delete s[o[i].identifier],i++;return d.length?[q(l.concat(d),"identifier",!0),d]:void 0}function me(){E.apply(this,arguments);var e=p(this.handler,this);this.touch=new pe(this.manager,e),this.mouse=new de(this.manager,e)}function ge(e,t){this.manager=e,this.set(t)}function he(e){if(u(e,Je))return Je;var t=u(e,Ze),a=u(e,Ke);return t&&a?Ze+" "+Ke:t||a?t?Ze:Ke:u(e,Xe)?Xe:Qe}function ve(e){this.id=b(),this.manager=null,this.options=n(e||{},this.defaults),this.options.enable=c(this.options.enable,!0),this.state=et,this.simultaneous={},this.requireFail=[]}function Ae(e){return e&nt?"cancel":e&it?"end":e&at?"move":e&tt?"start":""}function fe(e){return e==V?"down":e==U?"up":e==S?"left":e==T?"right":""}function _e(e,t){var a=t.manager;return a?a.get(e):e}function be(){ve.apply(this,arguments)}function ye(){be.apply(this,arguments),this.pX=null,this.pY=null}function xe(){be.apply(this,arguments)}function we(){ve.apply(this,arguments),this._timer=null,this._input=null}function Ce(){be.apply(this,arguments)}function Se(){be.apply(this,arguments)}function ke(){ve.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ee(e,t){return t=t||{},t.recognizers=c(t.recognizers,Ee.defaults.preset),new Te(e,t)}function Te(e,t){t=t||{},this.options=n(t,Ee.defaults),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.element=e,this.input=B(this),this.touchAction=new ge(this,this.options.touchAction),Ie(this,!0),l(t.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function Ie(e,t){var i=e.element;l(e.options.cssProps,function(e,a){i.style[A(i.style,a)]=t?e:""})}function Me(e,t){var a=L.createEvent("Event");a.initEvent(e,!0,!0),a.gesture=t,t.target.dispatchEvent(a)}var Re=["","webkit","moz","MS","ms","o"],e=L.createElement("div"),f="function",g=Math.round,h=Ne,Oe=Date.now,i=1,j=("ontouchstart"in M),G=A(M,"PointerEvent")!==F,H=j&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),I=25,N=1,O=2,P=4,Q=8,R=1,S=2,T=4,U=8,V=16,W=["x","y"],je=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&s(this.element,this.evEl,this.domHandler),this.evTarget&&s(this.target,this.evTarget,this.domHandler),this.evWin&&s(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&t(this.element,this.evEl,this.domHandler),this.evTarget&&t(this.target,this.evTarget,this.domHandler),this.evWin&&t(D(this.element),this.evWin,this.domHandler)}};var Pe={mousedown:1,mousemove:2,mouseup:4},De="mousedown",Be="mousemove mouseup";o(de,E,{handler:function(e){var t=Pe[e.type];t&1&&0===e.button&&(this.pressed=!0),t&2&&1!==e.which&&(t=4),this.pressed&&this.allow&&(t&4&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var Le={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},$e={2:"touch",3:"pen",4:"mouse",5:"kinect"},Ve="pointerdown",He="pointermove pointerup pointercancel";M.MSPointerEvent&&(Ve="MSPointerDown",He="MSPointerMove MSPointerUp MSPointerCancel"),o(ce,E,{handler:function(t){var a=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),s=Le[n],e=$e[t.pointerType]||t.pointerType,o=x(a,t.pointerId,"pointerId");s&1&&(0===t.button||e=="touch")?0>o&&(a.push(t),o=a.length-1):s&12&&(i=!0),0>o||(a[o]=t,this.callback(this.manager,s,{pointers:a,changedPointers:[t],pointerType:e,srcEvent:t}),i&&a.splice(o,1))}});var qe={touchstart:1,touchmove:2,touchend:4,touchcancel:8},Fe="touchstart",Ue="touchstart touchmove touchend touchcancel";o(re,E,{handler:function(e){var t=qe[e.type];if(t===1&&(this.started=!0),this.started){var a=le.call(this,e,t);t&12&&0==a[0].length-a[1].length&&(this.started=!1),this.callback(this.manager,t,{pointers:a[0],changedPointers:a[1],pointerType:"touch",srcEvent:e})}}});var Ge={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ze="touchstart touchmove touchend touchcancel";o(pe,E,{handler:function(e){var t=Ge[e.type],a=ue.call(this,e,t);a&&this.callback(this.manager,t,{pointers:a[0],changedPointers:a[1],pointerType:"touch",srcEvent:e})}}),o(me,E,{handler:function(t,a,i){var n=i.pointerType=="touch",s=i.pointerType=="mouse";if(n)this.mouse.allow=!1;else if(s&&!this.mouse.allow)return;a&12&&(this.mouse.allow=!0),this.callback(t,a,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ye=A(e.style,"touchAction"),We=Ye!==F,Qe="auto",Xe="manipulation",Je="none",Ze="pan-x",Ke="pan-y";ge.prototype={set:function(e){e=="compute"&&(e=this.compute()),We&&(this.manager.element.style[Ye]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return l(this.manager.recognizers,function(t){k(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),he(e.join(" "))},preventDefaults:function(t){if(!We){var a=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return a.preventDefault(),void 0;var n=this.actions,s=u(n,"none"),e=u(n,"pan-y"),o=u(n,"pan-x");return s||e&&i&6||o&&i&24?this.preventSrc(a):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var et=1,tt=2,at=4,it=8,nt=16;ve.prototype={defaults:{},set:function(e){return m(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(d(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=_e(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return d(e,"dropRecognizeWith",this)?this:(e=_e(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(d(e,"requireFailure",this))return this;var t=this.requireFail;return e=_e(e,this),-1===x(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(d(e,"dropRequireFailure",this))return this;e=_e(e,this);var t=x(this.requireFail,e);return-1<t&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){a.manager.emit(a.options.event+(t?Ae(i):""),e)}var a=this,i=this.state;8>i&&t(!0),t(),i>=8&&t(!0)},tryEmit:function(e){return this.canEmit()?this.emit(e):(this.state=32,void 0)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&33))return!1;e++}return!0},recognize:function(e){var t=m({},e);return k(this.options.enable,[this,t])?(this.state&56&&(this.state=1),this.state=this.process(t),this.state&30&&this.tryEmit(t),void 0):(this.reset(),this.state=32,void 0)},process:function(){},getTouchAction:function(){},reset:function(){}},o(be,ve,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(t){var a=this.state,i=t.eventType,n=a&6,s=this.attrTest(t);return n&&(i&8||!s)?a|16:n||s?i&4?a|8:a&2?a|4:2:32}}),o(ye,be,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return e&6&&t.push("pan-y"),e&24&&t.push("pan-x"),t},directionTest:function(t){var a=this.options,i=!0,n=t.distance,s=t.direction,o=t.deltaX,r=t.deltaY;return s&a.direction||(a.direction&6?(s=0===o?1:0>o?2:4,i=o!=this.pX,n=Ne(t.deltaX)):(s=0===r?1:0>r?8:16,i=r!=this.pY,n=Ne(t.deltaY))),t.direction=s,i&&n>a.threshold&&s&a.direction},attrTest:function(e){return be.prototype.attrTest.call(this,e)&&(this.state&2||!(this.state&2)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=fe(e.direction);t&&this.manager.emit(this.options.event+t,e),this._super.emit.call(this,e)}}),o(xe,be,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Ne(e.scale-1)>this.options.threshold||this.state&2)},emit:function(e){if(this._super.emit.call(this,e),1!==e.scale){var t=1>e.scale?"in":"out";this.manager.emit(this.options.event+t,e)}}}),o(we,ve,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(t){var a=this.options,i=t.pointers.length===a.pointers,n=t.distance<a.threshold,s=t.deltaTime>a.time;if(this._input=t,!n||!i||t.eventType&12&&!s)this.reset();else if(t.eventType&1)this.reset(),this._timer=Y(function(){this.state=8,this.tryEmit()},a.time,this);else if(t.eventType&4)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===8&&(e&&e.eventType&4?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=Oe(),this.manager.emit(this.options.event,this._input)))}}),o(Ce,be,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Ne(e.rotation)>this.options.threshold||this.state&2)}}),o(Se,be,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:30,pointers:1},getTouchAction:function(){return ye.prototype.getTouchAction.call(this)},attrTest:function(e){var t=this.options.direction,a;return t&30?a=e.velocity:t&6?a=e.velocityX:t&24&&(a=e.velocityY),this._super.attrTest.call(this,e)&&t&e.direction&&e.distance>this.options.threshold&&h(a)>this.options.velocity&&e.eventType&4},emit:function(e){var t=fe(e.direction);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),o(ke,ve,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(t){var a=this.options,i=t.pointers.length===a.pointers,n=t.distance<a.threshold,s=t.deltaTime<a.time;if(this.reset(),t.eventType&1&&0===this.count)return this.failTimeout();if(n&&s&&i){if(4!=t.eventType)return this.failTimeout();var e=!this.pTime||t.timeStamp-this.pTime<a.interval,o=!this.pCenter||ie(this.pCenter,t.center)<a.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,o&&e?this.count+=1:this.count=1,this._input=t;var d=this.count%a.taps;if(0==d)return this.hasRequireFailures()?(this._timer=Y(function(){this.state=8,this.tryEmit()},a.interval,this),2):8}return 32},failTimeout:function(){return this._timer=Y(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==8&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ee.VERSION="2.0.4",Ee.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Ce,{enable:!1}],[xe,{enable:!1},["rotate"]],[Se,{direction:6}],[ye,{direction:6},["swipe"]],[ke],[ke,{event:"doubletap",taps:2},["tap"]],[we]],cssProps:{userSelect:"default",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};Te.prototype={set:function(e){return m(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(t){var a=this.session;if(!a.stopped){this.touchAction.preventDefaults(t);var i=this.recognizers,n=a.curRecognizer,s;(!n||n&&n.state&8)&&(n=a.curRecognizer=null);for(var o=0;o<i.length;)s=i[o],a.stopped===2||n&&s!=n&&!s.canRecognizeWith(n)?s.reset():s.recognize(t),!n&&s.state&14&&(n=a.curRecognizer=s),o++}},get:function(e){if(e instanceof ve)return e;for(var t=this.recognizers,a=0;a<t.length;a++)if(t[a].options.event==e)return t[a];return null},add:function(e){if(d(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(d(e,"remove",this))return this;var t=this.recognizers;return e=this.get(e),t.splice(x(t,e),1),this.touchAction.update(),this},on:function(e,t){var i=this.handlers;return l(v(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this},off:function(e,t){var i=this.handlers;return l(v(e),function(e){t?i[e].splice(x(i[e],t),1):delete i[e]}),this},emit:function(e,t){this.options.domEvents&&Me(e,t);var a=this.handlers[e]&&this.handlers[e].slice();if(a&&a.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<a.length;)a[i](t),i++}},destroy:function(){this.element&&Ie(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},m(Ee,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Te,Input:E,TouchAction:ge,TouchInput:pe,MouseInput:de,PointerEventInput:ce,TouchMouseInput:me,SingleTouchInput:re,Recognizer:ve,AttrRecognizer:be,Tap:ke,Pan:ye,Swipe:Se,Pinch:xe,Rotate:Ce,Press:we,on:s,off:t,each:l,merge:n,extend:m,inherit:o,bindFn:p,prefixed:A}),typeof define=="function"&&define.amd?define("hammerjs",[],function(){return Ee}):"undefined"!=typeof module&&module.exports?module.exports=Ee:M[a]=Ee}(window,document,"Hammer"),define("materialize",["jquery","hammerjs"],function(h,v){var A=Math.exp,f=Math.asin,w=Math.sin,C=Math.sqrt,M=Math.round,L=Math.abs,V=Math.cos,H=Math.PI,q=String.fromCharCode,F=Math.floor,U=Math.pow,G=Math.min,z=Math.max;window.$=window.jQuery=$=h,h.easing.jswing=h.easing.swing,h.extend(h.easing,{def:"easeOutQuad",swing:function(e,a,t,i,n){return h.easing[h.easing.def](e,a,t,i,n)},easeInQuad:function(e,a,i,n,s){return n*(a/=s)*a+i},easeOutQuad:function(e,a,i,n,s){return-n*(a/=s)*(a-2)+i},easeInOutQuad:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a+i:-n/2*(--a*(a-2)-1)+i},easeInCubic:function(e,a,i,n,s){return n*(a/=s)*a*a+i},easeOutCubic:function(e,a,i,n,s){return n*((a=a/s-1)*a*a+1)+i},easeInOutCubic:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a*a+i:n/2*((a-=2)*a*a+2)+i},easeInQuart:function(e,a,i,n,s){return n*(a/=s)*a*a*a+i},easeOutQuart:function(e,a,i,n,s){return-n*((a=a/s-1)*a*a*a-1)+i},easeInOutQuart:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a*a*a+i:-n/2*((a-=2)*a*a*a-2)+i},easeInQuint:function(e,a,i,n,s){return n*(a/=s)*a*a*a*a+i},easeOutQuint:function(e,a,i,n,s){return n*((a=a/s-1)*a*a*a*a+1)+i},easeInOutQuint:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a*a*a*a+i:n/2*((a-=2)*a*a*a*a+2)+i},easeInSine:function(e,a,t,i,n){return-i*V(a/n*(H/2))+i+t},easeOutSine:function(e,a,t,i,n){return i*w(a/n*(H/2))+t},easeInOutSine:function(e,a,t,i,n){return-i/2*(V(H*a/n)-1)+t},easeInExpo:function(e,a,t,i,n){return 0==a?t:i*U(2,10*(a/n-1))+t},easeOutExpo:function(e,a,t,i,n){return a==n?t+i:i*(-U(2,-10*a/n)+1)+t},easeInOutExpo:function(e,a,i,n,s){return 0==a?i:a==s?i+n:1>(a/=s/2)?n/2*U(2,10*(a-1))+i:n/2*(-U(2,-10*--a)+2)+i},easeInCirc:function(e,a,i,n,s){return-n*(C(1-(a/=s)*a)-1)+i},easeOutCirc:function(e,a,i,n,s){return n*C(1-(a=a/s-1)*a)+i},easeInOutCirc:function(e,a,i,n,s){return 1>(a/=s/2)?-n/2*(C(1-a*a)-1)+i:n/2*(C(1-(a-=2)*a)+1)+i},easeInElastic:function(e,i,n,o,c){var d=1.70158,r=0,l=o;if(0==i)return n;if(1==(i/=c))return n+o;if(r||(r=.3*c),l<L(o)){l=o;var d=r/4}else var d=r/(2*H)*f(o/l);return-(l*U(2,10*(i-=1))*w((i*c-d)*(2*H)/r))+n},easeOutElastic:function(e,i,n,o,c){var d=1.70158,r=0,l=o;if(0==i)return n;if(1==(i/=c))return n+o;if(r||(r=.3*c),l<L(o)){l=o;var d=r/4}else var d=r/(2*H)*f(o/l);return l*U(2,-10*i)*w((i*c-d)*(2*H)/r)+o+n},easeInOutElastic:function(e,i,n,o,c){var d=1.70158,r=0,l=o;if(0==i)return n;if(2==(i/=c/2))return n+o;if(r||(r=c*(.3*1.5)),l<L(o)){l=o;var d=r/4}else var d=r/(2*H)*f(o/l);return 1>i?-.5*(l*U(2,10*(i-=1))*w((i*c-d)*(2*H)/r))+n:.5*(l*U(2,-10*(i-=1))*w((i*c-d)*(2*H)/r))+o+n},easeInBack:function(e,a,i,n,o,d){return null==d&&(d=1.70158),n*(a/=o)*a*((d+1)*a-d)+i},easeOutBack:function(e,a,i,n,o,d){return null==d&&(d=1.70158),n*((a=a/o-1)*a*((d+1)*a+d)+1)+i},easeInOutBack:function(e,a,i,n,o,d){return null==d&&(d=1.70158),1>(a/=o/2)?n/2*(a*a*(((d*=1.525)+1)*a-d))+i:n/2*((a-=2)*a*(((d*=1.525)+1)*a+d)+2)+i},easeInBounce:function(e,a,t,i,n){return i-h.easing.easeOutBounce(e,n-a,0,i,n)+t},easeOutBounce:function(e,a,i,n,s){return(a/=s)<1/2.75?n*(7.5625*a*a)+i:a<2/2.75?n*(7.5625*(a-=1.5/2.75)*a+.75)+i:a<2.5/2.75?n*(7.5625*(a-=2.25/2.75)*a+.9375)+i:n*(7.5625*(a-=2.625/2.75)*a+.984375)+i},easeInOutBounce:function(e,a,t,i,n){return a<n/2?.5*h.easing.easeInBounce(e,2*a,0,i,n)+t:.5*h.easing.easeOutBounce(e,2*a-n,0,i,n)+.5*i+t}});h.extend(h.easing,{easeInOutMaterial:function(e,a,i,n,s){return 1>(a/=s/2)?n/2*a*a+i:n/4*((a-=2)*a*a+2)+i}});h.Velocity?console.log("Velocity is already loaded. You may be needlessly importing Velocity again; note that Materialize includes Velocity."):(!function(d){function c(i){var e=i.length,t=p.type(i);return!("function"===t||p.isWindow(i))&&(!!(1===i.nodeType&&e)||"array"===t||0===e||"number"==typeof e&&0<e&&e-1 in i)}if(!d.jQuery){var p=function(a,e){return new p.fn.init(a,e)};p.isWindow=function(t){return null!=t&&t==t.window},p.type=function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?t[n.call(a)]||"object":typeof a},p.isArray=Array.isArray||function(t){return"array"===p.type(t)},p.isPlainObject=function(i){if(!i||"object"!==p.type(i)||i.nodeType||p.isWindow(i))return!1;try{if(i.constructor&&!a.call(i,"constructor")&&!a.call(i.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(var e in i);return void 0===e||a.call(i,e)},p.each=function(t,e,d){var a=0,r=t.length,i=c(t),s;if(d){if(i)for(;r>a&&(s=e.apply(t[a],d),!1!==s);a++);else for(a in t)if(s=e.apply(t[a],d),!1===s)break;}else if(i)for(;r>a&&(s=e.call(t[a],a,t[a]),!1!==s);a++);else for(a in t)if(s=e.call(t[a],a,t[a]),!1===s)break;return t},p.data=function(a,e,t){if(void 0===t){var n=a[p.expando],s=n&&r[n];if(void 0===e)return s;if(s&&e in s)return s[e]}else if(void 0!==e){var n=a[p.expando]||(a[p.expando]=++p.uuid);return r[n]=r[n]||{},r[n][e]=t,t}},p.removeData=function(a,e){var t=a[p.expando],i=t&&r[t];i&&p.each(e,function(a,e){delete i[e]})},p.extend=function(){var d=arguments[0]||{},r=1,m=arguments.length,u=!1,g,h,v,A,f,b;for("boolean"==typeof d&&(u=d,d=arguments[r]||{},r++),"object"!=typeof d&&"function"!==p.type(d)&&(d={}),r===m&&(d=this,r--);m>r;r++)if(null!=(f=arguments[r]))for(A in f)g=d[A],v=f[A],d!==v&&(u&&v&&(p.isPlainObject(v)||(h=p.isArray(v)))?(h?(h=!1,b=g&&p.isArray(g)?g:[]):b=g&&p.isPlainObject(g)?g:{},d[A]=p.extend(u,b,v)):void 0!==v&&(d[A]=v));return d},p.queue=function(t,e,s){function n(t,e){var i=e||[];return null!=t&&(c(Object(t))?!function(i,e){for(var t=+e.length,s=0,o=i.length;t>s;)i[o++]=e[s++];if(t!=t)for(;void 0!==e[s];)i[o++]=e[s++];return i.length=o,i}(i,"string"==typeof t?[t]:t):[].push.call(i,t)),i}if(t){e=(e||"fx")+"queue";var o=p.data(t,e);return s?(!o||p.isArray(s)?o=p.data(t,e,n(s)):o.push(s),o):o||[]}},p.dequeue=function(a,i){p.each(a.nodeType?[a]:a,function(t,e){i=i||"fx";var a=p.queue(e,i),n=a.shift();"inprogress"===n&&(n=a.shift()),n&&("fx"===i&&a.unshift("inprogress"),n.call(e,function(){p.dequeue(e,i)}))})},p.fn=p.prototype={init:function(t){if(t.nodeType)return this[0]=t,this;throw new Error("Not a DOM node.")},offset:function(){var e=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:e.top+(d.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:e.left+(d.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function i(){for(var t=this.offsetParent||document;t&&"html"===!t.nodeType.toLowerCase&&"static"===t.style.position;)t=t.offsetParent;return t||document}var s=this[0],i=i.apply(s),t=this.offset(),a=/^(?:body|html)$/i.test(i.nodeName)?{top:0,left:0}:p(i).offset();return t.top-=parseFloat(s.style.marginTop)||0,t.left-=parseFloat(s.style.marginLeft)||0,i.style&&(a.top+=parseFloat(i.style.borderTopWidth)||0,a.left+=parseFloat(i.style.borderLeftWidth)||0),{top:t.top-a.top,left:t.left-a.left}}};var r={};p.expando="velocity"+new Date().getTime(),p.uuid=0;for(var t={},a=t.hasOwnProperty,n=t.toString,e=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],i=0;i<e.length;i++)t["[object "+e[i]+"]"]=e[i].toLowerCase();p.fn.init.prototype=p.fn,d.Velocity={Utilities:p}}}(window),function(t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?t():t()}(function(){return function(C,k,E,T){function e(i){for(var e=-1,s=i?i.length:0,o=[],a;++e<s;)a=i[e],a&&o.push(a);return o}function a(t){return p.isWrapped(t)?t=[].slice.call(t):p.isNode(t)&&(t=[t]),t}function U(a){var e=J.data(a,"velocity");return null===e?T:e}function i(a){return function(e){return M(e*a)*(1/a)}}function n(A,E,I,r){function n(a,e){return 1-3*e+3*a}function o(a,e){return 3*e-6*a}function i(t){return 3*t}function M(a,e,t){return((n(e,t)*a+o(e,t))*a+i(e))*a}function N(a,e,t){return 3*n(e,t)*a*a+2*o(e,t)*a+i(e)}function u(e,t){for(var a=0,s;l>a;++a){if(s=N(t,A,I),0===s)return t;var d=M(t,A,I)-e;t-=d/s}return t}function t(){for(var e=0;h>e;++e)x[e]=M(e*v,A,I)}function c(e,t,a){var d=0,c,l;do l=t+(a-t)/2,c=M(l,A,I)-e,0<c?a=l:t=l;while(L(c)>m&&++d<g);return l}function s(e){for(var t=0,a=1;a!=h-1&&x[a]<=e;++a)t+=v;--a;var o=(e-x[a])/(x[a+1]-x[a]),i=t+o*v,s=N(i,A,I);return s>=p?u(e,i):0==s?i:c(e,t,t+v)}function d(){w=!0,(A!=E||I!=r)&&t()}var l=4,p=.001,m=1e-7,g=10,h=11,v=1/10,f=("Float32Array"in k);if(4!==arguments.length)return!1;for(var b=0;4>b;++b)if("number"!=typeof arguments[b]||isNaN(arguments[b])||!isFinite(arguments[b]))return!1;A=G(A,1),I=G(I,1),A=z(A,0),I=z(I,0);var x=f?new Float32Array(11):Array(11),w=!1,S=function(e){return w||d(),A===E&&I===r?e:0===e?0:1===e?1:M(s(e),E,r)};S.getControlPoints=function(){return[{x:A,y:E},{x:I,y:r}]};var C="generateBezier("+[A,E,I,r]+")";return S.toString=function(){return C},S}function I(a,e){var t=a;return p.isString(a)?Z.Easings[a]||(t=!1):t=p.isArray(a)&&1===a.length?i.apply(null,a):p.isArray(a)&&2===a.length?d.apply(null,a.concat([e])):!!(p.isArray(a)&&4===a.length)&&n.apply(null,a),!1===t&&(t=Z.Easings[Z.defaults.easing]?Z.defaults.easing:o),t}function X(a){if(a){var i=new Date().getTime(),t=Z.State.calls.length;1e4<t&&(Z.State.calls=e(Z.State.calls));for(var n=0;t>n;n++)if(Z.State.calls[n]){var r=Z.State.calls[n],s=r[0],l=r[2],u=r[3],f=!!u,g=null;u||(u=Z.State.calls[n][3]=i-16);for(var b=G((i-u)/l.duration,1),h=0,w=s.length;w>h;h++){var x=s[h],I=x.element;if(U(I)){var M=!1;if(l.display!==T&&null!==l.display&&"none"!==l.display){if("flex"===l.display){J.each(["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"],function(a,e){m.setPropertyValue(I,"display",e)})}m.setPropertyValue(I,"display",l.display)}for(var R in l.visibility!==T&&"hidden"!==l.visibility&&m.setPropertyValue(I,"visibility",l.visibility),x)if("element"!=R){var k=x[R],O=p.isString(k.easing)?Z.Easings[k.easing]:k.easing,j;if(1===b)j=k.endValue;else{var P=k.endValue-k.startValue;if(j=k.startValue+P*O(b,l,P),!f&&j===k.currentValue)continue}if(k.currentValue=j,"tween"===R)g=j;else{if(m.Hooks.registered[R]){var E=m.Hooks.getRoot(R),D=U(I).rootPropertyValueCache[E];D&&(k.rootPropertyValue=D)}var N=m.setPropertyValue(I,R,k.currentValue+(0===parseFloat(j)?"":k.unitType),k.rootPropertyValue,k.scrollData);m.Hooks.registered[R]&&(U(I).rootPropertyValueCache[E]=m.Normalizations.registered[E]?m.Normalizations.registered[E]("extract",null,N[1]):N[1]),"transform"===N[0]&&(M=!0)}}l.mobileHA&&U(I).transformCache.translate3d===T&&(U(I).transformCache.translate3d="(0px, 0px, 0px)",M=!0),M&&m.flushTransformCache(I)}}l.display!==T&&"none"!==l.display&&(Z.State.calls[n][2].display=!1),l.visibility!==T&&"hidden"!==l.visibility&&(Z.State.calls[n][2].visibility=!1),l.progress&&l.progress.call(r[1],r[1],b,z(0,u+l.duration-i),u,g),1===b&&c(n)}}Z.State.isTicking&&S(X)}function c(a,e){if(!Z.State.calls[a])return!1;for(var t=Z.State.calls[a][0],i=Z.State.calls[a][1],n=Z.State.calls[a][2],o=Z.State.calls[a][4],s=!1,r=0,g=t.length,c;g>r;r++){if(c=t[r].element,e||n.loop||("none"===n.display&&m.setPropertyValue(c,"display",n.display),"hidden"===n.visibility&&m.setPropertyValue(c,"visibility",n.visibility)),!0!==n.loop&&(J.queue(c)[1]===T||!/\.velocityQueueEntryFlag/i.test(J.queue(c)[1]))&&U(c)){U(c).isAnimating=!1,U(c).rootPropertyValueCache={};var h=!1;J.each(m.Lists.transforms3D,function(a,e){var t=/^scale/.test(e)?1:0,i=U(c).transformCache[e];U(c).transformCache[e]!==T&&new RegExp("^\\("+t+"[^.]").test(i)&&(h=!0,delete U(c).transformCache[e])}),n.mobileHA&&(h=!0,delete U(c).transformCache.translate3d),h&&m.flushTransformCache(c),m.Values.removeClass(c,"velocity-animating")}if(!e&&n.complete&&!n.loop&&r===g-1)try{n.complete.call(i,i)}catch(e){setTimeout(function(){throw e},1)}o&&!0!==n.loop&&o(i),U(c)&&!0===n.loop&&!e&&(J.each(U(c).tweensContainer,function(a,e){/^rotate/.test(a)&&360===parseFloat(e.endValue)&&(e.endValue=0,e.startValue=360),/^backgroundPosition/.test(a)&&100===parseFloat(e.endValue)&&"%"===e.unitType&&(e.endValue=0,e.startValue=100)}),Z(c,"reverse",{loop:!0,delay:n.delay})),!1!==n.queue&&J.dequeue(c,n.queue)}Z.State.calls[a]=!1;for(var v=0,A=Z.State.calls.length;A>v;v++)if(!1!==Z.State.calls[v]){s=!0;break}!1==s&&(Z.State.isTicking=!1,delete Z.State.calls,Z.State.calls=[])}var N=function(){if(E.documentMode)return E.documentMode;for(var a=7,i;4<a;a--)if(i=E.createElement("div"),i.innerHTML="<!--[if IE "+a+"]><span></span><![endif]-->",i.getElementsByTagName("span").length)return i=null,a;return T}(),t=function(){var i=0;return k.webkitRequestAnimationFrame||k.mozRequestAnimationFrame||function(e){var t=new Date().getTime(),a;return a=z(0,16-(t-i)),i=t+a,setTimeout(function(){e(t+a)},a)}}(),p={isString:function(t){return"string"==typeof t},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)},isNode:function(t){return t&&t.nodeType},isNodeList:function(t){return"object"==typeof t&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(t))&&t.length!==T&&(0===t.length||"object"==typeof t[0]&&0<t[0].nodeType)},isWrapped:function(t){return t&&(t.jquery||k.Zepto&&k.Zepto.zepto.isZ(t))},isSVG:function(t){return k.SVGElement&&t instanceof k.SVGElement},isEmptyObject:function(a){for(var e in a)return!1;return!0}},s=!1,J;if(C.fn&&C.fn.jquery?(J=C,s=!0):J=k.Velocity.Utilities,8>=N&&!s)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(7>=N)return void(h.fn.velocity=h.fn.animate);var o="swing",Z={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:k.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:E.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:J,Redirects:{},Easings:{},Promise:k.Promise,defaults:{queue:"",duration:400,easing:"swing",begin:T,complete:T,progress:T,display:T,visibility:T,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(t){J.data(t,"velocity",{isSVG:p.isSVG(t),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:2,patch:2},debug:!1};k.pageYOffset===T?(Z.State.scrollAnchor=E.documentElement||E.body.parentNode||E.body,Z.State.scrollPropertyLeft="scrollLeft",Z.State.scrollPropertyTop="scrollTop"):(Z.State.scrollAnchor=k,Z.State.scrollPropertyLeft="pageXOffset",Z.State.scrollPropertyTop="pageYOffset");var d=function(){function d(t){return-t.tension*t.x-t.friction*t.v}function e(e,t,i){var a={x:e.x+i.dx*t,v:e.v+i.dv*t,tension:e.tension,friction:e.friction};return{dx:a.v,dv:d(a)}}function m(t,c){var a={dx:t.v,dv:d(t)},n=e(t,.5*c,a),o=e(t,.5*c,n),i=e(t,c,o),s=1/6*(a.dx+2*(n.dx+o.dx)+i.dx),r=1/6*(a.dv+2*(n.dv+o.dv)+i.dv);return t.x+=s*c,t.v+=r*c,t}return function d(a,r,g){var h={x:-1,v:0,tension:null,friction:null},l=[0],u=0,v=1e-4,p=.016,A,f,b;for(a=parseFloat(a)||500,r=parseFloat(r)||20,g=g||null,h.tension=a,h.friction=r,A=null!==g,A?(u=d(a,r),f=u/g*p):f=p;b=m(b||h,f),l.push(1+b.x),u+=16,L(b.x)>v&&L(b.v)>v;);return A?function(t){return l[0|t*(l.length-1)]}:u}}();Z.Easings={linear:function(t){return t},swing:function(t){return .5-V(t*H)/2},spring:function(t){return 1-V(4.5*t*H)*A(6*-t)}},J.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(a,e){Z.Easings[e[0]]=n.apply(null,e[1])});var m=Z.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var d=0,c;d<m.Lists.colors.length;d++)c="color"===m.Lists.colors[d]?"0 0 0 1":"255 255 255 1",m.Hooks.templates[m.Lists.colors[d]]=["Red Green Blue Alpha",c];var l,p,u;if(N)for(l in m.Hooks.templates){p=m.Hooks.templates[l],u=p[0].split(" ");var g=p[1].match(m.RegEx.valueSplit);"Color"===u[0]&&(u.push(u.shift()),g.push(g.shift()),m.Hooks.templates[l]=[u.join(" "),g.join(" ")])}for(l in m.Hooks.templates)for(var d in p=m.Hooks.templates[l],u=p[0].split(" "),u){var o=l+u[d],i=d;m.Hooks.registered[o]=[l,i]}},getRoot:function(a){var e=m.Hooks.registered[a];return e?e[0]:a},cleanRootPropertyValue:function(a,e){return m.RegEx.valueUnwrap.test(e)&&(e=e.match(m.RegEx.valueUnwrap)[1]),m.Values.isCSSNullValue(e)&&(e=m.Hooks.templates[a][1]),e},extractValue:function(i,e){var s=m.Hooks.registered[i];if(s){var o=s[0],a=s[1];return e=m.Hooks.cleanRootPropertyValue(o,e),e.toString().match(m.RegEx.valueSplit)[a]}return e},injectValue:function(d,e,t){var c=m.Hooks.registered[d];if(c){var a=c[0],i=c[1],s,l;return t=m.Hooks.cleanRootPropertyValue(a,t),s=t.toString().match(m.RegEx.valueSplit),s[i]=e,l=s.join(" ")}return t}},Normalizations:{registered:{clip:function(i,e,t){switch(i){case"name":return"clip";case"extract":var n;return m.RegEx.wrappedValueAlreadyExtracted.test(t)?n=t:(n=t.toString().match(m.RegEx.valueUnwrap),n=n?n[1].replace(/,(\s+)?/g," "):t),n;case"inject":return"rect("+t+")";}},blur:function(i,e,t){switch(i){case"name":return Z.State.isFirefox?"filter":"-webkit-filter";case"extract":var s=parseFloat(t);if(!s&&0!==s){var o=t.toString().match(/blur\(([0-9]+[A-z]+)\)/i);s=o?o[1]:0}return s;case"inject":return parseFloat(t)?"blur("+t+")":"none";}},opacity:function(i,e,t){if(8>=N)switch(i){case"name":return"filter";case"extract":var n=t.toString().match(/alpha\(opacity=(.*)\)/i);return t=n?n[1]/100:1;case"inject":return e.style.zoom=1,1<=parseFloat(t)?"":"alpha(opacity="+parseInt(100*parseFloat(t),10)+")";}else switch(i){case"name":return"opacity";case"extract":return t;case"inject":return t;}}},register:function(){9>=N||Z.State.isGingerbread||(m.Lists.transformsBase=m.Lists.transformsBase.concat(m.Lists.transforms3D));for(var a=0;a<m.Lists.transformsBase.length;a++)!function(){var i=m.Lists.transformsBase[a];m.Normalizations.registered[i]=function(t,e,a){switch(t){case"name":return"transform";case"extract":return U(e)===T||U(e).transformCache[i]===T?/^scale/i.test(i)?1:0:U(e).transformCache[i].replace(/[()]/g,"");case"inject":var s=!1;switch(i.substr(0,i.length-1)){case"translate":s=!/(%|px|em|rem|vw|vh|\d)$/i.test(a);break;case"scal":case"scale":Z.State.isAndroid&&U(e).transformCache[i]===T&&1>a&&(a=1),s=!/(\d)$/i.test(a);break;case"skew":s=!/(deg|\d)$/i.test(a);break;case"rotate":s=!/(deg|\d)$/i.test(a);}return s||(U(e).transformCache[i]="("+a+")"),U(e).transformCache[i];}}}();for(var a=0;a<m.Lists.colors.length;a++)!function(){var d=m.Lists.colors[a];m.Normalizations.registered[d]=function(t,e,a){switch(t){case"name":return d;case"extract":var c;if(m.RegEx.wrappedValueAlreadyExtracted.test(a))c=a;else{var r={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"},s;/^[A-z]+$/i.test(a)?s=r[a]===T?r.black:r[a]:m.RegEx.isHex.test(a)?s="rgb("+m.Values.hexToRgb(a).join(" ")+")":/^rgba?\(/i.test(a)||(s=r.black),c=(s||a).toString().match(m.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return 8>=N||3!==c.split(" ").length||(c+=" 1"),c;case"inject":return 8>=N?4===a.split(" ").length&&(a=a.split(/\s+/).slice(0,3).join(" ")):3===a.split(" ").length&&(a+=" 1"),(8>=N?"rgb":"rgba")+"("+a.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")";}}}()}},Names:{camelCase:function(t){return t.replace(/-(\w)/g,function(a,e){return e.toUpperCase()})},SVGAttribute:function(a){var e="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(N||Z.State.isAndroid&&!Z.State.isChrome)&&(e+="|transform"),new RegExp("^("+e+")$","i").test(a)},prefixCheck:function(i){if(Z.State.prefixMatches[i])return[Z.State.prefixMatches[i],!0];for(var e=["","Webkit","Moz","ms","O"],t=0,s=e.length;s>t;t++){var a;if(a=0==t?i:e[t]+i.replace(/^\w/,function(t){return t.toUpperCase()}),p.isString(Z.State.prefixElement.style[a]))return Z.State.prefixMatches[i]=a,[a,!0]}return[i,!1]}},Values:{hexToRgb:function(a){var i;return a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(i,e,t,n){return e+e+t+t+n+n}),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a),i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:[0,0,0]},isCSSNullValue:function(t){return 0==t||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(t)},getUnitType:function(t){return /^(rotate|skew)/i.test(t)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(t)?"":"px"},getDisplayType:function(a){var e=a&&a.tagName.toString().toLowerCase();return /^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(e)?"inline":/^(li)$/i.test(e)?"list-item":/^(tr)$/i.test(e)?"table-row":/^(table)$/i.test(e)?"table":/^(tbody)$/i.test(e)?"table-row-group":"block"},addClass:function(a,e){a.classList?a.classList.add(e):a.className+=(a.className.length?" ":"")+e},removeClass:function(a,e){a.classList?a.classList.remove(e):a.className=a.className.toString().replace(new RegExp("(^|\\s)"+e.split(" ").join("|")+"(\\s|$)","gi")," ")}},getPropertyValue:function(t,e,a,i){function o(t,e){function a(){s&&m.setPropertyValue(t,"display","none")}var n=0;if(8>=N)n=J.css(t,e);else{var s=!1;if(/^(width|height)$/.test(e)&&0===m.getPropertyValue(t,"display")&&(s=!0,m.setPropertyValue(t,"display",m.Values.getDisplayType(t))),!i){if("height"===e&&"border-box"!==m.getPropertyValue(t,"boxSizing").toString().toLowerCase()){var d=t.offsetHeight-(parseFloat(m.getPropertyValue(t,"borderTopWidth"))||0)-(parseFloat(m.getPropertyValue(t,"borderBottomWidth"))||0)-(parseFloat(m.getPropertyValue(t,"paddingTop"))||0)-(parseFloat(m.getPropertyValue(t,"paddingBottom"))||0);return a(),d}if("width"===e&&"border-box"!==m.getPropertyValue(t,"boxSizing").toString().toLowerCase()){var c=t.offsetWidth-(parseFloat(m.getPropertyValue(t,"borderLeftWidth"))||0)-(parseFloat(m.getPropertyValue(t,"borderRightWidth"))||0)-(parseFloat(m.getPropertyValue(t,"paddingLeft"))||0)-(parseFloat(m.getPropertyValue(t,"paddingRight"))||0);return a(),c}}var p;p=U(t)===T?k.getComputedStyle(t,null):U(t).computedStyle?U(t).computedStyle:U(t).computedStyle=k.getComputedStyle(t,null),"borderColor"===e&&(e="borderTopColor"),n=9===N&&"filter"===e?p.getPropertyValue(e):p[e],(""===n||null===n)&&(n=t.style[e]),a()}if("auto"===n&&/^(top|right|bottom|left)$/i.test(e)){var h=o(t,"position");("fixed"===h||"absolute"===h&&/top|left/i.test(e))&&(n=J(t).position()[e]+"px")}return n}var s;if(m.Hooks.registered[e]){var d=e,r=m.Hooks.getRoot(d);a===T&&(a=m.getPropertyValue(t,m.Names.prefixCheck(r)[0])),m.Normalizations.registered[r]&&(a=m.Normalizations.registered[r]("extract",t,a)),s=m.Hooks.extractValue(d,a)}else if(m.Normalizations.registered[e]){var c,u;c=m.Normalizations.registered[e]("name",t),"transform"!==c&&(u=o(t,m.Names.prefixCheck(c)[0]),m.Values.isCSSNullValue(u)&&m.Hooks.templates[e]&&(u=m.Hooks.templates[e][1])),s=m.Normalizations.registered[e]("extract",t,u)}if(!/^[\d-]/.test(s))if(!(U(t)&&U(t).isSVG&&m.Names.SVGAttribute(e)))s=o(t,m.Names.prefixCheck(e)[0]);else if(/^(height|width)$/i.test(e))try{s=t.getBBox()[e]}catch(e){s=0}else s=t.getAttribute(e);return m.Values.isCSSNullValue(s)&&(s=0),2<=Z.debug&&console.log("Get "+e+": "+s),s},setPropertyValue:function(t,e,i,d,c){var o=e;if("scroll"===e)c.container?c.container["scroll"+c.direction]=i:"Left"===c.direction?k.scrollTo(i,c.alternateValue):k.scrollTo(c.alternateValue,i);else if(m.Normalizations.registered[e]&&"transform"===m.Normalizations.registered[e]("name",t))m.Normalizations.registered[e]("inject",t,i),o="transform",i=U(t).transformCache[e];else{if(m.Hooks.registered[e]){var p=e,l=m.Hooks.getRoot(e);d=d||m.getPropertyValue(t,l),i=m.Hooks.injectValue(p,i,d),e=l}if(m.Normalizations.registered[e]&&(i=m.Normalizations.registered[e]("inject",t,i),e=m.Normalizations.registered[e]("name",t)),o=m.Names.prefixCheck(e)[0],8>=N)try{t.style[o]=i}catch(e){Z.debug&&console.log("Browser does not support ["+i+"] for ["+o+"]")}else U(t)&&U(t).isSVG&&m.Names.SVGAttribute(e)?t.setAttribute(e,i):t.style[o]=i;2<=Z.debug&&console.log("Set "+e+" ("+o+"): "+i)}return[o,i]},flushTransformCache:function(i){function e(e){return parseFloat(m.getPropertyValue(i,e))}var s="";if((N||Z.State.isAndroid&&!Z.State.isChrome)&&U(i).isSVG){var t={translate:[e("translateX"),e("translateY")],skewX:[e("skewX")],skewY:[e("skewY")],scale:1===e("scale")?[e("scaleX"),e("scaleY")]:[e("scale"),e("scale")],rotate:[e("rotateZ"),0,0]};J.each(U(i).transformCache,function(a){/^translate/i.test(a)?a="translate":/^scale/i.test(a)?a="scale":/^rotate/i.test(a)&&(a="rotate"),t[a]&&(s+=a+"("+t[a].join(" ")+") ",delete t[a])})}else{var a,d;J.each(U(i).transformCache,function(e){return a=U(i).transformCache[e],"transformPerspective"===e?(d=a,!0):(9===N&&"rotateZ"==e&&(e="rotate"),void(s+=e+a+" "))}),d&&(s="perspective"+d+" "+s)}m.setPropertyValue(i,"transform",s)}};m.Hooks.register(),m.Normalizations.register(),Z.hook=function(i,d,t){var c=T;return i=a(i),J.each(i,function(a,e){if(U(e)===T&&Z.init(e),t===T)c===T&&(c=Z.CSS.getPropertyValue(e,d));else{var i=Z.CSS.setPropertyValue(e,d,t);"transform"===i[0]&&Z.CSS.flushTransformCache(e),c=i}}),c};var r=function(){function t(){return n?K.promise||null:o}function i(){function a(){function a(a,e){var t=T,s=T,d=T;return p.isArray(a)?(t=a[0],!p.isArray(a[1])&&/^[\d-]/.test(a[1])||p.isFunction(a[1])||m.RegEx.isHex.test(a[1])?d=a[1]:(p.isString(a[1])&&!m.RegEx.isHex.test(a[1])||p.isArray(a[1]))&&(s=e?a[1]:I(a[1],o.duration),a[2]!==T&&(d=a[2]))):t=a,e||(s=s||o.easing),p.isFunction(t)&&(t=t.call(c,w,x)),p.isFunction(d)&&(d=d.call(c,w,x)),[t||0,s,d]}function i(i,e){var t,n;return n=(e||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(a){return t=a,""}),t||(t=m.Values.getUnitType(i)),[n,t]}function n(){var t={myParent:c.parentNode||E.body,position:m.getPropertyValue(c,"position"),fontSize:m.getPropertyValue(c,"fontSize")},e=t.position===N.lastPosition&&t.myParent===N.lastParent,a=t.fontSize===N.lastFontSize;N.lastParent=t.myParent,N.lastPosition=t.position,N.lastFontSize=t.fontSize;var i={};if(a&&e)i.emToPx=N.lastEmToPx,i.percentToPxWidth=N.lastPercentToPxWidth,i.percentToPxHeight=N.lastPercentToPxHeight;else{var n=U(c).isSVG?E.createElementNS("http://www.w3.org/2000/svg","rect"):E.createElement("div");Z.init(n),t.myParent.appendChild(n),J.each(["overflow","overflowX","overflowY"],function(a,e){Z.CSS.setPropertyValue(n,e,"hidden")}),Z.CSS.setPropertyValue(n,"position",t.position),Z.CSS.setPropertyValue(n,"fontSize",t.fontSize),Z.CSS.setPropertyValue(n,"boxSizing","content-box"),J.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(a,e){Z.CSS.setPropertyValue(n,e,"100%")}),Z.CSS.setPropertyValue(n,"paddingLeft","100em"),i.percentToPxWidth=N.lastPercentToPxWidth=(parseFloat(m.getPropertyValue(n,"width",null,!0))||1)/100,i.percentToPxHeight=N.lastPercentToPxHeight=(parseFloat(m.getPropertyValue(n,"height",null,!0))||1)/100,i.emToPx=N.lastEmToPx=(parseFloat(m.getPropertyValue(n,"paddingLeft"))||1)/100,t.myParent.removeChild(n)}return null===N.remToPx&&(N.remToPx=parseFloat(m.getPropertyValue(E.body,"fontSize"))||16),null===N.vwToPx&&(N.vwToPx=parseFloat(k.innerWidth)/100,N.vhToPx=parseFloat(k.innerHeight)/100),i.remToPx=N.remToPx,i.vwToPx=N.vwToPx,i.vhToPx=N.vhToPx,1<=Z.debug&&console.log("Unit ratios: "+JSON.stringify(i),c),i}if(o.begin&&0==w)try{o.begin.call(f,f)}catch(e){setTimeout(function(){throw e},1)}if("scroll"===ee){var s=/^x$/i.test(o.axis)?"Left":"Top",d=parseFloat(o.offset)||0,r,l,u;o.container?p.isWrapped(o.container)||p.isNode(o.container)?(o.container=o.container[0]||o.container,r=o.container["scroll"+s],u=r+J(c).position()[s.toLowerCase()]+d):o.container=null:(r=Z.State.scrollAnchor[Z.State["scrollProperty"+s]],l=Z.State.scrollAnchor[Z.State["scrollProperty"+("Left"===s?"Top":"Left")]],u=J(c).offset()[s.toLowerCase()]+d),e={scroll:{rootPropertyValue:!1,startValue:r,currentValue:r,endValue:u,unitType:"",easing:o.easing,scrollData:{container:o.container,direction:s,alternateValue:l}},element:c},Z.debug&&console.log("tweensContainer (scroll): ",e.scroll,c)}else if("reverse"===ee){if(!U(c).tweensContainer)return void J.dequeue(c,o.queue);"none"===U(c).opts.display&&(U(c).opts.display="auto"),"hidden"===U(c).opts.visibility&&(U(c).opts.visibility="visible"),U(c).opts.loop=!1,U(c).opts.begin=null,U(c).opts.complete=null,h.easing||delete o.easing,h.duration||delete o.duration,o=J.extend({},U(c).opts,o);var g=J.extend(!0,{},U(c).tweensContainer);for(var v in g)if("element"!=v){var A=g[v].startValue;g[v].startValue=g[v].currentValue=g[v].endValue,g[v].endValue=A,p.isEmptyObject(h)||(g[v].easing=o.easing),Z.debug&&console.log("reverse tweensContainer ("+v+"): "+JSON.stringify(g[v]),c)}e=g}else if("start"===ee){var g;for(var S in U(c).tweensContainer&&!0===U(c).isAnimating&&(g=U(c).tweensContainer),J.each(b,function(d,e){if(RegExp("^"+m.Lists.colors.join("$|^")+"$").test(d)){var t=a(e,!0),r=t[0],n=t[1],o=t[2];if(m.RegEx.isHex.test(r)){for(var i=["Red","Green","Blue"],s=m.Values.hexToRgb(r),l=o?m.Values.hexToRgb(o):T,p=0,u;p<i.length;p++)u=[s[p]],n&&u.push(n),l!==T&&u.push(l[p]),b[d+i[p]]=u;delete b[d]}}}),b){var R=a(b[S]),O=R[0],j=R[1],V=R[2];S=m.Names.camelCase(S);var H=m.Hooks.getRoot(S),F=!1;if(U(c).isSVG||"tween"===H||!1!==m.Names.prefixCheck(H)[1]||m.Normalizations.registered[H]!==T){(o.display!==T&&null!==o.display&&"none"!==o.display||o.visibility!==T&&"hidden"!==o.visibility)&&/opacity|filter/.test(S)&&!V&&0!==O&&(V=0),o._cacheValues&&g&&g[S]?(V===T&&(V=g[S].endValue+g[S].unitType),F=U(c).rootPropertyValueCache[H]):m.Hooks.registered[S]?V===T?(F=m.getPropertyValue(c,H),V=m.getPropertyValue(c,S,F)):F=m.Hooks.templates[H][1]:V===T&&(V=m.getPropertyValue(c,S));var te=!1,ae,ie,ne;if(ae=i(S,V),V=ae[0],ne=ae[1],ae=i(S,O),O=ae[0].replace(/^([+-\/*])=/,function(a,e){return te=e,""}),ie=ae[1],V=parseFloat(V)||0,O=parseFloat(O)||0,"%"===ie&&(/^(fontSize|lineHeight)$/.test(S)?(O/=100,ie="em"):/^scale/.test(S)?(O/=100,ie=""):/(Red|Green|Blue)$/i.test(S)&&(O=255*(O/100),ie="")),/[\/*]/.test(te))ie=ne;else if(ne!==ie&&0!==V)if(0===O)ie=ne;else{t=t||n();var se=/margin|padding|left|right|width|text|word|letter/i.test(S)||/X$/.test(S)||"x"===S?"x":"y";switch(ne){case"%":V*="x"===se?t.percentToPxWidth:t.percentToPxHeight;break;case"px":break;default:V*=t[ne+"ToPx"];}switch(ie){case"%":V*=1/("x"===se?t.percentToPxWidth:t.percentToPxHeight);break;case"px":break;default:V*=1/t[ie+"ToPx"];}}"+"===te?O=V+O:"-"===te?O=V-O:"*"===te?O=V*O:"/"===te?O=V/O:void 0,e[S]={rootPropertyValue:F,startValue:V,currentValue:V,endValue:O,unitType:ie,easing:j},Z.debug&&console.log("tweensContainer ("+S+"): "+JSON.stringify(e[S]),c)}else Z.debug&&console.log("Skipping ["+H+"] due to a lack of browser support.")}e.element=c}e.element&&(m.Values.addClass(c,"velocity-animating"),L.push(e),""===o.queue&&(U(c).tweensContainer=e,U(c).opts=o),U(c).isAnimating=!0,w==x-1?(Z.State.calls.push([L,f,o,null,K.resolver]),!1===Z.State.isTicking&&(Z.State.isTicking=!0,X())):w++)}var c=this,o=J.extend({},Z.defaults,h),e={},t;switch(U(c)===T&&Z.init(c),parseFloat(o.delay)&&!1!==o.queue&&J.queue(c,o.queue,function(t){Z.velocityQueueEntryFlag=!0,U(c).delayTimer={setTimeout:setTimeout(t,parseFloat(o.delay)),next:t}}),o.duration.toString().toLowerCase()){case"fast":o.duration=200;break;case"normal":o.duration=400;break;case"slow":o.duration=600;break;default:o.duration=parseFloat(o.duration)||1;}!1!==Z.mock&&(!0===Z.mock?o.duration=o.delay=1:(o.duration*=parseFloat(Z.mock)||1,o.delay*=parseFloat(Z.mock)||1)),o.easing=I(o.easing,o.duration),o.begin&&!p.isFunction(o.begin)&&(o.begin=null),o.progress&&!p.isFunction(o.progress)&&(o.progress=null),o.complete&&!p.isFunction(o.complete)&&(o.complete=null),o.display!==T&&null!==o.display&&(o.display=o.display.toString().toLowerCase(),"auto"===o.display&&(o.display=Z.CSS.Values.getDisplayType(c))),o.visibility!==T&&null!==o.visibility&&(o.visibility=o.visibility.toString().toLowerCase()),o.mobileHA=o.mobileHA&&Z.State.isMobile&&!Z.State.isGingerbread,!1===o.queue?o.delay?setTimeout(a,o.delay):a():J.queue(c,o.queue,function(e,t){return!0===t?(K.promise&&K.resolver(f),!0):(Z.velocityQueueEntryFlag=!0,void a(e))}),""!==o.queue&&"fx"!==o.queue||"inprogress"===J.queue(c)[0]||J.dequeue(c)}var e=arguments[0]&&(arguments[0].p||J.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||p.isString(arguments[0].properties)),n,o,u,f,b,h;if(p.isWrapped(this)?(n=!1,u=0,f=this,o=this):(n=!0,u=1,f=e?arguments[0].elements||arguments[0].e:arguments[0]),f=a(f)){e?(b=arguments[0].properties||arguments[0].p,h=arguments[0].options||arguments[0].o):(b=arguments[u],h=arguments[u+1]);var x=f.length,w=0;if(!/^(stop|finish)$/i.test(b)&&!J.isPlainObject(h)){var S=u+1;h={};for(var C=S;C<arguments.length;C++)!p.isArray(arguments[C])&&(/^(fast|normal|slow)$/i.test(arguments[C])||/^\d/.test(arguments[C]))?h.duration=arguments[C]:p.isString(arguments[C])||p.isArray(arguments[C])?h.easing=arguments[C]:p.isFunction(arguments[C])&&(h.complete=arguments[C])}var K={promise:null,resolver:null,rejecter:null};n&&Z.Promise&&(K.promise=new Z.Promise(function(a,e){K.resolver=a,K.rejecter=e}));var ee;switch(b){case"scroll":ee="scroll";break;case"reverse":ee="reverse";break;case"finish":case"stop":J.each(f,function(a,e){U(e)&&U(e).delayTimer&&(clearTimeout(U(e).delayTimer.setTimeout),U(e).delayTimer.next&&U(e).delayTimer.next(),delete U(e).delayTimer)});var M=[];return J.each(Z.State.calls,function(i,e){e&&J.each(e[1],function(t,s){var n=h===T?"":h;return!0!==n&&e[2].queue!==n&&(h!==T||!1!==e[2].queue)||void J.each(f,function(t,o){o===s&&((!0===h||p.isString(h))&&(J.each(J.queue(o,p.isString(h)?h:""),function(a,e){p.isFunction(e)&&e(null,!0)}),J.queue(o,p.isString(h)?h:"",[])),"stop"===b?(U(o)&&U(o).tweensContainer&&!1!==n&&J.each(U(o).tweensContainer,function(a,e){e.endValue=e.currentValue}),M.push(i)):"finish"===b&&(e[2].duration=1))})})}),"stop"===b&&(J.each(M,function(a,e){c(e,!0)}),K.promise&&K.resolver(f)),t();default:if(!J.isPlainObject(b)||p.isEmptyObject(b)){if(p.isString(b)&&Z.Redirects[b]){var P=J.extend({},h),D=P.duration,B=P.delay||0;return!0===P.backwards&&(f=J.extend(!0,[],f).reverse()),J.each(f,function(a,e){parseFloat(P.stagger)?P.delay=B+parseFloat(P.stagger)*a:p.isFunction(P.stagger)&&(P.delay=B+P.stagger.call(e,a,x)),P.drag&&(P.duration=parseFloat(D)||(/^(callout|transition)/.test(b)?1e3:400),P.duration=z(P.duration*(P.backwards?1-a/x:(a+1)/x),.75*P.duration,200)),Z.Redirects[b].call(e,e,P||{},a,x,f,K.promise?K:T)}),t()}var H="Velocity: First argument ("+b+") was not a property map, a known action, or a registered redirect. Aborting.";return K.promise?K.rejecter(new Error(H)):console.log(H),t()}ee="start";}var N={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},L=[];J.each(f,function(a,e){p.isNode(e)&&i.call(e)});var P=J.extend({},Z.defaults,h),R;if(P.loop=parseInt(P.loop),R=2*P.loop-1,P.loop)for(var F=0,G;R>F;F++)G={delay:P.delay,progress:P.progress},F==R-1&&(G.display=P.display,G.visibility=P.visibility,G.complete=P.complete),r(f,"reverse",G);return t()}};Z=J.extend(r,Z),Z.animate=r;var S=k.requestAnimationFrame||t;return Z.State.isMobile||E.hidden===T||E.addEventListener("visibilitychange",function(){E.hidden?(S=function(t){return setTimeout(function(){t(!0)},16)},X()):S=k.requestAnimationFrame||t}),C.Velocity=Z,C!==k&&(C.fn.velocity=r,C.fn.velocity.defaults=Z.defaults),J.each(["Down","Up"],function(a,m){Z.Redirects["slide"+m]=function(g,e,t,a,n,i){var s=J.extend({},e),o=s.begin,r=s.complete,c={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},l={};s.display===T&&(s.display="Down"===m?"inline"===Z.CSS.Values.getDisplayType(g)?"inline-block":"block":"none"),s.begin=function(){for(var e in o&&o.call(n,n),c){l[e]=g.style[e];var t=Z.CSS.getPropertyValue(g,e);c[e]="Down"===m?[t,0]:[0,t]}l.overflow=g.style.overflow,g.style.overflow="hidden"},s.complete=function(){for(var e in l)g.style[e]=l[e];r&&r.call(n,n),i&&i.resolver(n)},Z(g,c,s)}}),J.each(["In","Out"],function(a,d){Z.Redirects["fade"+d]=function(t,e,a,n,o,i){var s=J.extend({},e),r={opacity:"In"===d?1:0},l=s.complete;s.complete=a===n-1?function(){l&&l.call(o,o),i&&i.resolver(o)}:s.begin=null,s.display===T&&(s.display="In"===d?"auto":"none"),Z(this,r,s)}}),Z}(window.jQuery||window.Zepto||window,window,document)}));!function(F,Y,a,X){"use strict";function J(e,t,a){return setTimeout(p(e,a),t)}function d(e,t,a){return!!Array.isArray(e)&&(l(e,a[t],a),!0)}function l(t,a,i){if(t)if(t.forEach)t.forEach(a,i);else if(t.length!==X)for(n=0;n<t.length;)a.call(i,t[n],n,t),n++;else for(var n in t)t.hasOwnProperty(n)&&a.call(i,t[n],n,t)}function m(t,a,i){for(var n=Object.keys(a),e=0;e<n.length;)(!i||i&&t[n[e]]===X)&&(t[n[e]]=a[n[e]]),e++;return t}function n(e,t){return m(e,t,!0)}function o(t,a,i){var n=a.prototype,s;s=t.prototype=Object.create(n),s.constructor=t,s._super=n,i&&m(s,i)}function p(e,t){return function(){return e.apply(t,arguments)}}function k(e,t){return typeof e==f?e.apply(t?t[0]||X:X,t):e}function c(e,t){return e===X?t:e}function s(e,t,a){l(v(t),function(t){e.addEventListener(t,a,!1)})}function t(e,t,a){l(v(t),function(t){e.removeEventListener(t,a,!1)})}function r(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function u(e,t){return-1<e.indexOf(t)}function v(e){return e.trim().split(/\s+/g)}function x(e,t,a){if(e.indexOf&&!a)return e.indexOf(t);for(var i=0;i<e.length;){if(a&&e[i][a]==t||!a&&e[i]===t)return i;i++}return-1}function w(e){return Array.prototype.slice.call(e,0)}function q(t,i,a){for(var n=[],s=[],e=0,o;e<t.length;)o=i?t[e][i]:t[e],0>x(s,o)&&n.push(t[e]),s[e]=o,e++;return a&&(n=i?n.sort(function(e,t){return e[i]>t[i]}):n.sort()),n}function A(e,t){for(var a=t[0].toUpperCase()+t.slice(1),i=0,n,s;i<Oe.length;){if(n=Oe[i],s=n?n+a:t,s in e)return s;i++}return X}function b(){return i++}function D(e){var t=e.ownerDocument;return t.defaultView||t.parentWindow}function E(e,t){var a=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){k(e.options.enable,[e])&&a.handler(t)},this.init()}function B(e){var t=e.options.inputClass,a;return a=t?t:G?le:Pe?me:j?he:re,new a(e,z)}function z(t,a,i){var n=i.pointers.length,s=i.changedPointers.length,e=a&N&&0==n-s;i.isFirst=!!e,i.isFinal=!!(a&(P|Q)&&0==n-s),e&&(t.session={}),i.eventType=a,Z(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function Z(t,a){var n=t.session,s=a.pointers,o=s.length;n.firstInput||(n.firstInput=te(a)),1<o&&!n.firstMultiple?n.firstMultiple=te(a):1===o&&(n.firstMultiple=!1);var e=n.firstInput,d=n.firstMultiple,c=d?d.center:e.center,l=a.center=ae(s);a.timeStamp=je(),a.deltaTime=a.timeStamp-e.timeStamp,a.angle=oe(c,l),a.distance=se(c,l),K(n,a),a.offsetDirection=ne(a.deltaX,a.deltaY),a.scale=d?ce(d.pointers,s):1,a.rotation=d?de(d.pointers,s):0,ee(n,a);var i=t.element;r(a.srcEvent.target,i)&&(i=a.srcEvent.target),a.target=i}function K(t,a){var i=a.center,n=t.offsetDelta||{},s=t.prevDelta||{},o=t.prevInput||{};(a.eventType===N||o.eventType===P)&&(s=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),a.deltaX=s.x+(i.x-n.x),a.deltaY=s.y+(i.y-n.y)}function ee(t,a){var i=t.lastInterval||a,n=a.timeStamp-i.timeStamp,e,s,o,d;if(a.eventType!=Q&&(n>I||i.velocity===X)){var c=i.deltaX-a.deltaX,r=i.deltaY-a.deltaY,l=ie(n,c,r);s=l.x,o=l.y,e=h(l.x)>h(l.y)?l.x:l.y,d=ne(c,r),t.lastInterval=a}else e=i.velocity,s=i.velocityX,o=i.velocityY,d=i.direction;a.velocity=e,a.velocityX=s,a.velocityY=o,a.direction=d}function te(e){for(var t=[],a=0;a<e.pointers.length;)t[a]={clientX:g(e.pointers[a].clientX),clientY:g(e.pointers[a].clientY)},a++;return{timeStamp:je(),pointers:t,center:ae(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ae(t){var a=t.length;if(1===a)return{x:g(t[0].clientX),y:g(t[0].clientY)};for(var i=0,n=0,s=0;a>s;)i+=t[s].clientX,n+=t[s].clientY,s++;return{x:g(i/a),y:g(n/a)}}function ie(e,t,a){return{x:t/e||0,y:a/e||0}}function ne(e,t){return e===t?R:h(e)>=h(t)?0<e?S:T:0<t?U:V}function se(t,a,i){i||(i=W);var n=a[i[0]]-t[i[0]],s=a[i[1]]-t[i[1]];return C(n*n+s*s)}function oe(t,a,i){i||(i=W);var n=a[i[0]]-t[i[0]],s=a[i[1]]-t[i[1]];return 180*Math.atan2(s,n)/H}function de(e,t){return oe(t[1],t[0],De)-oe(e[1],e[0],De)}function ce(e,t){return se(t[0],t[1],De)/se(e[0],e[1],De)}function re(){this.evEl=Le,this.evWin=$e,this.allow=!0,this.pressed=!1,E.apply(this,arguments)}function le(){this.evEl=qe,this.evWin=Fe,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function pe(){this.evTarget=Ge,this.evWin=ze,this.started=!1,E.apply(this,arguments)}function ue(e,t){var a=w(e.touches),i=w(e.changedTouches);return t&(P|Q)&&(a=q(a.concat(i),"identifier",!0)),[a,i]}function me(){this.evTarget=We,this.targetIds={},E.apply(this,arguments)}function ge(t,a){var n=w(t.touches),s=this.targetIds;if(a&(N|O)&&1===n.length)return s[n[0].identifier]=!0,[n,n];var o=w(t.changedTouches),d=[],c=this.target,i,l;if(l=n.filter(function(e){return r(e.target,c)}),a===N)for(i=0;i<l.length;)s[l[i].identifier]=!0,i++;for(i=0;i<o.length;)s[o[i].identifier]&&d.push(o[i]),a&(P|Q)&&delete s[o[i].identifier],i++;return d.length?[q(l.concat(d),"identifier",!0),d]:void 0}function he(){E.apply(this,arguments);var e=p(this.handler,this);this.touch=new me(this.manager,e),this.mouse=new re(this.manager,e)}function ve(e,t){this.manager=e,this.set(t)}function Ae(e){if(u(e,Ke))return Ke;var t=u(e,et),a=u(e,tt);return t&&a?et+" "+tt:t||a?t?et:tt:u(e,Ze)?Ze:Je}function fe(e){this.id=b(),this.manager=null,this.options=n(e||{},this.defaults),this.options.enable=c(this.options.enable,!0),this.state=at,this.simultaneous={},this.requireFail=[]}function _e(e){return e&ot?"cancel":e&st?"end":e&nt?"move":e&it?"start":""}function be(e){return e==V?"down":e==U?"up":e==S?"left":e==T?"right":""}function ye(e,t){var a=t.manager;return a?a.get(e):e}function xe(){fe.apply(this,arguments)}function we(){xe.apply(this,arguments),this.pX=null,this.pY=null}function Ce(){xe.apply(this,arguments)}function Se(){fe.apply(this,arguments),this._timer=null,this._input=null}function ke(){xe.apply(this,arguments)}function Ee(){xe.apply(this,arguments)}function Te(){fe.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ie(e,t){return t=t||{},t.recognizers=c(t.recognizers,Ie.defaults.preset),new Me(e,t)}function Me(e,t){t=t||{},this.options=n(t,Ie.defaults),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.element=e,this.input=B(this),this.touchAction=new ve(this,this.options.touchAction),Ne(this,!0),l(t.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function Ne(e,t){var i=e.element;l(e.options.cssProps,function(e,a){i.style[A(i.style,a)]=t?e:""})}function Re(e,t){var a=Y.createEvent("Event");a.initEvent(e,!0,!0),a.gesture=t,t.target.dispatchEvent(a)}var Oe=["","webkit","moz","MS","ms","o"],e=Y.createElement("div"),f="function",g=M,h=L,je=Date.now,i=1,j=("ontouchstart"in F),G=A(F,"PointerEvent")!==X,Pe=j&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),I=25,N=1,O=2,P=4,Q=8,R=1,S=2,T=4,U=8,V=16,W=["x","y"],De=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&s(this.element,this.evEl,this.domHandler),this.evTarget&&s(this.target,this.evTarget,this.domHandler),this.evWin&&s(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&t(this.element,this.evEl,this.domHandler),this.evTarget&&t(this.target,this.evTarget,this.domHandler),this.evWin&&t(D(this.element),this.evWin,this.domHandler)}};var Be={mousedown:1,mousemove:2,mouseup:4},Le="mousedown",$e="mousemove mouseup";o(re,E,{handler:function(e){var t=Be[e.type];t&1&&0===e.button&&(this.pressed=!0),t&2&&1!==e.which&&(t=4),this.pressed&&this.allow&&(t&4&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var Ve={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},He={2:"touch",3:"pen",4:"mouse",5:"kinect"},qe="pointerdown",Fe="pointermove pointerup pointercancel";F.MSPointerEvent&&(qe="MSPointerDown",Fe="MSPointerMove MSPointerUp MSPointerCancel"),o(le,E,{handler:function(t){var a=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),s=Ve[n],e=He[t.pointerType]||t.pointerType,o=x(a,t.pointerId,"pointerId");s&1&&(0===t.button||e=="touch")?0>o&&(a.push(t),o=a.length-1):s&12&&(i=!0),0>o||(a[o]=t,this.callback(this.manager,s,{pointers:a,changedPointers:[t],pointerType:e,srcEvent:t}),i&&a.splice(o,1))}});var Ue={touchstart:1,touchmove:2,touchend:4,touchcancel:8},Ge="touchstart",ze="touchstart touchmove touchend touchcancel";o(pe,E,{handler:function(e){var t=Ue[e.type];if(t===1&&(this.started=!0),this.started){var a=ue.call(this,e,t);t&12&&0==a[0].length-a[1].length&&(this.started=!1),this.callback(this.manager,t,{pointers:a[0],changedPointers:a[1],pointerType:"touch",srcEvent:e})}}});var Ye={touchstart:1,touchmove:2,touchend:4,touchcancel:8},We="touchstart touchmove touchend touchcancel";o(me,E,{handler:function(e){var t=Ye[e.type],a=ge.call(this,e,t);a&&this.callback(this.manager,t,{pointers:a[0],changedPointers:a[1],pointerType:"touch",srcEvent:e})}}),o(he,E,{handler:function(t,a,i){var n=i.pointerType=="touch",s=i.pointerType=="mouse";if(n)this.mouse.allow=!1;else if(s&&!this.mouse.allow)return;a&12&&(this.mouse.allow=!0),this.callback(t,a,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Qe=A(e.style,"touchAction"),Xe=Qe!==X,Je="auto",Ze="manipulation",Ke="none",et="pan-x",tt="pan-y";ve.prototype={set:function(e){e=="compute"&&(e=this.compute()),Xe&&(this.manager.element.style[Qe]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return l(this.manager.recognizers,function(t){k(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),Ae(e.join(" "))},preventDefaults:function(t){if(!Xe){var a=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return a.preventDefault(),void 0;var n=this.actions,s=u(n,"none"),e=u(n,"pan-y"),o=u(n,"pan-x");return s||e&&i&6||o&&i&24?this.preventSrc(a):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var at=1,it=2,nt=4,st=8,ot=16;fe.prototype={defaults:{},set:function(e){return m(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(d(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=ye(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return d(e,"dropRecognizeWith",this)?this:(e=ye(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(d(e,"requireFailure",this))return this;var t=this.requireFail;return e=ye(e,this),-1===x(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(d(e,"dropRequireFailure",this))return this;e=ye(e,this);var t=x(this.requireFail,e);return-1<t&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){a.manager.emit(a.options.event+(t?_e(i):""),e)}var a=this,i=this.state;8>i&&t(!0),t(),i>=8&&t(!0)},tryEmit:function(e){return this.canEmit()?this.emit(e):(this.state=32,void 0)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&33))return!1;e++}return!0},recognize:function(e){var t=m({},e);return k(this.options.enable,[this,t])?(this.state&56&&(this.state=1),this.state=this.process(t),this.state&30&&this.tryEmit(t),void 0):(this.reset(),this.state=32,void 0)},process:function(){},getTouchAction:function(){},reset:function(){}},o(xe,fe,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(t){var a=this.state,i=t.eventType,n=a&6,s=this.attrTest(t);return n&&(i&8||!s)?a|16:n||s?i&4?a|8:a&2?a|4:2:32}}),o(we,xe,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return e&6&&t.push("pan-y"),e&24&&t.push("pan-x"),t},directionTest:function(t){var a=this.options,i=!0,n=t.distance,s=t.direction,o=t.deltaX,r=t.deltaY;return s&a.direction||(a.direction&6?(s=0===o?1:0>o?2:4,i=o!=this.pX,n=L(t.deltaX)):(s=0===r?1:0>r?8:16,i=r!=this.pY,n=L(t.deltaY))),t.direction=s,i&&n>a.threshold&&s&a.direction},attrTest:function(e){return xe.prototype.attrTest.call(this,e)&&(this.state&2||!(this.state&2)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=be(e.direction);t&&this.manager.emit(this.options.event+t,e),this._super.emit.call(this,e)}}),o(Ce,xe,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(L(e.scale-1)>this.options.threshold||this.state&2)},emit:function(e){if(this._super.emit.call(this,e),1!==e.scale){var t=1>e.scale?"in":"out";this.manager.emit(this.options.event+t,e)}}}),o(Se,fe,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(t){var a=this.options,i=t.pointers.length===a.pointers,n=t.distance<a.threshold,s=t.deltaTime>a.time;if(this._input=t,!n||!i||t.eventType&12&&!s)this.reset();else if(t.eventType&1)this.reset(),this._timer=J(function(){this.state=8,this.tryEmit()},a.time,this);else if(t.eventType&4)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===8&&(e&&e.eventType&4?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=je(),this.manager.emit(this.options.event,this._input)))}}),o(ke,xe,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(L(e.rotation)>this.options.threshold||this.state&2)}}),o(Ee,xe,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:30,pointers:1},getTouchAction:function(){return we.prototype.getTouchAction.call(this)},attrTest:function(e){var t=this.options.direction,a;return t&30?a=e.velocity:t&6?a=e.velocityX:t&24&&(a=e.velocityY),this._super.attrTest.call(this,e)&&t&e.direction&&e.distance>this.options.threshold&&h(a)>this.options.velocity&&e.eventType&4},emit:function(e){var t=be(e.direction);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),o(Te,fe,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(t){var a=this.options,i=t.pointers.length===a.pointers,n=t.distance<a.threshold,s=t.deltaTime<a.time;if(this.reset(),t.eventType&1&&0===this.count)return this.failTimeout();if(n&&s&&i){if(4!=t.eventType)return this.failTimeout();var e=!this.pTime||t.timeStamp-this.pTime<a.interval,o=!this.pCenter||se(this.pCenter,t.center)<a.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,o&&e?this.count+=1:this.count=1,this._input=t;var d=this.count%a.taps;if(0==d)return this.hasRequireFailures()?(this._timer=J(function(){this.state=8,this.tryEmit()},a.interval,this),2):8}return 32},failTimeout:function(){return this._timer=J(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==8&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ie.VERSION="2.0.4",Ie.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[ke,{enable:!1}],[Ce,{enable:!1},["rotate"]],[Ee,{direction:6}],[we,{direction:6},["swipe"]],[Te],[Te,{event:"doubletap",taps:2},["tap"]],[Se]],cssProps:{userSelect:"default",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};Me.prototype={set:function(e){return m(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(t){var a=this.session;if(!a.stopped){this.touchAction.preventDefaults(t);var i=this.recognizers,n=a.curRecognizer,s;(!n||n&&n.state&8)&&(n=a.curRecognizer=null);for(var o=0;o<i.length;)s=i[o],a.stopped===2||n&&s!=n&&!s.canRecognizeWith(n)?s.reset():s.recognize(t),!n&&s.state&14&&(n=a.curRecognizer=s),o++}},get:function(e){if(e instanceof fe)return e;for(var t=this.recognizers,a=0;a<t.length;a++)if(t[a].options.event==e)return t[a];return null},add:function(e){if(d(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(d(e,"remove",this))return this;var t=this.recognizers;return e=this.get(e),t.splice(x(t,e),1),this.touchAction.update(),this},on:function(e,t){var i=this.handlers;return l(v(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this},off:function(e,t){var i=this.handlers;return l(v(e),function(e){t?i[e].splice(x(i[e],t),1):delete i[e]}),this},emit:function(e,t){this.options.domEvents&&Re(e,t);var a=this.handlers[e]&&this.handlers[e].slice();if(a&&a.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<a.length;)a[i](t),i++}},destroy:function(){this.element&&Ne(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},m(Ie,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Me,Input:E,TouchAction:ve,TouchInput:me,MouseInput:re,PointerEventInput:le,TouchMouseInput:he,SingleTouchInput:pe,Recognizer:fe,AttrRecognizer:xe,Tap:Te,Pan:we,Swipe:Ee,Pinch:Ce,Rotate:ke,Press:Se,on:s,off:t,each:l,merge:n,extend:m,inherit:o,bindFn:p,prefixed:A}),typeof define=="function"&&define.amd?define("materialize_anonymous_module_3",[],function(){return Ie}):"undefined"!=typeof module&&module.exports?module.exports=Ie:F[a]=Ie}(window,document,"Hammer");(function(e){"function"==typeof define&&define.amd?define("materialize_anonymous_module_1",["jquery","hammerjs"],e):"object"==typeof exports?e(h,v):e(h,v)})(function(e,t){function a(a,i){var n=e(a);n.data("hammer")||n.data("hammer",new t(n[0],i))}e.fn.hammer=function(e){return this.each(function(){a(this,e)})},t.Manager.prototype.emit=function(t){return function(a,i){t.call(this,a,i),e(this.element).trigger({type:a,gesture:i})}}(t.Manager.prototype.emit)});(function(e){e.Package?Materialize={}:e.Materialize={}})(window),Materialize.guid=function(){function e(){return F(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),Materialize.elementOrParentIsFixed=function(e){var t=$(e),a=t.add(t.parents()),i=!1;return a.each(function(){if("fixed"===$(this).css("position"))return i=!0,!1}),i};var Y=$?$.Velocity:h?h.Velocity:Velocity;(function(t){t.fn.collapsible=function(a){return a=t.extend({accordion:void 0},a),this.each(function(){function i(e){c=d.find("> li > .collapsible-header"),e.hasClass("active")?e.parent().addClass("active"):e.parent().removeClass("active"),e.parent().hasClass("active")?e.siblings(".collapsible-body").stop(!0,!1).slideDown({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}}):e.siblings(".collapsible-body").stop(!0,!1).slideUp({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}}),c.not(e).removeClass("active").parent().removeClass("active"),c.not(e).parent().children(".collapsible-body").stop(!0,!1).slideUp({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}})}function n(e){e.hasClass("active")?e.parent().addClass("active"):e.parent().removeClass("active"),e.parent().hasClass("active")?e.siblings(".collapsible-body").stop(!0,!1).slideDown({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}}):e.siblings(".collapsible-body").stop(!0,!1).slideUp({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){t(this).css("height","")}})}function s(e){var t=o(e);return 0<t.length}function o(e){return e.closest("li > .collapsible-header")}var d=t(this),c=t(this).find("> li > .collapsible-header"),r=d.data("collapsible");d.off("click.collapse","> li > .collapsible-header"),c.off("click.collapse"),d.on("click.collapse","> li > .collapsible-header",function(d){var e=t(this),c=t(d.target);s(c)&&(c=o(c)),c.toggleClass("active"),a.accordion||"accordion"===r||void 0===r?i(c):(n(c),e.hasClass("active")&&n(e))});var c=d.find("> li > .collapsible-header");a.accordion||"accordion"===r||void 0===r?i(c.filter(".active").first()):c.filter(".active").each(function(){n(t(this))})})},t(document).ready(function(){t(".collapsible").collapsible()})})(h);(function(t){t.fn.scrollTo=function(e){return t(this).scrollTop(t(this).scrollTop()-t(this).offset().top+t(e).offset().top),this},t.fn.dropdown=function(e){var a={inDuration:300,outDuration:225,constrain_width:!0,hover:!1,gutter:0,belowOrigin:!1,closeOnClick:!0,alignment:"left"};this.each(function(){function i(){void 0!==o.data("induration")&&(d.inDuration=o.data("inDuration")),void 0!==o.data("outduration")&&(d.outDuration=o.data("outDuration")),void 0!==o.data("constrainwidth")&&(d.constrain_width=o.data("constrainwidth")),void 0!==o.data("hover")&&(d.hover=o.data("hover")),void 0!==o.data("gutter")&&(d.gutter=o.data("gutter")),void 0!==o.data("beloworigin")&&(d.belowOrigin=o.data("beloworigin")),void 0!==o.data("closeOnClick")&&(d.closeOnClick=o.data("closeOnClick")),void 0!==o.data("alignment")&&(d.alignment=o.data("alignment"))}function n(e){"focus"===e&&(c=!0),i(),r.addClass("active"),o.addClass("active"),!0===d.constrain_width?r.css("width",o.outerWidth()):r.css("white-space","nowrap");var a=d.container?d.container.clientHeight:window.innerHeight,n=o.innerHeight(),s=o.offset().left,l=d.container?t(d.container).offset().top:t(window).scrollTop(),p=o.offset().top-l,u=d.alignment,m=0,g=0,h=0;!0===d.belowOrigin&&(h=n);var v=0,A=o.parent();if(!A.is("body")&&A[0].scrollHeight>A[0].clientHeight&&(v=A[0].scrollTop),s+r.innerWidth()>t(window).width()?u="right":0>s-r.innerWidth()+o.innerWidth()&&(u="left"),p+r.innerHeight()>a)if(0>p+n-r.innerHeight()){var f=a-p-h;r.css("max-height",f)}else h||(h+=n),h-=r.innerHeight();if("left"===u)m=d.gutter,g=o.position().left+m;else if("right"===u){var b=o.position().left+o.outerWidth()-r.outerWidth();m=-d.gutter,g=b+m}r.css({position:"absolute",top:o.position().top+h+v,left:g}),r.stop(!0,!0).css("opacity",0).slideDown({queue:!1,duration:d.inDuration,easing:"easeOutCubic",complete:function(){t(this).css("height",""),o.trigger("change_state",!0)}}).animate({opacity:1},{queue:!1,duration:d.inDuration,easing:"easeOutSine"})}function s(){c=!1,r.fadeOut(d.outDuration),r.removeClass("active"),o.removeClass("active"),setTimeout(function(){r.css("max-height",""),o.trigger("change_state",!1)},d.outDuration)}var o=t(this),d=t.extend({},a,e),c=!1,r=t("#"+o.attr("data-activates"));if(i(),o.after(r),d.hover){var l=!1;o.unbind("click."+o.attr("id")),o.on("mouseenter",function(){!1===l&&(n(),l=!0)}),o.on("mouseleave",function(a){var e=a.toElement||a.relatedTarget;t(e).closest(".dropdown-content").is(r)||(r.stop(!0,!0),s(),l=!1)}),r.on("mouseleave",function(a){var e=a.toElement||a.relatedTarget;t(e).closest(".dropdown-button").is(o)||(r.stop(!0,!0),s(),l=!1)})}else o.unbind("click."+o.attr("id")),o.bind("click."+o.attr("id"),function(a){c||(o[0]!=a.currentTarget||o.hasClass("active")||0!==t(a.target).closest(".dropdown-content").length?o.hasClass("active")&&(s(),t(document).unbind("click."+r.attr("id")+" touchstart."+r.attr("id"))):(a.preventDefault(),n("click")),r.hasClass("active")&&t(document).bind("click."+r.attr("id")+" touchstart."+r.attr("id"),function(a){r.is(a.target)||o.is(a.target)||o.find(a.target).length||(s(),t(document).unbind("click."+r.attr("id")+" touchstart."+r.attr("id")))}))});o.on("open",function(t,e){n(e)}),o.on("close",s)})},t(document).ready(function(){t(".dropdown-button").dropdown()})})(h);(function(t){var e=0,a=0,i=function(){return a++,"materialize-lean-overlay-"+a};Materialize.modalSettings={open:{},close:{}},t.fn.extend({openModal:function(a){var n=t("body"),s=n.innerWidth(),o=t.extend({opacity:.5,in_duration:350,out_duration:250,ready:void 0,complete:void 0,dismissible:!0,starting_top:"4%"},Materialize.modalSettings.open),d=t(this);d.hasClass("open")||(overlayID=i(),$overlay=t("<div class=\"lean-overlay\"></div>"),lStack=++e,$overlay.attr("id",overlayID).css("z-index",1e3+2*lStack),d.data("overlay-id",overlayID).css("z-index",1e3+2*lStack+1),d.addClass("open"),t("body").append($overlay),a=t.extend(o,a),a.dismissible&&($overlay.click(function(){d.closeModal(a)}),t(document).on("keyup.leanModal"+overlayID,function(t){27===t.keyCode&&(d.closeModal(a),t.preventDefault())})),d.find(".modal-close").on("click.close",function(){d.closeModal(a)}),$overlay.css({display:"block",opacity:0}),d.css({display:"block",opacity:0}),$overlay.velocity({opacity:a.opacity/lStack},{duration:a.in_duration,queue:!1,ease:"easeOutCubic"}),d.data("associated-overlay",$overlay[0]),d.hasClass("bottom-sheet")?d.velocity({bottom:"0",opacity:1},{duration:a.in_duration,queue:!1,ease:"easeOutCubic",complete:function(){"function"==typeof a.ready&&a.ready()}}):(t.Velocity.hook(d,"scaleX",.7),d.css({top:a.starting_top}),d.velocity({top:"10%",opacity:1,scaleX:"1"},{duration:a.in_duration,queue:!1,ease:"easeOutCubic",complete:function(){"function"==typeof a.ready&&a.ready()}})))}}),t.fn.extend({closeModal:function(a){var i=t.extend({out_duration:250,complete:void 0},Materialize.modalSettings.close),n=t(this),s=n.data("overlay-id"),o=t("#"+s);return n.hasClass("open")?void(n.removeClass("open"),a=t.extend(i,a),n.find(".modal-close").off("click.close"),t(document).off("keyup.leanModal"+s),o.velocity({opacity:0},{duration:a.out_duration,queue:!1,ease:"easeOutQuart"}),n.hasClass("bottom-sheet")?n.velocity({bottom:"-100%",opacity:0},{duration:a.out_duration,queue:!1,ease:"easeOutCubic",complete:function(){o.css({display:"none"}),e--,o.remove(),"function"==typeof a.complete&&a.complete()}}):n.velocity({top:a.starting_top,opacity:0,scaleX:.7},{duration:a.out_duration,complete:function(){t(this).css("display","none"),e--,o.remove(),"function"==typeof a.complete&&a.complete()}})):void("function"==typeof a.complete&&a.complete())}}),t.fn.extend({leanModal:function(e){return this.each(function(){var a=t.extend({starting_top:"4%"},e);t(this).click(function(i){a.starting_top=(t(this).offset().top-t(window).scrollTop())/1.15;var e=t(this).attr("href")||"#"+t(this).data("target");t(e).openModal(a),i.preventDefault()})})}})})(h);(function(e){e.fn.materialbox=function(){return this.each(function(){function t(){i=!1;var t=s.parent(".material-placeholder"),n=window.innerWidth,o=window.innerHeight,c=s.data("width"),r=s.data("height");s.velocity("stop",!0),e("#materialbox-overlay").velocity("stop",!0),e(".materialbox-caption").velocity("stop",!0),e("#materialbox-overlay").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){a=!1,e(this).remove()}}),s.velocity({width:0,height:0,left:0,top:0},{duration:200,queue:!1,easing:"easeOutQuad"}),e(".materialbox-caption").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){t.css({height:"",width:"",position:"",top:"",left:""}),s.css({height:"",top:"",left:"",width:"","max-width":"",position:"","z-index":""}),s.removeClass("active"),i=!0,e(this).remove(),d&&d.css("overflow","")}})}if(!e(this).hasClass("initialized")){e(this).addClass("initialized");var a=!1,i=!0,n=275,s=e(this),o=e("<div></div>").addClass("material-placeholder"),d,c;s.wrap(o),s.on("click",function(){var o=s.parent(".material-placeholder"),r=window.innerWidth,l=window.innerHeight,p=s.width(),u=s.height();if(!1===i)return t(),!1;if(a&&!0===i)return t(),!1;i=!1,s.addClass("active"),a=!0,o.css({width:o[0].getBoundingClientRect().width,height:o[0].getBoundingClientRect().height,position:"relative",top:0,left:0}),d=void 0,c=o[0].parentNode;for(var m;null!==c&&!e(c).is(document);)m=e(c),"visible"!==m.css("overflow")&&(m.css("overflow","visible"),d=void 0===d?m:d.add(m)),c=c.parentNode;s.css({position:"absolute","z-index":1e3}).data("width",p).data("height",u);var g=e("<div id=\"materialbox-overlay\"></div>").css({opacity:0}).click(function(){!0===i&&t()});if(s.before(g),g.velocity({opacity:1},{duration:n,queue:!1,easing:"easeOutQuad"}),""!==s.data("caption")){var h=e("<div class=\"materialbox-caption\"></div>");h.text(s.data("caption")),e("body").append(h),h.css({display:"inline"}),h.velocity({opacity:1},{duration:n,queue:!1,easing:"easeOutQuad"})}var v=0,A=0,f=0;p/r>u/l?(v=u/p,A=.9*r,f=.9*r*v):(v=p/u,A=.9*l*v,f=.9*l),s.hasClass("responsive-img")?s.velocity({"max-width":A,width:p},{duration:0,queue:!1,complete:function(){s.css({left:0,top:0}).velocity({height:f,width:A,left:e(document).scrollLeft()+r/2-s.parent(".material-placeholder").offset().left-A/2,top:e(document).scrollTop()+l/2-s.parent(".material-placeholder").offset().top-f/2},{duration:n,queue:!1,easing:"easeOutQuad",complete:function(){i=!0}})}}):s.css("left",0).css("top",0).velocity({height:f,width:A,left:e(document).scrollLeft()+r/2-s.parent(".material-placeholder").offset().left-A/2,top:e(document).scrollTop()+l/2-s.parent(".material-placeholder").offset().top-f/2},{duration:n,queue:!1,easing:"easeOutQuad",complete:function(){i=!0}})}),e(window).scroll(function(){a&&t()}),e(document).keyup(function(n){27===n.keyCode&&!0===i&&a&&t()})}})},e(document).ready(function(){e(".materialboxed").materialbox()})})(h);(function(e){e.fn.parallax=function(){var t=e(window).width();return this.each(function(){function a(a){var n=601>t?0<i.height()?i.height():i.children("img").height():0<i.height()?i.height():500;var s=i.children("img").first(),o=s.height(),d=o-n,c=i.offset().top+n,r=i.offset().top,l=e(window).scrollTop(),p=window.innerHeight,u=(l+p-r)/(n+p),m=M(d*u);a&&s.css("display","block"),c>l&&r<l+p&&s.css("transform","translate3D(-50%,"+m+"px, 0)")}var i=e(this);i.addClass("parallax"),i.children("img").one("load",function(){a(!0)}).each(function(){this.complete&&e(this).load()}),e(window).scroll(function(){t=e(window).width(),a(!1)}),e(window).resize(function(){t=e(window).width(),a(!1)})})}})(h);(function(t){var e={init:function(){return this.each(function(){var a=t(this),i=t(window).width();a.width("100%");var n=a.find("li.tab a"),s=a.width(),o=z(s,a[0].scrollWidth)/n.length,d=0,c,r;c=t(n.filter("[href=\""+location.hash+"\"]")),0===c.length&&(c=t(this).find("li.tab a.active").first()),0===c.length&&(c=t(this).find("li.tab a").first()),c.addClass("active"),d=n.index(c),0>d&&(d=0),c[0]!==void 0&&(r=t(c[0].hash)),a.append("<div class=\"indicator\"></div>");var l=a.find(".indicator");a.is(":visible")&&(l.css({right:s-(d+1)*o}),l.css({left:d*o})),t(window).resize(function(){s=a.width(),o=z(s,a[0].scrollWidth)/n.length,0>d&&(d=0),0!==o&&0!==s&&(l.css({right:s-(d+1)*o}),l.css({left:d*o}))}),n.not(c).each(function(){t(this.hash).hide()}),a.on("click","a",function(i){if(t(this).parent().hasClass("disabled"))return void i.preventDefault();s=a.width(),o=z(s,a[0].scrollWidth)/n.length,c.removeClass("active"),r!==void 0&&r.hide(),c=t(this),r=t(this.hash),n=a.find("li.tab a"),c.addClass("active");var e=d;d=n.index(t(this)),0>d&&(d=0),r!==void 0&&r.show(),0<=d-e?(l.velocity({right:s-(d+1)*o},{duration:300,queue:!1,easing:"easeOutQuad"}),l.velocity({left:d*o},{duration:300,queue:!1,easing:"easeOutQuad",delay:90})):(l.velocity({left:d*o},{duration:300,queue:!1,easing:"easeOutQuad"}),l.velocity({right:s-(d+1)*o},{duration:300,queue:!1,easing:"easeOutQuad",delay:90})),i.preventDefault()})})},select_tab:function(e){this.find("a[href=\"#"+e+"\"]").trigger("click")}};t.fn.tabs=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));return"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on jQuery.tooltip"):e.init.apply(this,arguments)},t(document).ready(function(){t("ul.tabs").tabs()})})(h);(function(e){e.fn.tooltip=function(a){return"remove"===a?(this.each(function(){e("#"+e(this).attr("data-tooltip-id")).remove(),e(this).off("mouseenter.tooltip mouseleave.tooltip")}),!1):(a=e.extend({delay:350},a),this.each(function(){var i=Materialize.guid(),n=e(this);n.attr("data-tooltip-id",i);var s=e("<span></span>").text(n.attr("data-tooltip")),o=e("<div></div>");o.addClass("material-tooltip").append(s).appendTo(e("body")).attr("id",i);var d=e("<div></div>").addClass("backdrop");d.appendTo(o),d.css({top:0,left:0}),n.off("mouseenter.tooltip mouseleave.tooltip");var c=!1,r;n.on({"mouseenter.tooltip":function(){var e=n.attr("data-delay");e=void 0===e||""===e?a.delay:e,r=setTimeout(function(){c=!0,o.velocity("stop"),d.velocity("stop"),o.css({display:"block",left:"0px",top:"0px"}),o.children("span").text(n.attr("data-tooltip"));var e=n.outerWidth(),a=n.outerHeight(),i=n.attr("data-position"),s=o.outerHeight(),r=o.outerWidth(),l="0px",p="0px",u=8,m,g,h;"top"===i?(m=n.offset().top-s-5,g=n.offset().left+e/2-r/2,h=t(g,m,r,s),l="-10px",d.css({borderRadius:"14px 14px 0 0",transformOrigin:"50% 90%",marginTop:s,marginLeft:r/2-d.width()/2})):"left"===i?(m=n.offset().top+a/2-s/2,g=n.offset().left-r-5,h=t(g,m,r,s),p="-10px",d.css({width:"14px",height:"14px",borderRadius:"14px 0 0 14px",transformOrigin:"95% 50%",marginTop:s/2,marginLeft:r})):"right"===i?(m=n.offset().top+a/2-s/2,g=n.offset().left+e+5,h=t(g,m,r,s),p="+10px",d.css({width:"14px",height:"14px",borderRadius:"0 14px 14px 0",transformOrigin:"5% 50%",marginTop:s/2,marginLeft:"0px"})):(m=n.offset().top+n.outerHeight()+5,g=n.offset().left+e/2-r/2,h=t(g,m,r,s),l="+10px",d.css({marginLeft:r/2-d.width()/2})),o.css({top:h.y,left:h.x}),u=r/8,8>u&&(u=8),("right"===i||"left"===i)&&(u=r/10,6>u&&(u=6)),o.velocity({marginTop:l,marginLeft:p},{duration:350,queue:!1}).velocity({opacity:1},{duration:300,delay:50,queue:!1}),d.css({display:"block"}).velocity({opacity:1},{duration:55,delay:0,queue:!1}).velocity({scale:u},{duration:300,delay:0,queue:!1,easing:"easeInOutQuad"})},e)},"mouseleave.tooltip":function(){c=!1,clearTimeout(r),setTimeout(function(){!0!=c&&(o.velocity({opacity:0,marginTop:0,marginLeft:0},{duration:225,queue:!1}),d.velocity({opacity:0,scale:1},{duration:225,queue:!1,complete:function(){d.css("display","none"),o.css("display","none"),c=!1}}))},225)}})}))};var t=function(t,a,i,n){var s=t,o=a;return 0>s?s=4:s+i>window.innerWidth&&(s-=s+i-window.innerWidth),0>o?o=4:o+n>(options.container?options.container.clientHeight:window.innerHeight)+e(window).scrollTop&&(o-=o+n-(options.container?options.container.clientHeight:window.innerHeight)),{x:s,y:o}};e(document).ready(function(){e(".tooltipped").tooltip()})})(h);(function(t){'use strict';function a(e){return null!==e&&e===e.window}function i(e){return a(e)?e:9===e.nodeType&&e.defaultView}function n(e){var t={top:0,left:0},a=e&&e.ownerDocument,n,s;return n=a.documentElement,"undefined"!=typeof e.getBoundingClientRect&&(t=e.getBoundingClientRect()),s=i(a),{top:t.top+s.pageYOffset-n.clientTop,left:t.left+s.pageXOffset-n.clientLeft}}function s(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t+=i+":"+e[i]+";");return t}function o(t){if(!1===p.allowEvent(t))return null;for(var e=null,a=t.target||t.srcElement;null!==a.parentElement;){if(!(a instanceof SVGElement)&&-1!==a.className.indexOf("waves-effect")){e=a;break}else if(a.classList.contains("waves-effect")){e=a;break}a=a.parentElement}return e}function d(a){var e=o(a);null!==e&&(l.show(a,e),"ontouchstart"in t&&(e.addEventListener("touchend",l.hide,!1),e.addEventListener("touchcancel",l.hide,!1)),e.addEventListener("mouseup",l.hide,!1),e.addEventListener("mouseleave",l.hide,!1))}var c=c||{},r=document.querySelectorAll.bind(document),l={duration:750,show:function(t,e){if(2===t.button)return!1;var a=e||this,i=document.createElement("div");i.className="waves-ripple",a.appendChild(i);var o=n(a),d=t.pageY-o.top,c=t.pageX-o.left,r="scale("+10*(a.clientWidth/100)+")";"touches"in t&&(d=t.touches[0].pageY-o.top,c=t.touches[0].pageX-o.left),i.setAttribute("data-hold",Date.now()),i.setAttribute("data-scale",r),i.setAttribute("data-x",c),i.setAttribute("data-y",d);var p={top:d+"px",left:c+"px"};i.className+=" waves-notransition",i.setAttribute("style",s(p)),i.className=i.className.replace("waves-notransition",""),p["-webkit-transform"]=r,p["-moz-transform"]=r,p["-ms-transform"]=r,p["-o-transform"]=r,p.transform=r,p.opacity="1",p["-webkit-transition-duration"]=l.duration+"ms",p["-moz-transition-duration"]=l.duration+"ms",p["-o-transition-duration"]=l.duration+"ms",p["transition-duration"]=l.duration+"ms",p["-webkit-transition-timing-function"]="cubic-bezier(0.250, 0.460, 0.450, 0.940)",p["-moz-transition-timing-function"]="cubic-bezier(0.250, 0.460, 0.450, 0.940)",p["-o-transition-timing-function"]="cubic-bezier(0.250, 0.460, 0.450, 0.940)",p["transition-timing-function"]="cubic-bezier(0.250, 0.460, 0.450, 0.940)",i.setAttribute("style",s(p))},hide:function(t){p.touchup(t);var e=this,a=1.4*e.clientWidth,i=null,n=e.getElementsByClassName("waves-ripple");if(0<n.length)i=n[n.length-1];else return!1;var o=i.getAttribute("data-x"),d=i.getAttribute("data-y"),c=i.getAttribute("data-scale"),r=Date.now()-+i.getAttribute("data-hold"),u=350-r;0>u&&(u=0),setTimeout(function(){var t={top:d+"px",left:o+"px",opacity:"0","-webkit-transition-duration":l.duration+"ms","-moz-transition-duration":l.duration+"ms","-o-transition-duration":l.duration+"ms","transition-duration":l.duration+"ms","-webkit-transform":c,"-moz-transform":c,"-ms-transform":c,"-o-transform":c,transform:c};i.setAttribute("style",s(t)),setTimeout(function(){try{e.removeChild(i)}catch(t){return!1}},l.duration)},u)},wrapInput:function(e){for(var t=0,i;t<e.length;t++)if(i=e[t],"input"===i.tagName.toLowerCase()){var n=i.parentNode;if("i"===n.tagName.toLowerCase()&&-1!==n.className.indexOf("waves-effect"))continue;var s=document.createElement("i");s.className=i.className+" waves-input-wrapper";var o=i.getAttribute("style");o||(o=""),s.setAttribute("style",o),i.className="waves-button-input",i.removeAttribute("style"),n.replaceChild(s,i),s.appendChild(i)}}},p={touches:0,allowEvent:function(t){var e=!0;return"touchstart"===t.type?p.touches+=1:"touchend"===t.type||"touchcancel"===t.type?setTimeout(function(){0<p.touches&&(p.touches-=1)},500):"mousedown"===t.type&&0<p.touches&&(e=!1),e},touchup:function(t){p.allowEvent(t)}};c.displayEffect=function(e){e=e||{},"duration"in e&&(l.duration=e.duration),l.wrapInput(r(".waves-effect")),"ontouchstart"in t&&document.body.addEventListener("touchstart",d,!1),document.body.addEventListener("mousedown",d,!1)},c.attach=function(e){"input"===e.tagName.toLowerCase()&&(l.wrapInput([e]),e=e.parentElement),"ontouchstart"in t&&e.addEventListener("touchstart",d,!1),e.addEventListener("mousedown",d,!1)},t.Waves=c,document.addEventListener("DOMContentLoaded",function(){c.displayEffect()},!1)})(window);Materialize.toast=function(e,t,a,i){function n(e){var t=document.createElement("div");if(t.classList.add("toast"),a)for(var n=a.split(" "),s=0,o=n.length;s<o;s++)t.classList.add(n[s]);("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName)?t.appendChild(e):e instanceof h?t.appendChild(e[0]):t.innerHTML=e;var d=new v(t,{prevent_default:!1});return d.on("pan",function(a){var e=a.deltaX;t.classList.contains("panning")||t.classList.add("panning");var i=1-L(e/80);0>i&&(i=0),Y(t,{left:e,opacity:i},{duration:50,queue:!1,easing:"easeOutQuad"})}),d.on("panend",function(a){var e=a.deltaX;L(e)>80?Y(t,{marginTop:"-40px"},{duration:375,easing:"easeOutExpo",queue:!1,complete:function(){"function"==typeof i&&i(),t.parentNode.removeChild(t)}}):(t.classList.remove("panning"),Y(t,{left:0,opacity:1},{duration:300,easing:"easeOutExpo",queue:!1}))}),t}a=a||"";var s=document.getElementById("toast-container");null===s&&(s=document.createElement("div"),s.id="toast-container",document.body.appendChild(s));var o=n(e);e&&s.appendChild(o),o.style.top="35px",o.style.opacity=0,Y(o,{top:"0px",opacity:1},{duration:300,easing:"easeOutCubic",queue:!1});var d=t,c=setInterval(function(){null===o.parentNode&&window.clearInterval(c),o.classList.contains("panning")||(d-=20),0>=d&&(Y(o,{opacity:0,marginTop:"-40px"},{duration:375,easing:"easeOutExpo",queue:!1,complete:function(){"function"==typeof i&&i(),this[0].parentNode.removeChild(this[0])}}),window.clearInterval(c))},20)};(function(t){var e={init:function(a){a=t.extend({menuWidth:240,edge:"left",closeOnClick:!1},a),t(this).each(function(){function e(e){o=!1,d=!1,t("#sidenav-overlay").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){t(this).remove()}}),"left"===a.edge?(s.css({width:"",right:"",left:"0"}),n.velocity({translateX:"-100%"},{duration:200,queue:!1,easing:"easeOutCubic",complete:function(){!0===e&&(n.removeAttr("style"),n.css("width",a.menuWidth))}})):(s.css({width:"",right:"0",left:""}),n.velocity({translateX:"100%"},{duration:200,queue:!1,easing:"easeOutCubic",complete:function(){!0===e&&(n.removeAttr("style"),n.css("width",a.menuWidth))}}))}var i=t(this),n=t("#"+i.attr("data-activates"));240!=a.menuWidth&&n.css("width",a.menuWidth);var s=t("<div class=\"drag-target\"></div>");t("body").append(s),"left"==a.edge?(n.css("transform","translateX(-100%)"),s.css({left:0})):(n.addClass("right-aligned").css("transform","translateX(100%)"),s.css({right:0})),n.hasClass("fixed")&&992<window.innerWidth&&n.css("transform","translateX(0)"),n.hasClass("fixed")&&t(window).resize(function(){992<window.innerWidth?0!=t("#sidenav-overlay").length&&d?e(!0):n.css("transform","translateX(0%)"):!1===d&&("left"===a.edge?n.css("transform","translateX(-100%)"):n.css("transform","translateX(100%)"))}),!0===a.closeOnClick&&n.on("click.itemclick","a:not(.collapsible-header)",function(){e()});var o=!1,d=!1;s.on("click",function(){e()}),s.hammer({prevent_default:!1}).bind("pan",function(i){if("touch"==i.gesture.pointerType){var s=i.gesture.direction,o=i.gesture.center.x,c=i.gesture.center.y,r=i.gesture.velocityX,l=t("body"),p=l.innerWidth();if(0===t("#sidenav-overlay").length){var u=t("<div id=\"sidenav-overlay\"></div>");u.css("opacity",0).click(function(){e()}),t("body").append(u)}if("left"===a.edge&&(o>a.menuWidth?o=a.menuWidth:0>o&&(o=0)),"left"===a.edge)o<a.menuWidth/2?d=!1:o>=a.menuWidth/2&&(d=!0),n.css("transform","translateX("+(o-a.menuWidth)+"px)");else{o<window.innerWidth-a.menuWidth/2?d=!0:o>=window.innerWidth-a.menuWidth/2&&(d=!1);var m=o-a.menuWidth/2;0>m&&(m=0),n.css("transform","translateX("+m+"px)")}var g;"left"===a.edge?(g=o/a.menuWidth,t("#sidenav-overlay").velocity({opacity:g},{duration:10,queue:!1,easing:"easeOutQuad"})):(g=L((o-window.innerWidth)/a.menuWidth),t("#sidenav-overlay").velocity({opacity:g},{duration:10,queue:!1,easing:"easeOutQuad"}))}}).bind("panend",function(i){if("touch"==i.gesture.pointerType){var e=i.gesture.velocityX,c=i.gesture.center.x,r=c-a.menuWidth,l=c-a.menuWidth/2;0<r&&(r=0),0>l&&(l=0),o=!1,"left"===a.edge?d&&.3>=e||-.5>e?(0!=r&&n.velocity({translateX:[0,r]},{duration:300,queue:!1,easing:"easeOutQuad"}),t("#sidenav-overlay").velocity({opacity:1},{duration:50,queue:!1,easing:"easeOutQuad"}),s.css({width:"50%",right:0,left:""})):(!d||.3<e)&&(n.velocity({translateX:[-1*a.menuWidth-10,r]},{duration:200,queue:!1,easing:"easeOutQuad"}),t("#sidenav-overlay").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){t(this).remove()}}),s.css({width:"10px",right:"",left:0})):d&&-.3<=e||.5<e?(n.velocity({translateX:[0,l]},{duration:300,queue:!1,easing:"easeOutQuad"}),t("#sidenav-overlay").velocity({opacity:1},{duration:50,queue:!1,easing:"easeOutQuad"}),s.css({width:"50%",right:"",left:0})):(!d||-.3>e)&&(n.velocity({translateX:[a.menuWidth+10,l]},{duration:200,queue:!1,easing:"easeOutQuad"}),t("#sidenav-overlay").velocity({opacity:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){t(this).remove()}}),s.css({width:"10px",right:0,left:""}))}}),i.click(function(){if(!0===d)d=!1,o=!1,e();else{var i=t("body"),c=i.innerWidth();t("body").append(s),"left"===a.edge?(s.css({width:"50%",right:0,left:""}),n.velocity({translateX:[0,-1*a.menuWidth]},{duration:300,queue:!1,easing:"easeOutQuad"})):(s.css({width:"50%",right:"",left:0}),n.velocity({translateX:[0,a.menuWidth]},{duration:300,queue:!1,easing:"easeOutQuad"}));var r=t("<div id=\"sidenav-overlay\"></div>");r.css("opacity",0).click(function(){d=!1,o=!1,e(),r.velocity({opacity:0},{duration:300,queue:!1,easing:"easeOutQuad",complete:function(){t(this).remove()}})}),t("body").append(r),r.velocity({opacity:1},{duration:300,queue:!1,easing:"easeOutQuad",complete:function(){d=!0,o=!1}})}return!1})})},show:function(){this.trigger("click")},hide:function(){t("#sidenav-overlay").trigger("click")}};t.fn.sideNav=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));return"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on jQuery.sideNav"):e.init.apply(this,arguments)}})(h);(function(t){function e(e,a,i,n){var s=t();return t.each(o,function(t,o){if(0<o.height()){var d=o.offset().top,c=o.offset().left,r=c+o.width(),l=d+o.height();!(c>a||r<n||d>i||l<e)&&s.push(o)}}),s}function a(){++r;var a=s.scrollTop(),i=s.scrollLeft(),n=i+s.width(),o=a+s.height(),c=e(a+l.top+200,n+l.right,o+l.bottom,i+l.left);t.each(c,function(e,t){var a=t.data("scrollSpy:ticks");"number"!=typeof a&&t.triggerHandler("scrollSpy:enter"),t.data("scrollSpy:ticks",r)}),t.each(d,function(e,t){var a=t.data("scrollSpy:ticks");"number"==typeof a&&a!==r&&(t.triggerHandler("scrollSpy:exit"),t.data("scrollSpy:ticks",null))}),d=c}function i(){s.trigger("scrollSpy:winSize")}/**
	 * Get time in ms
   * @license https://raw.github.com/jashkenas/underscore/master/LICENSE
	 * @type {function}
	 * @return {number}
	 */ /**
	 * Returns a function, that, when invoked, will only be triggered at most once
	 * during a given window of time. Normally, the throttled function will run
	 * as much as it can, without ever going more than once per `wait` duration;
	 * but if you'd like to disable the execution on the leading edge, pass
	 * `{leading: false}`. To disable execution on the trailing edge, ditto.
	 * @license https://raw.github.com/jashkenas/underscore/master/LICENSE
	 * @param {function} func
	 * @param {number} wait
	 * @param {Object=} options
	 * @returns {Function}
	 */function n(e,t,a){var i=null,n=0,s,o,d;a||(a={});var c=function(){n=!1===a.leading?0:p(),i=null,d=e.apply(s,o),s=o=null};return function(){var r=p();n||!1!==a.leading||(n=r);var l=t-(r-n);return s=this,o=arguments,0>=l?(clearTimeout(i),i=null,n=r,d=e.apply(s,o),s=o=null):!i&&!1!==a.trailing&&(i=setTimeout(c,l)),d}}var s=t(window),o=[],d=[],c=!1,r=0,l={top:0,right:0,bottom:0,left:0},p=Date.now||function(){return new Date().getTime()};t.scrollSpy=function(e,i){var d=[];e=t(e),e.each(function(e,a){o.push(t(a)),t(a).data("scrollSpy:id",e),t("a[href=\"#"+t(a).attr("id")+"\"]").click(function(a){a.preventDefault();var e=t(this.hash).offset().top+1;t("html, body").animate({scrollTop:e-200},{duration:400,queue:!1,easing:"easeOutCubic"})})}),i=i||{throttle:100},l.top=i.offsetTop||0,l.right=i.offsetRight||0,l.bottom=i.offsetBottom||0,l.left=i.offsetLeft||0;var r=n(a,i.throttle||100),p=function(){t(document).ready(r)};return c||(s.on("scroll",p),s.on("resize",p),c=!0),setTimeout(p,0),e.on("scrollSpy:enter",function(){d=t.grep(d,function(e){return 0!=e.height()});var e=t(this);d[0]?(t("a[href=\"#"+d[0].attr("id")+"\"]").removeClass("active"),e.data("scrollSpy:id")<d[0].data("scrollSpy:id")?d.unshift(t(this)):d.push(t(this))):d.push(t(this)),t("a[href=\"#"+d[0].attr("id")+"\"]").addClass("active")}),e.on("scrollSpy:exit",function(){if(d=t.grep(d,function(e){return 0!=e.height()}),d[0]){t("a[href=\"#"+d[0].attr("id")+"\"]").removeClass("active");var e=t(this);d=t.grep(d,function(t){return t.attr("id")!=e.attr("id")}),d[0]&&t("a[href=\"#"+d[0].attr("id")+"\"]").addClass("active")}}),e},t.winSizeSpy=function(e){return t.winSizeSpy=function(){return s},e=e||{throttle:100},s.on("resize",n(i,e.throttle||100))},t.fn.scrollSpy=function(e){return t.scrollSpy(t(this),e)}})(h);(function(t){t(document).ready(function(){function e(e){var i=e.css("font-family"),n=e.css("font-size");n&&a.css("font-size",n),i&&a.css("font-family",i),"off"===e.attr("wrap")&&a.css("overflow-wrap","normal").css("white-space","pre"),a.text(e.val()+"\n");var s=a.html().replace(/\n/g,"<br>");a.html(s),e.is(":visible")?a.css("width",e.width()):a.css("width",t(window).width()/2),e.css("height",a.height())}Materialize.updateTextFields=function(){t("input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea").each(function(e,a){0<t(a).val().length||a.autofocus||t(this).attr("placeholder")!==void 0||!0===t(a)[0].validity.badInput?t(this).siblings("label, i").addClass("active"):t(this).siblings("label, i").removeClass("active")})};t(document).on("change","input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea",function(){(0!==t(this).val().length||t(this).attr("placeholder")!==void 0)&&t(this).siblings("label").addClass("active"),validate_field(t(this))}),t(document).ready(function(){Materialize.updateTextFields()}),t(document).on("reset",function(a){var e=t(a.target);e.is("form")&&(e.find("input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea").removeClass("valid").removeClass("invalid"),e.find("input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea").each(function(){""===t(this).attr("value")&&t(this).siblings("label, i").removeClass("active")}),e.find("select.initialized").each(function(){var t=e.find("option[selected]").text();e.siblings("input.select-dropdown").val(t)}))}),t(document).on("focus","input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea",function(){t(this).siblings("label, i").addClass("active")}),t(document).on("blur","input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], textarea",function(){var e=t(this);0===e.val().length&&!0!==e[0].validity.badInput&&e.attr("placeholder")===void 0&&e.siblings("label, i").removeClass("active"),0===e.val().length&&!0!==e[0].validity.badInput&&e.attr("placeholder")!==void 0&&e.siblings("i").removeClass("active"),validate_field(e)}),window.validate_field=function(e){var t=e.attr("length")!==void 0,a=parseInt(e.attr("length")),i=e.val().length;0===e.val().length&&!1===e[0].validity.badInput?e.hasClass("validate")&&(e.removeClass("valid"),e.removeClass("invalid")):e.hasClass("validate")&&(e.is(":valid")&&t&&i<=a||e.is(":valid")&&!t?(e.removeClass("invalid"),e.addClass("valid")):(e.removeClass("valid"),e.addClass("invalid")))};t(document).on("keyup.radio","input[type=radio], input[type=checkbox]",function(a){if(9===a.which){t(this).addClass("tabbed");var e=t(this);return void e.one("blur",function(){t(this).removeClass("tabbed")})}});var a=t(".hiddendiv").first();a.length||(a=t("<div class=\"hiddendiv common\"></div>"),t("body").append(a));t(".materialize-textarea").each(function(){var a=t(this);a.val().length&&e(a)}),t("body").on("keyup keydown autoresize",".materialize-textarea",function(){e(t(this))}),t(document).on("change",".file-field input[type=\"file\"]",function(){for(var e=t(this).closest(".file-field"),a=e.find("input.file-path"),n=t(this)[0].files,s=[],o=0;o<n.length;o++)s.push(n[o].name);a.val(s.join(", ")),a.trigger("change")});var i=!1,n;t("input[type=range]").each(function(){var e=t("<span class=\"thumb\"><span class=\"value\"></span></span>");t(this).after(e)});t(document).on("change","input[type=range]",function(){var e=t(this).siblings(".thumb");e.find(".value").html(t(this).val())}),t(document).on("input mousedown touchstart","input[type=range]",function(a){var e=t(this).siblings(".thumb"),s=t(this).outerWidth();0>=e.length&&(e=t("<span class=\"thumb\"><span class=\"value\"></span></span>"),t(this).after(e)),e.find(".value").html(t(this).val()),i=!0,t(this).addClass("active"),e.hasClass("active")||e.velocity({height:"30px",width:"30px",top:"-20px",marginLeft:"-15px"},{duration:300,easing:"easeOutExpo"}),"input"!==a.type&&(n=void 0===a.pageX||null===a.pageX?a.originalEvent.touches[0].pageX-t(this).offset().left:a.pageX-t(this).offset().left,0>n?n=0:n>s&&(n=s),e.addClass("active").css("left",n)),e.find(".value").html(t(this).val())}),t(document).on("mouseup touchend",".range-field",function(){i=!1,t(this).removeClass("active")}),t(document).on("mousemove touchmove",".range-field",function(a){var e=t(this).children(".thumb"),n;if(i){e.hasClass("active")||e.velocity({height:"30px",width:"30px",top:"-20px",marginLeft:"-15px"},{duration:300,easing:"easeOutExpo"}),n=void 0===a.pageX||null===a.pageX?a.originalEvent.touches[0].pageX-t(this).offset().left:a.pageX-t(this).offset().left;var s=t(this).outerWidth();0>n?n=0:n>s&&(n=s),e.addClass("active").css("left",n),e.find(".value").html(e.siblings("input[type=range]").val())}}),t(document).on("mouseout touchleave",".range-field",function(){if(!i){var e=t(this).children(".thumb");e.hasClass("active")&&e.velocity({height:"0",width:"0",top:"10px",marginLeft:"-6px"},{duration:100}),e.removeClass("active")}})}),t.fn.material_select=function(e){function a(e,t,a){var n=e.indexOf(t),s=-1===n;return s?e.push(t):e.splice(n,1),a.siblings("ul.dropdown-content").find("li").eq(t).toggleClass("active"),a.find("option").eq(t).prop("selected",s),i(e,a),s}function i(e,t){for(var a="",n=0,s=e.length,o;n<s;n++)o=t.find("option").eq(e[n]).text(),a+=0==n?o:", "+o;""===a&&(a=t.find("option:disabled").eq(0).text()),t.siblings("input.select-dropdown").val(a)}t(this).each(function(){var n=t(this),s=n.siblings(".select-options"),o=s.length;if(!n.hasClass("browser-default")){var d=!!n.attr("multiple"),c=n.data("select-id");if(c&&(n.parent().find("span.caret").remove(),n.parent().find("input").remove(),n.unwrap(),t("ul#select-options-"+c).remove()),"destroy"===e)return void n.data("select-id",null).removeClass("initialized");var r=Materialize.guid();n.data("select-id",r);var l=t("<div class=\"select-wrapper\"></div>");l.addClass(n.attr("class"));var p=t("<ul id=\"select-options-"+r+"\" class=\"dropdown-content select-dropdown "+(d?"multiple-select-dropdown":"")+"\"></ul>"),u=n.children("option, optgroup"),m=[],g=!1,h=n.find("option:selected")||n.find("option:first"),v;v=h.html();var A=function(e,a,i){var n=a.is(":disabled")?"disabled ":"",d="optgroup-option"===i?"optgroup-option ":"",c;c=o?s.find("[data-value="+a.attr("value")+"]").html()||"<span>"+a.html()+"</span>":"<span>"+a.html()+"</span>";var r=a.data("icon"),l=a.attr("class");if(!!r){var u="";return!l||(u=" class=\""+l+"\""),"multiple"===i?p.append(t("<li class=\""+n+"\"><img src=\""+r+"\""+u+"><span><input type=\"checkbox\""+n+"/><label></label>"+c+"</span></li>")):p.append(t("<li class=\""+n+d+"\"><img src=\""+r+"\""+u+">"+c+"</li>")),!0}"multiple"===i?p.append(t("<li class=\""+n+"\"><span><input type=\"checkbox\""+n+"/><label></label>"+c+"</li>")):p.append(t("<li class=\""+n+d+"\">"+c+"</li>"))};u.length&&u.each(function(){if(t(this).is("option"))d?A(n,t(this),"multiple"):A(n,t(this));else if(t(this).is("optgroup")){var e=t(this).children("option");p.append(t("<li class=\"optgroup\"><span>"+t(this).attr("label")+"</span></li>")),e.each(function(){A(n,t(this),"optgroup-option")})}}),p.find("li:not(.optgroup)").each(function(s){t(this).click(function(i){if(!t(this).hasClass("disabled")&&!t(this).hasClass("optgroup")){var o=!0;d?(t("input[type=\"checkbox\"]",this).prop("checked",function(e,t){return!t}),o=a(m,t(this).index(),n),x.trigger("focus")):(p.find("li").removeClass("active"),t(this).toggleClass("active"),x.val(t(this).text().trim())),w(p,t(this)),n.find("option").eq(s).prop("selected",o),n.trigger("change"),"undefined"!=typeof e&&e()}i.stopPropagation()})}),n.wrap(l);var f=t("<span class=\"caret\">&#9660;</span>");n.is(":disabled")&&f.addClass("disabled");var b=o?v:v.replace(/"/g,"&quot;");var x=t("<input type=\"text\" class=\"select-dropdown\" readonly=\"true\" "+(n.is(":disabled")?"disabled":"")+" data-activates=\"select-options-"+r+"\" value=\""+b+"\"/>");n.before(x),x.before(f),x.after(p),n.is(":disabled")||x.dropdown({hover:!1,closeOnClick:!1}),n.attr("tabindex")&&t(x[0]).attr("tabindex",n.attr("tabindex")),n.addClass("initialized"),x.on({focus:function(){if(t("ul.select-dropdown").not(p[0]).is(":visible")&&t("input.select-dropdown").trigger("close"),!p.is(":visible")){t(this).trigger("open",["focus"]);var e=t(this).val(),a=p.find("li").filter(function(){return t(this).text().toLowerCase()===e.toLowerCase()})[0];w(p,a)}},click:function(t){t.stopPropagation()}}),x.on("blur",function(){d||t(this).trigger("close"),p.find("li.selected").removeClass("selected")}),p.hover(function(){g=!0},function(){g=!1}),t(window).on({click:function(){d&&(g||x.trigger("close"))}}),d&&n.find("option:selected:not(:disabled)").each(function(){var e=t(this).index();a(m,e,n),p.find("li").eq(e).find(":checkbox").prop("checked",!0)});var w=function(e,a){if(a){e.find("li.selected").removeClass("selected");var i=t(a);i.addClass("selected"),p.scrollTo(i)}},C=[],S=function(a){if(9==a.which)return void x.trigger("close");if(40==a.which&&!p.is(":visible"))return void x.trigger("open");if(13!=a.which||p.is(":visible")){a.preventDefault();var e=q(a.which).toLowerCase();if(e&&-1===[9,13,27,38,40].indexOf(a.which)){C.push(e);var i=C.join(""),n=p.find("li").filter(function(){return 0===t(this).text().toLowerCase().indexOf(i)})[0];n&&w(p,n)}if(13==a.which){var s=p.find("li.selected:not(.disabled)")[0];s&&(t(s).trigger("click"),!d&&x.trigger("close"))}40==a.which&&(n=p.find("li.selected").length?p.find("li.selected").next("li:not(.disabled)")[0]:p.find("li:not(.disabled)")[0],w(p,n)),27==a.which&&x.trigger("close"),38==a.which&&(n=p.find("li.selected").prev("li:not(.disabled)")[0],n&&w(p,n)),setTimeout(function(){C=[]},1e3)}};x.on("keydown",S)}})}})(h);(function(e){var t={init:function(t){return t=e.extend({indicators:!0,height:400,transition:500,interval:6e3},t),this.each(function(){function a(e,t){e.hasClass("center-align")?e.velocity({opacity:0,translateY:-100},{duration:t,queue:!1}):e.hasClass("right-align")?e.velocity({opacity:0,translateX:100},{duration:t,queue:!1}):e.hasClass("left-align")&&e.velocity({opacity:0,translateX:-100},{duration:t,queue:!1})}function i(e){e>=o.length?e=0:0>e&&(e=o.length-1),d=s.find(".active").index(),d!=e&&(c=o.eq(d),$caption=c.find(".caption"),c.removeClass("active"),c.velocity({opacity:0},{duration:t.transition,queue:!1,easing:"easeOutQuad",complete:function(){o.not(".active").velocity({opacity:0,translateX:0,translateY:0},{duration:0,queue:!1})}}),a($caption,t.transition),t.indicators&&r.eq(d).removeClass("active"),o.eq(e).velocity({opacity:1},{duration:t.transition,queue:!1,easing:"easeOutQuad"}),o.eq(e).find(".caption").velocity({opacity:1,translateX:0,translateY:0},{duration:t.transition,delay:t.transition,queue:!1,easing:"easeOutQuad"}),o.eq(e).addClass("active"),t.indicators&&r.eq(e).addClass("active"))}var n=e(this),s=n.find("ul.slides").first(),o=s.find("li"),d=s.find(".active").index(),c,r,l;-1!=d&&(c=o.eq(d)),n.hasClass("fullscreen")||(t.indicators?n.height(t.height+40):n.height(t.height),s.height(t.height)),o.find(".caption").each(function(){a(e(this),0)}),o.find("img").each(function(){"data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="!==e(this).attr("src")&&(e(this).css("background-image","url("+e(this).attr("src")+")"),e(this).attr("src","data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="))}),t.indicators&&(r=e("<ul class=\"indicators\"></ul>"),o.each(function(){var a=e("<li class=\"indicator-item\"></li>");a.click(function(){var a=s.parent(),n=a.find(e(this)).index();i(n),clearInterval(l),l=setInterval(function(){d=s.find(".active").index(),o.length==d+1?d=0:d+=1,i(d)},t.transition+t.interval)}),r.append(a)}),n.append(r),r=n.find("ul.indicators").find("li.indicator-item")),c?c.show():(o.first().addClass("active").velocity({opacity:1},{duration:t.transition,queue:!1,easing:"easeOutQuad"}),d=0,c=o.eq(d),t.indicators&&r.eq(d).addClass("active")),c.find("img").each(function(){c.find(".caption").velocity({opacity:1,translateX:0,translateY:0},{duration:t.transition,queue:!1,easing:"easeOutQuad"})}),l=setInterval(function(){d=s.find(".active").index(),i(d+1)},t.transition+t.interval);var p=!1,u=!1,m=!1;n.hammer({prevent_default:!1}).bind("pan",function(t){if("touch"===t.gesture.pointerType){clearInterval(l);var e=t.gesture.direction,a=t.gesture.deltaX,i=t.gesture.velocityX;$curr_slide=s.find(".active"),$curr_slide.velocity({translateX:a},{duration:50,queue:!1,easing:"easeOutQuad"}),4===e&&(a>n.innerWidth()/2||-.65>i)?m=!0:2===e&&(a<-1*n.innerWidth()/2||.65<i)&&(u=!0);var d;u&&(d=$curr_slide.next(),0===d.length&&(d=o.first()),d.velocity({opacity:1},{duration:300,queue:!1,easing:"easeOutQuad"})),m&&(d=$curr_slide.prev(),0===d.length&&(d=o.last()),d.velocity({opacity:1},{duration:300,queue:!1,easing:"easeOutQuad"}))}}).bind("panend",function(a){"touch"===a.gesture.pointerType&&($curr_slide=s.find(".active"),p=!1,curr_index=s.find(".active").index(),(m||u)&&!(1>=o.length)?u?(i(curr_index+1),$curr_slide.velocity({translateX:-1*n.innerWidth()},{duration:300,queue:!1,easing:"easeOutQuad",complete:function(){$curr_slide.velocity({opacity:0,translateX:0},{duration:0,queue:!1})}})):m&&(i(curr_index-1),$curr_slide.velocity({translateX:n.innerWidth()},{duration:300,queue:!1,easing:"easeOutQuad",complete:function(){$curr_slide.velocity({opacity:0,translateX:0},{duration:0,queue:!1})}})):$curr_slide.velocity({translateX:0},{duration:300,queue:!1,easing:"easeOutQuad"}),u=!1,m=!1,clearInterval(l),l=setInterval(function(){d=s.find(".active").index(),o.length==d+1?d=0:d+=1,i(d)},t.transition+t.interval))}),n.on("sliderPause",function(){clearInterval(l)}),n.on("sliderStart",function(){clearInterval(l),l=setInterval(function(){d=s.find(".active").index(),o.length==d+1?d=0:d+=1,i(d)},t.transition+t.interval)}),n.on("sliderNext",function(){d=s.find(".active").index(),i(d+1)}),n.on("sliderPrev",function(){d=s.find(".active").index(),i(d-1)})})},pause:function(){e(this).trigger("sliderPause")},start:function(){e(this).trigger("sliderStart")},next:function(){e(this).trigger("sliderNext")},prev:function(){e(this).trigger("sliderPrev")}};e.fn.slider=function(a){if(t[a])return t[a].apply(this,Array.prototype.slice.call(arguments,1));return"object"!=typeof a&&a?void e.error("Method "+a+" does not exist on jQuery.tooltip"):t.init.apply(this,arguments)}})(h);(function(t){t(document).ready(function(){t(document).on("click.card",".card",function(a){t(this).find("> .card-reveal").length&&(t(a.target).is(t(".card-reveal .card-title"))||t(a.target).is(t(".card-reveal .card-title i"))?t(this).find(".card-reveal").velocity({translateY:0},{duration:225,queue:!1,easing:"easeInOutQuad",complete:function(){t(this).css({display:"none"})}}):(t(a.target).is(t(".card .activator"))||t(a.target).is(t(".card .activator i")))&&(t(a.target).closest(".card").css("overflow","hidden"),t(this).find(".card-reveal").css({display:"block"}).velocity("stop",!1).velocity({translateY:"-100%"},{duration:300,queue:!1,easing:"easeInOutQuad"}))),t(".card-reveal").closest(".card").css("overflow","hidden")})})})(h);(function(e){e(document).ready(function(){e(document).on("click.chip",".chip .material-icons",function(){e(this).parent().remove()})})})(h);(function(e){e.fn.pushpin=function(t){return t=e.extend({top:0,bottom:1/0,offset:0},t),$index=0,this.each(function(){function a(e){e.removeClass("pin-top"),e.removeClass("pinned"),e.removeClass("pin-bottom")}function i(i,n){i.each(function(){t.top<=n&&t.bottom>=n&&!e(this).hasClass("pinned")&&(a(e(this)),e(this).css("top",t.offset),e(this).addClass("pinned")),n<t.top&&!e(this).hasClass("pin-top")&&(a(e(this)),e(this).css("top",0),e(this).addClass("pin-top")),n>t.bottom&&!e(this).hasClass("pin-bottom")&&(a(e(this)),e(this).addClass("pin-bottom"),e(this).css("top",t.bottom-o))})}var n=Materialize.guid(),s=e(this),o=e(this).offset().top;i(s,e(window).scrollTop()),e(window).on("scroll."+n,function(){var a=e(window).scrollTop()+t.offset;i(s,a)})})}})(h);(function(e){e(document).ready(function(){e.fn.reverse=[].reverse,e(document).on("mouseenter.fixedActionBtn",".fixed-action-btn:not(.click-to-toggle)",function(){var a=e(this);t(a)}),e(document).on("mouseleave.fixedActionBtn",".fixed-action-btn:not(.click-to-toggle)",function(){var t=e(this);a(t)}),e(document).on("click.fixedActionBtn",".fixed-action-btn.click-to-toggle > a",function(){var i=e(this),n=i.parent();n.hasClass("active")?a(n):t(n)})}),e.fn.extend({openFAB:function(){t(e(this))},closeFAB:function(){a(e(this))}});var t=function(t){if($this=t,!1===$this.hasClass("active")){var a=$this.hasClass("horizontal"),i,n;!0===a?n=40:i=40,$this.addClass("active"),$this.find("ul .btn-floating").velocity({scaleY:".4",scaleX:".4",translateY:i+"px",translateX:n+"px"},{duration:0});var s=0;$this.find("ul .btn-floating").reverse().each(function(){e(this).velocity({opacity:"1",scaleX:"1",scaleY:"1",translateY:"0",translateX:"0"},{duration:80,delay:s}),s+=40})}},a=function(e){$this=e;var t=$this.hasClass("horizontal"),a,i;!0===t?i=40:a=40,$this.removeClass("active");$this.find("ul .btn-floating").velocity("stop",!0),$this.find("ul .btn-floating").velocity({opacity:"0",scaleX:".4",scaleY:".4",translateY:a+"px",translateX:i+"px"},{duration:80})}})(h);(function(t){Materialize.fadeInImage=function(e){var a=t(e);a.css({opacity:0}),t(a).velocity({opacity:1},{duration:650,queue:!1,easing:"easeOutSine"}),t(a).velocity({opacity:1},{duration:1300,queue:!1,easing:"swing",step:function(e,a){a.start=100;var i=e/100,n=150-(100-e)/1.75;100>n&&(n=100),0<=e&&t(this).css({"-webkit-filter":"grayscale("+i+")brightness("+n+"%)",filter:"grayscale("+i+")brightness("+n+"%)"})}})},Materialize.showStaggeredList=function(e){var a=0;t(e).find("li").velocity({translateX:"-100px"},{duration:0}),t(e).find("li").each(function(){t(this).velocity({opacity:"1",translateX:"0"},{duration:800,delay:a,easing:[60,10]}),a+=120})},t(document).ready(function(){var a=!1,i=!1;t(".dismissable").each(function(){t(this).hammer({prevent_default:!1}).bind("pan",function(n){if("touch"===n.gesture.pointerType){var e=t(this),s=n.gesture.direction,o=n.gesture.deltaX,d=n.gesture.velocityX;e.velocity({translateX:o},{duration:50,queue:!1,easing:"easeOutQuad"}),4===s&&(o>e.innerWidth()/2||-.75>d)&&(a=!0),2===s&&(o<-1*e.innerWidth()/2||.75<d)&&(i=!0)}}).bind("panend",function(n){if(L(n.gesture.deltaX)<t(this).innerWidth()/2&&(i=!1,a=!1),"touch"===n.gesture.pointerType){var e=t(this);if(a||i){var s;s=a?e.innerWidth():-1*e.innerWidth(),e.velocity({translateX:s},{duration:100,queue:!1,easing:"easeOutQuad",complete:function(){e.css("border","none"),e.velocity({height:0,padding:0},{duration:200,queue:!1,easing:"easeOutQuad",complete:function(){e.remove()}})}})}else e.velocity({translateX:0},{duration:100,queue:!1,easing:"easeOutQuad"});a=!1,i=!1}})})})})(h);(function(){Materialize.scrollFire=function(e){var t=!1;window.addEventListener("scroll",function(){t=!0}),setInterval(function(){if(t){t=!1;for(var a=window.pageYOffset+window.innerHeight,n=0;n<e.length;n++){var s=e[n],o=s.selector,d=s.offset,c=s.callback,r=document.querySelector(o);if(null!==r){var l=r.getBoundingClientRect().top+window.pageYOffset;if(a>l+d&&!0!==s.done){if("function"==typeof c)c.call(this);else if("string"==typeof c){var p=new Function(c);p()}s.done=!0}}}}},100)}})(h);(function(e){Materialize.DefaultDatePicker=e(h)})(function(e){function t(s,d,l,p){function u(){return t._.node("div",t._.node("div",t._.node("div",t._.node("div",k.component.nodes(b.open),w.box),w.wrap),w.frame),w.holder)}function m(){C.data(d,k).addClass(w.input).attr("tabindex",-1).val(C.data("value")?k.get("select",x.format):s.value),x.editable||C.on("focus."+b.id+" click."+b.id,function(e){e.preventDefault(),k.$root.eq(0).focus()}).on("keydown."+b.id,v),n(s,{haspopup:!0,expanded:!1,readonly:!1,owns:s.id+"_root"})}function g(){k.$root.on({keydown:v,focusin:function(e){k.$root.removeClass(w.focused),e.stopPropagation()},"mousedown click":function(t){var a=t.target;a!=k.$root.children()[0]&&(t.stopPropagation(),"mousedown"==t.type&&!e(a).is("input, select, textarea, button, option")&&(t.preventDefault(),k.$root.eq(0).focus()))}}).on({focus:function(){C.addClass(w.target)},blur:function(){C.removeClass(w.target)}}).on("focus.toOpen",A).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var t=e(this),a=t.data(),i=t.hasClass(w.navDisabled)||t.hasClass(w.disabled),n=o();n=n&&(n.type||n.href),(i||n&&!e.contains(k.$root[0],n))&&k.$root.eq(0).focus(),!i&&a.nav?k.set("highlight",k.component.item.highlight,{nav:a.nav}):!i&&"pick"in a?k.set("select",a.pick):a.clear?k.clear().close(!0):a.close&&k.close(!0)}),n(k.$root[0],"hidden",!0)}function h(){var t;!0===x.hiddenName?(t=s.name,s.name=""):(t=["string"==typeof x.hiddenPrefix?x.hiddenPrefix:"","string"==typeof x.hiddenSuffix?x.hiddenSuffix:"_submit"],t=t[0]+s.name+t[1]),k._hidden=e("<input type=hidden name=\""+t+"\""+(C.data("value")||s.value?" value=\""+k.get("select",x.formatSubmit)+"\"":"")+">")[0],C.on("change."+b.id,function(){k._hidden.value=s.value?k.get("select",x.formatSubmit):""}),x.container?e(x.container).append(k._hidden):C.after(k._hidden)}function v(e){var t=e.keyCode,a=/^(8|46)$/.test(t);return 27==t?(k.close(),!1):void((32==t||a||!b.open&&k.component.key[t])&&(e.preventDefault(),e.stopPropagation(),a?k.clear().close():k.open()))}function A(e){e.stopPropagation(),"focus"==e.type&&k.$root.addClass(w.focused),k.open()}if(!s)return t;var f=!1,b={id:s.id||"P"+L(~~(Math.random()*new Date))},x=l?e.extend(!0,{},l.defaults,p):p||{},w=e.extend({},t.klasses(),x.klass),C=e(s),S=function(){return this.start()},k=S.prototype={constructor:S,$node:C,start:function(){return b&&b.start?k:(b.methods={},b.start=!0,b.open=!1,b.type=s.type,s.autofocus=s==o(),s.readOnly=!x.editable,s.id=s.id||b.id,"text"!=s.type&&(s.type="text"),k.component=new l(k,x),k.$root=e(t._.node("div",u(),w.picker,"id=\""+s.id+"_root\" tabindex=\"0\"")),g(),x.formatSubmit&&h(),m(),x.container?e(x.container).append(k.$root):C.after(k.$root),k.on({start:k.component.onStart,render:k.component.onRender,stop:k.component.onStop,open:k.component.onOpen,close:k.component.onClose,set:k.component.onSet}).on({start:x.onStart,render:x.onRender,stop:x.onStop,open:x.onOpen,close:x.onClose,set:x.onSet}),f=a(k.$root.children()[0]),s.autofocus&&k.open(),k.trigger("start").trigger("render"))},render:function(e){return e?k.$root.html(u()):k.$root.find("."+w.box).html(k.component.nodes(b.open)),k.trigger("render")},stop:function(){return b.start?(k.close(),k._hidden&&k._hidden.parentNode.removeChild(k._hidden),k.$root.remove(),C.removeClass(w.input).removeData(d),setTimeout(function(){C.off("."+b.id)},0),s.type=b.type,s.readOnly=!1,k.trigger("stop"),b.methods={},b.start=!1,k):k},open:function(a){return b.open?k:(C.addClass(w.active),n(s,"expanded",!0),setTimeout(function(){k.$root.addClass(w.opened),n(k.$root[0],"hidden",!1)},0),!1!==a&&(b.open=!0,f&&r.css("overflow","hidden").css("padding-right","+="+i()),k.$root.eq(0).focus(),c.on("click."+b.id+" focusin."+b.id,function(e){var t=e.target;t!=s&&t!=document&&3!=e.which&&k.close(t===k.$root.children()[0])}).on("keydown."+b.id,function(a){var i=a.keyCode,n=k.component.key[i],s=a.target;27==i?k.close(!0):s==k.$root[0]&&(n||13==i)?(a.preventDefault(),n?t._.trigger(k.component.key.go,k,[t._.trigger(n)]):!k.$root.find("."+w.highlighted).hasClass(w.disabled)&&k.set("select",k.component.item.highlight).close()):e.contains(k.$root[0],s)&&13==i&&(a.preventDefault(),s.click())})),k.trigger("open"))},close:function(e){return(e&&(k.$root.off("focus.toOpen").eq(0).focus(),setTimeout(function(){k.$root.on("focus.toOpen",A)},0)),C.removeClass(w.active),n(s,"expanded",!1),setTimeout(function(){k.$root.removeClass(w.opened+" "+w.focused),n(k.$root[0],"hidden",!0)},0),!b.open)?k:(b.open=!1,f&&r.css("overflow","").css("padding-right","-="+i()),c.off("."+b.id),k.trigger("close"))},clear:function(e){return k.set("clear",null,e)},set:function(t,a,i){var n=e.isPlainObject(t),s=n?t:{},o,d;if(i=n&&e.isPlainObject(a)?a:i||{},t){for(o in n||(s[t]=a),s)d=s[o],o in k.component.item&&(void 0===d&&(d=null),k.component.set(o,d,i)),("select"==o||"clear"==o)&&C.val("clear"==o?"":k.get(o,x.format)).trigger("change");k.render()}return i.muted?k:k.trigger("set",s)},get:function(e,a){if(e=e||"value",null!=b[e])return b[e];if("valueSubmit"==e){if(k._hidden)return k._hidden.value;e="value"}if("value"==e)return s.value;if(e in k.component.item){if("string"==typeof a){var i=k.component.get(e);return i?t._.trigger(k.component.formats.toString,k.component,[a,i]):""}return k.component.get(e)}},on:function(t,a,i){var n=e.isPlainObject(t),s=n?t:{},o,d;if(t)for(o in n||(s[t]=a),s)d=s[o],i&&(o="_"+o),b.methods[o]=b.methods[o]||[],b.methods[o].push(d);return k},off:function(){var e=arguments,t,a;for(t=0,namesCount=e.length;t<namesCount;t+=1)a=e[t],a in b.methods&&delete b.methods[a];return k},trigger:function(e,a){var i=function(e){var i=b.methods[e];i&&i.map(function(e){t._.trigger(e,k,[a])})};return i("_"+e),i(e),k}};return new S}function a(e){var t;return e.currentStyle?t=e.currentStyle.position:window.getComputedStyle&&(t=getComputedStyle(e).position),"fixed"==t}function i(){if(r.height()<=d.height())return 0;var t=e("<div style=\"visibility:hidden;width:100px\" />").appendTo("body"),a=t[0].offsetWidth;t.css("overflow","scroll");var i=e("<div style=\"width:100%\" />").appendTo(t),n=i[0].offsetWidth;return t.remove(),a-n}function n(t,a,i){if(e.isPlainObject(a))for(var n in a)s(t,n,a[n]);else s(t,a,i)}function s(e,t,a){e.setAttribute(("role"==t?"":"aria-")+t,a)}function o(){try{return document.activeElement}catch(e){}}var d=e(window),c=e(document),r=e(document.documentElement);return t.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},t._={group:function(e){for(var a="",i=t._.trigger(e.min,e),n;i<=t._.trigger(e.max,e,[i]);i+=e.i)n=t._.trigger(e.item,e,[i]),a+=t._.node(e.node,n[0],n[1],n[2]);return a},node:function(t,a,i,n){return a?(a=e.isArray(a)?a.join(""):a,i=i?" class=\""+i+"\"":"",n=n?" "+n:"","<"+t+i+n+">"+a+"</"+t+">"):""},lead:function(e){return(10>e?"0":"")+e},trigger:function(e,t,a){return"function"==typeof e?e.apply(t,a||[]):e},digits:function(e){return /\d/.test(e[1])?2:1},isDate:function(e){return-1<{}.toString.call(e).indexOf("Date")&&this.isInteger(e.getDate())},isInteger:function(e){return-1<{}.toString.call(e).indexOf("Number")&&0==e%1},ariaAttr:function(t,a){for(var i in e.isPlainObject(t)||(t={attribute:a}),a="",t){var n=("role"==i?"":"aria-")+i,s=t[i];a+=null==s?"":n+"=\""+t[i]+"\""}return a}},t.extend=function(a,i){e.fn[a]=function(n,s){var o=this.data(a);return"picker"==n?o:o&&"string"==typeof n?t._.trigger(o[n],o,[s]):this.each(function(){var s=e(this);s.data(a)||new t(this,a,i,n)})},e.fn[a].defaults=i.defaults},t});(function(e){e(Materialize.DefaultDatePicker,h)})(function(e,t){function a(e,t){var a=this,i=e.$node[0],n=i.value,s=e.$node.data("value"),o=s||n,d=s?t.formatSubmit:t.format,c=function(){return i.currentStyle?"rtl"==i.currentStyle.direction:"rtl"==getComputedStyle(e.$root[0]).direction};a.settings=t,a.$node=e.$node,a.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse navigate create validate",view:"parse create validate viewset",disable:"deactivate",enable:"activate"},a.item={},a.item.clear=null,a.item.disable=(t.disable||[]).slice(0),a.item.enable=-function(e){return!0===e[0]?e.shift():-1}(a.item.disable),a.set("min",t.min).set("max",t.max).set("now"),o?a.set("select",o,{format:d}):a.set("select",null).set("highlight",a.item.now),a.key={40:7,38:-7,39:function(){return c()?-1:1},37:function(){return c()?1:-1},go:function(e){var t=a.item.highlight,i=new Date(t.year,t.month,t.date+e);a.set("highlight",i,{interval:e}),this.render()}},e.on("render",function(){e.$root.find("."+t.klass.selectMonth).on("change",function(){var a=this.value;a&&(e.set("highlight",[e.get("view").year,a,e.get("highlight").date]),e.$root.find("."+t.klass.selectMonth).trigger("focus"))}),e.$root.find("."+t.klass.selectYear).on("change",function(){var a=this.value;a&&(e.set("highlight",[a,e.get("view").month,e.get("highlight").date]),e.$root.find("."+t.klass.selectYear).trigger("focus"))})},1).on("open",function(){var i="";a.disabled(a.get("now"))&&(i=":not(."+t.klass.buttonToday+")"),e.$root.find("button"+i+", select").attr("disabled",!1)},1).on("close",function(){e.$root.find("button, select").attr("disabled",!0)},1)}var i=e._;a.prototype.set=function(e,t,a){var i=this,n=i.item;return null===t?("clear"==e&&(e="select"),n[e]=t,i):(n["enable"==e?"disable":"flip"==e?"enable":e]=i.queue[e].split(" ").map(function(n){return t=i[n](e,t,a),t}).pop(),"select"==e?i.set("highlight",n.select,a):"highlight"==e?i.set("view",n.highlight,a):e.match(/^(flip|min|max|disable|enable)$/)&&(n.select&&i.disabled(n.select)&&i.set("select",n.select,a),n.highlight&&i.disabled(n.highlight)&&i.set("highlight",n.highlight,a)),i)},a.prototype.get=function(e){return this.item[e]},a.prototype.create=function(e,a,n){var s=this,o;return a=void 0===a?e:a,a==-Infinity||a==1/0?o=a:t.isPlainObject(a)&&i.isInteger(a.pick)?a=a.obj:t.isArray(a)?(a=new Date(a[0],a[1],a[2]),a=i.isDate(a)?a:s.create().obj):i.isInteger(a)||i.isDate(a)?a=s.normalize(new Date(a),n):a=s.now(e,a,n),{year:o||a.getFullYear(),month:o||a.getMonth(),date:o||a.getDate(),day:o||a.getDay(),obj:o||a,pick:o||a.getTime()}},a.prototype.createRange=function(e,a){var n=this,s=function(e){return!0===e||t.isArray(e)||i.isDate(e)?n.create(e):e};return i.isInteger(e)||(e=s(e)),i.isInteger(a)||(a=s(a)),i.isInteger(e)&&t.isPlainObject(a)?e=[a.year,a.month,a.date+e]:i.isInteger(a)&&t.isPlainObject(e)&&(a=[e.year,e.month,e.date+a]),{from:s(e),to:s(a)}},a.prototype.withinRange=function(e,t){return e=this.createRange(e.from,e.to),t.pick>=e.from.pick&&t.pick<=e.to.pick},a.prototype.overlapRanges=function(e,t){var a=this;return e=a.createRange(e.from,e.to),t=a.createRange(t.from,t.to),a.withinRange(e,t.from)||a.withinRange(e,t.to)||a.withinRange(t,e.from)||a.withinRange(t,e.to)},a.prototype.now=function(e,t,a){return t=new Date,a&&a.rel&&t.setDate(t.getDate()+a.rel),this.normalize(t,a)},a.prototype.navigate=function(e,a,i){var n=t.isArray(a),s=t.isPlainObject(a),o=this.item.view,d,c,r,l;if(n||s){for(s?(c=a.year,r=a.month,l=a.date):(c=+a[0],r=+a[1],l=+a[2]),i&&i.nav&&o&&o.month!==r&&(c=o.year,r=o.month),d=new Date(c,r+(i&&i.nav?i.nav:0),1),c=d.getFullYear(),r=d.getMonth();new Date(c,r,l).getMonth()!==r;)l-=1;a=[c,r,l]}return a},a.prototype.normalize=function(e){return e.setHours(0,0,0,0),e},a.prototype.measure=function(e,t){var a=this;return t?"string"==typeof t?t=a.parse(e,t):i.isInteger(t)&&(t=a.now(e,t,{rel:t})):t="min"==e?-Infinity:1/0,t},a.prototype.viewset=function(e,t){return this.create([t.year,t.month,1])},a.prototype.validate=function(e,a,n){var s=this,o=a,d=n&&n.interval?n.interval:1,c=-1===s.item.enable,r=s.item.min,l=s.item.max,p=c&&s.item.disable.filter(function(e){if(t.isArray(e)){var n=s.create(e).pick;n<a.pick?u=!0:n>a.pick&&(m=!0)}return i.isInteger(e)}).length,u,m,g,h;if((!n||!n.nav)&&(!c&&s.disabled(a)||c&&s.disabled(a)&&(p||u||m)||!c&&(a.pick<=r.pick||a.pick>=l.pick)))for(c&&!p&&(!m&&0<d||!u&&0>d)&&(d*=-1);s.disabled(a)&&(1<L(d)&&(a.month<o.month||a.month>o.month)&&(a=o,d=0<d?1:-1),a.pick<=r.pick?(g=!0,d=1,a=s.create([r.year,r.month,r.date+(a.pick===r.pick?0:-1)])):a.pick>=l.pick&&(h=!0,d=-1,a=s.create([l.year,l.month,l.date+(a.pick===l.pick?0:1)])),!(g&&h));)a=s.create([a.year,a.month,a.date+d]);return a},a.prototype.disabled=function(e){var a=this,n=a.item.disable.filter(function(n){return i.isInteger(n)?e.day===(a.settings.firstDay?n:n-1)%7:t.isArray(n)||i.isDate(n)?e.pick===a.create(n).pick:t.isPlainObject(n)?a.withinRange(n,e):void 0});return n=n.length&&!n.filter(function(e){return t.isArray(e)&&"inverted"==e[3]||t.isPlainObject(e)&&e.inverted}).length,-1===a.item.enable?!n:n||e.pick<a.item.min.pick||e.pick>a.item.max.pick},a.prototype.parse=function(e,t,a){var n=this,s={};return t&&"string"==typeof t?(a&&a.format||(a=a||{},a.format=n.settings.format),n.formats.toArray(a.format).map(function(e){var a=n.formats[e],o=a?i.trigger(a,n,[t,s]):e.replace(/^!/,"").length;a&&(s[e]=t.substr(0,o)),t=t.substr(o)}),[s.yyyy||s.yy,+(s.mm||s.m)-1,s.dd||s.d]):t},a.prototype.formats=function(){function e(e,t,a){var i=e.match(/\w+/)[0];return a.mm||a.m||(a.m=t.indexOf(i)+1),i.length}function t(e){return e.match(/\w+/)[0].length}return{d:function(e,t){return e?i.digits(e):t.date},dd:function(e,t){return e?2:i.lead(t.date)},ddd:function(e,a){return e?t(e):this.settings.weekdaysShort[a.day]},dddd:function(e,a){return e?t(e):this.settings.weekdaysFull[a.day]},m:function(e,t){return e?i.digits(e):t.month+1},mm:function(e,t){return e?2:i.lead(t.month+1)},mmm:function(t,a){var i=this.settings.monthsShort;return t?e(t,i,a):i[a.month]},mmmm:function(t,a){var i=this.settings.monthsFull;return t?e(t,i,a):i[a.month]},yy:function(e,t){return e?2:(""+t.year).slice(2)},yyyy:function(e,t){return e?4:t.year},toArray:function(e){return e.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(e,t){var a=this;return a.formats.toArray(e).map(function(e){return i.trigger(a.formats[e],a,[0,t])||e.replace(/^!/,"")}).join("")}}}(),a.prototype.isDateExact=function(e,a){var n=this;return i.isInteger(e)&&i.isInteger(a)||"boolean"==typeof e&&"boolean"==typeof a?e===a:(i.isDate(e)||t.isArray(e))&&(i.isDate(a)||t.isArray(a))?n.create(e).pick===n.create(a).pick:!!(t.isPlainObject(e)&&t.isPlainObject(a))&&n.isDateExact(e.from,a.from)&&n.isDateExact(e.to,a.to)},a.prototype.isDateOverlap=function(e,a){var n=this,s=n.settings.firstDay?1:0;return i.isInteger(e)&&(i.isDate(a)||t.isArray(a))?(e=e%7+s,e===n.create(a).day+1):i.isInteger(a)&&(i.isDate(e)||t.isArray(e))?(a=a%7+s,a===n.create(e).day+1):!!(t.isPlainObject(e)&&t.isPlainObject(a))&&n.overlapRanges(e,a)},a.prototype.flipEnable=function(e){var t=this.item;t.enable=e||(-1==t.enable?1:-1)},a.prototype.deactivate=function(e,a){var n=this,s=n.item.disable.slice(0);return"flip"==a?n.flipEnable():!1===a?(n.flipEnable(1),s=[]):!0===a?(n.flipEnable(-1),s=[]):a.map(function(e){for(var a=0,o;a<s.length;a+=1)if(n.isDateExact(e,s[a])){o=!0;break}!o&&(i.isInteger(e)||i.isDate(e)||t.isArray(e)||t.isPlainObject(e)&&e.from&&e.to)&&s.push(e)}),s},a.prototype.activate=function(e,a){var n=this,s=n.item.disable,o=s.length;return"flip"==a?n.flipEnable():!0===a?(n.flipEnable(1),s=[]):!1===a?(n.flipEnable(-1),s=[]):a.map(function(e){var a,d,c,r;for(c=0;c<o;c+=1)if(d=s[c],n.isDateExact(d,e)){a=s[c]=null,r=!0;break}else if(n.isDateOverlap(d,e)){t.isPlainObject(e)?(e.inverted=!0,a=e):t.isArray(e)?(a=e,!a[3]&&a.push("inverted")):i.isDate(e)&&(a=[e.getFullYear(),e.getMonth(),e.getDate(),"inverted"]);break}if(a)for(c=0;c<o;c+=1)if(n.isDateExact(s[c],e)){s[c]=null;break}if(r)for(c=0;c<o;c+=1)if(n.isDateOverlap(s[c],e)){s[c]=null;break}a&&s.push(a)}),s.filter(function(e){return null!=e})},a.prototype.nodes=function(e){var t=this,a=t.settings,n=t.item,s=n.now,o=n.select,d=n.highlight,c=n.view,r=n.disable,l=n.min,p=n.max,u=function(e,t){return a.firstDay&&(e.push(e.shift()),t.push(t.shift())),i.node("thead",i.node("tr",i.group({min:0,max:6,i:1,node:"th",item:function(i){return[e[i],a.klass.weekdays,"scope=col title=\""+t[i]+"\""]}})))}((a.showWeekdaysFull?a.weekdaysFull:a.weekdaysLetter).slice(0),a.weekdaysFull.slice(0)),m=function(e){return i.node("div"," ",a.klass["nav"+(e?"Next":"Prev")]+(e&&c.year>=p.year&&c.month>=p.month||!e&&c.year<=l.year&&c.month<=l.month?" "+a.klass.navDisabled:""),"data-nav="+(e||-1)+" "+i.ariaAttr({role:"button",controls:t.$node[0].id+"_table"})+" title=\""+(e?a.labelMonthNext:a.labelMonthPrev)+"\"")},g=function(n){var s=a.showMonthsShort?a.monthsShort:a.monthsFull;return"short_months"==n&&(s=a.monthsShort),a.selectMonths&&null==n?i.node("select",i.group({min:0,max:11,i:1,node:"option",item:function(e){return[s[e],0,"value="+e+(c.month==e?" selected":"")+(c.year==l.year&&e<l.month||c.year==p.year&&e>p.month?" disabled":"")]}}),a.klass.selectMonth+" browser-default",(e?"":"disabled")+" "+i.ariaAttr({controls:t.$node[0].id+"_table"})+" title=\""+a.labelMonthSelect+"\""):"short_months"==n?null==o?i.node("div",s[c.month]):i.node("div",s[o.month]):i.node("div",s[c.month],a.klass.month)},h=function(n){var s=c.year,o=!0===a.selectYears?5:~~(a.selectYears/2);if(o){var d=l.year,r=p.year,u=s-o,m=s+o;if(d>u&&(m+=d-u,u=d),r<m){var g=u-d,h=m-r;u-=g>h?h:g,m=r}if(a.selectYears&&null==n)return i.node("select",i.group({min:u,max:m,i:1,node:"option",item:function(e){return[e,0,"value="+e+(s==e?" selected":"")]}}),a.klass.selectYear+" browser-default",(e?"":"disabled")+" "+i.ariaAttr({controls:t.$node[0].id+"_table"})+" title=\""+a.labelYearSelect+"\"")}return"raw"==n?i.node("div",s):i.node("div",s,a.klass.year)};return createDayLabel=function(){return null==o?i.node("div",s.date):i.node("div",o.date)},createWeekdayLabel=function(){var e=null==o?s.day:o.day;var t=a.weekdaysFull[e];return t},i.node("div",i.node("div",createWeekdayLabel(),a.klass.weekday_display)+i.node("div",g("short_months"),a.klass.month_display)+i.node("div",createDayLabel(),a.klass.day_display)+i.node("div",h("raw"),a.klass.year_display),a.klass.date_display)+i.node("div",i.node("div",(a.selectYears?g()+h():g()+h())+m()+m(1),a.klass.header)+i.node("table",u+i.node("tbody",i.group({min:0,max:5,i:1,node:"tr",item:function(e){var n=a.firstDay&&0===t.create([c.year,c.month,1]).day?-7:0;return[i.group({min:7*e-c.day+n+1,max:function(){return this.min+7-1},i:1,node:"td",item:function(e){e=t.create([c.year,c.month,e+(a.firstDay?1:0)]);var n=o&&o.pick==e.pick,u=d&&d.pick==e.pick,m=r&&t.disabled(e)||e.pick<l.pick||e.pick>p.pick,g=i.trigger(t.formats.toString,t,[a.format,e]);return[i.node("div",e.date,function(t){return t.push(c.month==e.month?a.klass.infocus:a.klass.outfocus),s.pick==e.pick&&t.push(a.klass.now),n&&t.push(a.klass.selected),u&&t.push(a.klass.highlighted),m&&t.push(a.klass.disabled),t.join(" ")}([a.klass.day]),"data-pick="+e.pick+" "+i.ariaAttr({role:"gridcell",label:g,selected:!!(n&&t.$node.val()===g)||null,activedescendant:!!u||null,disabled:!!m||null})),"",i.ariaAttr({role:"presentation"})]}})]}})),a.klass.table,"id=\""+t.$node[0].id+"_table\" "+i.ariaAttr({role:"grid",controls:t.$node[0].id,readonly:!0})),a.klass.calendar_container)+i.node("div",i.node("button",a.today,a.klass.buttonToday,"type=button data-pick="+s.pick+(e&&!t.disabled(s)?"":" disabled")+" "+i.ariaAttr({controls:t.$node[0].id}))+i.node("button",a.clear,a.klass.buttonClear,"type=button data-clear=1"+(e?"":" disabled")+" "+i.ariaAttr({controls:t.$node[0].id}))+i.node("button",a.close,a.klass.buttonClose,"type=button data-close=true "+(e?"":" disabled")+" "+i.ariaAttr({controls:t.$node[0].id})),a.klass.footer)},a.defaults=function(e){return{labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdaysLetter:["S","M","T","W","T","F","S"],today:"Today",clear:"Clear",close:"Close",format:"d mmmm, yyyy",klass:{table:e+"table",header:e+"header",date_display:e+"date-display",day_display:e+"day-display",month_display:e+"month-display",year_display:e+"year-display",calendar_container:e+"calendar-container",navPrev:e+"nav--prev",navNext:e+"nav--next",navDisabled:e+"nav--disabled",month:e+"month",year:e+"year",selectMonth:e+"select--month",selectYear:e+"select--year",weekdays:e+"weekday",day:e+"day",disabled:e+"day--disabled",selected:e+"day--selected",highlighted:e+"day--highlighted",now:e+"day--today",infocus:e+"day--infocus",outfocus:e+"day--outfocus",footer:e+"footer",buttonClear:e+"button--clear",buttonToday:e+"button--today",buttonClose:e+"button--close"}}}(e.klasses().picker+"__"),e.extend("pickadate",a)});(function(e){function t(){var t=+e(this).attr("length"),a=+e(this).val().length;e(this).parent().find("span[class=\"character-counter\"]").html(a+"/"+t),n(a<=t,e(this))}function a(t){var a=t.parent().find("span[class=\"character-counter\"]");a.length||(a=e("<span/>").addClass("character-counter").css("float","right").css("font-size","12px").css("height",1),t.parent().append(a))}function i(){e(this).parent().find("span[class=\"character-counter\"]").html("")}function n(e,t){var a=t.hasClass("invalid");e&&a?t.removeClass("invalid"):!e&&!a&&(t.removeClass("valid"),t.addClass("invalid"))}e.fn.characterCounter=function(){return this.each(function(){var n=e(this),s=n.parent().find("span[class=\"character-counter\"]");if(!s.length){var o=void 0!==n.attr("length");o&&(n.on("input",t),n.on("focus",t),n.on("blur",i),a(n))}})},e(document).ready(function(){e("input, textarea").characterCounter()})})(h);(function(t){var e={init:function(a){return a=t.extend({time_constant:200,dist:-100,shift:0,padding:0,full_width:!1},a),this.each(function(){function i(t){return t.targetTouches&&1<=t.targetTouches.length?t.targetTouches[0].clientX:t.clientX}function n(t){return t.targetTouches&&1<=t.targetTouches.length?t.targetTouches[0].clientY:t.clientY}function s(e){return e>=w?e%w:0>e?s(w+e%w):e}function o(e){var t,n,o,d,c,r,l;for(h="number"==typeof e?e:h,v=F((h+b/2)/b),o=h-v*b,d=0>o?1:-1,c=2*(-d*o)/b,a.full_width?l="translateX(0)":(l="translateX("+(m[0].clientWidth-item_width)/2+"px) ",l+="translateY("+(m[0].clientHeight-item_width)/2+"px)"),r=g[s(v)],r.style[I]=l+" translateX("+-o/2+"px) translateX("+d*a.shift*c*t+"px) translateZ("+a.dist*c+"px)",r.style.zIndex=0,tweenedOpacity=a.full_width?1:1-.2*c,r.style.opacity=tweenedOpacity,n=w>>1,t=1;t<=n;++t)a.full_width?(zTranslation=a.dist,tweenedOpacity=t===n&&0>o?1-c:1):(zTranslation=a.dist*(2*t+c*d),tweenedOpacity=1-.2*(2*t+c*d)),r=g[s(v+t)],r.style[I]=l+" translateX("+(a.shift+(b*t-o)/2)+"px) translateZ("+zTranslation+"px)",r.style.zIndex=-t,r.style.opacity=tweenedOpacity,a.full_width?(zTranslation=a.dist,tweenedOpacity=t===n&&0<o?1-c:1):(zTranslation=a.dist*(2*t-c*d),tweenedOpacity=1-.2*(2*t-c*d)),r=g[s(v-t)],r.style[I]=l+" translateX("+(-a.shift+(-b*t-o)/2)+"px) translateZ("+zTranslation+"px)",r.style.zIndex=-t,r.style.opacity=tweenedOpacity;r=g[s(v)],r.style[I]=l+" translateX("+-o/2+"px) translateX("+d*a.shift*c+"px) translateZ("+a.dist*c+"px)",r.style.zIndex=0,tweenedOpacity=a.full_width?1:1-.2*c,r.style.opacity=tweenedOpacity}function d(){var e,t,a,i;e=Date.now(),t=e-R,R=e,a=h-N,N=h,i=1e3*a/(1+t),T=.8*i+.2*T}function c(){var e,t;k&&(e=Date.now()-R,t=k*A(-e/a.time_constant),2<t||-2>t?(o(E-t),requestAnimationFrame(c)):o(E))}function r(i){if(j)return i.preventDefault(),i.stopPropagation(),!1;if(!a.full_width){var e=t(i.target).closest(".carousel-item").index(),n=v%w-e;0>n?L(n+w)<L(n)&&(n+=w):0<n&&L(n-w)<n&&(n-=w),0>n?t(this).trigger("carouselNext",[L(n)]):0<n&&t(this).trigger("carouselPrev",[n])}}function l(t){f=!0,j=!1,P=!1,C=i(t),S=n(t),T=k=0,N=h,R=Date.now(),clearInterval(O),O=setInterval(d,100)}function p(t){var e,a,s;if(f)if(e=i(t),y=n(t),a=C-e,s=L(S-y),30>s&&!P)(2<a||-2>a)&&(j=!0,C=e,o(h+a));else{if(j)return t.preventDefault(),t.stopPropagation(),!1;P=!0}return j?(t.preventDefault(),t.stopPropagation(),!1):void 0}function u(t){return f=!1,clearInterval(O),E=h,(10<T||-10>T)&&(k=.9*T,E=h+k),E=M(E/b)*b,k=E-h,R=Date.now(),requestAnimationFrame(c),t.preventDefault(),t.stopPropagation(),!1}var m=t(this),g,h,v,f,b,w,C,S,k,E,T,I,N,R,O,j,P;return!!m.hasClass("initialized")||void(a.full_width&&(a.dist=0,imageHeight=m.find(".carousel-item img").first().load(function(){m.css("height",t(this).height())})),m.addClass("initialized"),f=!1,h=E=0,g=[],item_width=m.find(".carousel-item").first().innerWidth(),b=2*item_width+a.padding,m.find(".carousel-item").each(function(){g.push(t(this)[0])}),w=g.length,I="transform",["webkit","Moz","O","ms"].every(function(t){var a=t+"Transform";return"undefined"==typeof document.body.style[a]||(I=a,!1)}),window.onresize=o,function(){"undefined"!=typeof window.ontouchstart&&(m[0].addEventListener("touchstart",l),m[0].addEventListener("touchmove",p),m[0].addEventListener("touchend",u)),m[0].addEventListener("mousedown",l),m[0].addEventListener("mousemove",p),m[0].addEventListener("mouseup",u),m[0].addEventListener("click",r)}(),o(h),t(this).on("carouselNext",function(t,e){void 0===e&&(e=1),E=h+b*e,h!==E&&(k=E-h,R=Date.now(),requestAnimationFrame(c))}),t(this).on("carouselPrev",function(t,e){void 0===e&&(e=1),E=h-b*e,h!==E&&(k=E-h,R=Date.now(),requestAnimationFrame(c))}))})},next:function(e){t(this).trigger("carouselNext",[e])},prev:function(e){t(this).trigger("carouselPrev",[e])}};t.fn.carousel=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));return"object"!=typeof a&&a?void t.error("Method "+a+" does not exist on jQuery.carousel"):e.init.apply(this,arguments)}})(h)});function VanillaQR(A){var x=this;A="object"==typeof A?A:{},x.revision=3,x.imageTypes={bmp:"image/bmp",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpg",png:"image/png","svg+xml":"image/svg+xml",tiff:"image/tiff",webp:"image/webp","x-icon":"image/x-icon"},x.toTable=A.toTable,x.domElement=x.toTable?document.createElement("div"):document.createElement("canvas"),x.url=A.url||"",x.size=A.size||280,x.qrc=!1,x.colorLight=A.colorLight||"#fff",x.colorDark=A.colorDark||"#000",x.ecclevel=A.ecclevel||1,x.noBorder=A.noBorder,x.borderSize=A.borderSize||4;var S=[],I=[],d=[],w=[],v=[],e=[],m=function(t,a){var i;t>a&&(i=t,t=a,a=i),i=a,i*=a,i+=a,i>>=1,i+=t,w[i]=1},u=function(t,a){var e;for(d[t+T*a]=1,e=-2;2>e;e++)d[t+e+T*(a-2)]=1,d[t-2+T*(a+e+1)]=1,d[t+2+T*(a+e)]=1,d[t+e+1+T*(a+2)]=1;for(e=0;2>e;e++)m(t-1,a+e),m(t+1,a-e),m(t-e,a-1),m(t+e,a+1)},g=function(e){for(;255<=e;)e-=255,e=(e>>8)+(255&e);return e},p=function(s,d,c,o){var a=VanillaQR.gexp,r=VanillaQR.glog,l,p,u;for(l=0;l<o;l++)S[c+l]=0;for(l=0;l<d;l++){if(u=r[S[s+l]^S[c]],255!=u)for(p=1;p<o;p++)S[c+p-1]=S[c+p]^a[g(u+e[o-p])];else for(p=c;p<c+o;p++)S[p]=S[p+1];S[c+o-1]=255==u?0:a[g(u+e[0])]}},h=function(t,a){var i;return t>a&&(i=t,t=a,a=i),i=a,i+=a*a,i>>=1,i+=t,w[i]},b=function(i){var n,s,c,r;switch(i){case 0:for(s=0;s<T;s++)for(n=0;n<T;n++)1&n+s||h(n,s)||(d[n+s*T]^=1);break;case 1:for(s=0;s<T;s++)for(n=0;n<T;n++)1&s||h(n,s)||(d[n+s*T]^=1);break;case 2:for(s=0;s<T;s++)for(c=0,n=0;n<T;n++,c++)3==c&&(c=0),c||h(n,s)||(d[n+s*T]^=1);break;case 3:for(r=0,s=0;s<T;s++,r++)for(3==r&&(r=0),c=r,n=0;n<T;n++,c++)3==c&&(c=0),c||h(n,s)||(d[n+s*T]^=1);break;case 4:for(s=0;s<T;s++)for(c=0,r=1&s>>1,n=0;n<T;n++,c++)3==c&&(c=0,r=!r),r||h(n,s)||(d[n+s*T]^=1);break;case 5:for(r=0,s=0;s<T;s++,r++)for(3==r&&(r=0),c=0,n=0;n<T;n++,c++)3==c&&(c=0),(1&(n&s))+!(!c|!r)||h(n,s)||(d[n+s*T]^=1);break;case 6:for(r=0,s=0;s<T;s++,r++)for(3==r&&(r=0),c=0,n=0;n<T;n++,c++)3==c&&(c=0),1&(1&(n&s))+(c&&c==r)||h(n,s)||(d[n+s*T]^=1);break;case 7:for(r=0,s=0;s<T;s++,r++)for(3==r&&(r=0),c=0,n=0;n<T;n++,c++)3==c&&(c=0),1&(c&&c==r)+(1&n+s)||h(n,s)||(d[n+s*T]^=1);}},C=function(t){var a=0,i;for(i=0;i<=t;i++)5<=v[i]&&(a+=VanillaQR.N1+v[i]-5);for(i=3;i<t-1;i+=2)v[i-2]==v[i+2]&&v[i+2]==v[i-1]&&v[i-1]==v[i+1]&&3*v[i-1]==v[i]&&(0==v[i-3]||i+3>t||3*v[i-3]>=4*v[i]||3*v[i+3]>=4*v[i])&&(a+=VanillaQR.N3);return a},E=function(){var n=0,s=0,p,u,m,g,h;for(u=0;u<T-1;u++)for(p=0;p<T-1;p++)(d[p+T*u]&&d[p+1+T*u]&&d[p+T*(u+1)]&&d[p+1+T*(u+1)]||!(d[p+T*u]||d[p+1+T*u]||d[p+T*(u+1)]||d[p+1+T*(u+1)]))&&(n+=VanillaQR.N2);for(u=0;u<T;u++){for(v[0]=0,m=g=p=0;p<T;p++)(h=d[p+T*u])==g?v[m]++:v[++m]=1,g=h,s+=g?1:-1;n+=C(m)}0>s&&(s=-s);var A=s,b=0;for(A+=A<<2,A<<=1;A>T*T;)A-=T*T,b++;for(n+=b*VanillaQR.N4,p=0;p<T;p++){for(v[0]=0,m=g=u=0;u<T;u++)(h=d[p+T*u])==g?v[m]++:v[++m]=1,g=h;n+=C(m)}return n},k,M,T,R,O,j,P;x.genframe=function(t){var a=VanillaQR.eccblocks,i=VanillaQR.gexp,n=VanillaQR.glog,s,o,c,r,l,v,A,f;r=t.length,M=0;do if(M++,c=4*(k-1)+16*(M-1),R=a[c++],O=a[c++],j=a[c++],P=a[c],c=j*(R+O)+O-3+(9>=M),r<=c)break;while(40>M);for(T=17+4*M,l=j+(j+P)*(R+O)+O,r=0;r<l;r++)I[r]=0;for(S=t.slice(0),r=0;r<T*T;r++)d[r]=0;for(r=0;r<(T*(T+1)+1)/2;r++)w[r]=0;for(r=0;3>r;r++){for(c=0,o=0,1==r&&(c=T-7),2==r&&(o=T-7),d[o+3+T*(c+3)]=1,s=0;6>s;s++)d[o+s+T*c]=1,d[o+T*(c+s+1)]=1,d[o+6+T*(c+s)]=1,d[o+s+1+T*(c+6)]=1;for(s=1;5>s;s++)m(o+s,c+1),m(o+1,c+s+1),m(o+5,c+s),m(o+s+1,c+5);for(s=2;4>s;s++)d[o+s+T*(c+2)]=1,d[o+2+T*(c+s+1)]=1,d[o+4+T*(c+s)]=1,d[o+s+1+T*(c+4)]=1}if(1<M)for(r=VanillaQR.adelta[M],o=T-7;;){for(s=T-7;s>r-3&&(u(s,o),!(s<r));)s-=r;if(o<=r+9)break;o-=r,u(6,o),u(o,6)}for(d[8+T*(T-8)]=1,o=0;7>o;o++)m(7,o),m(T-8,o),m(7,o+T-7);for(s=0;8>s;s++)m(s,7),m(s+T-8,7),m(s,T-8);for(s=0;9>s;s++)m(s,8);for(s=0;8>s;s++)m(s+T-8,8),m(8,s);for(o=0;7>o;o++)m(8,o+T-7);for(s=0;s<T-14;s++)1&s?(m(8+s,6),m(6,8+s)):(d[8+s+6*T]=1,d[6+T*(8+s)]=1);if(6<M)for(r=VanillaQR.vpat[M-7],c=17,s=0;6>s;s++)for(o=0;3>o;o++,c--)1&(11<c?M>>c-12:r>>c)?(d[5-s+T*(2-o+T-11)]=1,d[2-o+T-11+T*(5-s)]=1):(m(5-s,2-o+T-11),m(2-o+T-11,5-s));for(o=0;o<T;o++)for(s=0;s<=o;s++)d[s+T*o]&&m(s,o);for(l=S.length,v=0;v<l;v++)I[v]=S.charCodeAt(v);if(S=I.slice(0),s=j*(R+O)+O,l>=s-2&&(l=s-2,9<M&&l--),v=l,9<M){for(S[v+2]=0,S[v+3]=0;v--;)r=S[v],S[v+3]|=255&r<<4,S[v+2]=r>>4;S[2]|=255&l<<4,S[1]=l>>4,S[0]=64|l>>12}else{for(S[v+1]=0,S[v+2]=0;v--;)r=S[v],S[v+2]|=255&r<<4,S[v+1]=r>>4;S[1]|=255&l<<4,S[0]=64|l>>4}for(v=l+3-(10>M);v<s;)S[v++]=236,S[v++]=17;for(e[0]=1,v=0;v<P;v++){for(e[v+1]=1,A=v;0<A;A--)e[A]=e[A]?e[A-1]^i[g(n[e[A]]+v)]:e[A-1];e[0]=i[g(n[e[0]]+v)]}for(v=0;v<=P;v++)e[v]=n[e[v]];for(c=s,o=0,v=0;v<R;v++)p(o,j,c,P),o+=j,c+=P;for(v=0;v<O;v++)p(o,j+1,c,P),o+=j+1,c+=P;for(o=0,v=0;v<j;v++){for(A=0;A<R;A++)I[o++]=S[v+A*j];for(A=0;A<O;A++)I[o++]=S[R*j+v+A*(j+1)]}for(A=0;A<O;A++)I[o++]=S[R*j+v+A*(j+1)];for(v=0;v<P;v++)for(A=0;A<R+O;A++)I[o++]=S[s+v+A*P];for(S=I,s=o=T-1,c=l=1,f=(j+P)*(R+O)+O,v=0;v<f;v++)for(r=S[v],A=0;8>A;A++,r<<=1){128&r&&(d[s+T*o]=1);do l?s--:(s++,c?0==o?(s-=2,c=!c,6==s&&(s--,o=9)):o--:o==T-1?(s-=2,c=!c,6==s&&(s--,o-=8)):o++),l=!l;while(h(s,o))}for(S=d.slice(0),r=0,o=3e4,c=0;8>c&&(b(c),s=E(),s<o&&(o=s,r=c),7!=r);c++)d=S.slice(0);for(r!=c&&b(r),o=VanillaQR.fmtword[r+(k-1<<3)],c=0;8>c;c++,o>>=1)1&o&&(d[T-1-c+8*T]=1,6>c?d[8+T*c]=1:d[8+T*(c+1)]=1);for(c=0;7>c;c++,o>>=1)1&o&&(d[8+T*(T-7+c)]=1,c?d[6-c+8*T]=1:d[7+8*T]=1);return d},x.init=function(){k=x.ecclevel;var e=x.genframe(x.url);x.toTable?x.tableWrite(e,T):x.canvasWrite(e,T)},x.init()}VanillaQR.prototype={canvasWrite:function(s,d){var e=this;if(!e.qrc&&(e.qrc=e.getContext(e.domElement),!e.qrc))return e.toTable=!0,e.domElement=document.createElement("div"),void e.tableWrite(s,d);var o=e.size,a=e.qrc;a.lineWidth=1;var n=o;n/=d+10,n=Math.round(n-.5);var c=4;e.noBorder?(a.canvas.width=a.canvas.height=n*d,c=0):a.canvas.width=a.canvas.height=o,a.clearRect(0,0,o,o),a.fillStyle=e.colorLight,a.fillRect(0,0,n*(d+8),n*(d+8)),a.fillStyle=e.colorDark;for(var r=0;r<d;r++)for(var p=0;p<d;p++)s[p*d+r]&&a.fillRect(n*(c+r),n*(c+p),n,n)},tableWrite:function(a,r){var A=this,e=Math.round(this.size/r-3.5)+"px",o=r+(A.noBorder?0:2*A.borderSize),t=A.borderSize,i="width:"+e+";height:"+e+";",n=A.colorLight,l=A.colorDark,c=document.createElement("table");c.style.cssText="border:0;border-collapse:collapse;";for(var d=document.createElement("tr"),s=document.createElement("td"),v=function(){return s.cloneNode()},g=function(){var e=v();return e.style.cssText=i+"background:"+l,e},m=function(){var e=v();return e.style.cssText=i+"background:"+n,e},u=function(t){for(var s=t.firstChild,e=0;e<A.borderSize;e++){for(var c=d.cloneNode(),n=0,r;n<o;n++)r=m(),c.appendChild(r);t.appendChild(c),t.insertBefore(c.cloneNode(!0),s)}},h=function(a){for(var i=a.firstChild,e=0;e<t;e++)a.insertBefore(m(),i),a.appendChild(m())},p=0,f;p<r;p++){f=d.cloneNode(),c.appendChild(f);for(var x=0;x<r;x++)if(1===a[p*r+x]){var w=g();f.appendChild(w)}else{var C=m();f.appendChild(C)}A.noBorder||h(f)}A.noBorder||u(c),A.domElement.innerHTML="",A.domElement.appendChild(c)},getContext:function(e){return e.getContext&&e.getContext("2d")?e.getContext("2d"):(console.log("Browser does not have 2d Canvas support"),!1)},toImage:function(t){if(this.qrc){var a=this.imageTypes[t];if(!a)throw new Error(t+" is not a valid image type ");var e=new Image;return e.src=this.domElement.toDataURL(a),e}}},VanillaQR.adelta=[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28],VanillaQR.vpat=[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177],VanillaQR.fmtword=[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],VanillaQR.eccblocks=[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],VanillaQR.glog=[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175],VanillaQR.gexp=[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],VanillaQR.N1=3,VanillaQR.N2=3,VanillaQR.N3=40,VanillaQR.N4=10,define("qrcode",function(){}),function d(c,e,t){function a(i,s){if(!e[i]){if(!c[i]){var o="function"==typeof require&&require;if(!s&&o)return o(i,!0);if(n)return n(i,!0);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}var p=e[i]={exports:{}};c[i][0].call(p.exports,function(t){var e=c[i][1][t];return a(e?e:t)},p,p.exports,d,c,e,t)}return e[i].exports}for(var n="function"==typeof require&&require,i=0;i<t.length;i++)a(t[i]);return a}({1:[function(e,t){'use strict';function a(e){e.fn.perfectScrollbar=function(e){return this.each(function(){if("object"==typeof e||"undefined"==typeof e){n.get(this)||i.initialize(this,e)}else{var t=e;"update"===t?i.update(this):"destroy"===t&&i.destroy(this)}})}}var i=e("../main"),n=e("../plugin/instances");if("function"==typeof define&&define.amd)define("perfectScrollbarJQuery",["jquery"],a);else{var s=window.jQuery?window.jQuery:window.$;"undefined"!=typeof s&&a(s)}t.exports=a},{"../main":7,"../plugin/instances":18}],2:[function(e,t,a){'use strict';function i(e,t){var a=e.className.split(" ");0>a.indexOf(t)&&a.push(t),e.className=a.join(" ")}function n(e,t){var a=e.className.split(" "),i=a.indexOf(t);0<=i&&a.splice(i,1),e.className=a.join(" ")}a.add=function(e,t){e.classList?e.classList.add(t):i(e,t)},a.remove=function(e,t){e.classList?e.classList.remove(t):n(e,t)},a.list=function(e){return e.classList?Array.prototype.slice.apply(e.classList):e.className.split(" ")}},{}],3:[function(e,t){'use strict';function a(e,t){return window.getComputedStyle(e)[t]}function i(e,t,a){return"number"==typeof a&&(a=a.toString()+"px"),e.style[t]=a,e}function n(e,t){for(var a in t){var i=t[a];"number"==typeof i&&(i=i.toString()+"px"),e.style[a]=i}return e}var s={};s.e=function(e,t){var a=document.createElement(e);return a.className=t,a},s.appendTo=function(e,t){return t.appendChild(e),e},s.css=function(e,t,s){return"object"==typeof t?n(e,t):"undefined"==typeof s?a(e,t):i(e,t,s)},s.matches=function(e,t){if("undefined"!=typeof e.matches)return e.matches(t);return"undefined"==typeof e.matchesSelector?"undefined"==typeof e.webkitMatchesSelector?"undefined"==typeof e.mozMatchesSelector?"undefined"==typeof e.msMatchesSelector?void 0:e.msMatchesSelector(t):e.mozMatchesSelector(t):e.webkitMatchesSelector(t):e.matchesSelector(t)},s.remove=function(e){"undefined"==typeof e.remove?e.parentNode&&e.parentNode.removeChild(e):e.remove()},s.queryChildren=function(e,t){return Array.prototype.filter.call(e.childNodes,function(e){return s.matches(e,t)})},t.exports=s},{}],4:[function(e,t){'use strict';var a=function(e){this.element=e,this.events={}};a.prototype.bind=function(e,t){"undefined"==typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),this.element.addEventListener(e,t,!1)},a.prototype.unbind=function(e,t){this.events[e]=this.events[e].filter(function(a){return!!("undefined"!=typeof t&&a!==t)||(this.element.removeEventListener(e,a,!1),!1)},this)},a.prototype.unbindAll=function(){for(var e in this.events)this.unbind(e)};var i=function(){this.eventElements=[]};i.prototype.eventElement=function(e){var t=this.eventElements.filter(function(t){return t.element===e})[0];return"undefined"==typeof t&&(t=new a(e),this.eventElements.push(t)),t},i.prototype.bind=function(e,t,a){this.eventElement(e).bind(t,a)},i.prototype.unbind=function(e,t,a){this.eventElement(e).unbind(t,a)},i.prototype.unbindAll=function(){for(var e=0;e<this.eventElements.length;e++)this.eventElements[e].unbindAll()},i.prototype.once=function(e,t,a){var i=this.eventElement(e),n=function(s){i.unbind(t,n),a(s)};i.bind(t,n)},t.exports=i},{}],5:[function(e,t){'use strict';t.exports=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}()},{}],6:[function(e,t,a){'use strict';var n=e("./class"),s=e("./dom"),o=a.toInt=function(e){return parseInt(e,10)||0},d=a.clone=function(e){if(!e)return null;if(e.constructor===Array)return e.map(d);if("object"==typeof e){var t={};for(var a in e)t[a]=d(e[a]);return t}return e};a.extend=function(e,t){var a=d(e);for(var i in t)a[i]=d(t[i]);return a},a.isEditable=function(e){return s.matches(e,"input,[contenteditable]")||s.matches(e,"select,[contenteditable]")||s.matches(e,"textarea,[contenteditable]")||s.matches(e,"button,[contenteditable]")},a.removePsClasses=function(e){for(var t=n.list(e),a=0,s;a<t.length;a++)s=t[a],0===s.indexOf("ps-")&&n.remove(e,s)},a.outerWidth=function(e){return o(s.css(e,"width"))+o(s.css(e,"paddingLeft"))+o(s.css(e,"paddingRight"))+o(s.css(e,"borderLeftWidth"))+o(s.css(e,"borderRightWidth"))},a.startScrolling=function(e,t){n.add(e,"ps-in-scrolling"),"undefined"==typeof t?(n.add(e,"ps-x"),n.add(e,"ps-y")):n.add(e,"ps-"+t)},a.stopScrolling=function(e,t){n.remove(e,"ps-in-scrolling"),"undefined"==typeof t?(n.remove(e,"ps-x"),n.remove(e,"ps-y")):n.remove(e,"ps-"+t)},a.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:null!==window.navigator.msMaxTouchPoints}},{"./class":2,"./dom":3}],7:[function(e,t){'use strict';var a=e("./plugin/destroy"),i=e("./plugin/initialize"),n=e("./plugin/update");t.exports={initialize:i,update:n,destroy:a}},{"./plugin/destroy":9,"./plugin/initialize":17,"./plugin/update":21}],8:[function(e,t){'use strict';t.exports={handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1,theme:"default"}},{}],9:[function(e,t){'use strict';var a=e("../lib/helper"),n=e("../lib/dom"),s=e("./instances");t.exports=function(e){var t=s.get(e);t&&(t.event.unbindAll(),n.remove(t.scrollbarX),n.remove(t.scrollbarY),n.remove(t.scrollbarXRail),n.remove(t.scrollbarYRail),a.removePsClasses(e),s.remove(e))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18}],10:[function(e,t){'use strict';function a(t,a){function i(e){return e.getBoundingClientRect()}var n=function(t){t.stopPropagation()};a.event.bind(a.scrollbarY,"click",n),a.event.bind(a.scrollbarYRail,"click",function(n){var e=n.pageY-window.pageYOffset-i(a.scrollbarYRail).top,d=e>a.scrollbarYTop?1:-1;o(t,"top",t.scrollTop+d*a.containerHeight),s(t),n.stopPropagation()}),a.event.bind(a.scrollbarX,"click",n),a.event.bind(a.scrollbarXRail,"click",function(n){var e=n.pageX-window.pageXOffset-i(a.scrollbarXRail).left,d=e>a.scrollbarXLeft?1:-1;o(t,"left",t.scrollLeft+d*a.containerWidth),s(t),n.stopPropagation()})}var n=e("../instances"),s=e("../update-geometry"),o=e("../update-scroll");t.exports=function(e){var t=n.get(e);a(e,t)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],11:[function(e,t){'use strict';var s=Math.max;function a(t,a){function i(e){var i=n+e*a.railXRatio,d=s(0,a.scrollbarXRail.getBoundingClientRect().left)+a.railXRatio*(a.railXWidth-a.scrollbarXWidth);a.scrollbarXLeft=0>i?0:i>d?d:i;var c=o.toInt(a.scrollbarXLeft*(a.contentWidth-a.containerWidth)/(a.containerWidth-a.railXRatio*a.scrollbarXWidth))-a.negativeScrollAdjustment;l(t,"left",c)}var n=null,c=null,p=function(a){i(a.pageX-c),r(t),a.stopPropagation(),a.preventDefault()},u=function(){o.stopScrolling(t,"x"),a.event.unbind(a.ownerDocument,"mousemove",p)};a.event.bind(a.scrollbarX,"mousedown",function(i){c=i.pageX,n=o.toInt(d.css(a.scrollbarX,"left"))*a.railXRatio,o.startScrolling(t,"x"),a.event.bind(a.ownerDocument,"mousemove",p),a.event.once(a.ownerDocument,"mouseup",u),i.stopPropagation(),i.preventDefault()})}function n(t,a){function i(e){var i=n+e*a.railYRatio,d=s(0,a.scrollbarYRail.getBoundingClientRect().top)+a.railYRatio*(a.railYHeight-a.scrollbarYHeight);a.scrollbarYTop=0>i?0:i>d?d:i;var c=o.toInt(a.scrollbarYTop*(a.contentHeight-a.containerHeight)/(a.containerHeight-a.railYRatio*a.scrollbarYHeight));l(t,"top",c)}var n=null,c=null,p=function(a){i(a.pageY-c),r(t),a.stopPropagation(),a.preventDefault()},u=function(){o.stopScrolling(t,"y"),a.event.unbind(a.ownerDocument,"mousemove",p)};a.event.bind(a.scrollbarY,"mousedown",function(i){c=i.pageY,n=o.toInt(d.css(a.scrollbarY,"top"))*a.railYRatio,o.startScrolling(t,"y"),a.event.bind(a.ownerDocument,"mousemove",p),a.event.once(a.ownerDocument,"mouseup",u),i.stopPropagation(),i.preventDefault()})}var o=e("../../lib/helper"),d=e("../../lib/dom"),c=e("../instances"),r=e("../update-geometry"),l=e("../update-scroll");t.exports=function(e){var t=c.get(e);a(e,t),n(e,t)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],12:[function(e,t){'use strict';function a(t,a){function s(e,i){var n=t.scrollTop;if(0===e){if(!a.scrollbarYActive)return!1;if(0===n&&0<i||n>=a.contentHeight-a.containerHeight&&0>i)return!a.settings.wheelPropagation}var s=t.scrollLeft;if(0===i){if(!a.scrollbarXActive)return!1;if(0===s&&0>e||s>=a.contentWidth-a.containerWidth&&0<e)return!a.settings.wheelPropagation}return!0}var c=!1;a.event.bind(t,"mouseenter",function(){c=!0}),a.event.bind(t,"mouseleave",function(){c=!1});var r=!1;a.event.bind(a.ownerDocument,"keydown",function(l){if(!(l.isDefaultPrevented&&l.isDefaultPrevented()||l.defaultPrevented)){var e=n.matches(a.scrollbarX,":focus")||n.matches(a.scrollbarY,":focus");if(c||e){var p=document.activeElement?document.activeElement:a.ownerDocument.activeElement;if(p){if("IFRAME"===p.tagName)p=p.contentDocument.activeElement;else for(;p.shadowRoot;)p=p.shadowRoot.activeElement;if(i.isEditable(p))return}var u=0,m=0;switch(l.which){case 37:u=l.metaKey?-a.contentWidth:l.altKey?-a.containerWidth:-30;break;case 38:m=l.metaKey?a.contentHeight:l.altKey?a.containerHeight:30;break;case 39:u=l.metaKey?a.contentWidth:l.altKey?a.containerWidth:30;break;case 40:m=l.metaKey?-a.contentHeight:l.altKey?-a.containerHeight:-30;break;case 33:m=90;break;case 32:m=l.shiftKey?90:-90;break;case 34:m=-90;break;case 35:m=l.ctrlKey?-a.contentHeight:-a.containerHeight;break;case 36:m=l.ctrlKey?t.scrollTop:a.containerHeight;break;default:return;}d(t,"top",t.scrollTop-m),d(t,"left",t.scrollLeft+u),o(t),r=s(u,m),r&&l.preventDefault()}}})}var i=e("../../lib/helper"),n=e("../../lib/dom"),s=e("../instances"),o=e("../update-geometry"),d=e("../update-scroll");t.exports=function(e){var t=s.get(e);a(e,t)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],13:[function(e,t){'use strict';function a(t,a){function i(e,i){var n=t.scrollTop;if(0===e){if(!a.scrollbarYActive)return!1;if(0===n&&0<i||n>=a.contentHeight-a.containerHeight&&0>i)return!a.settings.wheelPropagation}var s=t.scrollLeft;if(0===i){if(!a.scrollbarXActive)return!1;if(0===s&&0>e||s>=a.contentWidth-a.containerWidth&&0<e)return!a.settings.wheelPropagation}return!0}function n(t){var e=t.deltaX,a=-1*t.deltaY;return("undefined"==typeof e||"undefined"==typeof a)&&(e=-1*t.wheelDeltaX/6,a=t.wheelDeltaY/6),t.deltaMode&&1===t.deltaMode&&(e*=10,a*=10),e!==e&&a!==a&&(e=0,a=t.wheelDelta),t.shiftKey?[-a,-e]:[e,a]}function d(e,a){var i=t.querySelector("textarea:hover, select[multiple]:hover, .ps-child:hover");if(i){if(!window.getComputedStyle(i).overflow.match(/(scroll|auto)/))return!1;var n=i.scrollHeight-i.clientHeight;if(0<n&&!(0===i.scrollTop&&0<a)&&!(i.scrollTop===n&&0>a))return!0;var s=i.scrollLeft-i.clientWidth;if(0<s&&!(0===i.scrollLeft&&0>e)&&!(i.scrollLeft===s&&0<e))return!0}return!1}function c(c){var e=n(c),l=e[0],p=e[1];d(l,p)||(r=!1,a.settings.useBothWheelAxes?a.scrollbarYActive&&!a.scrollbarXActive?(p?o(t,"top",t.scrollTop-p*a.settings.wheelSpeed):o(t,"top",t.scrollTop+l*a.settings.wheelSpeed),r=!0):a.scrollbarXActive&&!a.scrollbarYActive&&(l?o(t,"left",t.scrollLeft+l*a.settings.wheelSpeed):o(t,"left",t.scrollLeft-p*a.settings.wheelSpeed),r=!0):(o(t,"top",t.scrollTop-p*a.settings.wheelSpeed),o(t,"left",t.scrollLeft+l*a.settings.wheelSpeed)),s(t),r=r||i(l,p),r&&(c.stopPropagation(),c.preventDefault()))}var r=!1;"undefined"==typeof window.onwheel?"undefined"!=typeof window.onmousewheel&&a.event.bind(t,"mousewheel",c):a.event.bind(t,"wheel",c)}var n=e("../instances"),s=e("../update-geometry"),o=e("../update-scroll");t.exports=function(e){var t=n.get(e);a(e,t)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],14:[function(e,t){'use strict';function a(e,t){t.event.bind(e,"scroll",function(){s(e)})}var n=e("../instances"),s=e("../update-geometry");t.exports=function(e){var t=n.get(e);a(e,t)}},{"../instances":18,"../update-geometry":19}],15:[function(e,t){'use strict';function a(t,a){function e(){var e=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return 0===e.toString().length?null:e.getRangeAt(0).commonAncestorContainer}function d(){r||(r=setInterval(function(){return n.get(t)?void(o(t,"top",t.scrollTop+l.top),o(t,"left",t.scrollLeft+l.left),s(t)):void clearInterval(r)},50))}function c(){r&&(clearInterval(r),r=null),i.stopScrolling(t)}var r=null,l={top:0,left:0},p=!1;a.event.bind(a.ownerDocument,"selectionchange",function(){t.contains(e())?p=!0:(p=!1,c())}),a.event.bind(window,"mouseup",function(){p&&(p=!1,c())}),a.event.bind(window,"keyup",function(){p&&(p=!1,c())}),a.event.bind(window,"mousemove",function(a){if(p){var e={x:a.pageX,y:a.pageY},n={left:t.offsetLeft,right:t.offsetLeft+t.offsetWidth,top:t.offsetTop,bottom:t.offsetTop+t.offsetHeight};e.x<n.left+3?(l.left=-5,i.startScrolling(t,"x")):e.x>n.right-3?(l.left=5,i.startScrolling(t,"x")):l.left=0,e.y<n.top+3?(l.top=5>n.top+3-e.y?-5:-20,i.startScrolling(t,"y")):e.y>n.bottom-3?(l.top=5>e.y-n.bottom+3?5:20,i.startScrolling(t,"y")):l.top=0,0===l.top&&0===l.left?c():d()}})}var i=e("../../lib/helper"),n=e("../instances"),s=e("../update-geometry"),o=e("../update-scroll");t.exports=function(e){var t=n.get(e);a(e,t)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],16:[function(e,t){'use strict';var n=Math.abs;function a(e,t,a,i){function s(a,i){var s=e.scrollTop,o=e.scrollLeft,d=n(a),c=n(i);if(c>d){if(0>i&&s===t.contentHeight-t.containerHeight||0<i&&0===s)return!t.settings.swipePropagation;}else if(d>c&&(0>a&&o===t.contentWidth-t.containerWidth||0<a&&0===o))return!t.settings.swipePropagation;return!0}function r(t,a){c(e,"top",e.scrollTop-a),c(e,"left",e.scrollLeft-t),d(e)}function l(){w=!0}function p(){w=!1}function u(t){return t.targetTouches?t.targetTouches[0]:t}function m(t){return!!(t.targetTouches&&1===t.targetTouches.length)||!!(t.pointerType&&"mouse"!==t.pointerType&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE)}function g(t){if(m(t)){C=!0;var e=u(t);A.pageX=e.pageX,A.pageY=e.pageY,f=new Date().getTime(),null!==x&&clearInterval(x),t.stopPropagation()}}function h(a){if(!C&&t.settings.swipePropagation&&g(a),!w&&C&&m(a)){var e=u(a),i={pageX:e.pageX,pageY:e.pageY},n=i.pageX-A.pageX,o=i.pageY-A.pageY;r(n,o),A=i;var d=new Date().getTime(),c=d-f;0<c&&(b.x=n/c,b.y=o/c,f=d),s(n,o)&&(a.stopPropagation(),a.preventDefault())}}function v(){!w&&C&&(C=!1,clearInterval(x),x=setInterval(function(){return o.get(e)?b.x||b.y?.01>n(b.x)&&.01>n(b.y)?void clearInterval(x):void(r(30*b.x,30*b.y),b.x*=.8,b.y*=.8):void clearInterval(x):void clearInterval(x)},10))}var A={},f=0,b={},x=null,w=!1,C=!1;a?(t.event.bind(window,"touchstart",l),t.event.bind(window,"touchend",p),t.event.bind(e,"touchstart",g),t.event.bind(e,"touchmove",h),t.event.bind(e,"touchend",v)):i&&(window.PointerEvent?(t.event.bind(window,"pointerdown",l),t.event.bind(window,"pointerup",p),t.event.bind(e,"pointerdown",g),t.event.bind(e,"pointermove",h),t.event.bind(e,"pointerup",v)):window.MSPointerEvent&&(t.event.bind(window,"MSPointerDown",l),t.event.bind(window,"MSPointerUp",p),t.event.bind(e,"MSPointerDown",g),t.event.bind(e,"MSPointerMove",h),t.event.bind(e,"MSPointerUp",v)))}var s=e("../../lib/helper"),o=e("../instances"),d=e("../update-geometry"),c=e("../update-scroll");t.exports=function(e){if(s.env.supportsTouch||s.env.supportsIePointer){var t=o.get(e);a(e,t,s.env.supportsTouch,s.env.supportsIePointer)}}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],17:[function(e,t){'use strict';var a=e("../lib/helper"),n=e("../lib/class"),s=e("./instances"),o=e("./update-geometry"),d={"click-rail":e("./handler/click-rail"),"drag-scrollbar":e("./handler/drag-scrollbar"),keyboard:e("./handler/keyboard"),wheel:e("./handler/mouse-wheel"),touch:e("./handler/touch"),selection:e("./handler/selection")},c=e("./handler/native-scroll");t.exports=function(e,t){t="object"==typeof t?t:{},n.add(e,"ps-container");var r=s.add(e);r.settings=a.extend(r.settings,t),n.add(e,"ps-theme-"+r.settings.theme),r.settings.handlers.forEach(function(t){d[t](e)}),c(e),o(e)}},{"../lib/class":2,"../lib/helper":6,"./handler/click-rail":10,"./handler/drag-scrollbar":11,"./handler/keyboard":12,"./handler/mouse-wheel":13,"./handler/native-scroll":14,"./handler/selection":15,"./handler/touch":16,"./instances":18,"./update-geometry":19}],18:[function(e,t,a){'use strict';function i(e){function t(){c.add(e,"ps-focus")}function a(){c.remove(e,"ps-focus")}var n=this;n.settings=d.clone(r),n.containerWidth=null,n.containerHeight=null,n.contentWidth=null,n.contentHeight=null,n.isRtl="rtl"===l.css(e,"direction"),n.isNegativeScroll=function(){var t=e.scrollLeft,a=null;return e.scrollLeft=-1,a=0>e.scrollLeft,e.scrollLeft=t,a}(),n.negativeScrollAdjustment=n.isNegativeScroll?e.scrollWidth-e.clientWidth:0,n.event=new p,n.ownerDocument=e.ownerDocument||document,n.scrollbarXRail=l.appendTo(l.e("div","ps-scrollbar-x-rail"),e),n.scrollbarX=l.appendTo(l.e("div","ps-scrollbar-x"),n.scrollbarXRail),n.scrollbarX.setAttribute("tabindex",0),n.event.bind(n.scrollbarX,"focus",t),n.event.bind(n.scrollbarX,"blur",a),n.scrollbarXActive=null,n.scrollbarXWidth=null,n.scrollbarXLeft=null,n.scrollbarXBottom=d.toInt(l.css(n.scrollbarXRail,"bottom")),n.isScrollbarXUsingBottom=n.scrollbarXBottom===n.scrollbarXBottom,n.scrollbarXTop=n.isScrollbarXUsingBottom?null:d.toInt(l.css(n.scrollbarXRail,"top")),n.railBorderXWidth=d.toInt(l.css(n.scrollbarXRail,"borderLeftWidth"))+d.toInt(l.css(n.scrollbarXRail,"borderRightWidth")),l.css(n.scrollbarXRail,"display","block"),n.railXMarginWidth=d.toInt(l.css(n.scrollbarXRail,"marginLeft"))+d.toInt(l.css(n.scrollbarXRail,"marginRight")),l.css(n.scrollbarXRail,"display",""),n.railXWidth=null,n.railXRatio=null,n.scrollbarYRail=l.appendTo(l.e("div","ps-scrollbar-y-rail"),e),n.scrollbarY=l.appendTo(l.e("div","ps-scrollbar-y"),n.scrollbarYRail),n.scrollbarY.setAttribute("tabindex",0),n.event.bind(n.scrollbarY,"focus",t),n.event.bind(n.scrollbarY,"blur",a),n.scrollbarYActive=null,n.scrollbarYHeight=null,n.scrollbarYTop=null,n.scrollbarYRight=d.toInt(l.css(n.scrollbarYRail,"right")),n.isScrollbarYUsingRight=n.scrollbarYRight===n.scrollbarYRight,n.scrollbarYLeft=n.isScrollbarYUsingRight?null:d.toInt(l.css(n.scrollbarYRail,"left")),n.scrollbarYOuterWidth=n.isRtl?d.outerWidth(n.scrollbarY):null,n.railBorderYWidth=d.toInt(l.css(n.scrollbarYRail,"borderTopWidth"))+d.toInt(l.css(n.scrollbarYRail,"borderBottomWidth")),l.css(n.scrollbarYRail,"display","block"),n.railYMarginHeight=d.toInt(l.css(n.scrollbarYRail,"marginTop"))+d.toInt(l.css(n.scrollbarYRail,"marginBottom")),l.css(n.scrollbarYRail,"display",""),n.railYHeight=null,n.railYRatio=null}function n(e){return e.getAttribute("data-ps-id")}function s(e,t){e.setAttribute("data-ps-id",t)}function o(e){e.removeAttribute("data-ps-id")}var d=e("../lib/helper"),c=e("../lib/class"),r=e("./default-setting"),l=e("../lib/dom"),p=e("../lib/event-manager"),u=e("../lib/guid"),m={};a.add=function(e){var t=u();return s(e,t),m[t]=new i(e),m[t]},a.remove=function(e){delete m[n(e)],o(e)},a.get=function(e){return m[n(e)]}},{"../lib/class":2,"../lib/dom":3,"../lib/event-manager":4,"../lib/guid":5,"../lib/helper":6,"./default-setting":8}],19:[function(e,t){'use strict';var s=Math.min,o=Math.max;function a(e,t){return e.settings.minScrollbarLength&&(t=o(t,e.settings.minScrollbarLength)),e.settings.maxScrollbarLength&&(t=s(t,e.settings.maxScrollbarLength)),t}function n(e,t){var a={width:t.railXWidth};a.left=t.isRtl?t.negativeScrollAdjustment+e.scrollLeft+t.containerWidth-t.contentWidth:e.scrollLeft,t.isScrollbarXUsingBottom?a.bottom=t.scrollbarXBottom-e.scrollTop:a.top=t.scrollbarXTop+e.scrollTop,r.css(t.scrollbarXRail,a);var i={top:e.scrollTop,height:t.railYHeight};t.isScrollbarYUsingRight?t.isRtl?i.right=t.contentWidth-(t.negativeScrollAdjustment+e.scrollLeft)-t.scrollbarYRight-t.scrollbarYOuterWidth:i.right=t.scrollbarYRight-e.scrollLeft:t.isRtl?i.left=t.negativeScrollAdjustment+e.scrollLeft+2*t.containerWidth-t.contentWidth-t.scrollbarYLeft-t.scrollbarYOuterWidth:i.left=t.scrollbarYLeft+e.scrollLeft,r.css(t.scrollbarYRail,i),r.css(t.scrollbarX,{left:t.scrollbarXLeft,width:t.scrollbarXWidth-t.railBorderXWidth}),r.css(t.scrollbarY,{top:t.scrollbarYTop,height:t.scrollbarYHeight-t.railBorderYWidth})}var d=e("../lib/helper"),c=e("../lib/class"),r=e("../lib/dom"),l=e("./instances"),p=e("./update-scroll");t.exports=function(e){var t=l.get(e);t.containerWidth=e.clientWidth,t.containerHeight=e.clientHeight,t.contentWidth=e.scrollWidth,t.contentHeight=e.scrollHeight;var i;e.contains(t.scrollbarXRail)||(i=r.queryChildren(e,".ps-scrollbar-x-rail"),0<i.length&&i.forEach(function(e){r.remove(e)}),r.appendTo(t.scrollbarXRail,e)),e.contains(t.scrollbarYRail)||(i=r.queryChildren(e,".ps-scrollbar-y-rail"),0<i.length&&i.forEach(function(e){r.remove(e)}),r.appendTo(t.scrollbarYRail,e)),!t.settings.suppressScrollX&&t.containerWidth+t.settings.scrollXMarginOffset<t.contentWidth?(t.scrollbarXActive=!0,t.railXWidth=t.containerWidth-t.railXMarginWidth,t.railXRatio=t.containerWidth/t.railXWidth,t.scrollbarXWidth=a(t,d.toInt(t.railXWidth*t.containerWidth/t.contentWidth)),t.scrollbarXLeft=d.toInt((t.negativeScrollAdjustment+e.scrollLeft)*(t.railXWidth-t.scrollbarXWidth)/(t.contentWidth-t.containerWidth))):t.scrollbarXActive=!1,!t.settings.suppressScrollY&&t.containerHeight+t.settings.scrollYMarginOffset<t.contentHeight?(t.scrollbarYActive=!0,t.railYHeight=t.containerHeight-t.railYMarginHeight,t.railYRatio=t.containerHeight/t.railYHeight,t.scrollbarYHeight=a(t,d.toInt(t.railYHeight*t.containerHeight/t.contentHeight)),t.scrollbarYTop=d.toInt(e.scrollTop*(t.railYHeight-t.scrollbarYHeight)/(t.contentHeight-t.containerHeight))):t.scrollbarYActive=!1,t.scrollbarXLeft>=t.railXWidth-t.scrollbarXWidth&&(t.scrollbarXLeft=t.railXWidth-t.scrollbarXWidth),t.scrollbarYTop>=t.railYHeight-t.scrollbarYHeight&&(t.scrollbarYTop=t.railYHeight-t.scrollbarYHeight),n(e,t),t.scrollbarXActive?c.add(e,"ps-active-x"):(c.remove(e,"ps-active-x"),t.scrollbarXWidth=0,t.scrollbarXLeft=0,p(e,"left",0)),t.scrollbarYActive?c.add(e,"ps-active-y"):(c.remove(e,"ps-active-y"),t.scrollbarYHeight=0,t.scrollbarYTop=0,p(e,"top",0))}},{"../lib/class":2,"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-scroll":20}],20:[function(e,t){'use strict';var a=e("./instances"),n=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!0),t},s,o;t.exports=function(e,t,d){if("undefined"==typeof e)throw"You must provide an element to the update-scroll function";if("undefined"==typeof t)throw"You must provide an axis to the update-scroll function";if("undefined"==typeof d)throw"You must provide a value to the update-scroll function";"top"===t&&0>=d&&(e.scrollTop=d=0,e.dispatchEvent(n("ps-y-reach-start"))),"left"===t&&0>=d&&(e.scrollLeft=d=0,e.dispatchEvent(n("ps-x-reach-start")));var c=a.get(e);"top"===t&&d>=c.contentHeight-c.containerHeight&&(d=c.contentHeight-c.containerHeight,1>=d-e.scrollTop?d=e.scrollTop:e.scrollTop=d,e.dispatchEvent(n("ps-y-reach-end"))),"left"===t&&d>=c.contentWidth-c.containerWidth&&(d=c.contentWidth-c.containerWidth,1>=d-e.scrollLeft?d=e.scrollLeft:e.scrollLeft=d,e.dispatchEvent(n("ps-x-reach-end"))),s||(s=e.scrollTop),o||(o=e.scrollLeft),"top"===t&&d<s&&e.dispatchEvent(n("ps-scroll-up")),"top"===t&&d>s&&e.dispatchEvent(n("ps-scroll-down")),"left"===t&&d<o&&e.dispatchEvent(n("ps-scroll-left")),"left"===t&&d>o&&e.dispatchEvent(n("ps-scroll-right")),"top"===t&&(e.scrollTop=s=d,e.dispatchEvent(n("ps-scroll-y"))),"left"===t&&(e.scrollLeft=o=d,e.dispatchEvent(n("ps-scroll-x")))}},{"./instances":18}],21:[function(e,t){'use strict';var a=e("../lib/helper"),n=e("../lib/dom"),s=e("./instances"),o=e("./update-geometry"),d=e("./update-scroll");t.exports=function(e){var t=s.get(e);t&&(t.negativeScrollAdjustment=t.isNegativeScroll?e.scrollWidth-e.clientWidth:0,n.css(t.scrollbarXRail,"display","block"),n.css(t.scrollbarYRail,"display","block"),t.railXMarginWidth=a.toInt(n.css(t.scrollbarXRail,"marginLeft"))+a.toInt(n.css(t.scrollbarXRail,"marginRight")),t.railYMarginHeight=a.toInt(n.css(t.scrollbarYRail,"marginTop"))+a.toInt(n.css(t.scrollbarYRail,"marginBottom")),n.css(t.scrollbarXRail,"display","none"),n.css(t.scrollbarYRail,"display","none"),o(e),d(e,"top",e.scrollTop),d(e,"left",e.scrollLeft),n.css(t.scrollbarXRail,"display",""),n.css(t.scrollbarYRail,"display",""))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-geometry":19,"./update-scroll":20}]},{},[1]),define("xabber-dependencies",["backbone","underscore","jquery","moment","wavesurfer","slug","magnific-popup","strophe","strophe.disco","strophe.ping","strophe.rsm","strophe.caps","strophe.pubsub","backbone.localsync","sha1_hasher","materialize","qrcode","perfectScrollbarJQuery"],function(e,t,a,i,n,s,o,d){return t.extend({$:a,_:t,moment:i,WaveSurfer:n,slug:s,magnificPopup:o,Strophe:d},d)});var constants={DEBUG:!1,STORAGE_NAME:"xabber-storage",STORAGE_VERSION:"v8",FAVICON_DEFAULT:"images/favicon.png",FAVICON_MESSAGE:"images/favicon-message.png",WIDTH_MEDIUM:1420,WIDTH_NARROW:1280,WIDTH_TINY:1152,LOG_LEVEL_NONE:-1,LOG_LEVEL_ERROR:1,LOG_LEVEL_WARN:2,LOG_LEVEL_INFO:3,LOG_LEVEL_DEBUG:4,LOG_LEVEL:"ERROR",KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_ESCAPE:27,KEY_SPACE:32,KEY_ARROW_LEFT:37,KEY_ARROW_UP:38,KEY_ARROW_RIGHT:39,KEY_ARROW_DOWN:40,KEY_DELETE:46,KEY_FORWARD_SLASH:47,KEY_AT:50,VOICE_MSG_TIME:120,PASSWORD_DOT:String.fromCharCode(8226),CONNECTION_URL:null,CONN_STATUSES:{0:"ERROR",1:"CONNECTING",2:"CONNFAIL",3:"AUTHENTICATING",4:"AUTHFAIL",5:"CONNECTED",6:"DISCONNECTED",7:"DISCONNECTING",8:"ATTACHED",9:"REDIRECT",10:"CONNTIMEOUT"},BAD_CONN_STATUSES:[0,2,4,6,10],RECONNECTION_TIMEOUTS:[5e3,1e4,15e3],STATUSES:{chat:"Ready for chat",online:"Online",away:"Away",xa:"Away for long time",dnd:"Busy",offline:"Offline",unavailable:"Unavailable"},STATUS_WEIGHTS:{chat:1,online:2,away:3,xa:4,dnd:5,offline:6,unavailable:7},CHATSTATE_INTERVAL_COMPOSING_AUDIO:5e3,CHATSTATE_TIMEOUT_PAUSED:15e3,CHATSTATE_TIMEOUT_STOPPED:5e3,CHATSTATE_TIMEOUT_PAUSED_AUDIO:1e4,JINGLE_WAITING_TIME:60,JINGLE_MSG_PROPOSE:0,JINGLE_MSG_REJECT:1,JINGLE_MSG_ACCEPT:2,MSG_BLOCKED:-2,MSG_ERROR:-1,MSG_PENDING:0,MSG_SENT:1,MSG_DELIVERED:2,MSG_DISPLAYED:3,MSG_ARCHIVED:4,RSM_ATTRIBUTES:["max","first","last","after","before","index","count"],MAM_ATTRIBUTES:["with","start","end"],GENERAL_GROUP_ID:1,NON_ROSTER_GROUP_ID:2,ACCOUNT_COLORS:["red","green","blue","deep-purple","orange","lime","pink","purple","indigo","light-blue","cyan","teal","light-green","amber","deep-orange","brown","blue-grey"],MAX_AVATAR_FILE_SIZE:2e7,AVATAR_PRIORITIES:{VCARD_AVATAR:0,PUBSUB_AVATAR:1},AVATAR_SIZES:{TOOLBAR_ACCOUNT_ITEM:32,SETTINGS_ACCOUNT_ITEM:32,XABBER_ACCOUNT:32,SYNCHRONIZE_ACCOUNT_ITEM:36,MENTION_ITEM:36,ACCOUNT_SETTINGS_LEFT:96,ACCOUNT_VCARD_EDIT:80,ROSTER_RIGHT_ACCOUNT_ITEM:38,ROSTER_LEFT_ACCOUNT_ITEM:40,PARTICIPANT_DETAILS_ITEM:48,CONTACT_RIGHT_ITEM:32,GROUPCHAT_MEMBER_ITEM:32,CONTACT_LEFT_ITEM:32,CONTACT_BLOCKED_ITEM:32,CONTACT_DETAILS:192,GROUP_SETTINGS:96,CHAT_ITEM:40,CHAT_HEAD:40,CHAT_MESSAGE:32,CHAT_BOTTOM:48,XABBER_VOICE_CALL_VIEW:128},SOUNDS:{beep_up:"sounds/beep_up.ogg",tiny_noize:"sounds/tiny_noize.ogg",retro_game:"sounds/retro_game.ogg",pixel_beep:"sounds/pixel_beep.ogg",beep_positive:"sounds/beep_positive.ogg",good_chime:"sounds/good_chime.ogg",cellular_click:"sounds/cellular_click.ogg",bleep:"sounds/bleep.ogg",mono_u:"sounds/mono_u.ogg",plop:"sounds/plop.ogg",ether:"sounds/ether.ogg",pop:"sounds/pop.ogg",computer_chime:"sounds/computer_chime.ogg",beep_a:"sounds/beep_a.ogg",call:"sounds/marching-band-dave-girtsman.mp3",connecting:"sounds/alien-bomb-timer.wav",busy:"sounds/phone_busy.wav",attention:"sounds/attention.wav"},SYNC_WAY_DATA:{no:{tip:"Settings are already synchronized",icon:"mdi-cloud-check"},from_server:{tip:"Settings will be downloaded from the cloud",icon:"mdi-cloud-download"},to_server:{tip:"Local settings will be uploaded to cloud",icon:"mdi-cloud-upload"},delete:{tip:"Local account will be deleted",icon:"mdi-delete"},off_local:{tip:"Local account",icon:"mdi-cloud-outline-off"},off_remote:{tip:"Remote account",icon:"mdi-cloud-outline-off"}},SYNCED_STATUS_DATA:{off:{tip:"Synchronization disabled",icon:"mdi-cloud-outline-off"},yes:{tip:"Settings are synchronized",icon:"mdi-cloud-check"},no:{tip:"Settings are not synchronized with cloud",icon:"mdi-cloud"}},EMOJI_LIST_NAME:function(e){return{ru:{"smiles and people":"\u0421\u043C\u0430\u0439\u043B\u0438\u043A\u0438 \u0438 \u043B\u044E\u0434\u0438","body and clothes":"\u0422\u0435\u043B\u043E \u0438 \u043E\u0434\u0435\u0436\u0434\u0430","animals and nature":"\u0416\u0438\u0432\u043E\u0442\u043D\u044B\u0435 \u0438 \u043F\u0440\u0438\u0440\u043E\u0434\u0430","food and drinks":"\u0415\u0434\u0430 \u0438 \u043D\u0430\u043F\u0438\u0442\u043A\u0438","travel and places":"\u041F\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044F \u0438 \u043C\u0435\u0441\u0442\u0430",events:"\u0421\u043E\u0431\u044B\u0442\u0438\u044F",objects:"\u041E\u0431\u044A\u0435\u043A\u0442\u044B",signs:"\u0417\u043D\u0430\u043A\u0438"},en:{"smiles and people":"Smiles and people","body and clothes":"Body and clothes","animals and nature":"Animals and nature","food and drinks":"Food and drinks","travel and places":"Travel and places",events:"Events",objects:"Objects",signs:"Signs"}}.en[e]},QUOTE_MARKER:"&gt;",MARKUP_TAGS:["bold","underline","italic","strike","link","quote"],BLANK_VIDEO:{OGG:"data:video/ogg;base64, T2dnUwACAAAAAAAAAAAjaKehAAAAAEAjsCsBKoB0aGVvcmEDAgEACwAJAACwAACQAAAAAAAZAAAAAQAAAQAAAQADDUAA2E9nZ1MAAgAAAAAAAAAAlksvwgAAAABKGTdzAR4Bdm9yYmlzAAAAAAKAuwAAAAAAAIC1AQAAAAAAuAFPZ2dTAAAAAAAAAAAAACNop6EBAAAAPZIZjg41////////////////kIF0aGVvcmENAAAATGF2ZjU1LjMzLjEwMAEAAAAVAAAAZW5jb2Rlcj1MYXZmNTUuMzMuMTAwgnRoZW9yYb7NKPe5zWsYtalJShBznOYxjFKUpCEIMYxiEIQhCEAAAAAAAAAAAAARba5TZ5LI/FYS/Hg5W2zmKvVoq1QoEykkWhD+eTmbjWZTCXiyVSmTiSSCGQh8PB2OBqNBgLxWKhQJBGIhCHw8HAyGAsFAiDgVFtrlNnksj8VhL8eDlbbOYq9WirVCgTKSRaEP55OZuNZlMJeLJVKZOJJIIZCHw8HY4Go0GAvFYqFAkEYiEIfDwcDIYCwUCIOBQLDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8MDA8SFBQVDQ0OERIVFRQODg8SFBUVFQ4QERMUFRUVEBEUFRUVFRUSExQVFRUVFRQVFRUVFRUVFRUVFRUVFRUQDAsQFBkbHA0NDhIVHBwbDg0QFBkcHBwOEBMWGx0dHBETGRwcHh4dFBgbHB0eHh0bHB0dHh4eHh0dHR0eHh4dEAsKEBgoMz0MDA4TGjo8Nw4NEBgoOUU4DhEWHTNXUD4SFiU6RG1nTRgjN0BRaHFcMUBOV2d5eGVIXF9icGRnYxMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMSEhUZGhoaGhIUFhoaGhoaFRYZGhoaGhoZGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaERIWHyQkJCQSFBgiJCQkJBYYISQkJCQkHyIkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJBESGC9jY2NjEhUaQmNjY2MYGjhjY2NjYy9CY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2MVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVEhISFRcYGRsSEhUXGBkbHBIVFxgZGxwdFRcYGRscHR0XGBkbHB0dHRgZGxwdHR0eGRscHR0dHh4bHB0dHR4eHhERERQXGhwgEREUFxocICIRFBcaHCAiJRQXGhwgIiUlFxocICIlJSUaHCAiJSUlKRwgIiUlJSkqICIlJSUpKioQEBAUGBwgKBAQFBgcICgwEBQYHCAoMEAUGBwgKDBAQBgcICgwQEBAHCAoMEBAQGAgKDBAQEBggCgwQEBAYICAB8Xlx0fV7c7D8vrrAaZid8hRvB1RN7csxFuo43wH7lEkS9wbGS+tVSNMyuxdiECcjB7R1Ml85htasNjKpSvPt3D8k7iGmZXYuxBC+RR4arUGxkvH5y7mJXR7R5Jwn3VUhBiuap91VIrsaCM5TSg9o867khwMrWY2+cP4rwvBLzt/wnHaYe0edSRMYC6tZmU1BrvhktIUf2gXoU8bHMuyNA7lB7R51ym213sFcFKowIviT/i0Wscg+4RDubX+4haRsMxZWgN05K5FD3bzqS9VSVCPM4TpWs2C43ihFdgaSByeKHu3Xf/2TG8tgpB7PAtOs7jixWYw+Ayo5GjUTSybX/1KW52RxYfB8nBNLJtHgt4DPq6BZWBFpjyZX/1KW5Ca0evOwG1EX/A9j5fQm5hOz6W2CtcCaWTXTFAeZO71VIgCTX69y9TiaXag3Os2ES1DcLKw0/xR5HfnCqkpQF0Z1kxKNfhZWLycml2keduHMQh3HubB/pbUUoCK5wxetZRZWPJF/bdyE21H2YjMOhP/pkthqKUCOEWVm68+1J5n7ahES5sOhaZPdOC5j4kc91FVIsrF8ofe+A2on/16Z4RiKQZcMU3NouO9N4YAvrWaiA6h4bfLqhTitbnnJ2iPSVRNJH+aZGE+YXzq7Ah/OncW2K59AKamlocOUYTSvaJPNcjDfMGrmG9pOV2MbgI9v3B3ECZ7RLJ51UpzMn0C1huA87Ngom9lkiaw3t5yvFZmDl1HpkuP+PiqlawgD69jAT5Nxr2i6cwiytcwHhK2KJvZI9C1m/4VUil8RvO/ydxmgsFdzdgGpMbUeyyRNOi1k5hMb6hVSMuTrOE/xuDhGExQ219l07sV2kG5fOEnkWHwgqUkbvC0P2KTytY4nHLqJDc3DMGlDbX2aXK/4UuJxizaIkZITS7a3HN5374PrVlYKIcP9xl1BUKqQ7aAml2k1o5uGcN8A+tPz1HF1YVnmE7cyx4FIiUA2ml1k0hX9HB7l4tMO+R9YrMWcf5Anub1BZXUp3Ce4jBM21l0kyhcF/vg6FGeHa345MYv4BVSciTJhj5AbuD2K0dfIXc4jKAbazaS53rv1lYqpIVr2fcgcPox4u/WVnRfJ25GGING2s2cqjKIVUtwGbRtrljLd9CQOHhewUTfiKxWk7Olr2dHyIKlLgejEbasmmdGF/dhuhVrU9xGi6Hksgm/+5Bw813T3mJyRNqIYGdYspVZFzQ6dhNLJ7H+fYWh8Q+cMbzLc/O0evM4srXGjpECaXaT2jApqM4LRavgPnH7ecDRQSErabX3zC4EcXfOVZZUpYs3UIfMsKVR+6hgFzHhvWWWl4EqZtrJpHnyeO0T2icPrqVRyyDRKmbayexv7wdolGfh1hwtsK4G5jDOIHz/lTULUM47PaBmNJm2ssmTq+ssXeHBjgij3G5P+u5QVFIGQ21TNM5aGOHbqKssQ/HiM9kvcWjdCtF6gZNMzbXFhNP2gV2FNQi+OpOR+S+3RvOBVSOr+E5hjyPrQho7/QDNEG2qRNLpHl6WVl3m4p3POFvwEWUN0ByvCQTSttdM48H7tjQWVk73qoUvhiSDbVK0mzyohbuHXofmEaK/xXYJ+Vq7tBUN6lMAdrouC3p96IS8kMzbVK0myY4f+HKdRGsrG9SlDwEfQkXsGLIbapmmcv/sA5TrqC36t4sRdjylU4JC9KwG2plM0zxuT2iFFzAPXyj9ZWRu+tx5UpFv0jn0gQrKyMF5MyaZsDbXG7/qIdp0tHG4jOQumLzBliaZttaLfZFUBSOu7FaUn/+IXETfwUj2E0o6gJ2HB/l8N7jFnzWWBESErabWPvy9bUKqS4y78CME0rbXSTNFRf8H7r1wwxQbltish5nFVIRkhKaTNtc6L3LHAh8+B2yi/tHvXG4nusVwAKMb/0/MCmoWrvASDM0mbay5YRI+7CtC96OPtxudDEyTGmbbWVRgkvR8qaiA8+rLCft7cW8H8UI3E8nzmJVSQIT3+0srHfUbgKA21ZNM8WEy+W7wbj9OuBpm21MKGWN80kaA5PZfoSqkRPLa1h31wIEjiUhcnX/e5VSWVkQnPhtqoYXrjLFpn7M8tjB17xSqfWgoA21StJpM48eSG+5A/dsGUQn8sV7impA4dQjxPyrsBfHd8tUGBIJWkxtrnljE3eu/xTUO/nVsA9I4uVlZ5uQvy9IwYjbWUmaZ5XE9HAWVkXUKmoI3y4vDKZpnKNtccJHK2iA83ej+fvgI3KR9P6qpG/kBCUdxHFisLkq8aZttTCZlj/b0G8XoLX/3fHhZWCVcMsWmZtqmYXz0cpOiBHCqpKUZu76iICRxYVuSULpmF/421MsWmfyhbP4ew1FVKAjFlY437JXImUTm2r/4ZYtMy61hf16RPJIRA8tU1BDc5/JzAkEzTM21lyx7sK9wojRX/OHXoOv05IDbUymaZyscL7qlMA8c/CiK3csceqzuOEU1EPpbz4QEahIShpm21MJmWN924f98WKyf51EEYBli0zNtUzC+6X9P9ysrU1CHyA3RJFFr1w67HpyULT+YMsWmZtquYXz97oKil44sI1bpL8hRSDeMkhiIBwOgxwZ5Fs6+5M+NdH+3Kjv0sreSqqRvGSQxEA4HQY4M8i2dfcmfGuj/blR36WVvJVVI3jJIYiAcDoMcGeRbOvuTPjXR/tyo79LK3kqqkVUnCfqAES8EzTM21lykY4Q+LKxby+9F3ZHR/uC2OGpS9cv6BZXAebhckMGIymaZm2st8/B38i6A/n58pVLKwfURet4UBwSF6UaZttSZljhd2jW9BZWcrX0/hG4Sdt/SBCdH6UMJmWK80zba3URKaik8iB9PR2459CuyOAbi0/GWLTMmYXm2t0vUkNQhRPVldKpAN5HgHyZfdOtGuj/YxwZ5S8u3CjqMgQoyQJRdawvJlE530/+sVg21c8GWLTPf3yJVSVUoCMWVjjfslciZRObav/hli0zLrWF/XpE8khT2dnUwAAAAAAAAAAAACWSy/CAQAAAB7oAsQRNv///////////////////wcDdm9yYmlzDQAAAExhdmY1NS4zMy4xMDABAAAAFQAAAGVuY29kZXI9TGF2ZjU1LjMzLjEwMAEFdm9yYmlzJUJDVgEAQAAAJHMYKkalcxaEEBpCUBnjHELOa+wZQkwRghwyTFvLJXOQIaSgQohbKIHQkFUAAEAAAIdBeBSEikEIIYQlPViSgyc9CCGEiDl4FIRpQQghhBBCCCGEEEIIIYRFOWiSgydBCB2E4zA4DIPlOPgchEU5WBCDJ0HoIIQPQriag6w5CCGEJDVIUIMGOegchMIsKIqCxDC4FoQENSiMguQwyNSDC0KImoNJNfgahGdBeBaEaUEIIYQkQUiQgwZByBiERkFYkoMGObgUhMtBqBqEKjkIH4QgNGQVAJAAAKCiKIqiKAoQGrIKAMgAABBAURTHcRzJkRzJsRwLCA1ZBQAAAQAIAACgSIqkSI7kSJIkWZIlWZIlWZLmiaosy7Isy7IsyzIQGrIKAEgAAFBRDEVxFAcIDVkFAGQAAAigOIqlWIqlaIrniI4IhIasAgCAAAAEAAAQNENTPEeURM9UVde2bdu2bdu2bdu2bdu2bVuWZRkIDVkFAEAAABDSaWapBogwAxkGQkNWAQAIAACAEYowxIDQkFUAAEAAAIAYSg6iCa0535zjoFkOmkqxOR2cSLV5kpuKuTnnnHPOyeacMc4555yinFkMmgmtOeecxKBZCpoJrTnnnCexedCaKq0555xxzulgnBHGOeecJq15kJqNtTnnnAWtaY6aS7E555xIuXlSm0u1Oeecc84555xzzjnnnOrF6RycE84555yovbmWm9DFOeecT8bp3pwQzjnnnHPOOeecc84555wgNGQVAAAEAEAQho1h3CkI0udoIEYRYhoy6UH36DAJGoOcQurR6GiklDoIJZVxUkonCA1ZBQAAAgBACCGFFFJIIYUUUkghhRRiiCGGGHLKKaeggkoqqaiijDLLLLPMMssss8w67KyzDjsMMcQQQyutxFJTbTXWWGvuOeeag7RWWmuttVJKKaWUUgpCQ1YBACAAAARCBhlkkFFIIYUUYogpp5xyCiqogNCQVQAAIACAAAAAAE/yHNERHdERHdERHdERHdHxHM8RJVESJVESLdMyNdNTRVV1ZdeWdVm3fVvYhV33fd33fd34dWFYlmVZlmVZlmVZlmVZlmVZliA0ZBUAAAIAACCEEEJIIYUUUkgpxhhzzDnoJJQQCA1ZBQAAAgAIAAAAcBRHcRzJkRxJsiRL0iTN0ixP8zRPEz1RFEXTNFXRFV1RN21RNmXTNV1TNl1VVm1Xlm1btnXbl2Xb933f933f933f933f931dB0JDVgEAEgAAOpIjKZIiKZLjOI4kSUBoyCoAQAYAQAAAiuIojuM4kiRJkiVpkmd5lqiZmumZniqqQGjIKgAAEABAAAAAAAAAiqZ4iql4iqh4juiIkmiZlqipmivKpuy6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6rguEhqwCACQAAHQkR3IkR1IkRVIkR3KA0JBVAIAMAIAAABzDMSRFcizL0jRP8zRPEz3REz3TU0VXdIHQkFUAACAAgAAAAAAAAAzJsBTL0RxNEiXVUi1VUy3VUkXVU1VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU3TNE0TCA1ZCQCQAQCQEFMtLcaaCYskYtJqq6BjDFLspbFIKme1t8oxhRi1XhqHlFEQe6kkY4pBzC2k0CkmrdZUQoUUpJhjKhVSDlIgNGSFABCaAeBwHECyLECyLAAAAAAAAACQNA3QPA+wNA8AAAAAAAAAJE0DLE8DNM8DAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEDSNEDzPEDzPAAAAAAAAADQPA/wPBHwRBEAAAAAAAAALM8DNNEDPFEEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEDSNEDzPEDzPAAAAAAAAACwPA/wRBHQPBEAAAAAAAAALM8DPFEEPNEDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAQ4AAAEGAhFBqyIgCIEwBwSBIkCZIEzQNIlgVNg6bBNAGSZUHToGkwTQAAAAAAAAAAAAAkTYOmQdMgigBJ06Bp0DSIIgAAAAAAAAAAAACSpkHToGkQRYCkadA0aBpEEQAAAAAAAAAAAADPNCGKEEWYJsAzTYgiRBGmCQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQasiIAiBMAcDiKZQEAgOM4lgUAAI7jWBYAAFiWJYoAAGBZmigCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAABhwAAAIMKEMFBqyEgCIAgBwKIplAcexLOA4lgUkybIAlgXQPICmAUQRAAgAAChwAAAIsEFTYnGAQkNWAgBRAAAGxbEsTRNFkqRpmieKJEnTPE8UaZrneZ5pwvM8zzQhiqJomhBFUTRNmKZpqiowTVUVAABQ4AAAEGCDpsTiAIWGrAQAQgIAHIpiWZrmeZ4niqapmiRJ0zxPFEXRNE1TVUmSpnmeKIqiaZqmqrIsTfM8URRF01RVVYWmeZ4oiqJpqqrqwvM8TxRF0TRV1XXheZ4niqJomqrquhBFUTRN01RNVXVdIIqmaZqqqqquC0RPFE1TVV3XdYHniaJpqqqrui4QTdNUVVV1XVkGmKZpqqrryjJAVVXVdV1XlgGqqqqu67qyDFBV13VdWZZlAK7rurIsywIAAA4cAAACjKCTjCqLsNGECw9AoSErAoAoAADAGKYUU8owJiGkEBrGJIQUQiYlpdJSqiCkUlIpFYRUSiolo5RSailVEFIpqZQKQiollVIAANiBAwDYgYVQaMhKACAPAIAwRinGGHNOIqQUY845JxFSijHnnJNKMeacc85JKRlzzDnnpJTOOeecc1JK5pxzzjkppXPOOeeclFJK55xzTkopJYTOQSellNI555wTAABU4AAAEGCjyOYEI0GFhqwEAFIBAAyOY1ma5nmiaJqWJGma53meKJqmJkma5nmeJ4qqyfM8TxRF0TRVled5niiKommqKtcVRdM0TVVVXbIsiqZpmqrqujBN01RV13VdmKZpqqrrui5sW1VV1XVlGbatqqrqurIMXNd1ZdmWgSy7ruzasgAA8AQHAKACG1ZHOCkaCyw0ZCUAkAEAQBiDkEIIIWUQQgohhJRSCAkAABhwAAAIMKEMFBqyEgBIBQAAjLHWWmuttdZAZ6211lprrYDMWmuttdZaa6211lprrbXWUmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaay2llFJKKaWUUkoppZRSSimllFJKBQD6VTgA+D/YsDrCSdFYYKEhKwGAcAAAwBilGHMMQimlVAgx5px0VFqLsUKIMeckpNRabMVzzkEoIZXWYiyecw5CKSnFVmNRKYRSUkottliLSqGjklJKrdVYjDGppNZai63GYoxJKbTUWosxFiNsTam12GqrsRhjayottBhjjMUIX2RsLabaag3GCCNbLC3VWmswxhjdW4ultpqLMT742lIsMdZcAAB3gwMARIKNM6wknRWOBhcashIACAkAIBBSijHGGHPOOeekUow55pxzDkIIoVSKMcaccw5CCCGUjDHmnHMQQgghhFJKxpxzEEIIIYSQUuqccxBCCCGEEEopnXMOQgghhBBCKaWDEEIIIYQQSiilpBRCCCGEEEIIqaSUQgghhFJCKCGVlFIIIYQQQiklpJRSCiGEUkIIoYSUUkophRBCCKWUklJKKaUSSgklhBJSKSmlFEoIIZRSSkoppVRKCaGEEkopJaWUUkohhBBKKQUAABw4AAAEGEEnGVUWYaMJFx6AQkNWAgBkAACQopRSKS1FgiKlGKQYS0YVc1BaiqhyDFLNqVLOIOYklogxhJSTVDLmFEIMQuocdUwpBi2VGELGGKTYckuhcw4AAABBAICAkAAAAwQFMwDA4ADhcxB0AgRHGwCAIERmiETDQnB4UAkQEVMBQGKCQi4AVFhcpF1cQJcBLujirgMhBCEIQSwOoIAEHJxwwxNveMINTtApKnUgAAAAAAAMAPAAAJBcABER0cxhZGhscHR4fICEiIyQCAAAAAAAFwB8AAAkJUBERDRzGBkaGxwdHh8gISIjJAEAgAACAAAAACCAAAQEBAAAAAAAAgAAAAQET2dnUwAAQAAAAAAAAAAjaKehAgAAAEhTii0BRjLV6A+997733vvfe+997733vvfG+8fePvH3j7x94+8fePvH3j7x94+8fePvH3j7x94+8fePvH3gAAAAAAAAAAXm5PqUgABPZ2dTAABLAAAAAAAAACNop6EDAAAAIOuvQAsAAAAAAAAAAAAAAE9nZ1MAAEADAAAAAAAAI2inoQQAAAB/G0m4ATg/8A+997733vvfe+997733vvfK+8B94D7wAB94AAAAD8Kl94D7wH3gAD7wAAAAH4VABem0+pSAAE9nZ1MAAEsDAAAAAAAAI2inoQUAAABc3zKaCwAAAAAAAAAAAAAAT2dnUwAEQAYAAAAAAAAjaKehBgAAAOytEQUBOD/wD733vvfe+997733vvfe+98r7wH3gPvAAH3gAAAAPwqX3gPvAfeAAPvAAAAAfhUAF6bT6lIAAT2dnUwAAQL4AAAAAAACWSy/CAgAAAHsqKaIxAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQAKDg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg5PZ2dTAAQAxAAAAAAAAJZLL8IDAAAABLWpWwIBAQ4O",MP4:"data:video/mp4;base64, AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw",WEBM:"data:video/webm;base64, GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK"},MIME_TYPES:{image:["image/gif","image/jpeg","image/pjpeg","image/png","image/svg+xml","image/tiff","image/vnd.microsoft.icon","image/vnd.wap.wbmp","image/webp"],audio:["audio/basic","audio/L24","audio/mp4","audio/aac","audio/mpeg","audio/ogg","audio/ogg; codecs=opus","audio/vorbis","audio/x-ms-wma","audio/x-ms-wax","audio/vnd.rn-realaudio","audio/vnd.wave","audio/webm","audio/x-wav"],video:["video/mpeg","video/mp4","video/ogg","video/quicktime","video/webm","video/x-ms-wmv","video/x-flv","video/3gpp","video/3gpp2"],document:["text/cmd","text/css","text/csv","text/html","text/javascript (Obsolete)","text/plain","text/php","text/xml","text/markdown","text/cache-manifestapplication/json","application/xml","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.graphics","application/msword"],pdf:["application/pdf"],table:["application/vnd.oasis.opendocument.spreadsheet","application/vnd.ms-excel"],archive:["application/zip","application/gzip","application/x-rar-compressed","application/x-tar","application/x-7z-compressed"],presentation:["application/vnd.ms-powerpoint","application/vnd.oasis.opendocument.presentation"]},PERSONAL_AREA_URL:{},XABBER_ACCOUNT_URL:"https://www.xabber.com/account",API_SERVICE_URL:"https://api.xabber.com/api/v2",USE_SOCIAL_AUTH:!0,CHECK_VERSION:!0,DEFAULT_LOGIN_SCREEN:"xmpp",GCM_SENDER_ID:"868637702480",GCM_API_KEY:"AIzaSyC1JCBB3LLf_4DG_vRWMEEe0I4X5msEU-M",MESSAGE_ARCHIVE_DB_NAME:"MessageArchive"};constants.JINGLE_MSG_STATE={},constants.JINGLE_MSG_STATE[constants.JINGLE_MSG_RETRACT]="retract",constants.JINGLE_MSG_STATE[constants.JINGLE_MSG_REJECT]="reject",constants.JINGLE_MSG_STATE[constants.JINGLE_MSG_PROPOSE]="propose",constants.JINGLE_MSG_STATE[constants.JINGLE_MSG_ACCEPT]="accept",constants.JINGLE_MSG_VERBOSE_STATE={},constants.JINGLE_MSG_VERBOSE_STATE[constants.JINGLE_MSG_RETRACT]="retract",constants.JINGLE_MSG_VERBOSE_STATE[constants.JINGLE_MSG_PROPOSE]="Calling...",constants.MSG_STATE={},constants.MSG_STATE[constants.MSG_ERROR]="error",constants.MSG_STATE[constants.MSG_PENDING]="pending",constants.MSG_STATE[constants.MSG_SENT]="sent",constants.MSG_STATE[constants.MSG_DELIVERED]="delivered",constants.MSG_STATE[constants.MSG_DISPLAYED]="displayed",constants.MSG_STATE[constants.MSG_ARCHIVED]="archived",constants.MSG_STATE[constants.MSG_BLOCKED]="not-allowed",constants.MSG_VERBOSE_STATE={},constants.MSG_VERBOSE_STATE[constants.MSG_ERROR]="Message error",constants.MSG_VERBOSE_STATE[constants.MSG_PENDING]="Message not sent",constants.MSG_VERBOSE_STATE[constants.MSG_SENT]="Message sent",constants.MSG_VERBOSE_STATE[constants.MSG_DELIVERED]="Message delivered to user",constants.MSG_VERBOSE_STATE[constants.MSG_DISPLAYED]="Message read",constants.MSG_VERBOSE_STATE[constants.MSG_ARCHIVED]="Message from archive",constants.MSG_VERBOSE_STATE[constants.MSG_BLOCKED]="Message error","function"==typeof define&&define("xabber-constants",[],function(){return constants});/**
 * @license text 2.0.15 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/text/LICENSE
 */define("text",["module"],function(e){'use strict';function t(e,t){return void 0===e||""===e?t:e}function a(e,a,i,n){if(a===n)return!0;if(e===i){if("http"===e)return t(a,"80")===t(n,"80");if("https"===e)return t(a,"443")===t(n,"443")}return!1}var n=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s="undefined"!=typeof location&&location.href,o=s&&location.protocol&&location.protocol.replace(/\:/,""),d=s&&location.hostname,c=s&&(location.port||void 0),r={},l=e.config&&e.config()||{},p,u,i,m,g;return p={version:"2.0.15",strip:function(e){if(e){e=e.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");var t=e.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:l.createXhr||function(){var e,t,a;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){a=n[t];try{e=new ActiveXObject(a)}catch(t){}if(e){n=[a];break}}return e},parseName:function(e){var t=!1,a=e.lastIndexOf("."),i=0===e.indexOf("./")||0===e.indexOf("../"),n,s,o;return-1!==a&&(!i||1<a)?(n=e.substring(0,a),s=e.substring(a+1)):n=e,o=s||n,a=o.indexOf("!"),-1!==a&&(t="strip"===o.substring(a+1),o=o.substring(0,a),s?s=o:n=o),{moduleName:n,ext:s,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,i,n){var s=p.xdRegExp.exec(e),o,d,c;return!s||(o=s[2],d=s[3],d=d.split(":"),c=d[1],d=d[0],(!o||o===t)&&(!d||d.toLowerCase()===i.toLowerCase())&&(!c&&!d||a(o,c,t,n)))},finishLoad:function(e,t,a,i){a=t?p.strip(a):a,l.isBuild&&(r[e]=a),i(a)},load:function(e,t,a,i){if(i&&i.isBuild&&!i.inlineText)return void a();l.isBuild=i&&i.isBuild;var n=p.parseName(e),r=n.moduleName+(n.ext?"."+n.ext:""),u=t.toUrl(r),m=l.useXhr||p.useXhr;return 0===u.indexOf("empty:")?void a():void(!s||m(u,o,d,c)?p.get(u,function(t){p.finishLoad(e,n.strip,t,a)},function(e){a.error&&a.error(e)}):t([r],function(e){p.finishLoad(n.moduleName+"."+n.ext,n.strip,e,a)}))},write:function(e,t,a){if(r.hasOwnProperty(t)){var i=p.jsEscape(r[t]);a.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,a,i,n){var s=p.parseName(t),o=s.ext?"."+s.ext:"",d=s.moduleName+o,c=a.toUrl(s.moduleName+o)+".js";p.load(d,a,function(){var t=function(e){return i(c,e)};t.asModule=function(e,t){return i.asModule(e,c,t)},p.write(e,d,t,n)},n)}},"node"!==l.env&&(l.env||"undefined"==typeof process||!process.versions||!process.versions.node||process.versions["node-webkit"]||process.versions["atom-shell"])?"xhr"===l.env||!l.env&&p.createXhr()?p.get=function(e,t,a,i){var n=p.createXhr(),s;if(n.open("GET",e,!0),i)for(s in i)i.hasOwnProperty(s)&&n.setRequestHeader(s.toLowerCase(),i[s]);l.onXhr&&l.onXhr(n,e),n.onreadystatechange=function(){var i,s;4===n.readyState&&(i=n.status||0,399<i&&600>i?(s=new Error(e+" HTTP status: "+i),s.xhr=n,a&&a(s)):t(n.responseText),l.onXhrComplete&&l.onXhrComplete(n,e))},n.send(null)}:"rhino"!==l.env&&(l.env||"undefined"==typeof Packages||"undefined"==typeof java)?("xpconnect"===l.env||!l.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,m=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),g="@mozilla.org/windows-registry-key;1"in i,p.get=function(e,t){var a={},n,s,o;g&&(e=e.replace(/\//g,"\\")),o=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(m.nsIFileInputStream),n.init(o,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(m.nsIConverterInputStream),s.init(n,"utf-8",n.available(),m.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),a),s.close(),n.close(),t(a.value)}catch(t){throw new Error((o&&o.path||"")+": "+t)}}):p.get=function(e,t){var a=new java.io.File(e),i=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),"utf-8")),s="",o,d;try{for(o=new java.lang.StringBuffer,d=n.readLine(),d&&d.length()&&65279===d.charAt(0)&&(d=d.substring(1)),null!==d&&o.append(d);null!==(d=n.readLine());)o.append(i),o.append(d);s=o.toString()+""}finally{n.close()}t(s)}:(u=require.nodeRequire("fs"),p.get=function(e,t,a){try{var i=u.readFileSync(e,"utf8");"\uFEFF"===i[0]&&(i=i.substring(1)),t(i)}catch(t){a&&a(t)}}),p}),define("text!templates/base/dialog.html",[],function(){return"<div class=\"modal dialog-modal\">\n    <div class=\"modal-header\">\n        <div class=\"panel-header black-text\">{{header}}</div>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"dialog-text\">{{text}}</div>\n        <div class=\"dialog-options-wrap\">\n        {[ for (var idx in dialog_options) { var option = dialog_options[idx]; ]}\n            <div class=\"dialog-option\" data-name=\"{{option.name}}\">\n                <input type=\"checkbox\" class=\"filled-in\" id=\"dialog_option_{{option.name}}\" {[ if (option.checked) { ]}checked=\"checked\"{[ } ]}/>\n                <label for=\"dialog_option_{{option.name}}\">{{option.text}}</label>\n            </div>\n        {[ } ]}\n        </div>\n        <div class=\"container-for-img hidden\"><img class=\"img-from-clipboard\"></div>\n    </div>\n    <div class=\"modal-footer {{flag}}\">\n        {[ for (var idx in optional_buttons) { var button = optional_buttons[idx]; ]}\n        <button class=\"optional-button btn-flat btn-main btn-dark\" data-option=\"{{button.value}}\">{{button.name}}</button>\n        {[ } ]}\n        {[ if (ok_button) { ]}\n        <button class=\"ok-button btn-flat btn-main\" data-option=true>{{ok_button.text}}</button>\n        {[ } ]}\n        {[ if (cancel_button) { ]}\n        <button class=\"cancel-button btn-flat btn-main btn-dark btn-cancel\" data-option=false>{{cancel_button.text}}</button>\n        {[ } ]}\n    </div>\n</div>\n"}),define("text!templates/base/jingle_message_calling.html",[],function(){return"<i class=\"mdi mdi-phone btn-collapse\"></i>\n<div class=\"call-header\">\n    Xabber voice call\n    <div class=\"calling-status\"/>\n</div>\n<div class=\"blur-background\"></div>\n<div class=\"contact-info\">\n    <div class=\"name one-line\"/>\n    <div class=\"calling-status\"/>\n</div>\n<div class=\"video-wrap\">\n    <video autoplay loop class=\"blank-video hidden\">\n        <source src=\"{{constants.BLANK_VIDEO.MP4}}\">\n        <source src=\"{{constants.BLANK_VIDEO.OGG}}\" type=\"video/ogg\">\n        <source src=\"{{constants.BLANK_VIDEO.WEBM}}\" type=\"video/webm\">\n    </video>\n    <audio autoplay class=\"webrtc-remote-audio hidden\"/>\n    <video autoplay muted class=\"webrtc-local-video collapsed hidden\"/>\n    <div class=\"default-screen\">\n        <div class=\"circle-avatar\"/>\n        <div class=\"name one-line\"/>\n    </div>\n</div>\n<div class=\"buttons-panel\">\n    <div class=\"buttons-wrap\">\n        <div class=\"btn-wrap\" title=\"Collapse window\"><svg class=\"btn-collapse mdi-24px\" viewBox=\"0 0 24 24\">\n            <path d=\"M19.5,3.09L15,7.59V4H13V11H20V9H16.41L20.91,4.5L19.5,3.09M4,13V15H7.59L3.09,19.5L4.5,20.91L9,16.41V20H11V13H4Z\"/>\n        </svg></div>\n        <div class=\"btn-wrap\" title=\"Fullscreen mode\"><svg class=\"btn-full-screen mdi-24px\" viewBox=\"0 0 24 24\">\n            <path d=\"M11,21H3V13H5V17.59L17.59,5H13V3H21V11H19V6.41L6.41,19H11V21Z\" />\n        </svg></div>\n        <i title=\"Mute\" class=\"btn-volume mdi mdi-24px mdi-volume-high\"/>\n        <i title=\"Mute microphone\" class=\"btn-microphone mdi mdi-24px mdi-microphone\"/>\n        <i title=\"Switch on/off video\" class=\"btn-video mdi mdi-24px mdi-video\"/>\n        <i title=\"Share screen\" class=\"btn-share-screen mdi mdi-24px mdi-monitor\"/>\n        <i title=\"Accept call\" class=\"btn-accept mdi mdi-24px mdi-phone\"/>\n        <i title=\"Decline call\" class=\"btn-cancel mdi mdi-24px mdi-phone-hangup\"/>\n    </div>\n</div>"}),define("text!templates/base/input_widget.html",[],function(){return"<div class=\"input-widget-wrap {{field_name}}-wrap\">\n    <div class=\"{{field_name}} field-text one-line\"></div>\n    <div class=\"btn-rename\">\n        <span>rename</span>\n    </div>\n    <div class=\"{{field_name}}-input-wrap\">\n        <input class=\"{{field_name}}-input field-input hidden\" type=\"{{field_type}}\" placeholder=\"{{placeholder}}\">\n    </div>\n</div>\n"}),define("text!templates/base/toolbar.html",[],function(){return"<div class=\"toolbar-item all-chats active\" title=\"All chats\">\n    <div class=\"border\"></div>\n    <img class=\"logo\" src=\"images/xabber-logo.png\">\n    <span class=\"all-msg-indicator\"></span>\n</div>\n\n<div class=\"toolbar-item chats\" title=\"Chats\">\n    <div class=\"border\"></div>\n    <i class=\"toolbar-icon mdi mdi-24px mdi-message-text\"></i>\n    <span class=\"msg-indicator\"></span>\n</div>\n\n<div class=\"toolbar-item group-chats\" title=\"Group chats\">\n    <div class=\"border\"></div>\n    <svg class=\"toolbar-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"message-group\"></svg>\n    <span class=\"group-msg-indicator\"></span>\n</div>\n\n<div class=\"toolbar-item mentions\" title=\"Mentions\">\n    <div class=\"border\"></div>\n    <svg class=\"toolbar-icon mdi mdi-24px mdi-svg-template\" viewBox=\"0 0 24 24\" data-svgname=\"ic-at\"></svg>\n    <span class=\"mentions-indicator\"></span>\n</div>\n\n<div class=\"toolbar-item archive-chats\" title=\"Archive chats\">\n    <div class=\"border\"></div>\n    <i class=\"toolbar-icon mdi mdi-24px mdi-archive\"></i>\n    <span class=\"archive-msg-indicator hidden\"></span>\n</div>\n\n<div class=\"toolbar-item contacts\" title=\"Contacts\">\n    <div class=\"border\"></div>\n    <i class=\"toolbar-icon mdi mdi-24px mdi-account-multiple\"></i>\n</div>\n\n<div class=\"toolbar-item search\" title=\"Search\">\n    <div class=\"border\"></div>\n    <svg class=\"toolbar-icon mdi mdi-24px mdi-svg-template\" viewBox=\"0 0 24 24\" data-svgname=\"ic-searching\"></svg>\n</div>\n\n<div class=\"add-something-wrap\">\n    <div class=\"toolbar-item dropdown-button add-something\" data-activates=\"{{view.cid}}-add\" title=\"Add group chat, contact or account\">\n        <i class=\"toolbar-icon mdi mdi-24px mdi-plus\"></i>\n    </div>\n\n    <div id=\"{{view.cid}}-add\" class=\"add-variants dropdown-content noselect\">\n        <div class=\"add-variant groupchat\">\n            <i class=\"mdi mdi-20px mdi-account-multiple-plus\"></i>\n            <span class=\"text\">Create group chat</span>\n        </div>\n        <div class=\"add-variant contact\">\n            <i class=\"mdi mdi-20px mdi-account-plus\"></i>\n            <span class=\"text\">Add contact</span>\n        </div>\n        <div class=\"add-variant account\">\n            <i class=\"mdi mdi-20px mdi-account-circle\"></i>\n            <span class=\"text\">Add account</span>\n        </div>\n    </div>\n</div>\n\n<div class=\"divider noselect\"></div>\n\n<div class=\"accounts-wrap\">\n    <div class=\"accounts\">\n    </div>\n</div>\n\n<div class=\"toolbar-bottom\">\n    <div class=\"toolbar-item about\" title=\"About\">\n        <div class=\"border\"></div>\n        <i class=\"toolbar-icon mdi mdi-24px mdi-information\"></i>\n    </div>\n    <div class=\"toolbar-item settings\" title=\"Settings\">\n        <div class=\"border\"></div>\n        <i class=\"toolbar-icon mdi mdi-24px mdi-settings\"></i>\n    </div>\n</div>\n"}),define("text!templates/base/settings.html",[],function(){return"    <div class=\"left-column noselect\">\n        <div class=\"main-info-wrap xabber-info-wrap\">\n            <div class=\"picture-wrap\">\n                <img class=\"logo\" src=\"images/xabber-logo-96.png\"/>\n            </div>\n            <div class=\"name\">Xabber for Web</div>\n            <div class=\"version\"></div>\n        </div>\n        <div class=\"settings-tabs-wrap\">\n            <div class=\"settings-tab xabber-account-tab offline\" data-block-name=\"xabber-account\">\n                <svg class=\"mdi mdi-24px mdi-svg-template xabber-offline-icon\" data-svgname=\"xabber-offline\"></svg>\n                <svg class=\"mdi mdi-24px mdi-svg-template xabber-online-icon\" data-svgname=\"xabber-online\"></svg>\n                <div class=\"settings-block-name one-line\">Xabber Account</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"xmpp-accounts\">\n                <i class=\"mdi mdi-24px mdi-settings\"/>\n                <div class=\"settings-block-name one-line\">XMPP Accounts</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"keyboard\">\n                <i class=\"mdi mdi-24px mdi-keyboard\"></i>\n                <div class=\"settings-block-name one-line\">Keyboard</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"contact-list\">\n                <i class=\"mdi mdi-24px mdi-account-multiple\"></i>\n                <div class=\"settings-block-name one-line\">Contact list</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"notifications\">\n                <i class=\"mdi mdi-24px mdi-bell\"></i>\n                <div class=\"settings-block-name one-line\">Notifications</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"sounds\">\n                <i class=\"mdi mdi-24px mdi-volume-high\"></i>\n                <div class=\"settings-block-name one-line\">Sounds</div>\n            </div>\n            {[if (PERSONAL_AREA_URL) {]}\n            <a href=\"{{PERSONAL_AREA_URL.url}}\" target=\"_blank\"><div class=\"link-button settings-tab\" data-block-name=\"{{PERSONAL_AREA_URL.label}}\">\n                <i class=\"mdi mdi-24px mdi-{{PERSONAL_AREA_URL.icon_name}}\"></i>\n                <div class=\"settings-block-name one-line\">{{PERSONAL_AREA_URL.label}}</div>\n            </div>\n            </a>\n            {[}]}\n        </div>\n        <div class=\"settings-tabs-bottom-wrap\">\n            <div class=\"settings-tab delete-all-accounts\">\n                <i class=\"mdi mdi-24px mdi-logout-variant\"></i>\n                <div class=\"settings-block-name\">Quit Xabber Web</div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"right-column noselect\">\n        <div class=\"settings-panel-head\">\n            <span>Settings</span>\n        </div>\n\n        <div class=\"panel-content-wrap\">\n            <div class=\"panel-content\">\n                <div class=\"settings-block-wrap xabber-account\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Xabber account</span>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap xmpp-accounts\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">XMPP accounts</span>\n                    </div>\n                    <div class=\"setting xmpp-account-list\">\n                        <div class=\"accounts-head-wrap\">\n                            <div class=\"accounts-head xmppid-head\">XMPP ID</div>\n                            <div class=\"accounts-head sync-head\">Sync</div>\n                            <div class=\"accounts-head enabled-head\">Enabled</div>\n                        </div>\n                        <span class=\"no-accounts-tip\">No accounts</span>\n                        <div class=\"move-account-to-bottom droppable\"></div>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap keyboard\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Keyboard</span>\n                    </div>\n\n                    <div class=\"setting hotkeys radio-button field-wrap\">\n                        <div class=\"field radio-field clickable-field\">\n                            <form action=\"#\">\n                                <p>\n                                    <input class=\"with-gap\" name=\"hotkeys\" value=\"enter\" type=\"radio\" id=\"{{view.cid}}-enter\" />\n                                    <label for=\"{{view.cid}}-enter\">Send message on Enter</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"hotkeys\" value=\"ctrlenter\" type=\"radio\" id=\"{{view.cid}}-ctrlenter\" />\n                                    <label for=\"{{view.cid}}-ctrlenter\">Send message on Ctrl+Enter</label>\n                                </p>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap contact-list\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Contact list</span>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap notifications\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Notifications</span>\n                    </div>\n\n                    <div class=\"setting notifications field-wrap\">\n                        <div class=\"field clickable-field switch small\">\n                            <span class=\"field-name\">Desktop notifications</span>\n                            <label class=\"field-value\">\n                                <input type=\"checkbox\" name=\"notifications\">\n                                <span class=\"lever\"></span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class=\"setting message-preview field-wrap\">\n                        <div class=\"field clickable-field switch small\">\n                            <span class=\"field-name\">Message preview</span>\n                            <label class=\"field-value\">\n                                <input type=\"checkbox\" name=\"message-preview\">\n                                <span class=\"lever\"></span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class=\"setting call-attention field-wrap\">\n                        <div class=\"field clickable-field switch small\">\n                            <span class=\"field-name\">Call attention</span>\n                            <label class=\"field-value\">\n                                <input type=\"checkbox\" name=\"call-attention\">\n                                <span class=\"lever\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"settings-block-wrap sounds\">\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Sounds</span>\n                    </div>\n                    <div class=\"setting sound radio-button field-wrap\">\n                        <div class=\"field radio-field clickable-field\">\n                            <form action=\"#\">\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"\" type=\"radio\" id=\"{{view.cid}}-sound-no\" />\n                                    <label for=\"{{view.cid}}-sound-no\">No sound</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"beep_up\" type=\"radio\" id=\"{{view.cid}}-sound-beep-up\" />\n                                    <label for=\"{{view.cid}}-sound-beep-up\">Beep Up</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"tiny_noize\" type=\"radio\" id=\"{{view.cid}}-sound-tiny-noize\" />\n                                    <label for=\"{{view.cid}}-sound-tiny-noize\">Tiny Noize</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"retro_game\" type=\"radio\" id=\"{{view.cid}}-sound-retro-game\" />\n                                    <label for=\"{{view.cid}}-sound-retro-game\">Retro Game</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"pixel_beep\" type=\"radio\" id=\"{{view.cid}}-sound-pixel-beep\" />\n                                    <label for=\"{{view.cid}}-sound-pixel-beep\">Pixel Beep</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"beep_positive\" type=\"radio\" id=\"{{view.cid}}-sound-beep-positive\" />\n                                    <label for=\"{{view.cid}}-sound-beep-positive\">Beep Positive</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"good_chime\" type=\"radio\" id=\"{{view.cid}}-sound-good-chime\" />\n                                    <label for=\"{{view.cid}}-sound-good-chime\">Good Chime</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"cellular_click\" type=\"radio\" id=\"{{view.cid}}-sound-cellular-click\" />\n                                    <label for=\"{{view.cid}}-sound-cellular-click\">Cellular Click</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"bleep\" type=\"radio\" id=\"{{view.cid}}-sound-bleep\" />\n                                    <label for=\"{{view.cid}}-sound-bleep\">Bleep</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"mono_u\" type=\"radio\" id=\"{{view.cid}}-sound-mono-u\" />\n                                    <label for=\"{{view.cid}}-sound-mono-u\">Mono U</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"plop\" type=\"radio\" id=\"{{view.cid}}-sound-plop\" />\n                                    <label for=\"{{view.cid}}-sound-plop\">Plop</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"ether\" type=\"radio\" id=\"{{view.cid}}-sound-ether\" />\n                                    <label for=\"{{view.cid}}-sound-ether\">Ether</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"pop\" type=\"radio\" id=\"{{view.cid}}-sound-pop\" />\n                                    <label for=\"{{view.cid}}-sound-pop\">Pop</label>\n                                </p>\n                                <p>\n                                    <input class=\"with-gap\" name=\"sound\" value=\"computer_chime\" type=\"radio\" id=\"{{view.cid}}-sound-computer-chime\" />\n                                    <label for=\"{{view.cid}}-sound-computer-chime\">Computer Chime</label>\n                                </p>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/base/about.html",[],function(){return"    <div class=\"left-column noselect\">\n        <div class=\"main-info-wrap xabber-info-wrap\">\n            <div class=\"picture-wrap\">\n                <img class=\"logo\" src=\"images/xabber-logo-96.png\"/>\n            </div>\n            <div class=\"name\">Xabber for Web</div>\n            <div class=\"version\"></div>\n        </div>\n    </div>\n\n    <div class=\"right-column noselect\">\n        <div class=\"settings-panel-head\">\n            <span>About</span>\n        </div>\n\n        <div class=\"panel-content-wrap\">\n            <div class=\"panel-content\">\n                <div class=\"settings-block-wrap about\">\n                    <div class=\"block-content\">\n                        Xabber is an open source XMPP messenger for Android, iOS and Web platforms. It is build around open standards, interoperability, design and great user experience. Versions of Xabber for every platform are built to provide a continuous chat experience between them.\n                    </div>\n                    <div class=\"block-content\">\n                        You will find more information on our official website <a href=\"https://www.xabber.com\" target=\"_blank\">https://www.xabber.com</a>\n                    </div>\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">XMPP protocol</span>\n                    </div>\n                    <div class=\"block-content\">\n                        Extensible Messaging and Presence Protocol (XMPP) is a communications protocol for message-oriented middleware based on XML (Extensible Markup Language). It enables the near-real-time exchange of structured yet extensible data between any two or more network entities. The protocol was originally named Jabber, and was developed by the Jabber open-source community in 1999 for near real-time instant messaging (IM),presence information, and contact list maintenance.\n                    </div>\n\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">XMPP Extension Protocols</span>\n                    </div>\n                    <div class=\"block-content\">\n                        XMPP is highly extensible, via extensions known as XEPs (XMPP Extension Protocol). Xabber supports a number of popular XEPs that are essential to providing great chat experience for our users.\n                    </div>\n\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Developers</span>\n                    </div>\n                    <div class=\"block-content\">\n                        Xabber for Android was originally developed by <a href=\"http://redsolution.com\" target=\"_blank\">Redsolution</a> \u2014 an international software and services company currently based in Estonia. Since then, a number of individuals joined Xabber as developers, testers and translators.\n                    </div>\n                    <div class=\"block-content\">\n                        Our goal is to create a stable, reliable, interoperable and user friendly ecosystem for instant messaging that does not rely on proprietary services and data silos. We welcome anyone who believes in open standards and free information interchange to take part in moving Xabber forward.\n                    </div>\n                    <div class=\"block-content\">\n                        Follow us on Twitter and Github.\n                    </div>\n                    <div class=\"block-content flex-content\">\n                        <img class=\"logo\" src=\"images/redsolution-logo.png\"/>\n                        <a href=\"https://twitter.com/Xabber_XMPP\" target=\"_blank\"><div class=\"btn-social twitter-color\">\n                            <i class=\"mdi mdi-28px mdi-twitter\"></i>\n                        </div></a>\n                        <a href=\"https://github.com/redsolution/xabber-web\" target=\"_blank\"><img class=\"btn-social github-logo\" src=\"images/ic_github.png\"/></a>\n                    </div>\n\n\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">Translators</span>\n                    </div>\n                    <div class=\"block-content\">\n                        Xabber is available in multiple languages thanks to many fine people from all over the world. We have created a special page on our website to acknowledge their efforts.\n                    </div>\n                    <div class=\"block-content\">\n                        You may join their ranks and help us improve translation quality by contributing your translations to <a href=\"https://crowdin.com/project/xabber\" target=\"_blank\">Xabber project</a>\n                    </div>\n\n                    <div class=\"block-header\">\n                        <span class=\"block-name\">License</span>\n                    </div>\n                    <div class=\"block-content\">\n                        Xabber for Web source code is licensed under GNU AGPL v.3 license and is available on <a href=\"https://github.com/redsolution/xabber-web\" target=\"_blank\">GitHub</a>\n                    </div>\n                    <div class=\"block-content\">\n                        Graphical images are licensed under Creative Commons Attribution Share-Alike (CC BY-SA) license.\n                    </div>\n                    <div class=\"block-content\">\n                        Xabber & Redsolution logo are property of <a href=\"https://redsolution.com\" target=\"_blank\">Redsolution, O\xDC</a>\n                    </div>\n                    <div class=\"block-content\">\n                        View Xabber for Web <a href=\"https://github.com/redsolution/xabber-web/blob/master/LICENSE\" target=\"_blank\">license file</a> for more information.\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/api_service/xabber_login.html",[],function(){return"<div class=\"login-panel\">\n    <div class=\"login-panel-head noselect\">\n        <img src=\"images/xabber-logo.png\" class=\"client-logo\">\n        <span class=\"client-name\">Xabber</span>\n    </div>\n    <div class=\"login-panel-form xmpp-login-form noselect\">\n        <div class=\"btn-escape\">\n            <i class=\"mdi mdi-24px mdi-close\"></i>\n        </div>\n        <div class=\"login-form-header\">Email Login</div>\n        <div class=\"input-field email-name\">\n            <input id=\"username\" type=\"text\" name=\"username\">\n            <label for=\"username\">Email</label>\n            <span class=\"errors fixed one-line\"></span>\n        </div>\n        <div class=\"input-field\">\n            <input id=\"password\" type=\"password\" name=\"password\">\n            <label for=\"password\">Password</label>\n            <span class=\"errors fixed one-line\"></span>\n        </div>\n        <div class=\"input-field buttons-wrap\">\n            <a href=\"{{XABBER_ACCOUNT_URL}}/auth/forgot-password/\" target=\"_blank\" class=\"btn-flat btn-main btn-forgot-password\">Forgot password?</a>\n            <button class=\"btn btn-flat btn-main-filled btn-log-in\">Log In</button>\n        </div>\n        <div class=\"social-auth-wrap\"><div class=\"social-header\">\n            <div class=\"divider\"></div>\n            <div class=\"social-header-tip\">New Account</div>\n        </div></div>\n        <div class=\"registration-footer\">\n            <div class=\"registration-tip-wrap\">\n                <span class=\"registration-tip\">No XMPP account?</span>\n                <a href=\"{{XABBER_ACCOUNT_URL}}/auth/signup/?source=Xabber Web\" target=\"_blank\" class=\"btn-flat btn-main btn-registration\">Registration</a>\n            </div>\n        </div>\n        <div class=\"clearfix\"></div>\n    </div>\n</div>\n"}),define("text!templates/api_service/xabber_login_by_email.html",[],function(){return"<div class=\"login-panel-form xmpp-login-form noselect\">\n    <div class=\"login-form-header\">Email Login</div>\n    <div class=\"input-field email-name\">\n        <input id=\"username\" type=\"text\" name=\"username\">\n        <label for=\"username\">Email</label>\n        <span class=\"errors fixed one-line\"></span>\n    </div>\n    <div class=\"input-field\">\n        <input id=\"password\" type=\"password\" name=\"password\">\n        <label for=\"password\">Password</label>\n        <span class=\"errors fixed one-line\"></span>\n    </div>\n    <div class=\"login-panel-footer buttons-wrap\"><button class=\"btn btn-flat btn-main-filled btn-log-in\">Log In</button><button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button></div>\n</div>"}),define("text!templates/api_service/xabber_account.html",[],function(){return"<div class=\"xabber-account-content-wrap\">\n    <div class=\"account-info-wrap\">\n        <div class=\"circle-avatar noselect\">\n            <img>\n        </div>\n        <div class=\"text-info-wrap\">\n            <div class=\"name-wrap\">\n                <div class=\"name text-color-red-700 one-line\"></div>\n            </div>\n            <div class=\"last-sync-info\"></div>\n        </div>\n    </div>\n    <div class=\"sync-wrap\">\n        <div class=\"btn-sync\">\n            <div class=\"preloader-wrapper preloader-20px active\">\n                <div class=\"spinner-layer\">\n                    <div class=\"circle-clipper left\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"gap-patch\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"circle-clipper right\">\n                        <div class=\"circle\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class=\"buttons-wrap\">\n        <button class=\"btn-flat btn-main btn-login\">Log in</button>\n        <div class=\"chat-tool btn-more dropdown-button\" data-activates=\"account-action-more\">\n            <i class=\"mdi mdi-20px mdi-dots-vertical\"></i>\n        </div>\n        <ul id=\"account-action-more\" class=\"xabber-account-menu dropdown-content noselect\">\n            <li class=\"btn-sync btn-sync-settings\">\n                <span class=\"one-line\">Synchronize</span>\n            </li>\n            <li class=\"btn-set-password\">\n                <span class=\"one-line\">Set password</span>\n            </li>\n            <li class=\"btn-logout\">\n                <span class=\"one-line\">Quit</span>\n            </li>\n        </ul>\n    </div>\n</div>\n<div class=\"xabber-account-tip\">Xabber account lets you easily sync your settings and connected XMPP accounts between various devices.</div>\n<div class=\"linked-social-accounts-and-emails\">\n    <div class=\"social-linked-header\"><div class=\"chevron-icon\"><i class=\"arrow mdi mdi-20px\"></i></div><div class=\"social-linked-header-text\">Linked social accounts and emails</div></div>\n    <div class=\"social-linked-wrap\">\n        <div id='google' class=\"not-linked social-account social-linked-item-wrap google-linked\"><div class=\"google-color social-icon\"><i class=\"mdi mdi-24px mdi-google-plus\"></i></div><div class=\"synced-info\">Not linked</div><div class=\"btn-main btn-flat btn-link\">link</div></div>\n        <div id='facebook' class=\"not-linked social-account social-linked-item-wrap facebook-linked\"><div class=\"facebook-color social-icon\"><i class=\"mdi mdi-24px mdi-facebook\"></i></div><div class=\"synced-info\">Not linked</div><div class=\"btn-main btn-flat btn-link\">link</div></div>\n        <div id='twitter' class=\"not-linked social-account social-linked-item-wrap twitter-linked\"><div class=\"twitter-color social-icon\"><i class=\"mdi mdi-24px mdi-twitter\"></i></div><div class=\"synced-info\">Not linked</div><div class=\"btn-main btn-flat btn-link\">link</div></div>\n        <div id='email' class=\"not-linked social-linked-item-wrap\"><div class=\"email-color social-icon\"><svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n            <path fill=\"#FFF\" d=\"M3,4C1.89,4 1,4.89 1,6V18A2,2 0 0,0 3,20H14.09C14.03,19.67 14,19.34 14,19A6,6 0 0,1 20,13C20.34,13 20.67,13.03 21,13.09V6C21,4.89 20.1,4 19,4H3M3,6L11,11L19,6V8L11,13L3,8V6M19,15V18H16V20H19V23H21V20H24V18H21V15H19Z\" />\n        </svg></div><div class=\"synced-info\">Link email account</div><div class=\"btn-main btn-flat btn-link\">link</div></div>\n    </div>\n    <span class=\"errors\"></span>\n</div>"}),define("text!templates/api_service/linked_email_item.html",[],function(){return"<div data-id=\"{{email_id}}\" data-email=\"{{email}}\" class=\"{[if (!verified){]}not-linked {[}]}social-linked-item-wrap email-linked\"><div style=\"background-color:{{color}}\" class=\"social-icon\">{[if (verified){]}<svg style=\"width:24px;height:24px\" viewBox=\"0 0 24 24\">\n    <path fill=\"#FFF\" d=\"M21,13.34C20.37,13.12 19.7,13 19,13A6,6 0 0,0 13,19C13,19.34 13.03,19.67 13.08,20H3A2,2 0 0,1 1,18V6C1,4.89 1.89,4 3,4H19A2,2 0 0,1 21,6V13.34M23.5,17L18.5,22L15,18.5L16.5,17L18.5,19L22,15.5L23.5,17M3,6V8L11,13L19,8V6L11,11L3,6Z\" />\n</svg>{[} else {]}<i class=\"mdi mdi-24px mdi-email\"></i>{[}]}</div><div class=\"synced-info\"><div class=\"name one-line\">{{email}}</div><div class=\"verified-status one-line\">{{verified_status}} email address</div></div>{[if (!verified){]}<div class=\"btn-main btn-flat btn-verify-email\">verify</div>{[}]}<div class=\"btn-main btn-flat btn-link btn-unlink\">unlink</div></div>"}),define("text!templates/api_service/add_xabber_account.html",[],function(){return"<div class=\"modal main-modal add-xabber-account-modal\">\n\n<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Xabber Login</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row account-field\">\n            <div class=\"multiple-acc\">\n                <div class=\"account-dropdown-wrap\">\n                    <div class=\"dropdown-button\" data-activates=\"select-account-for-add-contact\">\n                        <div class=\"account-item-wrap\">\n                        </div>\n                        <div class=\"caret\">\n                            <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                        </div>\n                    </div>\n                    <div id=\"select-account-for-add-contact\" class=\"dropdown-content noselect\">\n                    </div>\n                </div>\n            </div>\n            <div class=\"single-acc\">\n                <div class=\"dropdown-button\">\n                    <div class=\"account-item-wrap\">\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"row social-auth-wrap\">\n            <div class=\"social-header\">\n                <div class=\"divider\"></div>\n                <div class=\"social-header-tip\">Social Sign In</div>\n            </div>\n            <div class=\"social-buttons\">\n                <div class=\"btn-social google-color\" data-provider=\"google\">\n                    <i class=\"mdi mdi-28px mdi-google-plus\"></i>\n                </div>\n                <div class=\"btn-social facebook-color\" data-provider=\"facebook\">\n                    <i class=\"mdi mdi-28px mdi-facebook\"></i>\n                </div>\n                <div class=\"btn-social twitter-color\" data-provider=\"twitter\">\n                    <i class=\"mdi mdi-28px mdi-twitter\"></i>\n                </div>\n                <div class=\"btn-social xabber-color\" data-provider=\"email\">\n                    <i class=\"mdi mdi-28px mdi-at\"></i>\n                </div>\n            </div>\n        </div>\n\n    </div>\n    <div class=\"modal-footer\">\n        <!--<button class=\"btn-flat btn-main btn-add\">Log in</button>-->\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n\n</div>\n\n    <div class=\"login-panel-footer\">\n        <div class=\"registration-footer\">\n            <div class=\"registration-tip-wrap\">\n                <span class=\"registration-tip\">No Xabber account?</span>\n                <a href=\"{{XABBER_ACCOUNT_URL}}/auth/signup/\" target=\"_blank\" class=\"btn-flat btn-main btn-registration\">Registration</a>\n            </div>\n        </div>\n        <div class=\"footer-text clearfix\">Xabber account lets you easily sync your settings and connected XMPP accounts between various devices. Visit Xabber.com for more details.</div>\n    </div>\n"}),define("text!templates/api_service/sync_settings.html",[],function(){return"<div class=\"modal-content-wrap settings-panel\">\n    <div class=\"modal-header\">\n        <span>Synchronization</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row\">\n            <div class=\"setting sync-all-wrap field-wrap\">\n                <div class=\"field clickable-field switch normal\">\n                    <span class=\"field-name\">Synchronize all</span>\n                    <label class=\"field-value\">\n                       <input type=\"checkbox\" class=\"sync-all\">\n                       <span class=\"lever\"></span>\n                    </label>\n                </div>\n            </div>\n            <div class=\"accounts-wrap\">\n            </div>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-sync\">Synchronize</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/api_service/sync_settings_account_item.html",[],function(){return"<div class=\"account-wrap\" data-jid=\"{{jid}}\">\n    <div class=\"account-info-wrap\">\n        <i class=\"sync-icon mdi mdi-24px\" data-mdiclass=\"\"></i>\n        <div class=\"text-info-wrap\">\n            <div class=\"name text-color-grey-900 one-line\">{{jid}}</div>\n            <div class=\"sync-tip text-color-grey-500 one-line\"></div>\n        </div>\n    </div>\n    <div class=\"input-field checkbox-field sync-one-wrap no-padding\">\n        <input type=\"checkbox\" class=\"filled-in sync-one\" id=\"{{view.cid}}_sync_{{jid}}\"/>\n        <label for=\"{{view.cid}}_sync_{{jid}}\"></label>\n    </div>\n</div>\n"}),define("text!templates/accounts/xmpp_login.html",[],function(){return"<div class=\"login-panel\">\n    <div class=\"login-panel-container\">\n        <div class=\"login-panel-header\">\n            <div class=\"logo\">\n                <img src=\"/static/xmppserverui/img/logo.png\" alt=\"xabber-logo\" class=\"client-logo\"/>\n            </div>\n        </div>\n\n        <div class=\"login-panel-body\">\n            <div class=\"client-name\">Xabber for Web</div>\n            <div class=\"client-subtitle\">Online team chat right in your browser</div>\n\n            <input class=\"login-form-field\" id=\"jid\" placeholder=\"username@example.com\" type=\"text\" name=\"jid\">\n            <label for=\"jid\"></label>\n\n            <input class=\"login-form-field\" id=\"password\" placeholder=\"Password\" type=\"password\" name=\"password\">\n            <label for=\"password\"></label>\n\n            <span class=\"login-error errors\"></span>\n\n            <div class=\"login-button-row\">\n                <button class=\"login-button btn-log-in\">Login</button>\n            </div>\n\n        </div>\n\n        <div class=\"login-panel-clients-wrap\">\n            <div class=\"row login-panel-clients\">\n                <div class=\"col lp-client-item\">\n                    <a target=\"_blank\" href=\"https://play.google.com/store/apps/details?id=com.xabber.android\">\n                        <div class=\"lp-client-logo\">\n                            <img src=\"images/client_android.svg\" alt=\"\">\n                        </div>\n                        <div class=\"lp-client-title\">\n                            Xabber for Android\n                        </div>\n                    </a>\n                </div>\n                <div class=\"col lp-client-item\">\n                    <a target=\"_blank\" href=\"https://testflight.apple.com/join/8AVdKqCK\">\n                        <div class=\"lp-client-logo\">\n                            <img src=\"images/client_iphone.svg\" alt=\"\">\n                        </div>\n                        <div class=\"lp-client-title\">\n                            Xabber for iOS\n                        </div>\n                    </a>\n                </div>\n            </div>\n        </div>\n    </div>\n\n</div>\n\n<div class=\"login-panel-footer\">\n    <div class=\"col\">\n        <div class=\"login-page-footer-link\">\n            <a href=\"https://www.xabber.com/\">www.xabber.com</a>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/accounts/add_account.html",[],function(){return"<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Add new account</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row login-form-field\">\n            <div class=\"input-field\">\n                <input id=\"jid\" type=\"text\" name=\"jid\">\n                <label for=\"jid\">Username</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n            <div class=\"input-field\">\n                <input id=\"password\" type=\"password\" name=\"password\">\n                <label for=\"password\">Password</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n        </div>\n        <div class=\"sync-option\">\n            <input type=\"checkbox\" class=\"filled-in\" id=\"{{view.cid}}_sync_acc\"/>\n            <label for=\"{{view.cid}}_sync_acc\">Synchronize with Xabber account</label>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-add\">Add</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/accounts/change_password.html",[],function(){return"<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Set password</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row login-form-field\">\n            <div class=\"input-field\">\n                <input id=\"jid\" type=\"text\" name=\"jid\" readonly>\n                <label for=\"jid\">Username</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n            <div class=\"input-field\">\n                <input id=\"password\" type=\"password\" name=\"password\">\n                <label for=\"password\">Password</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-change\">Set</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/accounts/toolbar_item.html",[],function(){return"<div class=\"border\"/>\n<div class=\"dropdown-button circle-avatar border-color ground-color-700 noselect\"/>\n<div class=\"status\"/>\n<i class=\"auth-failed mdi mdi-16px mdi-close\"></i>\n<div class=\"account-actions-panel\">\n    <div class=\"filter-chats\">\n        <i class=\"mdi mdi-filter mdi-20px\"></i>\n        <div class=\"text\">Filter chats</div>\n    </div>\n</div>"}),define("text!templates/accounts/settings_left.html",[],function(){return"    <div class=\"left-column ground-color-900 noselect\">\n        <div class=\"main-info-wrap account-main-info-wrap\">\n            <!--<i title=\"Back to settings\" class=\"mdi mdi-arrow-left mdi-28px back-to-settings\"></i>-->\n            <div class=\"picture-wrap\">\n                <div class=\"avatar-wrap\">\n                    <div class=\"circle-avatar\">\n                        <img/>\n                        <input type=\"file\"/>\n                        <svg class=\"set-groupchat-avatar\" viewBox=\"0 0 24 24\">\n                            <path d=\"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z\" />\n                        </svg>\n                        <div class=\"preloader-wrap\"><div class=\"preloader-wrapper preloader-32px visible\">\n                            <div class=\"spinner-layer\">\n                                <div class=\"circle-clipper left\">\n                                    <div class=\"circle\"></div>\n                                </div>\n                                <div class=\"gap-patch\">\n                                    <div class=\"circle\"></div>\n                                </div>\n                                <div class=\"circle-clipper right\">\n                                    <div class=\"circle\"></div>\n                                </div>\n                            </div>\n                        </div>\n                        </div>\n                    </div>\n                    <div class=\"status\"></div>\n                </div>\n            </div>\n            <div class=\"name-wrap\">\n                <div class=\"name\"></div>\n            </div>\n            <div class=\"status-wrap\"></div>\n        </div>\n        <div class=\"settings-tabs-wrap\">\n            <div class=\"settings-tab\" data-block-name=\"connection\">\n                <i class=\"mdi mdi-24px mdi-settings\"></i>\n                <div class=\"settings-block-name one-line\">Connection settings</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"tokens\">\n                <i class=\"mdi mdi-24px mdi-key\"></i>\n                <div class=\"settings-block-name one-line\">Active sessions</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"synchronization\">\n                <i class=\"mdi mdi-24px mdi-sync\"></i>\n                <div class=\"settings-block-name one-line\">Synchronization</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"color-scheme\">\n                <i class=\"mdi mdi-24px mdi-palette\"></i>\n                <div class=\"settings-block-name one-line\">Color scheme</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"xmpp-resources\">\n                <svg class=\"mdi mdi-24px mdi-svg-template\" data-svgname=\"ic-jabber\"></svg>\n                <div class=\"settings-block-name one-line\">XMPP Resources</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"vcard\">\n                <i class=\"mdi mdi-24px mdi-account-card-details\"></i>\n                <div class=\"settings-block-name one-line\">vCard</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"server-info\">\n                <i class=\"mdi mdi-24px mdi-information\"></i>\n                <div class=\"settings-block-name one-line\">Server information</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"blocklist-info\">\n                <i class=\"mdi mdi-24px mdi-block-helper\"></i>\n                <div class=\"settings-block-name one-line\">Blocked contacts</div>\n            </div>\n            <div class=\"settings-tab\" data-block-name=\"groups-info\">\n                <i class=\"mdi mdi-24px mdi-account-multiple\"></i>\n                <div class=\"settings-block-name one-line\">Groups</div>\n            </div>\n        </div>\n        <div class=\"settings-tabs-bottom-wrap ground-color-900\">\n            <div class=\"settings-tab delete-account\">\n                <i class=\"mdi mdi-24px mdi-logout-variant\"></i>\n                <div class=\"settings-block-name\">Quit account</div>\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/accounts/settings_right.html",[],function(){return"<div class=\"right-column noselect\">\n    <div class=\"settings-panel-head\">\n        <span>Account settings</span>\n        <div class=\"field enabled-state switch normal\">\n            <label class=\"field-value\">\n                <input type=\"checkbox\">\n                <span class=\"lever\"></span>\n            </label>\n        </div>\n    </div>\n\n    <div class=\"panel-content-wrap\">\n        <div class=\"panel-content details-panel\">\n\n            <div class=\"settings-block-wrap connection\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Connection settings</span>\n                </div>\n                <div class=\"connection-wrap\">\n                    <div class=\"readonly-setting\">\n                        <i class=\"details-icon mdi mdi-24px mdi-account\"></i>\n                        <div class=\"setting-wrap account-name\">\n                            <div class=\"value one-line\"></div>\n                            <div class=\"label conn-status\"></div>\n                        </div>\n                    </div>\n                    <div class=\"buttons-wrap\">\n                        <button class=\"btn-change-password btn-flat btn-main btn-dark ground-color-100 hover-ground-color-300\">Set password</button>\n                        <button class=\"btn-reconnect btn-flat btn-main btn-dark ground-color-100 hover-ground-color-300\">Reconnect</button>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap tokens\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Active sessions</span>\n                </div>\n                <div class=\"tokens-wrap\">\n                    <div class=\"current-token-wrap\">\n                        <div class=\"sessions-wrap current-session selectable-text\"></div>\n                        <div class=\"buttons-wrap\">\n                            <p class=\"btn-revoke-all-tokens hover-text-color-500 text-color-700\">Terminate all others sessions</p>\n                        </div>\n                    </div>\n                    <div class=\"all-sessions-wrap\">\n                        <div class=\"sessions-wrap all-sessions selectable-text\"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap synchronization\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Synchronization</span>\n                </div>\n                <div class=\"synchronization-wrap\">\n                    <div class=\"readonly-setting\">\n                        <i class=\"details-icon sync-status-icon mdi mdi-24px\" data-mdiclass=\"\"></i>\n                        <div class=\"setting-wrap account-name\">\n                            <div class=\"value one-line\"></div>\n                            <div class=\"label sync-status\"></div>\n                        </div>\n                    </div>\n                    <div class=\"xabber-account-features-wrap\">\n                        <div class=\"sync-enable-wrap\">\n                            <input type=\"checkbox\" class=\"filled-in sync-account\" id=\"{{view.cid}}_sync_account\"/>\n                            <label for=\"{{view.cid}}_sync_account\">Enable synchronization</label>\n                        </div>\n                        <div class=\"buttons-wrap\">\n                            <button class=\"btn-delete-settings btn-flat btn-main btn-dark ground-color-grey-100 hover-ground-color-grey-300\">Delete settings</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap color-scheme\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Color scheme</span>\n                </div>\n                <div class=\"color-scheme-wrap\">\n                    <div class=\"account-color\">\n                        <div class=\"current-color-name text-color-700\"></div>\n                        <div class=\"dropdown-button\" data-activates=\"select-color-{{view.cid}}\">\n                            <i class=\"mdi mdi-24px mdi-menu-down\"></i>\n                        </div>\n                        <ul id=\"select-color-{{view.cid}}\" class=\"color-values dropdown-content noselect\">\n                            <li class=\"color-value\" data-value=\"red\">\n                                <div class=\"color-name text-color-red-700\">red</div>\n                                <div class=\"color-pattern ground-color-red-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"pink\">\n                                <div class=\"color-name text-color-pink-700\">pink</div>\n                                <div class=\"color-pattern ground-color-pink-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"purple\">\n                                <div class=\"color-name text-color-purple-700\">purple</div>\n                                <div class=\"color-pattern ground-color-purple-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"deep-purple\">\n                                <div class=\"color-name text-color-deep-purple-700\">deep purple</div>\n                                <div class=\"color-pattern ground-color-deep-purple-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"indigo\">\n                                <div class=\"color-name text-color-indigo-700\">indigo</div>\n                                <div class=\"color-pattern ground-color-indigo-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"blue\">\n                                <div class=\"color-name text-color-blue-700\">blue</div>\n                                <div class=\"color-pattern ground-color-blue-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"light-blue\">\n                                <div class=\"color-name text-color-light-blue-700\">light blue</div>\n                                <div class=\"color-pattern ground-color-light-blue-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"cyan\">\n                                <div class=\"color-name text-color-cyan-700\">cyan</div>\n                                <div class=\"color-pattern ground-color-cyan-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"teal\">\n                                <div class=\"color-name text-color-teal-700\">teal</div>\n                                <div class=\"color-pattern ground-color-teal-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"green\">\n                                <div class=\"color-name text-color-green-700\">green</div>\n                                <div class=\"color-pattern ground-color-green-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"light-green\">\n                                <div class=\"color-name text-color-light-green-700\">light green</div>\n                                <div class=\"color-pattern ground-color-light-green-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"lime\">\n                                <div class=\"color-name text-color-lime-700\">lime</div>\n                                <div class=\"color-pattern ground-color-lime-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"amber\">\n                                <div class=\"color-name text-color-amber-700\">amber</div>\n                                <div class=\"color-pattern ground-color-amber-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"orange\">\n                                <div class=\"color-name text-color-orange-700\">orange</div>\n                                <div class=\"color-pattern ground-color-orange-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"deep-orange\">\n                                <div class=\"color-name text-color-deep-orange-700\">deep orange</div>\n                                <div class=\"color-pattern ground-color-deep-orange-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"brown\">\n                                <div class=\"color-name text-color-brown-700\">brown</div>\n                                <div class=\"color-pattern ground-color-brown-700\"></div>\n                            </li>\n                            <li class=\"color-value\" data-value=\"blue-grey\">\n                                <div class=\"color-name text-color-blue-grey-700\">blue grey</div>\n                                <div class=\"color-pattern ground-color-blue-grey-700\"></div>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap xmpp-resources\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">XMPP Resources</span>\n                </div>\n                <div class=\"resources-wrap\">\n                    <div class=\"resource-wrap main-resource\">\n                        <svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"ic-jabber\"></svg>\n                        <div class=\"info status-info\">\n                            <div class=\"label\">Status:</div>\n                            <div class=\"value status-message one-line\"></div>\n                            <div class=\"status\"></div>\n                        </div>\n                        <div class=\"info client-info\">\n                            <div class=\"label\">Client:</div>\n                            <div class=\"value client one-line\"></div>\n                        </div>\n                        <div class=\"info resource-info\">\n                            <div class=\"label\">Resource:</div>\n                            <div class=\"value resource one-line\"></div>\n                            <div class=\"device-indicator text-color-700\">(this device)</div>\n                        </div>\n                        <div class=\"info priority-info\">\n                            <div class=\"label\">Priority:</div>\n                            <div class=\"value priority\"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap vcard\">\n            </div>\n\n            <div class=\"settings-block-wrap server-info\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Server capabilities</span>\n                </div>\n                <div class=\"capabilities-wrap\">\n                    <div class=\"capabilities\">\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap blocklist-info\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Blocked contacts</span>\n                </div>\n                <div class=\"blocklist-wrap\">\n                    <div class=\"blocked-items\">\n                        <div class=\"placeholder\">No blocked contacts yet</div>\n                        <div class=\"blocked-domains-wrap hidden\">\n                            <div class=\"blocked-item domains-item\">\n                                <i class=\"toggle-items arrow mdi mdi-20px mdi-chevron-right\"></i>\n                                <div class=\"blocked-item-header one-line\">Blocked domains</div>\n                                <div class=\"blocked-item-description one-line\"/>\n                            </div>\n                            <div class=\"blocked-domains blocked-list hidden\"/>\n                        </div>\n                        <div class=\"blocked-invitations-wrap hidden\">\n                            <div class=\"blocked-item invitations-item\">\n                                <i class=\"toggle-items arrow mdi mdi-20px mdi-chevron-right\"></i>\n                                <div class=\"blocked-item-header one-line\">Groupchat invitations</div>\n                                <div class=\"blocked-item-description\">Blocking is used to mark groupchat invitations as 'read'</div>\n                            </div>\n                            <div class=\"blocked-invitations blocked-list hidden\"/>\n                        </div>\n                        <div class=\"blocked-contacts-wrap hidden\">\n                            <div class=\"blocked-item contacts-item\">\n                                <i class=\"toggle-items arrow mdi mdi-20px mdi-chevron-right\"></i>\n                                <div class=\"blocked-item-header one-line\">Blocked contacts</div>\n                                <div class=\"blocked-item-description one-line\"/>\n                            </div>\n                            <div class=\"blocked-contacts blocked-list hidden\"/>\n                        </div>\n                        <button class=\"btn-block btn-flat btn-main btn-dark ground-color-100 hover-ground-color-300\">Block</button>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"settings-block-wrap groups-info\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Groups</span>\n                </div>\n                <div class=\"groups-wrap\">\n                    <div class=\"groups\">\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/accounts/existing_groupchat_item.html",[],function(){return"<div class=\"existing-chat-wrap\" data-name=\"{{name}}\" data-jid=\"{{jid}}\">\n    <div class=\"circle-avatar\">\n        <img>\n    </div>\n    <div class=\"existing-chat-item\">\n        <div class=\"name one-line\">{{name}}</div>\n        <div class=\"jid one-line\">{{jid}}</div>\n    </div>\n    <button class=\"btn-join-existing-chat btn-flat btn-dark btn-main\">join</button>\n</div>"}),define("text!templates/accounts/resource.html",[],function(){return"    <svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"ic-jabber\"></svg>\n    <div class=\"info status-info\">\n        <div class=\"label\">Status:</div>\n        <div class=\"value status-message one-line\"></div>\n        <div class=\"status\"></div>\n    </div>\n    <div class=\"info client-info\">\n        <div class=\"label\">Client:</div>\n        <div class=\"value client one-line\"></div>\n    </div>\n    <div class=\"info resource-info\">\n        <div class=\"label\">Resource:</div>\n        <div class=\"value resource one-line\"></div>\n    </div>\n    <div class=\"info priority-info\">\n        <div class=\"label\">Priority:</div>\n        <div class=\"value priority\"></div>\n    </div>\n"}),define("text!templates/accounts/global_settings_item.html",[],function(){return"<div class=\"move-account-to-this droppable\"></div>\n<div class=\"account-info-wrap\">\n    <i class=\"drag-item drag-handle mdi mdi-28px mdi-drag-vertical\"></i>\n    <div class=\"circle-avatar noselect\">\n        <img>\n    </div>\n    <div class=\"text-info-wrap\">\n        <div class=\"jid-wrap\">\n            <div class=\"jid text-color-700 one-line\"></div>\n        </div>\n        <div class=\"conn-status one-line\"></div>\n    </div>\n</div>\n<div class=\"sync-marker-wrap hidden\">\n    <i class=\"sync-marker mdi mdi-20px mdi-cloud-check\"></i>\n</div>\n<div class=\"field clickable-field enabled-state switch normal\">\n    <label class=\"field-value\">\n        <input type=\"checkbox\">\n        <span class=\"lever\"></span>\n    </label>\n</div>\n"}),define("text!templates/accounts/change_status.html",[],function(){return"<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Set status</span>\n    </div>\n    <ul class=\"status-values noselect\">\n        <li data-value=\"chat\">\n            <span class=\"status-value one-line\">Ready for chat</span>\n            <span class=\"status-bulb\" data-status=\"chat\"></span>\n        </li>\n        <li data-value=\"online\">\n            <span class=\"status-value one-line\">Online</span>\n            <span class=\"status-bulb\" data-status=\"online\"></span>\n        </li>\n        <li data-value=\"away\">\n            <span class=\"status-value one-line\">Away</span>\n            <span class=\"status-bulb\" data-status=\"away\"></span>\n        </li>\n        <li data-value=\"xa\">\n            <span class=\"status-value one-line\">Away for long time</span>\n            <span class=\"status-bulb\" data-status=\"xa\"></span>\n        </li>\n        <li data-value=\"dnd\">\n            <span class=\"status-value one-line\">Busy</span>\n            <span class=\"status-bulb\" data-status=\"dnd\"></span>\n        </li>\n        <li data-value=\"offline\">\n            <span class=\"status-value one-line\">Offline</span>\n            <span class=\"status-bulb\" data-status=\"offline\"></span>\n        </li>\n    </ul>\n    <div class=\"modal-content\">\n        <div class=\"row\">\n            <div class=\"input-field status-message-wrap\">\n                <span class=\"static-label\">Custom status message</span>\n                <input type=\"text\" class=\"status-message\">\n                <i class=\"clear-input mdi mdi-20px mdi-close\"></i>\n            </div>\n            <div class=\"input-field checkbox-field no-padding\">\n                <input type=\"checkbox\" class=\"filled-in apply-to-all\" id=\"{{view.cid}}_apply_to_all\"/>\n                <label for=\"{{view.cid}}_apply_to_all\">Apply to all accounts</label>\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/accounts/token_item.html",[],function(){return"<div class=\"token-wrap\" data-token-uid=\"{{token_uid}}\">\n    <div class=\"client one-line\">{{client}}</div>\n    <div class=\"device one-line\">{{device}}</div>\n    <div class=\"ip-address\">{{ip}}</div>\n    <div class=\"last-auth\">{{last_auth}}</div>\n    <i class=\"btn-revoke-token mdi mdi-24px mdi-close\"></i>\n</div>"}),define("text!templates/accounts/current_token_item.html",[],function(){return"<div class=\"token-wrap\" data-token-uid=\"{{token_uid}}\">\n    <div class=\"client one-line\">{{client}}</div>\n    <div class=\"device one-line\">{{device}}</div>\n    <div class=\"ip-address\">{{ip}}</div>\n    <div class=\"last-auth text-color-700\">Online</div>\n    <div class=\"token-indicator\">this device</div>\n</div>"}),define("text!templates/vcard/vcard.html",[],function(){return"<div class=\"block-header\">\n    <span class=\"block-name\"></span>\n    <div class=\"btn-vcard-refresh\">\n        <div class=\"button\">\n            <i class=\"mdi mdi-20px mdi-refresh\"></i>\n        </div>\n        <div class=\"preloader-wrapper preloader-20px active\">\n            <div class=\"spinner-layer\">\n                <div class=\"circle-clipper left\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"gap-patch\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"circle-clipper right\">\n                    <div class=\"circle\"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class=\"vcard-wrap\">\n    <div class=\"info-wrap jid-info-wrap hidden\">\n        <div class=\"details-icon-wrap\" title=\"Click to copy\"><svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"xmpp\"></svg></div>\n        <div class=\"info jabber-id\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Jabber ID</div>\n        </div>\n    </div>\n    <div class=\"info-wrap personal-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-account-card-details\"></i>\n        <div class=\"info first-name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">First name</div>\n        </div>\n        <div class=\"info middle-name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Middle name</div>\n        </div>\n        <div class=\"info last-name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Surname</div>\n        </div>\n        <div class=\"info fullname\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Full name</div>\n        </div>\n    </div>\n    <div class=\"info-wrap nickname-info-wrap hidden\">\n        <i class=\"details-icon mdi mdi-24px mdi-account-box-outline\"></i>\n        <div class=\"info nickname\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Nickname</div>\n        </div>\n    </div>\n    <div class=\"info-wrap birthday-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-cake-variant\"></i>\n        <div class=\"info birthday\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Birthday</div>\n        </div>\n    </div>\n    <div class=\"info-wrap job-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-briefcase\"></i>\n        <div class=\"info org-name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Company</div>\n        </div>\n        <div class=\"info job-title\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Job title</div>\n        </div>\n        <div class=\"info org-unit\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Unit</div>\n        </div>\n        <div class=\"info role\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Role</div>\n        </div>\n    </div>\n    <div class=\"info-wrap site-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-web\"></i>\n        <div class=\"info url\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Website</div>\n        </div>\n    </div>\n    <div class=\"info-wrap description-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-file-document-box\"></i>\n        <div class=\"info description\">\n            <div class=\"value\"></div>\n            <div class=\"label\">Description</div>\n        </div>\n    </div>\n    <div class=\"info-wrap phone-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-phone\"></i>\n        <div class=\"info phone-work\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Work</div>\n        </div>\n        <div class=\"info phone-home\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Home</div>\n        </div>\n        <div class=\"info phone-mobile\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Mobile</div>\n        </div>\n        <div class=\"info phone-default\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Phone</div>\n        </div>\n    </div>\n    <div class=\"info-wrap email-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-email\"></i>\n        <div class=\"info email-work\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Work</div>\n        </div>\n        <div class=\"info email-home\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Personal</div>\n        </div>\n        <div class=\"info email-default\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Email</div>\n        </div>\n    </div>\n    <div class=\"info-wrap address-info-wrap hidden\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-map-marker\"></i>\n        <div class=\"info address-home\">\n            <div class=\"pobox value one-line\"></div>\n            <div class=\"extadd value one-line\"></div>\n            <div class=\"street value one-line\"></div>\n            <div class=\"locality value one-line\"></div>\n            <div class=\"region value one-line\"></div>\n            <div class=\"pcode value one-line\"></div>\n            <div class=\"country value one-line\"></div>\n            <div class=\"label\">Home</div>\n        </div>\n        <div class=\"info address-work\">\n            <div class=\"pobox value one-line\"></div>\n            <div class=\"extadd value one-line\"></div>\n            <div class=\"street value one-line\"></div>\n            <div class=\"locality value one-line\"></div>\n            <div class=\"region value one-line\"></div>\n            <div class=\"pcode value one-line\"></div>\n            <div class=\"country value one-line\"></div>\n            <div class=\"label\">Work</div>\n        </div>\n        <div class=\"info address-default\">\n            <div class=\"extadd value one-line\"></div>\n            <div class=\"street value one-line\"></div>\n            <div class=\"locality value one-line\"></div>\n            <div class=\"region value one-line\"></div>\n            <div class=\"pcode value one-line\"></div>\n            <div class=\"country value one-line\"></div>\n            <div class=\"label\">Address</div>\n        </div>\n    </div>\n    <button class=\"btn-vcard-edit btn-flat btn-main btn-dark ground-color-100 hover-ground-color-300 hidden\">Edit</button>\n</div>\n"}),define("text!templates/vcard/vcard_edit.html",[],function(){return"    <div class=\"right-column noselect\">\n        <div class=\"settings-panel-head\">\n            <span>Edit vCard</span>\n        </div>\n\n        <div class=\"panel-content-wrap\">\n            <div class=\"panel-content details-panel\">\n\n                <div class=\"settings-block-wrap vcard\">\n                    <div class=\"vcard-edit-wrap\">\n                        <div class=\"info-wrap personal-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-account-card-details\"></i>\n                            <div class=\"input-field first-name\">\n                                <input id=\"{{view.cid}}-first-name\" placeholder=\"First name\" type=\"text\" name=\"first_name\">\n                            </div>\n                            <div class=\"input-field middle-name\">\n                                <input id=\"{{view.cid}}-middle-name\" placeholder=\"Middle name\" type=\"text\" name=\"middle_name\">\n                            </div>\n                            <div class=\"input-field last-name\">\n                                <input id=\"{{view.cid}}-last-name\" placeholder=\"Surname\" type=\"text\" name=\"last_name\">\n                            </div>\n                            <div class=\"input-field fullname\">\n                                <input id=\"{{view.cid}}-fullname\" placeholder=\"Full name\" type=\"text\" name=\"fullname\">\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap nickname-info-wrap\">\n                            <div class=\"input-label\">Nickname</div>\n                            <i class=\"details-icon mdi mdi-24px mdi-account-box-outline\"></i>\n                            <div class=\"input-field nickname\">\n                                <input id=\"{{view.cid}}-nickname\" placeholder=\"Nickname\" type=\"text\" name=\"nickname\">\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap birthday-info-wrap\">\n                            <div class=\"input-label\">Birthday</div>\n                            <i class=\"details-icon mdi mdi-24px mdi-cake-variant\"></i>\n                            <div class=\"input-field birthday\">\n                                <input id=\"{{view.cid}}-birthday\" placeholder=\"YYYYY-MM-DD\" type=\"text\" class=\"datepicker\">\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap job-info-wrap\">\n                            <div class=\"input-label\">Job</div>\n                            <i class=\"details-icon mdi mdi-24px mdi-briefcase\"></i>\n                            <div class=\"input-field org-name\">\n                                <input id=\"{{view.cid}}-org-name\" placeholder=\"Company\" type=\"text\" name=\"org_name\">\n                            </div>\n                            <div class=\"input-field job-title\">\n                                <input id=\"{{view.cid}}-job-title\" placeholder=\"Job title\" type=\"text\" name=\"job_title\">\n                            </div>\n                            <div class=\"input-field org-unit\">\n                                <input id=\"{{view.cid}}-org-unit\" placeholder=\"Unit\" type=\"text\" name=\"org_unit\">\n                            </div>\n                            <div class=\"input-field role\">\n                                <input id=\"{{view.cid}}-role\" placeholder=\"Role\" type=\"text\" name=\"role\">\n                            </div>\n                        </div>\n                        <div class=\"info-wrap site-info-wrap\">\n                            <div class=\"input-label\">Website</div>\n                            <i class=\"details-icon mdi mdi-24px mdi-web\"></i>\n                            <div class=\"input-field url\">\n                                <input id=\"{{view.cid}}-url\" placeholder=\"www.example.com\" type=\"text\" name=\"url\">\n                            </div>\n                        </div>\n                        <div class=\"info-wrap description-info-wrap\">\n                            <div class=\"input-label\">Description</div>\n                            <i class=\"details-icon mdi mdi-24px mdi-file-document-box\"></i>\n                            <div class=\"input-field description\">\n                                <textarea id=\"{{view.cid}}-description\" placeholder=\"Some text field, 3-5 rows\" type=\"text\" cols=\"30\" rows=\"10\" class=\"text-field materialize-textarea\" name=\"description\"></textarea>\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap phone-info-wrap\">\n                            <div class=\"input-label\">Phone</div>\n                            <i class=\"details-icon mdi mdi-24px mdi-phone\"></i>\n                            <div class=\"input-field phone-work\">\n                                <input id=\"{{view.cid}}-phone-work\" placeholder=\"Work\" type=\"text\" name=\"phone_work\">\n                            </div>\n                            <div class=\"input-field phone-home\">\n                                <input id=\"{{view.cid}}-phone-home\" placeholder=\"Home\" type=\"text\" name=\"phone_home\">\n                            </div>\n                            <div class=\"input-field phone-mobile\">\n                                <input id=\"{{view.cid}}-phone-mobile\" placeholder=\"Mobile\" type=\"text\" name=\"phone_mobile\">\n                            </div>\n                        </div>\n                        <div class=\"info-wrap email-info-wrap\">\n                            <div class=\"input-label\">Email</div>\n                            <i class=\"details-icon mdi mdi-24px mdi-email\"></i>\n                            <div class=\"input-field email-work\">\n                                <input id=\"{{view.cid}}-email-work\" placeholder=\"Work\" type=\"text\" name=\"email_work\">\n                            </div>\n                            <div class=\"input-field email-home\">\n                                <input id=\"{{view.cid}}-email-home\" placeholder=\"Personal\" type=\"text\" name=\"email_home\">\n                            </div>\n                        </div>\n\n                        <div class=\"info-wrap address-info-wrap\">\n                            <i class=\"details-icon mdi mdi-24px mdi-map-marker\"></i>\n                            <div class=\"input-wrap address-wrap address-home-wrap\">\n                                <div class=\"input-label\">Home address</div>\n                                <div class=\"input-field pobox\">\n                                    <input id=\"{{view.cid}}-po-home-box\" placeholder=\"PO Box\" type=\"text\" name=\"po_home_box\">\n                                </div>\n                                <div class=\"input-field extadd\">\n                                    <input id=\"{{view.cid}}-addr-home-extadd\" placeholder=\"Extended address\" type=\"text\" name=\"addr_home_extadd\">\n                                </div>\n                                <div class=\"input-field street\">\n                                    <input id=\"{{view.cid}}-addr-home-street\" placeholder=\"Street\" type=\"text\" name=\"addr_home_street\">\n                                </div>\n                                <div class=\"input-field locality\">\n                                    <input id=\"{{view.cid}}-addr-home-locality\" placeholder=\"Locality\" type=\"text\" name=\"addr_home_locality\">\n                                </div>\n                                <div class=\"input-field region\">\n                                    <input id=\"{{view.cid}}-addr-home-region\" placeholder=\"Region\" type=\"text\" name=\"addr_home_region\">\n                                </div>\n                                <div class=\"input-field pcode\">\n                                    <input id=\"{{view.cid}}-addr-home-pcode\" placeholder=\"Postal code\" type=\"text\" name=\"addr_home_pcode\">\n                                </div>\n                                <div class=\"input-field country\">\n                                    <input id=\"{{view.cid}}-addr-home-country\" placeholder=\"Country name\" type=\"text\" name=\"addr_home_country\">\n                                </div>\n                            </div>\n                            <div class=\"input-wrap address-wrap address-work-wrap\">\n                                <div class=\"input-label\">Work address</div>\n                                <div class=\"input-field pobox\">\n                                    <input id=\"{{view.cid}}-po-work-box\" placeholder=\"PO Box\" type=\"text\" name=\"po_work_box\">\n                                </div>\n                                <div class=\"input-field extadd\">\n                                    <input id=\"{{view.cid}}-addr-work-extadd\" placeholder=\"Extended address\" type=\"text\" name=\"addr_work_extadd\">\n                                </div>\n                                <div class=\"input-field street\">\n                                    <input id=\"{{view.cid}}-addr-work-street\" placeholder=\"Street\" type=\"text\" name=\"addr_work_street\">\n                                </div>\n                                <div class=\"input-field locality\">\n                                    <input id=\"{{view.cid}}-addr-work-locality\" placeholder=\"Locality\" type=\"text\" name=\"addr_work_locality\">\n                                </div>\n                                <div class=\"input-field region\">\n                                    <input id=\"{{view.cid}}-addr-work-region\" placeholder=\"Region\" type=\"text\" name=\"addr_work_region\">\n                                </div>\n                                <div class=\"input-field pcode\">\n                                    <input id=\"{{view.cid}}-addr-work-pcode\" placeholder=\"Postal code\" type=\"text\" name=\"addr_work_pcode\">\n                                </div>\n                                <div class=\"input-field country\">\n                                    <input id=\"{{view.cid}}-addr-work-country\" placeholder=\"Country name\" type=\"text\" name=\"addr_work_country\">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n        <div class=\"panel-footer noselect\">\n            <div class=\"buttons-wrap\">\n                <button class=\"btn-vcard-save btn-flat btn-main\">Save</button>\n                <button class=\"btn-vcard-back btn-flat btn-main btn-dark\">Cancel</button>\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/searching/searching_wide.html",[],function(){return"<div class=\"searching-panel\">\n    <div class=\"search-form\">\n        <div class=\"account-indicator ground-color-500\"></div>\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search by domain\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n    <div class=\"searching-properties-field\">\n        <div class=\"dropdown-button\" data-visible=\"false\">\n            <i class=\"mdi mdi-24px mdi-chevron-down arrow\"></i>\n        </div>\n    </div>\n    <ul id=\"select-searching-properties\" class=\"selectable-text\">\n        <div class=\"account-property\">\n            <p class=\"property-name\">Account</p>\n            <div class=\"account-field\">\n                <div class=\"multiple-acc\">\n                    <div class=\"account-dropdown-wrap\">\n                        <div class=\"dropdown-button\" data-activates=\"select-account-for-searching\">\n                            <div class=\"account-item-wrap\">\n                            </div>\n                            <div class=\"caret\">\n                                <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                            </div>\n                        </div>\n                        <div id=\"select-account-for-searching\" class=\"dropdown-content\">\n                        </div>\n                    </div>\n                </div>\n                <div class=\"single-acc\">\n                    <div class=\"dropdown-button\">\n                        <div class=\"account-item-wrap\">\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"title-property\">\n            <p class=\"property-name\">Title</p>\n            <div class=\"input-field\">\n                <input id=\"searching_property_title\" type=\"text\" name=\"title\">\n            </div>\n        </div>\n        <div class=\"sorting-property\">\n            <p class=\"property-name\">Sort by</p>\n            <div class=\"input-field\">\n                <input id=\"searching_property_sort_by\" type=\"text\" name=\"title\">\n            </div>\n        </div>\n        <button class=\"btn-search btn btn-main-filled ground-color-700\">Search</button>\n    </ul>\n</div>\n<div class=\"searching-result-wrap\">\n    <div class=\"chats-list-wrap\">\n        <div class=\"result-string\"></div>\n        <div class=\"preloader-wrapper preloader-17px active\">\n            <div class=\"spinner-layer\">\n                <div class=\"circle-clipper left\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"gap-patch\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"circle-clipper right\">\n                    <div class=\"circle\"></div>\n                </div>\n            </div></div>\n        <div class=\"chats-list\"></div></div>\n    <div class=\"searching-more\"></div>\n</div>"}),define("text!templates/searching/searching_account_item.html",[],function(){return"<div class=\"account-item-wrap\" data-jid=\"{{jid}}\">\n    <div class=\"name one-line\">{{jid}}</div>\n</div>"}),define("text!templates/searching/existing_groupchat_item.html",[],function(){return"<div class=\"existing-chat-wrap\" data-name=\"{{name}}\" data-jid=\"{{jid}}\">\n    <div class=\"account-indicator ground-color-{{color}}-500\"></div>\n    <div class=\"circle-avatar\">\n        <img>\n    </div>\n    <div class=\"existing-chat-item\">\n        <div class=\"name one-line\">{{name}}</div>\n        <div class=\"jid one-line\">{{jid}}</div>\n    </div>\n</div>"}),define("text!templates/searching/existing_groupchat_details_view.html",[],function(){return"<div class=\"block-header\">\n    <span class=\"block-name\">Chat properties</span>\n</div>\n<div class=\"chat-properties-wrap selectable-text\">\n    <div class=\"info-wrap jid-info-wrap\">\n        <svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"xmpp\"></svg>\n        <div class=\"info jabber-id\">\n            <div class=\"value one-line\">{{jid}}</div>\n            <div class=\"label\">Jabber ID</div>\n        </div>\n    </div>\n    <div class=\"info-wrap name-info-wrap\">\n        <i class=\"details-icon mdi mdi-24px mdi-account-box-outline\"></i>\n        <div class=\"info name\">\n            <div class=\"value one-line\">{{name}}</div>\n            <div class=\"label\">Name</div>\n        </div>\n    </div>\n    <div class=\"info-wrap description-info-wrap\">\n        <i class=\"details-icon mdi mdi-24px mdi-file-document-box\"></i>\n        <div class=\"info description\">\n            <div class=\"value one-line\">{{description}}</div>\n            <div class=\"label\">Description</div>\n        </div>\n    </div>\n    <div class=\"info-wrap anonymous-info-wrap\">\n        <i class=\"details-icon mdi mdi-24px mdi-comment-question-outline\"></i>\n        <div class=\"info anonymous\">\n            <div class=\"value one-line\">{{anonymous}}</div>\n            <div class=\"label\">Anonymous</div>\n        </div>\n    </div>\n    <div class=\"info-wrap model-info-wrap\">\n        <i class=\"details-icon mdi mdi-24px mdi-lock-open-outline\"></i>\n        <div class=\"info model\">\n            <div class=\"value one-line\">{{membership}}</div>\n            <div class=\"label\">Membership</div>\n        </div>\n    </div>\n</div>\n<button class=\"btn-join-chat btn-flat btn-main btn-dark ground-color-100 hover-ground-color-300\">Join</button>\n"}),define("text!templates/contacts/roster_right.html",[],function(){return"<div class=\"contacts-panel noselect\">\n    <div class=\"collapsed-wrap\">\n        <i class=\"collapsed-contacts-icon mdi mdi-24px mdi-account-multiple\"></i>\n        <div class=\"all-contacts-counter\"></div>\n    </div>\n    <div class=\"expanded-wrap\">\n        <div class=\"roster-head panel-head\">\n            <div class=\"contacts-header\">Contacts</div>\n            <div class=\"roster-button btn-pin\"></div>\n        </div>\n\n        <div class=\"contact-list-wrap\">\n            <div class=\"contact-list\">\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/contacts/roster_left.html",[],function(){return"<div class=\"contacts-panel noselect\">\n    <div class=\"contacts-search-form search-form panel-head\">\n        <div class=\"account-indicator\"></div>\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n\n    <div class=\"contact-list-wrap left-panel-list-wrap\">\n        <div class=\"contact-list item-list\">\n        </div>\n        <div class=\"searched-lists-wrap\">\n            <div class=\"chats-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"chats-title\">Chats</div>\n                <div class=\"chats-list roster-left-container\"></div>\n            </div>\n            <div class=\"contacts-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"contacts-title\">Contacts</div>\n                <div class=\"contacts-list roster-left-container\"></div>\n            </div>\n            <div class=\"messages-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"messages-title\">Messages</div>\n                <div class=\"messages-list roster-left-container\"></div>\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/contacts/account_roster_right.html",[],function(){return"<div class=\"roster-account-info-wrap\">\n    <div class=\"roster-account-info\">\n        <div class=\"circle-avatar border-color ground-color-700 noselect\">\n            <img>\n        </div>\n        <div class=\"text-info-wrap\">\n            <p class=\"name text-color-700 one-line\"></p>\n            <p class=\"status-message text-color-700 one-line\"></p>\n            <div class=\"roster-info\">\n                <i class=\"mdi mdi-account-multiple-outline\"></i>\n                <span class=\"counter\"></span>\n            </div>\n        </div>\n    </div>\n    <div class=\"status-button\">\n        <div class=\"status\"></div>\n    </div>\n    <div class=\"roster-account-shrank-footer1\"></div>\n    <div class=\"roster-account-shrank-footer2\"></div>\n</div>\n"}),define("text!templates/contacts/account_roster_left.html",[],function(){return"<div class=\"roster-account-info-wrap\">\n    <div class=\"roster-account-info ground-color-100\">\n        <div class=\"account-indicator ground-color-700\"></div>\n        <div class=\"circle-avatar noselect\">\n            <img>\n        </div>\n        <div class=\"text-info-wrap\">\n            <p class=\"name text-color-900 one-line\"></p>\n            <p class=\"jid one-line\"></p>\n        </div>\n        <div class=\"button-divider\"></div>\n    </div>\n    <div class=\"status-button\">\n        <div class=\"status\"></div>\n    </div>\n    <div class=\"roster-account-shrank-footer1 ground-color-50\">\n        <div class=\"account-indicator ground-color-300\"></div>\n    </div>\n    <div class=\"roster-account-shrank-footer2 ground-color-50\">\n        <div class=\"account-indicator ground-color-300\"></div>\n    </div>\n</div>\n"}),define("text!templates/contacts/group_right.html",[],function(){return"<div class=\"group-head\">\n    <i class=\"arrow mdi mdi-20px\"></i>\n    <div class=\"group-title\">\n        <span class=\"group-name one-line\"></span>\n        <span class=\"member-counter one-line\"></span>\n    </div>\n    <i class=\"group-icon mdi mdi-20px hidden\"></i>\n</div>\n"}),define("text!templates/contacts/group_left.html",[],function(){return"<div class=\"account-indicator ground-color-700\"></div>\n<div class=\"group-head\">\n    <i class=\"arrow mdi mdi-20px\"></i>\n    <div class=\"group-title\">\n        <span class=\"group-name one-line\"></span>\n        <span class=\"member-counter one-line\"></span>\n    </div>\n    <i class=\"group-icon mdi mdi-20px hidden\"></i>\n</div>\n"}),define("text!templates/contacts/add_contact.html",[],function(){return"<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Add new contact</span>\n    </div>\n    <div class=\"modal-content\">\n        <div class=\"row account-field\">\n            <div class=\"field-header\">Account</div>\n            <div class=\"multiple-acc\">\n                <div class=\"account-dropdown-wrap\">\n                    <div class=\"dropdown-button\" data-activates=\"select-account-for-add-contact\">\n                        <div class=\"account-item-wrap\">\n                        </div>\n                        <div class=\"caret\">\n                            <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                        </div>\n                    </div>\n                    <div id=\"select-account-for-add-contact\" class=\"dropdown-content noselect\">\n                    </div>\n                </div>\n            </div>\n            <div class=\"single-acc\">\n                <div class=\"dropdown-button\">\n                    <div class=\"account-item-wrap\">\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row name-field\">\n            <div class=\"input-field\">\n                <input id=\"new_contact_username\" type=\"text\" name=\"username\">\n                <label for=\"new_contact_username\">Contact JID</label>\n                <span class=\"errors fixed\"></span>\n            </div>\n            <div class=\"input-field\">\n                <input id=\"new_contact_name\" type=\"text\" name=\"contact_name\" required>\n                <label for=\"new_contact_name\">Contact name</label>\n            </div>\n            <span class=\"add-contact-feedback red-text\"></span>\n        </div>\n        <div class=\"row groups-field\">\n            <div class=\"field-header\">Groups</div>\n            <div class=\"groups checkbox-list\">\n            </div>\n        </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-add\">Add</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/contacts/contact_right_item.html",[],function(){return"<div class=\"circle-avatar noselect\"></div>\n<div class=\"text-info-wrap\">\n    <p class=\"name one-line\"></p>\n    <p class=\"jid one-line hidden\"></p>\n    <p class=\"status-message one-line\"></p>\n</div>\n<div class=\"status hide-offline\"></div>\n<div class=\"chat-icon hidden\"><svg class=\"mdi mdi-18px\" viewBox=\"0 0 18 18\"/></div>\n"}),define("text!templates/contacts/contact_left_item.html",[],function(){return"<div class=\"circle-avatar noselect\"></div>\n<div class=\"text-info-wrap\">\n    <div class=\"name-wrap\">\n        <p class=\"name one-line\"></p>\n        <i class=\"mdi muted-icon mdi-14px mdi-bell-off\"/>\n    </div>\n    <p class=\"jid one-line\"></p>\n</div>\n<div class=\"status hide-offline\"></div>\n<div class=\"chat-icon hidden\"><svg class=\"mdi mdi-18px\" viewBox=\"0 0 18 18\"/></div>"}),define("text!templates/contacts/contact_blocked_item.html",[],function(){return"<div class=\"circle-avatar noselect\">\n    <img>\n</div>\n<div class=\"text-info-wrap\">\n    <p class=\"jid one-line\"></p>\n    <p class=\"btn-unblock text-color-700 hover-text-color-900 one-line\">Unblock</p>\n</div>\n\n"}),define("text!templates/contacts/contact_details.html",[],function(){return"<div class=\"panel-content-wrap noselect\">\n    <div class=\"main-info\">\n        <div class=\"avatar-wrap\">\n            <div class=\"circle-avatar\"/>\n            <div class=\"status hide-offline\"></div>\n        </div>\n        <div class=\"text-info\">\n            <div class=\"name-wrap\"></div>\n            <div class=\"status-message one-line\"></div>\n        </div>\n        <div class=\"btn-escape\">\n            <i class=\"mdi mdi-24px mdi-close\"></i>\n            <span class=\"btn-text\">Esc</span>\n        </div>\n        <div class=\"btn-more  dropdown-button\" data-activates=\"{{view.cid}}-buttons-wrap\">\n            <i class=\"mdi mdi-24px mdi-dots-vertical\"></i>\n        </div>\n        <ul class=\"buttons-menu-wrap dropdown-content noselect\" id=\"{{view.cid}}-buttons-wrap\">\n            <li class=\"btn-qr-code\"><span class=\"one-line\">Show QR-code</span></li>\n            <li class=\"btn-auth-request\"><span class=\"one-line\">Request authorization</span></li>\n            <li class=\"btn-add\"><span class=\"one-line\">Add contact</span></li>\n            <li class=\"btn-delete\"><span class=\"one-line\">Delete contact</span></li>\n        </ul>\n        <div class=\"buttons-wrap\">\n            <div class=\"button-wrap btn-chat-wrap\">\n                <i class=\"mdi mdi-24px mdi-message-text btn-chat\"></i>\n                <div class=\"btn-name\">Chat</div>\n            </div>\n            <div class=\"button-wrap btn-voice-call-wrap\">\n                <i class=\"mdi mdi-24px mdi-phone btn-voice-call\"></i>\n                <div class=\"btn-name\">Voice Call</div>\n            </div>\n            <div class=\"button-wrap btn-mute-wrap\">\n                <i class=\"mdi mdi-24px mdi-bell btn-mute\"></i>\n                <div class=\"btn-name\">Notifications</div>\n            </div>\n            <div class=\"button-wrap btn-block-wrap\">\n                <i class=\"mdi mdi-24px mdi-block-helper btn-block\"></i>\n                <div class=\"btn-name\">Block</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"panel-content private-chat\">\n        <div class=\"left-column\">\n            <div class=\"block-wrap subscription-block-wrap\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Subscription information</span>\n                </div>\n                <div class=\"subscription-info-wrap\">\n                    <div class=\"incoming-subscription-wrap\">\n                        <div class=\"input-field checkbox-field incoming-subscription-wrap\">\n                            <input type=\"checkbox\" class=\"filled-in\" id=\"incoming-subscription\"/>\n                            <label for=\"incoming-subscription\"></label>\n                        </div>\n                    </div>\n                    <div class=\"outcoming-subscription-wrap\">\n                        <div class=\"input-field checkbox-field incoming-subscription-wrap\">\n                            <input type=\"checkbox\" class=\"filled-in\" id=\"outcoming-subscription\"/>\n                            <label for=\"outcoming-subscription\"></label>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"block-wrap vcard\">\n            </div>\n        </div>\n        <div class=\"right-column\">\n            <div class=\"block-wrap resources-block-wrap hidden\">\n                <div class=\"block-header\">\n                    <span class=\"block-name\">Connected devices</span>\n                </div>\n                <div class=\"resources-wrap\">\n                </div>\n            </div>\n            <div class=\"block-wrap groups-block-wrap\"></div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/roster_settings.html",[],function(){return"    <div class=\"setting-name\">Show offline contacts</div>\n    <div class=\"setting offline-contacts radio-button field-wrap\">\n        <div class=\"field radio-field clickable-field\">\n            <form action=\"#\">\n                <p>\n                    <input class=\"with-gap\" name=\"offline-contacts\" value=\"yes\" type=\"radio\" id=\"{{view.cid}}-show\" />\n                    <label for=\"{{view.cid}}-show\">Always show</label>\n                </p>\n                <p>\n                    <input class=\"with-gap\" name=\"offline-contacts\" value=\"no\" type=\"radio\" id=\"{{view.cid}}-hide\" />\n                    <label for=\"{{view.cid}}-hide\">Always hide</label>\n                </p>\n            </form>\n        </div>\n    </div>\n    <div class=\"setting-name\">Sorting contacts</div>\n    <div class=\"setting sorting-contacts radio-button field-wrap\">\n        <div class=\"field radio-field clickable-field\">\n            <form action=\"#\">\n                <p>\n                    <input class=\"with-gap\" name=\"sorting-contacts\" value=\"online-first\" type=\"radio\" id=\"{{view.cid}}-online-first\" />\n                    <label for=\"{{view.cid}}-online-first\">Online first</label>\n                </p>\n                <p>\n                    <input class=\"with-gap\" name=\"sorting-contacts\" value=\"by-alphabet\" type=\"radio\" id=\"{{view.cid}}-by-alphabet\" />\n                    <label for=\"{{view.cid}}-by-alphabet\">Alphabet order (A -> Z)</label>\n                </p>\n            </form>\n        </div>\n    </div>\n"}),define("text!templates/contacts/group_settings.html",[],function(){return"<div class=\"modal-content-wrap settings-panel\">\n    <div class=\"modal-header\">\n        <span>Group settings</span>\n    </div>\n\n    <div class=\"modal-content\">\n            <div class=\"field-wrap group-name\">\n                <div class=\"input-field\">\n                    <input id=\"{{view.cid}}-group-name\" type=\"text\" name=\"group_name\">\n                    <label for=\"{{view.cid}}-group-name\">Name</label>\n                    <span class=\"errors fixed\"></span>\n                </div>\n            </div>\n\n            <div class=\"setting-name\">Offline contacts</div>\n            <div class=\"setting-wrap\">\n                <div class=\"setting offline radio-button field-wrap\">\n                    <div class=\"field radio-field clickable-field\">\n                        <form action=\"#\">\n                            <p>\n                                <input class=\"with-gap\" name=\"offline\" value=\"yes\" type=\"radio\" id=\"{{view.cid}}-show\" />\n                                <label for=\"{{view.cid}}-show\">Always show</label>\n                            </p>\n                            <p>\n                                <input class=\"with-gap\" name=\"offline\" value=\"no\" type=\"radio\" id=\"{{view.cid}}-hide\" />\n                                <label for=\"{{view.cid}}-hide\">Always hide</label>\n                            </p>\n                            <p>\n                                <input class=\"with-gap\" name=\"offline\" value=\"default\" type=\"radio\" id=\"{{view.cid}}-show-offline-default\" />\n                                <label for=\"{{view.cid}}-show-offline-default\">Use common settings</label>\n                            </p>\n                        </form>\n                    </div>\n                </div>\n            </div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-dark btn-delete left\">Delete</button>\n        <button class=\"btn-flat btn-main btn-apply\">Apply</button>\n        <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n    </div>\n</div>\n"}),define("text!templates/contacts/groups_checkbox_list.html",[],function(){return"{[ for (var i = 0; i < groups.length; i++) { var name = groups[i].name, checked = groups[i].checked, group_id = groups[i].id; ]}\n    <div class=\"input-field checkbox-field existing-group-field\">\n        <input type=\"checkbox\" class=\"filled-in\" id=\"{{group_id}}\" data-groupname=\"{{name}}\" {[ if (checked) { ]}checked=\"checked\"{[ } ]} />\n        <label for=\"{{group_id}}\">{{name}}</label>\n    </div>\n{[ } ]}\n    <div class=\"new-group-field-wrap\">\n        <div class=\"input-field checkbox-field new-group-checkbox hidden\">\n            <input type=\"checkbox\" class=\"filled-in\" id=\"new_group_checkbox\"/>\n            <label for=\"new_group_checkbox\">.</label>\n        </div>\n        <div class=\"input-field new-group-name\">\n            <input class=\"xabber-input\" id=\"new-group-name\" type=\"text\" name=\"new_group_name\" placeholder=\"Create new circle\">\n        </div>\n    </div>\n"}),define("text!templates/contacts/add_contact_account_item.html",[],function(){return"<div class=\"account-item-wrap\" data-jid=\"{{jid}}\">\n    <div class=\"circle-avatar noselect\">\n        <img>\n    </div>\n    <div class=\"name one-line\">{{jid}}</div>\n</div>\n"}),define("text!templates/contacts/contact_placeholder.html",[],function(){return"<div class=\"text\">Please select a contact to view details</div>\n"}),define("text!templates/contacts/groups.html",[],function(){return"<div class=\"groups-header block-header\">\n    <span class=\"block-name\">Circles</span>\n</div>\n<div class=\"groups-wrap\">\n    <div class=\"groups checkbox-list\">\n    </div>\n</div>"}),define("text!templates/contacts/preloader.html",[],function(){return"<div class=\"preloader-wrapper preloader-17px active visible\">\n    <div class=\"spinner-layer\">\n        <div class=\"circle-clipper left\">\n            <div class=\"circle\"></div>\n        </div>\n        <div class=\"gap-patch\">\n            <div class=\"circle\"></div>\n        </div>\n        <div class=\"circle-clipper right\">\n            <div class=\"circle\"></div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/group_chat_properties.html",[],function(){return"<div class=\"block-header\">\n    <span class=\"block-name\"></span>\n    <span class=\"btn-edit-settings\">edit</span>\n</div>\n<div class=\"group-chat-properties vcard\">\n    <div class=\"info-wrap jid-info-wrap\">\n        <div title=\"Click to copy\" class=\"details-icon-wrap\">\n            <svg class=\"details-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"xmpp\"></svg>\n        </div>\n        <div class=\"info jabber-id\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Jabber ID</div>\n        </div>\n    </div>\n    <div class=\"info-wrap name-info-wrap\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-account-box-outline\"></i>\n        <div class=\"info name\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Name</div>\n        </div>\n    </div>\n    <div class=\"info-wrap description-info-wrap\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-file-document-box\"></i>\n        <div class=\"info description\">\n            <div class=\"value\"></div>\n            <div class=\"label\">Description</div>\n        </div>\n    </div>\n    <div class=\"info-wrap searchable-info-wrap\">\n        <svg class=\"details-icon toolbar-icon mdi mdi-24px\" viewBox=\"0 0 24 24\">\n            <path title=\"Click to copy\" d=\"M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M19.35,8.03C21.95,8.22 24,10.36 24,13C24,14.64 23.21,16.1 22,17V16.5A6.5,6.5 0 0,0 15.5,10A6.5,6.5 0 0,0 9,16.5C9,17 9.06,17.5 9.17,18H6A6,6 0 0,1 0,12C0,8.9 2.34,6.36 5.35,6.03C6.6,3.64 9.11,2 12,2C15.64,2 18.67,4.59 19.35,8.03Z\"></path>\n        </svg>\n        <div class=\"info searchable\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Indexed</div>\n        </div>\n    </div>\n    <div class=\"info-wrap model-info-wrap\">\n        <i title=\"Click to copy\" class=\"details-icon mdi mdi-24px mdi-lock\"></i>\n        <div class=\"info model\">\n            <div class=\"value one-line\"></div>\n            <div class=\"label\">Membership</div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/group_chat_details.html",[],function(){return"<div class=\"panel-content-wrap noselect\">\n    <div class=\"main-info\">\n        <div class=\"avatar-wrap\">\n            <div class=\"circle-avatar\">\n                <input title=\"Change avatar\" type=\"file\"/>\n                <svg class=\"set-groupchat-avatar\" viewBox=\"0 0 24 24\">\n                    <path d=\"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z\" />\n                </svg>\n                <div class=\"preloader-wrap\"><div class=\"preloader-wrapper preloader-32px visible\">\n                    <div class=\"spinner-layer\">\n                        <div class=\"circle-clipper left\">\n                            <div class=\"circle\"></div>\n                        </div>\n                        <div class=\"gap-patch\">\n                            <div class=\"circle\"></div>\n                        </div>\n                        <div class=\"circle-clipper right\">\n                            <div class=\"circle\"></div>\n                        </div>\n                    </div>\n                </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"text-info\">\n            <div class=\"name-wrap\"></div>\n            <div class=\"status-message one-line\"></div>\n        </div>\n        <div class=\"btn-more dropdown-button\" data-activates=\"{{view.cid}}-buttons-wrap\">\n            <i class=\"mdi mdi-24px mdi-dots-vertical\"></i>\n        </div>\n        <ul class=\"buttons-menu-wrap dropdown-content noselect\" id=\"{{view.cid}}-buttons-wrap\">\n            <li class=\"btn-qr-code\"><span class=\"one-line\">Show QR-code</span></li>\n            <li class=\"btn-edit-settings\"><span class=\"one-line\">Settings</span></li>\n            <li class=\"btn-default-restrictions\"><span class=\"one-line\">Default restrictions</span></li>\n            <li class=\"btn-delete-group\"><span class=\"one-line\">Delete group</span></li>\n        </ul>\n        <div class=\"btn-escape\">\n            <i class=\"mdi mdi-24px mdi-close\"></i>\n            <span class=\"btn-text\">Esc</span>\n        </div>\n        <div class=\"buttons-wrap\">\n            <div class=\"button-wrap btn-chat-wrap\">\n                <i class=\"mdi mdi-24px mdi-message-text btn-chat\"></i>\n                <div class=\"btn-name\">Chat</div>\n            </div>\n            <div class=\"button-wrap btn-invite-wrap\">\n                <i class=\"mdi mdi-24px mdi-account-multiple-plus btn-invite\"></i>\n                <div class=\"btn-name\">Invite</div>\n            </div>\n            <div class=\"button-wrap btn-mute-wrap\">\n                <i class=\"mdi mdi-24px mdi-bell btn-mute\"></i>\n                <div class=\"btn-name\">Notifications</div>\n            </div>\n            <div class=\"button-wrap btn-leave-wrap\">\n                <div class=\"btn-leave\"><svg viewBox=\"0 0 24 24\">\n                    <path d=\"M13.34,8.17C12.41,8.17 11.65,7.4 11.65,6.47A1.69,1.69 0 0,1 13.34,4.78C14.28,4.78 15.04,5.54 15.04,6.47C15.04,7.4 14.28,8.17 13.34,8.17M10.3,19.93L4.37,18.75L4.71,17.05L8.86,17.9L10.21,11.04L8.69,11.64V14.5H7V10.54L11.4,8.67L12.07,8.59C12.67,8.59 13.17,8.93 13.5,9.44L14.36,10.79C15.04,12 16.39,12.82 18,12.82V14.5C16.14,14.5 14.44,13.67 13.34,12.4L12.84,14.94L14.61,16.63V23H12.92V17.9L11.14,16.21L10.3,19.93M21,23H19V3H6V16.11L4,15.69V1H21V23M6,23H4V19.78L6,20.2V23Z\" />\n                </svg>\n                </div>\n                <div class=\"btn-name\">Leave</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"panel-content\">\n        <div class=\"head-block\">\n            <div class=\"left-column\">\n                <div class=\"block-wrap group-chat-properties-wrap\"></div>\n            </div>\n            <div class=\"right-column\">\n                <div class=\"block-wrap status-block-wrap\"></div>\n                <div class=\"block-wrap groups-block-wrap\"></div>\n            </div>\n        </div>\n        <div class=\"bottom-block\">\n            <ul class=\"tabs\">\n                <li data-value=\"participants\" class=\"list-variant tab\"><a class=\"text-color-700\">Participants</a></li>\n                <li data-value=\"invitations\" class=\"list-variant tab\"><a class=\"text-color-700\">Invitations</a></li>\n                <li data-value=\"blocked\" class=\"list-variant tab\"><a class=\"text-color-700\">Blocked</a></li>\n            </ul>\n            <div class=\"block-wrap participants-wrap\"></div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/contacts/group_chats/invitation.html",[],function(){return"    <div class=\"panel-content-wrap noselect\">\n        <div class=\"main-info\">\n            <div class=\"circle-avatar\"><img></div>\n            <div class=\"text-info\">\n                <div class=\"name-wrap one-line\"></div>\n                <div class=\"jid one-line\"></div>\n            </div>\n        </div>\n\n        <div class=\"panel-content\">\n            <div class=\"invite-msg\"><p class=\"invite-msg-text\"></p></div>\n            <div class=\"panel-footer noselect\">\n                <div class=\"buttons-wrap\">\n                    <button class=\"btn-accept btn-flat btn-main\">Accept</button>\n                    <button class=\"btn-join btn-flat btn-main hidden\">Join</button>\n                    <button class=\"btn-decline btn-flat btn-main\">Decline</button>\n                    <button class=\"btn-decline-all btn-flat btn-main\">Decline all</button>\n                    <button class=\"btn-block btn-flat btn-main\">Block</button>\n                    <button class=\"btn-chat btn-flat btn-main hidden\">Chat</button>\n                </div>\n            </div>\n        </div>\n    </div>\n"}),define("text!templates/contacts/group_chats/group_chat_properties_edit.html",[],function(){return"<div class=\"modal-header\"><div class=\"panel-header black-text\">{{anonymous}} Group settings</div></div>\n<div class=\"modal-content group-chat-properties-wrap selectable-text\">\n    <div class=\"property-wrap jid-info-wrap\">\n        <div class=\"property-header\">XMPP ID</div>\n        <div class=\"jabber-id\">\n            <div class=\"value one-line\">{{jid}}</div>\n        </div>\n        <p id=\"anonymous-public\" class=\"property-description hidden\">Public group chat. Participants can see real XMPP IDs of other participants</p>\n        <p id=\"anonymous-incognito\" class=\"property-description hidden\">Incognito group chat. Participants can not see real XMPP IDs of other participants</p>\n    </div>\n    {[fields.forEach(function (field) { if (field.type === 'hidden' || field.type === 'jid-multi') return;]}\n    <div class=\"property-wrap {{field.var}}-field\">\n        <div class=\"property-header\">{{field.label}}</div>\n        {[if (field.type === 'text-single') {]}\n        <div class=\"input-field input-group-chat-name\">\n            <input value=\"{{field.values[0]}}\" id=\"new_{{field.var}}_value\" type=\"text\" name=\"{{field.var}}\" placeholder=\"Input Chat Name\" class=\"text-field\">\n        </div>\n        {[} else if (field.type === 'text-multi') {]}\n        <textarea placeholder=\"Input {{field.var}}\" id=\"{{field.var}}\" cols=\"30\" rows=\"10\" class=\"text-field materialize-textarea\">{{field.values[0]}}</textarea>\n        {[} else if (field.type === 'list-single') { field.options.forEach(function (option) {]}\n        <div class=\"property-radio\">\n            <input {[if (option.value === field.values[0]){]}checked{[}]} id=\"{{option.value}}\" name=\"{{field.var}}\" type=\"radio\" class=\"with-gap\" required=\"\">\n            <label class=\"{{option.value}}-label\" for=\"{{option.value}}\">{{option.label}}</label>\n        </div>\n        {[});}]}\n        {[if (field.var === 'index'){]}\n        <p class=\"property-description\">Locally indexed chats can be discovered by searching host server. Globally indexed chats can be discovered by searching global index</p>\n        {[} else if (field.var === 'membership') {]}\n        <p class=\"property-description\">Member-only chats can be joined only by invitation</p>\n        {[}]}\n    </div>\n    {[})]}\n</div>\n<div class=\"modal-footer\">\n    <div class=\"buttons-wrap\">\n        <button class=\"btn-save btn-flat btn-main non-active\">Save</button>\n        <button class=\"btn-cancel btn-flat btn-dark btn-main\">Cancel</button>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/default_restrictions.html",[],function(){return"<div class=\"modal-header\"><div class=\"panel-header black-text\">Default restrictions</div></div>\n<div class=\"modal-content\">\n    <div class=\"default-restrictions-list-wrap\"></div>\n    <p class=\"default-restrictions-info\">These restrictions will be automatically applied to all new group chat participants</p>\n</div>\n<div class=\"modal-footer\">\n    <div class=\"buttons-wrap\">\n        <button class=\"btn-default-restrictions-save btn-flat btn-main non-active\">Save</button>\n        <button class=\"btn-default-restrictions-cancel btn-flat btn-main btn-dark\">Cancel</button>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/group_member_item.html",[],function(){return"<tr class=\"participant-wrap\" data-id=\"{{id}}\" data-jid=\"{{jid}}\">\n    <td class=\"list-item group-chat-participant\">\n        <div class=\"member-item\">\n            <div class=\"circle-avatar\"/>\n            <div class=\"participant-info\">\n            <div class=\"top-line\"><div title=\"{{nickname}}\" class=\"nickname one-line\">{{nickname}}</div>{[if (badge) {]}<div class=\"badge one-line\">{{badge}}</div>{[}]}</div>\n            {[if (jid) {]}<p class=\"jid one-line\">{{jid}}</p>{[} else {]}<p class=\"id one-line\">{{id}}</p>{[}]}\n            </div>\n        </div>\n    </td>\n    <td class=\"last-seen\">{[if (!present) {]}<span class=\"online-status text-color-green-700\">Online</span>{[} else {]}<span title=\"{{present}}\">{{pretty_present}}</span>{[}]}</td>\n    <td class=\"role\">{[if (role !== 'member') {]}{{role}}{[}]}</td>\n    <td>\n        {[if (is_me) {]}\n        <span style=\"font-size:12px\" class=\"text-color-500\">this is you</span>\n        {[} else {]}\n        <div class=\"buttons-wrap\">\n            <div title=\"Kick\" class=\"btn-kick\">\n                <i class=\"mdi mdi-24px mdi-account-remove\"></i>\n            </div>\n            <div title=\"Block\" class=\"btn-block\">\n                <svg class=\"mdi mdi-24px\" viewBox=\"0 0 24 24\">\n                    <path fill=\"#9e9e9e\" d=\"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,13.85 4.63,15.55 5.68,16.91L16.91,5.68C15.55,4.63 13.85,4 12,4M12,20A8,8 0 0,0 20,12C20,10.15 19.37,8.45 18.32,7.09L7.09,18.32C8.45,19.37 10.15,20 12,20Z\" />\n                </svg>\n            </div>\n        </div>\n        {[}]}\n    </td>\n</tr>"}),define("text!templates/contacts/group_chats/invited_member_item.html",[],function(){return"<div class=\"list-item {{status}}-user\" data-jid=\"{{jid}}\">\n    <div class=\"member-item\">\n        <div class=\"circle-avatar\"/>\n        <p title=\"{{jid}}\" class=\"one-line\">{{jid}}</p>\n        {[if (status == 'invitations') {]}\n        <div title=\"Revoke invitation\" class=\"revoke-invitation\">\n            {[}else{]}\n            <div title=\"Unblock user\" class=\"unblock-user\">\n                {[}]}\n                <i class=\"mdi mdi-20px mdi-close\"></i>\n            </div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/participant_rights.html",[],function(){return"<div class=\"header\">\n</div>\n<div class=\"modal-content\">\n    <div class=\"rights-wrap\">\n    </div>\n</div>\n<div class=\"modal-footer noselect\">\n    <div class=\"buttons-wrap\">\n        <button class=\"btn-save-user-rights non-active btn-flat btn-main\">Save</button>\n        <button class=\"btn-cancel-changes btn-flat btn-main btn-dark\">Cancel</button>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/restriction_item.html",[],function(){return"<div class=\"right-item restriction restriction-{{name}}\">\n    <div class=\"right-name\">{{pretty_name}}</div>\n    <div class=\"field clickable-field restriction-{{name}}-state switch normal\">\n        <input type=\"checkbox\" {[if (type === 'fixed') {]} onclick=\"return false;\" {[}]} class=\"filled-in\" id=\"{{name}}\">\n        <label for=\"{{name}}\"></label>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/right_expire_variants.html",[],function(){return"<div class=\"select-timer\">\n    <div class=\"dropdown-button\" data-activates=\"select-timer-{{right_name}}\">\n        <div class=\"timer-item-wrap\"><div data-value=\"0\" class=\"default-value property-value\">set timer</div></div>\n    </div>\n    <div id=\"select-timer-{{right_name}}\" class=\"dropdown-content noselect\">\n        {[expire_options.forEach(function (option) {]}\n        <div data-value=\"{{option.value}}\" class=\"property-variant\">{{option.label}}</div>\n        {[}.bind(this));]}\n    </div>\n</div>\n"}),define("text!templates/contacts/group_chats/pinned_message.html",[],function(){return"<svg class=\"pin\" viewBox=\"0 0 24 24\">\n    <path fill=\"#757575\" d=\"M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z\" />\n</svg>\n<div class=\"msg-wrap\">\n    <div class=\"chat-msg-author-wrap\">\n        <div class=\"chat-msg-author text-color-700 one-line\">{{author}}</div>{[if (fwd_author){]}<svg class=\"fwd-chevron\" viewBox=\"0 0 24 24\"><path fill=\"#9E9E9E\" d=\"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z\"/></svg><div class=\"chat-msg-author text-color-700 one-line\">{{fwd_author}}</div>{[}]}\n        <div class=\"msg-time\">{{time}}</div>\n    </div>\n    <div class=\"chat-msg-content chat-text-content one-line\">\n        {{message}}\n    </div>\n</div>\n<svg title=\"Unpin\" class=\"close\" viewBox=\"0 0 24 24\">\n    <path class=\"close\" fill=\"#9E9E9E\" d=\"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z\" />\n</svg>"}),define("text!templates/contacts/group_chats/participant_details_item.html",[],function(){return"<div class=\"participant-details-item\" data-id=\"{{id}}\" data-jid=\"{{jid}}\" data-role=\"{{role}}\">\n    <div class=\"btn-more dropdown-button\" data-activates=\"{{id}}-buttons-wrap\">\n        <i class=\"mdi mdi-24px mdi-dots-vertical\"></i>\n    </div>\n    <ul class=\"buttons-menu-wrap dropdown-content noselect\" id=\"{{id}}-buttons-wrap\">\n        <li class=\"btn-block-participant\"><span class=\"one-line\">Block</span></li>\n    </ul>\n        <div class=\"circle-avatar\">\n            <input title=\"Change avatar\" type=\"file\">\n            <img>\n            <svg class=\"set-groupchat-avatar\" viewBox=\"0 0 24 24\">\n                <path d=\"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z\" />\n            </svg>\n            <div class=\"preloader-wrap\"><div class=\"preloader-wrapper preloader-16px visible\">\n                <div class=\"spinner-layer\">\n                    <div class=\"circle-clipper left\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"gap-patch\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"circle-clipper right\">\n                        <div class=\"circle\"></div>\n                    </div>\n                </div>\n            </div>\n            </div>\n        </div>\n        <div class=\"participant-info\">\n            <div id=\"edit-nickname\" class=\"rich-textarea\" tabindex=\"1\" contenteditable></div>\n            <div title=\"{{nickname}}\" class=\"nickname one-line\">{{nickname}}</div>\n            <div class=\"badge one-line {[if (!badge) {]}hidden{[}]}\">{{badge}}</div>\n            {[if (jid) {]}<p title=\"{{jid}}\" class=\"jid selectable-text one-line\">{{jid}}</p>{[} else {]}<p title=\"{{id}}\" class=\"id selectable-text one-line\">{{id}}</p>{[}]}\n        </div>\n    <div class=\"buttons-wrap\">\n        {[if (incognito_chat) {]}\n        <div class=\"button-wrap non-active btn-chat-wrap\">\n            <i class=\"mdi mdi-24px mdi-incognito btn-chat\"></i>\n            <div class=\"btn-name\">Private chat</div>\n        </div>\n        {[} else {]}\n        <div class=\"button-wrap non-active btn-chat-wrap\">\n            <i class=\"mdi mdi-24px mdi-message-text btn-chat\"></i>\n            <div class=\"btn-name\">Direct chat</div>\n        </div>\n        {[}]}\n        <div class=\"button-wrap btn-participant-messages-wrap\">\n            <i class=\"mdi mdi-24px mdi-view-list btn-participant-messages\"></i>\n            <div class=\"btn-name\">Messages</div>\n        </div>\n        <div class=\"button-wrap btn-set-badge-wrap\">\n            <svg class=\"btn-set-badge\" viewBox=\"0 0 24 24\">\n                <path d=\"M17,3H14V6H10V3H7A2,2 0 0,0 5,5V21A2,2 0 0,0 7,23H17A2,2 0 0,0 19,21V5A2,2 0 0,0 17,3M12,8A2,2 0 0,1 14,10A2,2 0 0,1 12,12A2,2 0 0,1 10,10A2,2 0 0,1 12,8M16,16H8V15C8,13.67 10.67,13 12,13C13.33,13 16,13.67 16,15V16M13,5H11V1H13V5M16,19H8V18H16V19M12,21H8V20H12V21Z\" />\n            </svg>\n            <div class=\"btn-name\">Set badge</div>\n        </div>\n        <div class=\"button-wrap btn-kick-participant-wrap\">\n            <i class=\"mdi mdi-24px mdi-account-remove btn-kick-participant\"></i>\n            <div class=\"btn-name\">Kick</div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/participant_placeholder.html",[],function(){return"<div class=\"default-screen-wrap\">\n    <div class=\"default-image-wrap\"><img src=\"images/astronaut@2x.png\" class=\"image-select-participant\"></div>\n    <p class=\"text-select-participant\">Select chat participant</p>\n</div>"}),define("text!templates/contacts/group_chats/participants.html",[],function(){return"<table class=\"members-list-wrap\">\n    <thead>\n    <tr>\n        <th>\n            <div class=\"participants-search-form search-form\">\n                <svg class=\"search-icon\" viewBox=\"0 0 24 24\">\n                    <path d=\"M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M10,4A4,4 0 0,1 14,8C14,8.91 13.69,9.75 13.18,10.43C12.32,10.75 11.55,11.26 10.91,11.9L10,12A4,4 0 0,1 6,8A4,4 0 0,1 10,4M2,20V18C2,15.88 5.31,14.14 9.5,14C9.18,14.78 9,15.62 9,16.5C9,17.79 9.38,19 10,20H2Z\" />\n                </svg>\n                <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search participant\">\n                <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n            </div>\n        </th>\n        <th>Last seen</th>\n        <th>Role</th>\n        <th></th>\n    </tr>\n    </thead>\n    <tbody></tbody>\n</table>\n<div class=\"preloader-wrapper preloader-17px active\">\n    <div class=\"spinner-layer\">\n        <div class=\"circle-clipper left\">\n            <div class=\"circle\"></div>\n        </div>\n        <div class=\"gap-patch\">\n            <div class=\"circle\"></div>\n        </div>\n        <div class=\"circle-clipper right\">\n            <div class=\"circle\"></div>\n        </div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/badge_edit_view.html",[],function(){return"\n    <div class=\"modal-content\">\n        <div class=\"rich-textarea badge-text\" tabindex=\"1\" contenteditable></div>\n        <div class=\"error\"></div>\n    </div>\n    <div class=\"panel-footer noselect\">\n        <div class=\"buttons-wrap\">\n            <div class=\"insert-emoticon\">\n                <i class=\"mdi mdi-24px mdi-emoticon hover-text-color-500\"></i>\n            </div>\n            <div class=\"emoticons-panel-wrap\">\n                <div class=\"emoticons-panel\"></div>\n                <div class=\"emoji-menu\"></div>\n            </div>\n            <button class=\"btn-save btn-flat btn-main\">Save</button>\n            <button class=\"btn-cancel btn-flat btn-main btn-dark\">Cancel</button>\n        </div>\n    </div>"}),define("text!templates/contacts/group_chats/private_participant_details.html",[],function(){return"<div class=\"participant-details-item\" data-id=\"{{id}}\" data-jid=\"{{jid}}\" data-role=\"{{role}}\">\n    <div class=\"circle-avatar\">\n        {[ if (is_myself) {]}\n        <input title=\"Change avatar\" type=\"file\">\n        {[}]}\n        <img>\n        {[ if (is_myself) {]}\n        <svg class=\"set-groupchat-avatar\" viewBox=\"0 0 24 24\">\n            <path d=\"M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z\" />\n        </svg>\n        <div class=\"preloader-wrap\"><div class=\"preloader-wrapper preloader-16px visible\">\n            <div class=\"spinner-layer\">\n                <div class=\"circle-clipper left\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"gap-patch\">\n                    <div class=\"circle\"></div>\n                </div>\n                <div class=\"circle-clipper right\">\n                    <div class=\"circle\"></div>\n                </div>\n            </div>\n        </div>\n        </div>\n        {[}]}\n    </div>\n    <div class=\"participant-info\">\n        {[ if (is_myself) {]}\n        <div id=\"edit-nickname\" class=\"rich-textarea\" tabindex=\"1\" contenteditable></div>\n        {[}]}\n        <div title=\"{{nickname}}\" class=\"{{is_myself && 'is-myself'}} nickname one-line\">{{nickname}}</div>\n        <div class=\"badge one-line {[if (!badge) {]}hidden{[}]}\">{{badge}}</div>\n    </div>\n</div>"}),define("text!templates/contacts/group_chats/set_status.html",[],function(){return"<div class=\"modal-content-wrap\">\n    <div class=\"modal-header\">\n        <span>Set status</span>\n    </div>\n    <ul class=\"status-values noselect\">\n        <div class=\"loading-status\">\n            <div class=\"preloader-wrapper preloader-17px active\">\n                <div class=\"spinner-layer\">\n                    <div class=\"circle-clipper left\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"gap-patch\">\n                        <div class=\"circle\"></div>\n                    </div>\n                    <div class=\"circle-clipper right\">\n                        <div class=\"circle\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </ul>\n</div>\n"}),define("text!templates/contacts/group_chats/status_item.html",[],function(){return"<li data-value=\"{{option.value}}\">\n    <span class=\"status-value one-line\">{{option.label}}</span>\n    <span class=\"status-bulb\" data-status=\"{{option.value}}\"></span>\n</li>"}),define("text!templates/contacts/group_chats/group_status.html",[],function(){return"<div class=\"block-header\">\n    <span class=\"block-name\">Status</span>\n</div>\n<div class=\"group-chat-status\">\n    <div class=\"status-wrap\">\n        <div class=\"status status-bulb\"></div>\n        <div class=\"status-message\"></div>\n    </div>\n    <div class=\"btn-edit-status\">edit</div>\n</div>"}),define("text!templates/chats/chats_panel.html",[],function(){return"<div class=\"recent-chats-panel noselect\">\n    <div class=\"chats-search-form search-form panel-head\">\n        <div class=\"account-indicator\"></div>\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n    <div class=\"chat-list-wrap left-panel-list-wrap\">\n        <div class=\"chat-list item-list\">\n        </div>\n        <div class=\"searched-lists-wrap\">\n            <div class=\"chats-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"chats-title\">Chats</div>\n                <div class=\"chats-list roster-left-container\"></div>\n            </div>\n            <div class=\"contacts-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"contacts-title\">Contacts</div>\n                <div class=\"contacts-list roster-left-container\"></div>\n            </div>\n            <div class=\"messages-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"messages-title\">Messages</div>\n                <div class=\"messages-list roster-left-container\"></div>\n            </div>\n        </div>\n        <div class=\"load-chats-feedback hidden\">Loading...</div>\n    </div>\n    <div class=\"read-all-button hidden\">Mark all as read</div>\n</div>\n"}),define("text!templates/chats/add_chat_account_item.html",[],function(){return"<div class=\"account-item-wrap\" data-jid=\"{{jid}}\">\n    <div class=\"name one-line\">{{jid}}</div>\n</div>\n"}),define("text!templates/chats/chat_item.html",[],function(){return"<div class=\"account-indicator ground-color-700\"></div>\n<div class=\"circle-avatar\"></div>\n<div class=\"status hide-offline\"></div>\n<div class=\"chat-icon hidden\"><svg class=\"mdi mdi-18px\" viewBox=\"0 0 18 18\"/></div>\n<div class=\"recent-chat-info\">\n    <div class=\"chat-title-wrap\">\n        <p class=\"chat-title one-line\"></p>\n        <i class=\"mdi muted-icon mdi-14px mdi-bell-off\"></i>\n        <p class=\"last-msg-date\"></p>\n    </div>\n    <p class=\"last-msg one-line\"></p>\n    <i class=\"msg-delivering-state mdi mdi-12px hidden\"></i>\n    <span class=\"msg-counter hidden\"></span>\n</div>\n"}),define("text!templates/chats/chat_head.html",[],function(){return"    <div class=\"circle-avatar\"/>\n    <div class=\"contact-status hide-offline\"/>\n    <div class=\"chat-icon hidden\"><svg class=\"mdi mdi-18px\" viewBox=\"0 0 18 18\"/></div>\n    <div class=\"contact-info\">\n        <p class=\"contact-name one-line\"></p>\n        <p class=\"contact-status-message one-line\"></p>\n    </div>\n    <div class=\"chat-tools-wrap\">\n        <div class=\"chat-tool btn-jingle-message\">\n            <i class=\"mdi mdi-phone mdi-24px\"></i>\n        </div>\n        <div class=\"chat-tool btn-set-status\">\n            <svg class=\"mdi mdi-24px\" viewBox=\"0 0 24 24\">\n                <g stroke=\"none\" stroke-width=\"1\" fill=\"none\">\n                    <rect x=\"0\" y=\"0\" width=\"24\" height=\"24\"/>\n                    <path d=\"M20,4 C21.1045695,4 22,4.8954305 22,6 L22,16 C22,17.1045695 21.1045695,18 20,18 L16,18 L12,22 L8,18 L4,18 C2.8954305,18 2,17.1045695 2,16 L2,6 C2,4.8954305 2.8954305,4 4,4 L20,4 Z M16,12 L6,12 L6,14 L16,14 L16,12 Z M18,8 L6,8 L6,10 L18,10 L18,8 Z\" id=\"tooltip-variant\" fill=\"#9E9E9E\" fill-rule=\"nonzero\"/>\n                </g>\n            </svg>\n        </div>\n        <div class=\"chat-tool btn-search-messages\">\n            <i class=\"search-icon mdi mdi-24px mdi-magnify\"></i>\n        </div>\n        <div class=\"chat-tool btn-archive-chat\">\n            <i class=\"mdi mdi-24px mdi-package-down\"></i>\n        </div>\n        <div class=\"chat-tool btn-notifications\">\n            <i class=\"mdi muted-icon mdi-22px mdi-bell\"></i>\n        </div>\n        <div class=\"chat-tool btn-more dropdown-button\" data-activates=\"{{view.cid}}-more\">\n            <i class=\"mdi mdi-24px mdi-dots-vertical\"></i>\n        </div>\n        <ul id=\"{{view.cid}}-more\" class=\"chat-head-menu dropdown-content noselect\">\n            <li class=\"btn-contact-details\">\n                <span class=\"one-line\">Contact info</span>\n            </li>\n            <li class=\"btn-call-attention\">\n                <span class=\"one-line\">Call attention</span>\n            </li>\n            <li class=\"btn-export-history\">\n                <span class=\"one-line\">Export history</span>\n            </li>\n            <li class=\"btn-clear-history\">\n                <span class=\"one-line\">Clear history</span>\n            </li>\n            <li class=\"btn-invite-users\">\n                <span class=\"one-line\">Invite users</span>\n            </li>\n            <li class=\"btn-delete-chat\">\n                <span class=\"one-line\">Delete chat</span>\n            </li>\n            <li class=\"btn-delete-contact\">\n                <span class=\"one-line\">Delete contact</span>\n            </li>\n            <li class=\"btn-block-contact\">\n                <span class=\"one-line\">Block contact</span>\n            </li>\n            <li class=\"btn-unblock-contact\">\n                <span class=\"one-line\">Unblock contact</span>\n            </li>\n        </ul>\n    </div>\n"}),define("text!templates/chats/chat_content.html",[],function(){return"<div class=\"search-form-header\">\n    <div class=\"messages-search-form search-form\">\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search messages\" autofocus>\n    </div>\n    <div class=\"text-color-700 btn-cancel-searching\">cancel</div>\n</div>\n<div class=\"pinned-message\"></div>\n<div class=\"elements-in-top\">\n    <div class=\"subscription-buttons-wrap hidden\"/>\n    <div class=\"chat-day-indicator fixed-day-indicator-wrap hidden\"><div class=\"fixed-day-indicator\"></div></div>\n</div>\n<div class=\"load-history-feedback hidden\"></div>\n<div class=\"participant-messages-header hidden\"><div class=\"messages-by-header\">Messages by <div class=\"participant-nickname text-color-700\"></div></div><div class=\"text-color-700 btn-cancel-selection\">cancel</div><div class=\"btn-retract-messages\">delete all</div></div>\n<div class=\"chat-content\">\n</div>\n<i class=\"mdi mdi-36px back-to-bottom mdi-chevron-down\"></i>\n<div class=\"chat-notification hidden one-line\"></div>"}),define("text!templates/chats/chat_bottom.html",[],function(){return"    <div class=\"message-input-panel noselect\">\n        <div class=\"my-avatar circle-avatar circle-image-fix\">\n            <img>\n        </div>\n        <div class=\"message-form\">\n            <div class=\"fwd-messages-preview noselect hidden\">\n                <div class=\"msg-border ground-color-700\">\n                </div>\n                <div class=\"msg-content\">\n                    <p class=\"msg-author text-color-700 one-line\"></p>\n                    <p class=\"msg-text one-line\"></p>\n                </div>\n                <div class=\"close-forward\">\n                    <i class=\"mdi mdi-20px mdi-close hover-text-color-500\"></i>\n                </div>\n            </div>\n            <div class=\"input-field input-message\">\n                <div class=\"mentions-list\"></div>\n                <div class=\"rich-textarea-wrap notranslate\">\n                </div>\n                <div class=\"scrollbar-cover\"></div>\n                <div class=\"insert-emoticon\">\n                    <i class=\"mdi mdi-24px mdi-emoticon hover-text-color-500\"></i>\n                </div>\n                <div class=\"emoticons-panel-wrap\">\n                    <div class=\"emoticons-panel\"></div>\n                    <div class=\"emoji-menu\"></div>\n                    <div class=\"uploading-emoticons\">\n                    <div class=\"preloader-wrapper preloader-20px active visible\">\n                        <div class=\"spinner-layer\">\n                            <div class=\"circle-clipper left\">\n                                <div class=\"circle\"></div>\n                            </div>\n                            <div class=\"gap-patch\">\n                                <div class=\"circle\"></div>\n                            </div>\n                            <div class=\"circle-clipper right\">\n                                <div class=\"circle\"></div>\n                            </div>\n                        </div>\n                    </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"input-voice-message\">\n                <div class=\"voice-visualizer\"></div>\n                <div class=\"timer\">0:00</div>\n                <div class=\"voice-msg-status\">Release outside this form to cancel</div>\n            </div>\n            <div class=\"input-toolbar\">\n                <div class=\"attach attach-file\">\n                    <input type=\"file\" title=\"Send file\" multiple>\n                    <i class=\"mdi mdi-24px mdi-paperclip\"></i>\n                </div>\n                <div title=\"Format text\" class=\"format-text\">\n                    <i class=\"mdi mdi-24px mdi-format-text\"></i>\n                </div>\n                <div class=\"last-emoticons\">\n                </div>\n                <div class=\"account-jid text-color-700\"></div><div class=\"account-role ground-color-700\"></div><div class=\"account-badge\"></div><div class=\"account-nickname text-color-700\"></div>\n            </div>\n        </div>\n        <div class=\"send-area\">\n            <button class=\"btn-save btn-flat btn-main text-color-700 hidden\">Save</button>\n            <i class=\"send-message mdi mdi-28px mdi-send text-color-700 hover-text-color-500 hidden\"></i>\n            <i class=\"mdi mdi-28px mdi-microphone attach-voice-message text-color-700 hover-text-color-500\"></i>\n        </div>\n    </div>\n    <div class=\"blocked-msg hidden\">blocked</div>\n    <div class=\"message-actions-panel noselect hidden\">\n        <div class=\"button-wrap reply-message-wrap\">\n            <i class=\"action-button reply-message mdi ground-color-700 mdi-reply mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">R</span>eply</div>\n        </div>\n        <div class=\"button-wrap forward-message-wrap\">\n            <i class=\"action-button forward-message mdi ground-color-700 mdi-forward mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">F</span>orward</div>\n        </div>\n        <div class=\"button-wrap copy-message-wrap\">\n            <i class=\"action-button copy-message mdi ground-color-700 mdi-content-copy mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">C</span>opy</div>\n        </div>\n        <div class=\"button-wrap delete-message-wrap\">\n            <i class=\"action-button delete-message mdi ground-color-700 mdi-delete mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">D</span>elete</div>\n        </div>\n        <div class=\"button-wrap edit-message-wrap\">\n            <i class=\"action-button edit-message mdi ground-color-700 mdi-pencil mdi-24px\"></i>\n            <div class=\"button-name\"><span class=\"text-color-500\">E</span>dit</div>\n        </div>\n        <div class=\"button-wrap pin-message-wrap\">\n            <svg class=\"action-button pin-message ground-color-700\" viewBox=\"0 0 24 24\">\n                <path fill=\"#FFF\" d=\"M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z\"/>\n            </svg>\n            <div class=\"button-name\"><span class=\"text-color-500\">P</span>in</div>\n        </div>\n        <div class=\"button-wrap cancel-message-wrap\">\n            <i class=\"action-button close-message-panel mdi mdi-close mdi-24px\"></i>\n            <div class=\"button-name\">Cancel</div>\n        </div>\n    </div>\n"}),define("text!templates/chats/subscription_buttons.html",[],function(){return"<div class=\"subscription-buttons\">\n    <div class=\"subscription-info\"></div>\n    <div class=\"button text-color-500 btn-add\">Add contact</div>\n    <div class=\"button btn-block\">Block</div>\n    <div class=\"button text-color-500 btn-allow\">Allow</div>\n    <div class=\"button text-color-500 btn-subscribe\">Subscribe</div>\n    <i class=\"mdi-close btn-decline mdi mdi-24px\"/>\n</div>"}),define("text!templates/chats/forward_panel.html",[],function(){return"<div class=\"modal-header noselect\">\n    <div class=\"panel-header\">\n        <span class=\"header\">Forward message</span>\n    </div>\n</div>\n<div class=\"modal-content noselect\">\n    <div class=\"chats-search-form search-form\">\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" placeholder=\"Search\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n    <div class=\"chat-list-wrap\">\n    </div>\n    <div class=\"error hidden\">No matches</div>\n</div>\n"}),define("text!templates/chats/chat_placeholder.html",[],function(){return"<div class=\"text\">Please select a chat to start messaging</div>\n"}),define("text!templates/chats/message_item.html",[],function(){return"<div class=\"account-indicator ground-color-700\"></div>\n<div class=\"circle-avatar\"></div>\n<div class=\"chat-icon hidden\"><svg class=\"mdi mdi-18px\" viewBox=\"0 0 18 18\"/></div>\n<div class=\"recent-chat-info\">\n    <div class=\"chat-title-wrap\">\n        <p class=\"chat-title one-line\"></p>\n        <p class=\"last-msg-date\"></p>\n    </div>\n    <p class=\"last-msg one-line\"></p>\n</div>\n"}),define("text!templates/chats/messages/main.html",[],function(){return"<div class=\"chat-message main {{classlist}}\"  {[if (avatar_id) {]} data-avatar=\"{{avatar_id}}\" {[}]} data-time=\"{{timestamp}}\" data-uniqueid=\"{{unique_id}}\" {[if (from_id) {]} data-from-id=\"{{from_id}}\" {[}]} data-from=\"{{from_jid}}\">\n    <div class=\"left-side noselect\">\n        <div class=\"circle-avatar\"></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-author-wrap\">\n            <div class=\"chat-msg-author text-color-700 one-line\">{{username}}</div>\n            {[if (badge) {]} <div class=\"chat-msg-author-badge one-line\">{{badge}}</div>\n            {[ } if (role && (role != 'Member')) {]} <div class=\"chat-msg-author-role ground-color-700 one-line\">{{role}}</div> {[}]}\n        </div>\n        <div class=\"fwd-msgs-block\"></div>\n        <div class=\"chat-msg-content chat-text-content\">{{message}}</div>\n        <div class=\"chat-msg-media-content\"></div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n        <div class=\"edited-info one-line hidden\"></div>\n        {[ if (is_sender) { ]}\n            <i class=\"msg-delivering-state mdi mdi-14px\" data-state=\"{{state}}\" title=\"{{verbose_state}}\" data-activates=\"retry-send-msg-{{msgid}}\"></i>\n            <div id=\"retry-send-msg-{{msgid}}\" class=\"dropdown-content retry-send-message noselect\"><div class=\"btn-retry-send-message\">retry</div></div>\n        {[ } ]}\n        <div class=\"msg-copy-link\" title=\"Copy link\"><i class=\"mdi mdi-link-variant\" data-image=\"{{is_image}}\"></i></div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/forwarded.html",[],function(){return"<div class=\"fwd-message\" data-time=\"{{timestamp}}\" data-uniqueid=\"{{unique_id}}\" {[if (avatar_id) {]} data-avatar=\"{{avatar_id}}\" {[}]} data-from-id=\"{{from_id}}\" data-from=\"{{from_jid}}\">\n    <div class=\"fwd-left-side noselect\">\n        <div class=\"circle-avatar\"><!--<img>--></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"fwd-msg-author-wrap\">\n            <div class=\"fwd-msg-author text-color-700 one-line\">{{username}}</div>\n            {[if (badge) {]} <div class=\"chat-msg-author-badge one-line\">{{badge}}</div>\n            {[ } if ((role)&&(role != 'Member')) {]} <div class=\"chat-msg-author-role ground-color-700 one-line\">{{role}}</div> {[}]}\n            <div class=\"msg-time selectable-text one-line\" title=\"{{time}}\">{{short_time}}</div>\n        </div>\n        <div class=\"fwd-msgs-block\"></div>\n        <div class=\"chat-msg-content chat-text-content\">{{message}}</div>\n        <div class=\"chat-msg-media-content\"></div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/system.html",[],function(){return"<div class=\"chat-message system\"  data-time=\"{{timestamp}}\" data-uniqueid=\"{{unique_id}}\" data-from=\"{{from_jid}}\">\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-content chat-text-content\">{{message}}</div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/file_upload.html",[],function(){return"<div class=\"chat-message file-upload noselect\" {[if (avatar_id) {]} data-avatar=\"{{avatar_id}}\" {[}]} data-time=\"{{timestamp}}\" data-from=\"{{from_jid}}\" data-uniqueid=\"{{unique_id}}\">\n    <div class=\"left-side noselect\">\n        <div class=\"circle-avatar\"><!--<img>--></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-author-wrap\">\n            <div class=\"chat-msg-author text-color-700 one-line\">{{username}}</div>\n            {[if (badge) {]} <div class=\"chat-msg-author-badge one-line\">{{badge}}</div>\n            {[ } if (role && (role != 'Member')) {]} <div class=\"chat-msg-author-role ground-color-700 one-line\">{{role}}</div> {[}]}\n        </div>\n        <div class=\"chat-msg-content chat-file-content\">\n            <div class=\"chat-file-info\">\n                <div class=\"filename text-color-700 one-line\">{{files[0].name}}</div>\n                <div class=\"filesize grey-text one-line\"></div>\n                <div class=\"status-area\">\n                    <div class=\"status one-line text-color-700\" style=\"display: none\"></div>\n                    <div class=\"repeat-upload text-color-700\" style=\"display: none;\">Resend</div>\n                </div>\n                <div class=\"progress-area\">\n                    <div class=\"progress ground-color-100\">\n                        <div class=\"determinate ground-color-700\" style=\"width: 0%\"></div>\n                    </div>\n                    <div class=\"cancel-upload text-color-700\">Cancel</div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n        <i class=\"msg-delivering-state mdi mdi-14px\" data-state=\"pending\" title=\"{{verbose_state}}\" data-activates=\"retry-send-msg-{{msgid}}\"></i>\n        <div id=\"retry-send-msg-{{msgid}}\" class=\"dropdown-content retry-send-message noselect\"><div class=\"btn-retry-send-message\">retry</div></div>\n        <div class=\"msg-copy-link\" title=\"Copy link\"><i class=\"mdi mdi-link-variant\" data-image=\"{{is_image}}\"></i></div>\n    </div>\n</div>"}),define("text!templates/chats/messages/file.html",[],function(){return"<div class=\"one-file-wrap link-file\">\n    <i class=\"mdi {{mdi_icon}}\"></i>\n    <div class=\"file-container\">\n        <div class=\"file-info one-line\">\n            <span class=\"file-name\">{{name}}</span>{[ if (is_audio && duration) { ]}, {{duration}}{[ } ]},  <span class=\"file-size\">{{size}}</span>\n        </div>\n        <a href=\"{{sources[0]}}\" class=\"file-link-download\">Download</a>\n    </div>\n</div>"}),define("text!templates/chats/messages/audio_file.html",[],function(){return"<div class=\"one-file-wrap link-file\">\n    <i class=\"mdi mdi-play no-uploaded\"></i>\n    <i class=\"mdi mdi-pause\"></i>\n    <div class=\"file-container\">\n        <div class=\"file-info one-line\">\n            <span class=\"file-name\">{{name}}</span>{[ if (duration) { ]}, {{duration}}{[ } ]},  <span class=\"file-size\">{{size}}</span>\n        </div>\n        <a href=\"{{sources[0]}}\" class=\"file-link-download\">Download</a>\n        <a class=\"voice-message-play\">Play</a>\n    </div>\n</div>"}),define("text!templates/chats/messages/audio_file_waveform.html",[],function(){return"<div class=\"waveform\" id=\"{{waveform_id}}\"></div>\n<div class=\"audio-control-panel\">\n    <span class=\"voice-msg-current-time\">0:00</span> /\n    <span class=\"voice-msg-total-time\">0:00</span>\n    <input value=\"50\" type=\"range\" class=\"voice-message-volume\">\n</div>"}),define("text!templates/chats/messages/auth_request.html",[],function(){return"<div class=\"chat-message system auth-request\" data-time=\"{{timestamp}}\" data-uniqueid=\"{{unique_id}}\" data-from=\"{{from_jid}}\">\n    <div class=\"left-side noselect\">\n        <div class=\"circle-avatar\"><img></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-author-wrap\">\n            <div class=\"chat-msg-author text-color-700 one-line\">{{username}}</div>\n        </div>\n        <div class=\"chat-msg-content chat-text-content\">{{message}}<span class=\"accept-request\">Accept</span><span class=\"decline-request\">Decline</span><span class=\"block-request\">Block</span></div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/group_request.html",[],function(){return"<div class=\"chat-message system auth-request\" data-time=\"{{timestamp}}\" data-uniqueid=\"{{unique_id}}\" data-from=\"{{from_jid}}\">\n    <div class=\"left-side noselect\">\n        <div class=\"circle-avatar\"><img></div>\n    </div>\n\n    <div class=\"msg-wrap\">\n        <div class=\"chat-msg-author-wrap\">\n            <div class=\"chat-msg-author text-color-700 one-line\">{{username}}</div>\n        </div>\n        <div class=\"chat-msg-content chat-text-content\">{{message}}<div><span class=\"accept-request-group\">Accept</span><span class=\"decline-request-group\">Decline</span><span class=\"block-request-group\">Block</span></div></div>\n    </div>\n\n    <div class=\"right-side noselect\">\n        <div class=\"msg-time selectable-text\" title=\"{{time}}\">{{short_time}}</div>\n    </div>\n</div>\n"}),define("text!templates/chats/messages/template-for-2.html",[],function(){return"<div class=\"image-collection zoom-gallery\"><div class=\"img-content-template template-for-2\"><img src=\"{{images[0].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].sources[0]}}\"></div>\n<div class=\"img-content-template template-for-2\"><img src=\"{{images[1].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].sources[0]}}\"></div></div>\n\n"}),define("text!templates/chats/messages/template-for-3.html",[],function(){return"<div class=\"image-collection zoom-gallery\"><div class=\"img-content-template template-for-3 main\"><img src=\"{{images[0].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].sources[0]}}\"></div>\n<div class=\"template-for-3 minor-images\"><div class=\"img-content-template template-for-3 minor\"><img src=\"{{images[1].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].sources[0]}}\"></div>\n<div class=\"img-content-template template-for-3 minor\"><img src=\"{{images[2].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[2].sources[0]}}\"></div></div></div>"}),define("text!templates/chats/messages/template-for-4.html",[],function(){return"<div class=\"image-collection zoom-gallery\"><div class=\"img-content-template template-for-4 main\"><img src=\"{{images[0].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].sources[0]}}\"></div><div class=\"template-for-4 minor-images\">\n<div class=\"img-content-template template-for-4 minor\"><img src=\"{{images[1].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].sources[0]}}\"></div>\n<div class=\"img-content-template template-for-4 minor\"><img src=\"{{images[2].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[2].sources[0]}}\"></div>\n<div class=\"img-content-template template-for-4 minor\"><img src=\"{{images[3].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[3].sources[0]}}\"></div></div></div>"}),define("text!templates/chats/messages/template-for-5.html",[],function(){return"<div class=\"image-collection zoom-gallery template-for-5\"><div class=\"img-content-wrap template-for-5 main\"><div class=\"img-content-template template-for-5\"><img src=\"{{images[0].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].sources[0]}}\"></div><div class=\"img-content-template template-for-5\"><img src=\"{{images[1].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].sources[0]}}\"></div></div>\n<div class=\"img-content-wrap template-for-5 minor-images\"><div class=\"img-content-template template-for-5\"><img src=\"{{images[2].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[2].sources[0]}}\"></div>\n<div class=\"img-content-template template-for-5\"><img src=\"{{images[3].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[3].sources[0]}}\"></div>\n<div class=\"img-content-template template-for-5\"><img src=\"{{images[4].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[4].sources[0]}}\"></div></div></div>"}),define("text!templates/chats/messages/template-for-6.html",[],function(){return"<div class=\"image-collection zoom-gallery template-for-6\"><div class=\"img-content-wrap template-for-6 main-row\"><div class=\"img-content-template template-for-6 main\"><img src=\"{{images[0].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[0].sources[0]}}\"></div><div class=\"template-for-6 minor-1\"><div class=\"img-content-template template-for-6\"><img src=\"{{images[1].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[1].sources[0]}}\"></div>\n<div class=\"img-content-template template-for-6\"><img src=\"{{images[2].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[2].sources[0]}}\"></div></div></div>\n<div class=\"template-for-6 minor-2\"><div class=\"img-content-template template-for-6\"><img src=\"{{images[3].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[3].sources[0]}}\"></div>\n<div class=\"img-content-template template-for-6\"><img src=\"{{images[4].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[4].sources[0]}}\"></div>\n<div class=\"img-content-template template-for-6 last-image\"><img src=\"{{images[5].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[5].sources[0]}}\">\n{[ if (images.length > 6) { ]}<span class=\"image-counter\"></span>{[ for (var i=6; i < images.length; i++) {]} <div class=\"img-content-template hidden\"><img src=\"{{images[i].sources[0]}}\" class=\"uploaded-img-for-collage popup-img\" data-mfp-src=\"{{images[i].sources[0]}}\"></div> {[}} ]}</div></div></div>\n"}),define("text!templates/chats/archive_placeholder.html",[],function(){return"<div class=\"text\">Archive chats are not implemented yet</div>"}),define("text!templates/chats/group_chats/pinned_message_panel.html",[],function(){return"<div class=\"modal-content full-pinned-message\">\n</div>\n"}),define("text!templates/chats/group_chats/add_group_chat.html",[],function(){return"<div class=\"modal-header\">\n    <div class=\"panel-header black-text\">Create group chat</div>\n</div>\n<div class=\"modal-content\">\n    <div class=\"row account-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-account-circle\"></i>\n        <div class=\"multiple-acc\">\n            <div class=\"account-dropdown-wrap\">\n                <div class=\"dropdown-button\" data-activates=\"select-account-for-creating-groupchat\">\n                    <div class=\"account-item-wrap\">\n                    </div>\n                    <div class=\"caret\">\n                        <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                    </div>\n                </div>\n                <div id=\"select-account-for-creating-groupchat\" class=\"dropdown-content noselect\">\n                </div>\n            </div>\n        </div>\n        <div class=\"single-acc\">\n            <div class=\"dropdown-button\">\n                <div class=\"account-item-wrap\">\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class=\"row name-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-pencil\"></i>\n        <div class=\"input-field input-group-chat-name\">\n            <input id=\"new_chat_name\" type=\"text\" name=\"chat_name\" placeholder=\"Edit group chat name\" required>\n        </div>\n    </div>\n    <div class=\"row jid-field\">\n        <svg class=\"field-icon mdi mdi-24px mdi-svg-template\" data-svgname=\"xmpp\"></svg>\n        <div class=\"property-field xmpp-server-dropdown-wrap\">\n            <div class=\"select-xmpp-server\">\n                <div data-activates=\"select-xmpp-server\" class=\"xmpp-server-item-wrap property-wrap\"><div class=\"jid-at\">@</div><div class=\"field-jid one-line property-value\"></div></div>\n                <div class=\"input-field input-group-chat-domain hidden\">\n                    <input id=\"new_chat_domain\" type=\"text\" placeholder=\"domain\" name=\"chat_domain\">\n                </div>\n                <div data-activates=\"select-xmpp-server\" class=\"caret\">\n                    <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                </div>\n            </div>\n            <div id=\"select-xmpp-server\" class=\"dropdown-content noselect\">\n                <div class=\"property-variant set-custom-domain\">custom server...</div>\n            </div>\n        </div>\n        <div class=\"input-field input-group-chat-jid\">\n            <input id=\"new_chat_jid\" type=\"text\" placeholder=\"jid\" name=\"chat_jid\">\n        </div>\n    </div>\n    <div class=\"row incognito-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-incognito\"></i>\n        <div class=\"property-field incognito-dropdown-wrap\">\n            <div class=\"dropdown-button\" data-activates=\"select-incognito\">\n                <div class=\"incognito-item-wrap property-wrap\"><div data-value=\"public\" class=\"property-value\">Public</div></div>\n                <div class=\"caret\">\n                    <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                </div>\n            </div>\n            <div id=\"select-incognito\" class=\"dropdown-content noselect\">\n                <div data-value=\"public\" class=\"property-variant default-value\">Public</div>\n                <div data-value=\"incognito\" class=\"property-variant\">Incognito</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"row global-field\">\n        <svg class=\"field-icon toolbar-icon mdi mdi-24px\" viewBox=\"0 0 24 24\">\n            <path d=\"M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M19.35,8.03C21.95,8.22 24,10.36 24,13C24,14.64 23.21,16.1 22,17V16.5A6.5,6.5 0 0,0 15.5,10A6.5,6.5 0 0,0 9,16.5C9,17 9.06,17.5 9.17,18H6A6,6 0 0,1 0,12C0,8.9 2.34,6.36 5.35,6.03C6.6,3.64 9.11,2 12,2C15.64,2 18.67,4.59 19.35,8.03Z\"></path>\n        </svg>\n        <div class=\"property-field global-dropdown-wrap\">\n            <div class=\"dropdown-button\" data-activates=\"select-global\">\n                <div class=\"global-item-wrap property-wrap\"><div data-value=\"none\" class=\"property-value\">Not indexed</div></div>\n                <div class=\"caret\">\n                    <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                </div>\n            </div>\n            <div id=\"select-global\" class=\"dropdown-content noselect\">\n                <div data-value=\"none\" class=\"property-variant default-value\">Not indexed</div>\n                <div data-value=\"local\" class=\"property-variant\">Local index</div>\n                <div data-value=\"global\" class=\"property-variant\">Global index</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"row membership-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-lock\"></i>\n        <div class=\"property-field membership-dropdown-wrap\">\n            <div class=\"dropdown-button\" data-activates=\"select-membership\">\n                <div class=\"membership-item-wrap property-wrap\"><div data-value=\"open\" class=\"property-value\">Open membership</div></div>\n                <div class=\"caret\">\n                    <i class=\"mdi mdi-20px mdi-menu-down\"></i>\n                </div>\n            </div>\n            <div id=\"select-membership\" class=\"dropdown-content noselect\">\n                <div data-value=\"open\" class=\"property-variant default-value\">Open membership</div>\n                <div data-value=\"member-only\" class=\"property-variant\">Member-only</div>\n            </div>\n        </div>\n    </div>\n    <div class=\"row description-field\">\n        <i class=\"field-icon mdi mdi-24px mdi-sort-variant\"></i>\n        <div class=\"input-field input-message\">\n            <div class=\"rich-textarea-wrap notranslate\">\n                <div class=\"rich-textarea\" tabindex=\"2\" contenteditable=\"\"></div>\n                <div class=\"placeholder\">Write a description...</div>\n            </div>\n        </div>\n    </div>\n</div>\n</div>\n<div class=\"modal-footer\">\n    <span class=\"errors\"></span>\n    <button class=\"btn-flat btn-main text-color-700 non-active btn-add\">Create</button>\n    <button class=\"btn-flat btn-main btn-dark btn-cancel\">Cancel</button>\n</div>"}),define("text!templates/chats/group_chats/invitation_panel_view.html",[],function(){return"    <div class=\"modal-header noselect\">\n        <div class=\"panel-header\">\n            <span class=\"header\">Invite users</span>\n        </div>\n    </div>\n    <div class=\"modal-content noselect\">\n        <div class=\"chats-search-form search-form\">\n            <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n            <input type=\"text\" class=\"search-input simple-input-field\" placeholder=\"Search\">\n            <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n        </div>\n        <div class=\"contacts-list-wrap\">\n        </div>\n        <div class=\"error hidden\">No matches</div>\n    </div>\n    <div class=\"modal-footer\">\n        <button class=\"btn-flat btn-main btn-add\"><span class=\"counter hidden\"></span>Invite</button>\n        <button class=\"btn-flat btn-dark btn-main btn-cancel\">Cancel</button>\n        <span class=\"errors\"></span>\n    </div>"}),define("text!templates/chats/group_chats/mention_item.html",[],function(){return"<div class=\"list-item mention-item\" data-jid=\"{{jid}}\" data-id=\"{{id}}\" data-nickname=\"{{nickname}}\">\n    <div class=\"circle-avatar\"><img></div>\n    <div class=\"participant-info\">\n        <span class=\"one-line nickname\">{{nickname}}</span>\n        <span class=\"one-line jid\">{{jid}}</span>\n    </div>\n</div>"}),define("text!templates/mentions/mentions_panel.html",[],function(){return"<div class=\"mentions-panel noselect\">\n    <div class=\"chats-search-form search-form panel-head\">\n        <div class=\"account-indicator\"></div>\n        <i class=\"search-icon mdi mdi-20px mdi-magnify\"></i>\n        <input type=\"text\" class=\"search-input simple-input-field\" tabindex=\"1\" placeholder=\"Search\">\n        <i class=\"close-search-icon mdi mdi-20px mdi-close\"></i>\n    </div>\n    <div class=\"mentions-list-wrap left-panel-list-wrap\">\n        <div class=\"mentions-list item-list\">\n        </div>\n        <div class=\"searched-lists-wrap\">\n            <div class=\"chats-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"chats-title\">Chats</div>\n                <div class=\"chats-list roster-left-container\"></div>\n            </div>\n            <div class=\"contacts-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"contacts-title\">Contacts</div>\n                <div class=\"contacts-list roster-left-container\"></div>\n            </div>\n            <div class=\"messages-list-wrap hidden\">\n                <div class=\"account-indicator\"></div>\n                <div class=\"messages-title\">Messages</div>\n                <div class=\"messages-list roster-left-container\"></div>\n            </div>\n        </div>\n    </div>\n</div>\n"}),define("text!templates/mentions/mentions_placeholder.html",[],function(){return"<div class=\"text\">Please select mention to view in chat</div>"}),define("text!templates/mentions/mention_item.html",[],function(){return"<div class=\"group-chat-title-wrap hidden\">\n    <div class=\"account-indicator ground-color-700\"></div>\n    <div class=\"contact-icon\">\n        <img class=\"server-icon hidden\" src=\"./images/BotIcon20x20@2x.png\">\n        <img class=\"group-chat-icon hidden\" src=\"./images/GroupchatIcon20x20@2x.png\">\n    </div>\n    <div class=\"group-chat-name one-line\"></div>\n</div>\n<div class=\"mention-info-wrap\">\n<div class=\"account-indicator ground-color-700\"></div>\n<div class=\"circle-avatar\"></div>\n<div class=\"mention-info\">\n    <div class=\"chat-title-wrap\">\n        <p class=\"chat-title one-line\"></p>\n        <p class=\"last-msg-date\"></p>\n    </div>\n    <p class=\"last-msg one-line\"></p>\n    <span class=\"msg-counter hidden\"></span>\n</div>\n</div>"}),define("text!templates/svg/ic-jabber.html",[],function(){return"<path\n     style=\"fill-rule:evenodd\"\n     inkscape:connector-curvature=\"0\"\n     id=\"path5\"\n     d=\"m 5.2462478,6.4309194 c 0,0 0.2534497,0.5323027 1.6195791,-0.2126538 C 9.2126105,5.0708821 11.67437,4.0095 14.785441,5.5382202 17.009904,6.7924 17.27733,10.360371 13.864368,13.369134 c -1.679464,1.609494 -1.887868,4.226006 -1.825254,4.993295 -0.128246,1.561168 0.259655,1.837265 0.594912,1.938246 0.335257,0.100981 1.461445,-0.04379 1.305934,-1.000087 -0.193265,-1.461227 -0.06192,-2.413209 0.855267,-4.044829 0.758763,-1.162942 2.123721,-1.871086 3.273016,-4.211889 C 18.840748,9.1444158 18.891207,6.503336 17.479328,4.894053 16.152845,3.3821059 14.670099,2.4131656 12.422552,2.4210559 9.8716741,2.446853 8.13424,2.8374168 6.751418,3.5206351 4.5012489,4.730324 4.2973099,4.8714754 5.2462478,6.4309194 z\"\n     clip-rule=\"evenodd\"\n     sodipodi:nodetypes=\"cccccscccsccc\" />\n<path\n     style=\"fill-rule:evenodd\"\n     inkscape:connector-curvature=\"0\"\n     id=\"path7\"\n     d=\"M 10.393116,10.546893 C 10.179036,9.8582024 9.6418168,9.5037588 9.1268128,9.5037588 c -0.686671,0 -1.6386388,0.1373222 -1.6546508,1.5832442 0,0 0.5308711,2.944458 1.5235151,2.93234 0.364542,-0.004 0.7403587,-0.28287 0.017892,-1.856769 0,0 -0.4395592,-0.974022 -0.1380497,-1.193301 0.5440269,-0.394487 0.5911749,0.418754 0.9156116,1.069105 0.674692,0.328471 1.06244,-0.702948 1.201092,-0.722298 1.026124,-0.142524 -0.130551,1.372622 -0.2386,1.539241 -0.467844,0.515308 -1.3020963,1.251877 -0.614252,1.612091 0.864686,0.205725 1.292561,-0.492065 1.464229,-0.658684 0.2663,-0.37565 0.549622,-0.820112 0.721289,-1.133153 0.877971,-1.468145 0.834305,-2.8722146 -0.558429,-2.9011876 -0.515004,0 -0.814918,0.2302366 -1.373344,0.7725056 z\"\n     clip-rule=\"evenodd\"\n     sodipodi:nodetypes=\"cscccccccccccc\" />\n<path\n     sodipodi:nodetypes=\"cssccsccccssccssc\"\n     style=\"fill-rule:evenodd\"\n     inkscape:connector-curvature=\"0\"\n     id=\"path9\"\n     d=\"m 6.8360046,14.735541 c -0.2526865,-0.134842 -0.341246,-0.148685 -0.556785,-0.125105 -0.4758127,0.05205 -0.712045,0.475393 -0.6165306,0.901178 0.2727696,1.215955 1.0359093,1.641989 2.25985,2.132257 1.2530682,0.41756 2.475738,0.396638 3.398493,-0.0757 0.298412,-0.05064 0.287556,-0.683612 0.292618,-1.034981 0.006,-0.414484 -0.327129,-0.528727 -0.651454,-0.493243 -0.82369,0.222079 -0.891361,0.338578 -1.882259,0.248554 -1.1996954,-0.369888 -1.6284239,-0.589257 -2.2439324,-1.55296 z m -0.596727,2.884244 c -0.1641271,-0.121 -0.2921232,-0.08347 -0.442594,-0.06701 -0.3893935,0.0426 -0.727761,0.382603 -0.6463412,0.81143 0.2795655,1.472433 3.2776659,2.179707 4.6014193,2.113323 1.0831623,-0.05044 1.6865703,-0.273231 1.7646093,-1.16247 -0.03364,-0.366114 -0.266964,-0.659232 -0.720411,-0.609623 -0.432095,0.04727 -0.373883,0.118182 -1.0438868,0.191485 C 8.563559,19.026954 7.5842504,18.723225 6.2392776,17.619785 z\"\n     clip-rule=\"evenodd\" />\n"}),define("text!templates/svg/xmpp.html",[],function(){return"<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 17.765357,5.9248618 c 0.009,0.1518861 -0.206601,0.1119764 -0.206601,0.2652514 0,4.4595198 -5.17314,11.2012628 -10.3933633,12.5152538 v 0.136731 C 14.101125,18.204712 21.825325,11.114777 22,4.2839629 l -4.233831,1.6413619 z\"\n     id=\"path4-5\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 15.907561,6.3610856 c 0.009,0.1518861 0.014,0.3045804 0.014,0.4578554 0,4.459522 -3.55133,10.468554 -8.7715528,11.783009 v 0.189367 C 13.982554,18.349079 19.389945,11.500913 19.389945,6.1592263 c 0,-0.2747361 -0.01446,-0.5470438 -0.04292,-0.8162264 l -3.439122,1.017508 z\"\n     id=\"path6\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 6.2332547,5.9248618 c -0.00886,0.1518861 0.2067174,0.1119764 0.2067174,0.2652514 0,4.4595198 5.3857609,11.2631498 10.6063279,12.5777208 V 18.95743 C 10.11103,18.318886 2.1746761,11.11443 2,4.2836157 l 4.2337177,1.6413618 z\"\n     id=\"path8\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"M 8.3307389,6.473525 C 8.3219828,6.6254111 8.31686,6.7777591 8.31686,6.9312646 c 0,4.4595214 3.551213,10.4685544 8.771549,11.7830104 v 0.189596 C 10.258286,18.581129 4.8484667,11.613351 4.8484667,6.2717814 c 0,-0.2747361 0.014805,-0.5470427 0.042915,-0.8162284 l 3.4391228,1.0177415 z\"\n     id=\"path10\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 4.8583007,5.3920472 0.8811221,0.3148763 c -0.00473,0.111283 -0.00765,0.2607395 -0.00765,0.3730642 0,4.7681513 4.3114542,11.3600893 10.0954942,12.3914783 0.375377,0.125857 0.871982,0.240263 1.264595,0.339052 V 19 C 9.5433961,18.356828 4.2400023,10.686651 4.857725,5.3915852 z\"\n     id=\"path12\" />\n<path\n     inkscape:connector-curvature=\"0\"\n     d=\"m 19.390639,5.2968432 -0.906108,0.3036565 c 0.0047,0.1113977 0.02208,0.2548387 0.02208,0.3670476 0,4.7681497 -4.311569,11.3602047 -10.0957226,12.3914777 -0.3751445,0.125972 -0.8719856,0.240267 -1.2643666,0.33917 v 0.189596 C 15.052467,17.886018 20.00767,10.591448 19.389946,5.2967275 z\"\n     id=\"path14\" />\n"}),define("text!templates/svg/ic-at.html",[],function(){return"<path fill=\"#9E9E9E\" d=\"M12,15C12.81,15 13.5,14.7 14.11,14.11C14.7,13.5 15,12.81 15,12C15,11.19 14.7,10.5 14.11,9.89C13.5,9.3 12.81,9 12,9C11.19,9 10.5,9.3 9.89,9.89C9.3,10.5 9,11.19 9,12C9,12.81 9.3,13.5 9.89,14.11C10.5,14.7 11.19,15 12,15M12,2C14.75,2 17.1,3 19.05,4.95C21,6.9 22,9.25 22,12V13.45C22,14.45 21.65,15.3 21,16C20.3,16.67 19.5,17 18.5,17C17.3,17 16.31,16.5 15.56,15.5C14.56,16.5 13.38,17 12,17C10.63,17 9.45,16.5 8.46,15.54C7.5,14.55 7,13.38 7,12C7,10.63 7.5,9.45 8.46,8.46C9.45,7.5 10.63,7 12,7C13.38,7 14.55,7.5 15.54,8.46C16.5,9.45 17,10.63 17,12V13.45C17,13.86 17.16,14.22 17.46,14.53C17.76,14.84 18.11,15 18.5,15C18.92,15 19.27,14.84 19.57,14.53C19.87,14.22 20,13.86 20,13.45V12C20,9.81 19.23,7.93 17.65,6.35C16.07,4.77 14.19,4 12,4C9.81,4 7.93,4.77 6.35,6.35C4.77,7.93 4,9.81 4,12C4,14.19 4.77,16.07 6.35,17.65C7.93,19.23 9.81,20 12,20H17V22H12C9.25,22 6.9,21 4.95,19.05C3,17.1 2,14.75 2,12C2,9.25 3,6.9 4.95,4.95C6.9,3 9.25,2 12,2Z\" />"}),define("text!templates/svg/ic-searching.html",[],function(){return"<path fill=\"#9E9E9E\" d=\"M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M19.35,8.03C21.95,8.22 24,10.36 24,13C24,14.64 23.21,16.1 22,17V16.5A6.5,6.5 0 0,0 15.5,10A6.5,6.5 0 0,0 9,16.5C9,17 9.06,17.5 9.17,18H6A6,6 0 0,1 0,12C0,8.9 2.34,6.36 5.35,6.03C6.6,3.64 9.11,2 12,2C15.64,2 18.67,4.59 19.35,8.03Z\" />"}),define("text!templates/svg/ic-invitation-chat.html",[],function(){return"<g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <circle fill=\"#4a8e3d\" cx=\"9\" cy=\"9\" r=\"7\"/>\n    <path d=\"M5.8,6 L12.2,6 C12.64,6 13,6.33981818 13,6.76363636 L13,11.2363636 C13,11.6581084 12.6418278,12 12.2,12 L5.8,12 C5.3581722,12 5,11.6581084 5,11.2363636 L5,6.76363636 C5,6.33981818 5.356,6 5.8,6 Z M5.57142857,6.81818182 L5.57142857,7.90909091 L9,10.0909091 L12.4285714,7.90909091 L12.4285714,6.81818182 L9,9 L5.57142857,6.81818182 Z\" id=\"Icon-Shape\" fill=\"#FFFFFF\" fill-rule=\"nonzero\"/>\n</g>"}),define("text!templates/svg/ic-group-chat.html",[],function(){return"<defs>\n    <path d=\"M11.500501,9 C12.3287776,9 12.995,8.328 12.995,7.5 C12.995,6.672 12.3287776,6 11.500501,6 C10.6722244,6 10,6.672 10,7.5 C10,8.328 10.6722244,9 11.500501,9 Z M7.5,8 C8.33,8 8.995,7.33 8.995,6.5 C8.995,5.67 8.33,5 7.5,5 C6.67,5 6,5.67 6,6.5 C6,7.33 6.67,8 7.5,8 Z M11.5,10 C10.6681818,10 9,10.46 9,11.375 L9,11.9989178 L14,11.9989178 L14,11.375 C14,10.46 12.3318182,10 11.5,10 Z M7.50474946,8.99186821 C5.77490105,8.99186821 4,9.585 4,10.75 L4,12 L8,12 L8,11 C8,10.2484187 8.73828683,9.72461975 9.70884076,9.35916117 C9.08932051,9.04219075 7.85693708,8.99186821 7.50474946,8.99186821 Z\" id=\"path-1\"/>\n</defs>\n<g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <circle fill=\"#4a8e3d\" cx=\"9\" cy=\"9\" r=\"7\"/>\n    <mask fill=\"white\">\n        <use xlink:href=\"#path-1\"/>\n    </mask>\n    <use fill=\"#FFFFFF\" xlink:href=\"#path-1\"/>\n</g>"}),define("text!templates/svg/ic-incognito-chat.html",[],function(){return"<g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <circle fill=\"#4a8e3d\" cx=\"9\" cy=\"9\" r=\"7\"/>\n    <g transform=\"translate(1.000000, 1.000000)\">\n        <rect x=\"0\" y=\"0\" width=\"16\" height=\"16\"/>\n        <path d=\"M6.50474946,7.99186821 C6.85693708,7.99186821 8.08932051,8.04219075 8.70884076,8.35916117 C7.73828683,8.72461975 7,9.24841871 7,10 L7,10 L7,11 L3,11 L3,9.75 C3,8.585 4.77490105,7.99186821 6.50474946,7.99186821 Z M10.5,9 C11.3318182,9 13,9.46 13,10.375 L13,10.375 L13,10.9989178 L8,10.9989178 L8,10.375 C8,9.46 9.66818182,9 10.5,9 Z M9.5,5.88 C9.84241654,5.88 10.12,6.15758346 10.12,6.5 C10.12,6.84241654 9.84241654,7.12 9.5,7.12 C9.15758346,7.12 8.88,6.84241654 8.88,6.5 C8.88,6.15758346 9.15758346,5.88 9.5,5.88 Z M11.5,5.88 C11.8424165,5.88 12.12,6.15758346 12.12,6.5 C12.12,6.84241654 11.8424165,7.12 11.5,7.12 C11.1575835,7.12 10.88,6.84241654 10.88,6.5 C10.88,6.15758346 11.1575835,5.88 11.5,5.88 Z M5.5,4.88 C5.84241654,4.88 6.12,5.15758346 6.12,5.5 C6.12,5.84241654 5.84241654,6.12 5.5,6.12 C5.15758346,6.12 4.88,5.84241654 4.88,5.5 C4.88,5.15758346 5.15758346,4.88 5.5,4.88 Z M7.5,4.88 C7.84241654,4.88 8.12,5.15758346 8.12,5.5 C8.12,5.84241654 7.84241654,6.12 7.5,6.12 C7.15758346,6.12 6.88,5.84241654 6.88,5.5 C6.88,5.15758346 7.15758346,4.88 7.5,4.88 Z\" id=\"Incognito\" fill=\"#FFFFFF\" fill-rule=\"nonzero\"/>\n    </g>\n</g>"}),define("text!templates/svg/ic-bot-chat.html",[],function(){return"<g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <circle fill=\"#4a8e3d\" cx=\"9\" cy=\"9\" r=\"7\"/>\n    <path d=\"M9,4 C11.1421954,4 12.8910789,5.68396847 12.9951047,7.80035966 L13,8 L13,11 C13,12.6568542 11.209139,14 9,14 C6.86449897,14 5.11985549,12.7449049 5.0059187,11.1646016 L5,11 L5,8 L5.00489531,7.80035966 C5.10892112,5.68396847 6.85780461,4 9,4 Z M3.75,7 C4.16421356,7 4.5,7.33578644 4.5,7.75 L4.5,10.25 C4.5,10.6642136 4.16421356,11 3.75,11 C3.33578644,11 3,10.6642136 3,10.25 L3,7.75 C3,7.33578644 3.33578644,7 3.75,7 Z M14.25,7 C14.6642136,7 15,7.33578644 15,7.75 L15,10.25 C15,10.6642136 14.6642136,11 14.25,11 C13.8357864,11 13.5,10.6642136 13.5,10.25 L13.5,7.75 C13.5,7.33578644 13.8357864,7 14.25,7 Z M9,5.5 C7.72974508,5.5 6.68075921,6.44736547 6.52105111,7.67408771 L6.50531768,7.83562431 L6.5,8 L6.5,9 C6.5,9.82842712 7.61928813,10.5 9,10.5 C10.3179522,10.5 11.3977064,9.88809166 11.4931428,9.11194676 L11.5,9 L11.5,8 L11.4946823,7.83562431 C11.4100387,6.53153594 10.3254834,5.5 9,5.5 Z\" id=\"Bot\" fill=\"#FFFFFF\" fill-rule=\"nonzero\"/>\n</g>\n"}),define("text!templates/svg/ic-private-chat.html",[],function(){return"<g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <circle fill=\"#4a8e3d\" cx=\"9\" cy=\"9\" r=\"7\"/>\n    <g transform=\"translate(1.000000, 1.000000)\">\n        <rect x=\"0\" y=\"0\" width=\"16\" height=\"16\"/>\n        <path d=\"M10.45296,9.00001406 C11.2484973,9.00015914 11.9605655,9.50273575 12.2400509,10.2613541 C12.5195363,11.0199725 12.3078467,11.8755937 11.7087696,12.4087226 C11.1096925,12.9418515 10.2488201,13.0407214 9.5482222,12.6568582 C8.84762429,12.272995 8.45417618,11.4868729 8.56077817,10.683913 C8.38677817,10.6450242 8.19859635,10.6155798 7.99841453,10.6144687 C7.79823271,10.6139132 7.61005089,10.6450242 7.43605089,10.683913 C7.54265288,11.4868729 7.14920477,12.272995 6.44860686,12.6568582 C5.74800895,13.0407214 4.88713659,12.9418515 4.28805949,12.4087226 C3.68898239,11.8755937 3.4772928,11.0199725 3.75677818,10.2613541 C4.03626356,9.50273575 4.74833179,9.00015914 5.54386908,9.00001406 C6.32349136,8.99699984 7.02602967,9.47872777 7.31659635,10.2155808 C7.49059635,10.1616921 7.69841453,10.1111366 7.99841453,10.1111366 C8.22964016,10.109582 8.45968538,10.1448214 8.68023271,10.2155808 C8.97079939,9.47872777 9.6733377,8.99699984 10.45296,9.00001406 Z M5.54386908,9.55558244 C4.79075351,9.55558244 4.18023271,10.1774076 4.18023271,10.9444679 C4.18023271,11.7115282 4.79075351,12.3333534 5.54386908,12.3333534 C6.29698464,12.3333534 6.90750544,11.7115282 6.90750544,10.9444679 C6.90750544,10.1774076 6.29698464,9.55558244 5.54386908,9.55558244 Z M10.45296,9.55558244 C9.69984442,9.55558244 9.08932362,10.1774076 9.08932362,10.9444679 C9.08932362,11.7115282 9.69984442,12.3333534 10.45296,12.3333534 C11.2060756,12.3333534 11.8165963,11.7115282 11.8165963,10.9444679 C11.8165963,10.1774076 11.2060756,9.55558244 10.45296,9.55558244 Z M8,7 C9.54036364,7 11.7330909,7.297 11.7330909,7.297 C12.2062901,7.40997808 12.6727414,7.54549536 13.1305455,7.703 C13.6858182,7.877 14,8 14,8 L14,8 L2,8 C2,8 2.31418182,7.877 2.86945455,7.703 C3.32163107,7.54577794 3.78243762,7.41026088 4.25,7.297 C4.39345455,7.268 6.512,7 8,7 Z M8,3 C9.46836364,3.001 10.5058182,3.6095 10.5058182,3.6095 L10.5058182,3.6095 L11.2727273,6 L4.72727273,6 L5.49418182,3.6095 C5.49418182,3.6095 6.53163636,3.0015 8,3 Z\" id=\"Private\" fill=\"#FFFFFF\" fill-rule=\"nonzero\"/>\n    </g>\n</g>"}),define("text!templates/svg/ic-group-contact.html",[],function(){return"<defs>\n    <path d=\"M11.500501,9 C12.3287776,9 12.995,8.328 12.995,7.5 C12.995,6.672 12.3287776,6 11.500501,6 C10.6722244,6 10,6.672 10,7.5 C10,8.328 10.6722244,9 11.500501,9 Z M7.5,8 C8.33,8 8.995,7.33 8.995,6.5 C8.995,5.67 8.33,5 7.5,5 C6.67,5 6,5.67 6,6.5 C6,7.33 6.67,8 7.5,8 Z M11.5,10 C10.6681818,10 9,10.46 9,11.375 L9,11.9989178 L14,11.9989178 L14,11.375 C14,10.46 12.3318182,10 11.5,10 Z M7.50474946,8.99186821 C5.77490105,8.99186821 4,9.585 4,10.75 L4,12 L8,12 L8,11 C8,10.2484187 8.73828683,9.72461975 9.70884076,9.35916117 C9.08932051,9.04219075 7.85693708,8.99186821 7.50474946,8.99186821 Z\" id=\"path-1\"/>\n</defs>\n<g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <circle fill=\"#4a8e3d\" cx=\"9\" cy=\"9\" r=\"8\"/>\n    <g>\n        <circle fill=\"transparent\" cx=\"9\" cy=\"9\" r=\"7\"/>\n        <mask id=\"mask-2\" fill=\"white\">\n            <use xlink:href=\"#path-1\"/>\n        </mask>\n        <use id=\"Shape\" fill=\"#FFFFFF\" xlink:href=\"#path-1\"/>\n    </g>\n</g>\n"}),define("text!templates/svg/ic-blocked.html",[],function(){return"<path fill=\"#d32f2f\" d=\"M 9 2 C 12.866 2 16 5.134 16 9 C 16 12.866 12.866 16 9 16 C 5.134 16 2 12.866 2 9 C 2 5.134 5.134 2 9 2 Z M 13.357 5.644 L 5.644 13.357 C 6.572 14.074 7.736 14.5 9 14.5 C 12.038 14.5 14.5 12.038 14.5 9 C 14.5 7.736 14.074 6.572 13.357 5.644 Z M 9 3.5 C 5.962 3.5 3.5 5.962 3.5 9 C 3.5 10.264 3.926 11.429 4.643 12.357 L 12.357 4.643 C 11.429 3.926 10.264 3.5 9 3.5 Z\" stroke=\"#00000000\" stroke-width=\"1\" fill-rule=\"evenodd\"/>\n"}),define("text!templates/svg/ic-incognito-contact.html",[],function(){return"<g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <circle fill=\"#4a8e3d\" fill-rule=\"nonzero\" cx=\"9\" cy=\"9\" r=\"8\"/>\n    <g>\n        <circle fill=\"transparent\" fill-rule=\"nonzero\" cx=\"9\" cy=\"9\" r=\"7\"/>\n        <g transform=\"translate(1.000000, 1.000000)\">\n            <rect x=\"0\" y=\"0\" width=\"16\" height=\"16\"/>\n            <path d=\"M6.50474946,7.99186821 C6.85693708,7.99186821 8.08932051,8.04219075 8.70884076,8.35916117 C7.73828683,8.72461975 7,9.24841871 7,10 L7,10 L7,11 L3,11 L3,9.75 C3,8.585 4.77490105,7.99186821 6.50474946,7.99186821 Z M10.5,9 C11.3318182,9 13,9.46 13,10.375 L13,10.375 L13,10.9989178 L8,10.9989178 L8,10.375 C8,9.46 9.66818182,9 10.5,9 Z M9.5,5.88 C9.84241654,5.88 10.12,6.15758346 10.12,6.5 C10.12,6.84241654 9.84241654,7.12 9.5,7.12 C9.15758346,7.12 8.88,6.84241654 8.88,6.5 C8.88,6.15758346 9.15758346,5.88 9.5,5.88 Z M11.5,5.88 C11.8424165,5.88 12.12,6.15758346 12.12,6.5 C12.12,6.84241654 11.8424165,7.12 11.5,7.12 C11.1575835,7.12 10.88,6.84241654 10.88,6.5 C10.88,6.15758346 11.1575835,5.88 11.5,5.88 Z M5.5,4.88 C5.84241654,4.88 6.12,5.15758346 6.12,5.5 C6.12,5.84241654 5.84241654,6.12 5.5,6.12 C5.15758346,6.12 4.88,5.84241654 4.88,5.5 C4.88,5.15758346 5.15758346,4.88 5.5,4.88 Z M7.5,4.88 C7.84241654,4.88 8.12,5.15758346 8.12,5.5 C8.12,5.84241654 7.84241654,6.12 7.5,6.12 C7.15758346,6.12 6.88,5.84241654 6.88,5.5 C6.88,5.15758346 7.15758346,4.88 7.5,4.88 Z\" id=\"Incognito\" fill=\"#FFFFFF\" fill-rule=\"nonzero\"/>\n        </g>\n    </g>\n</g>"}),define("text!templates/svg/ic-bot-contact.html",[],function(){return"<g id=\"Badge/Bot/Circle16\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <circle fill=\"#4a8e3d\" cx=\"9\" cy=\"9\" r=\"8\"/>\n    <g>\n        <circle fill=\"transparent\" cx=\"9\" cy=\"9\" r=\"7\"/>\n        <path d=\"M9,4 C11.1421954,4 12.8910789,5.68396847 12.9951047,7.80035966 L13,8 L13,11 C13,12.6568542 11.209139,14 9,14 C6.86449897,14 5.11985549,12.7449049 5.0059187,11.1646016 L5,11 L5,8 L5.00489531,7.80035966 C5.10892112,5.68396847 6.85780461,4 9,4 Z M3.75,7 C4.16421356,7 4.5,7.33578644 4.5,7.75 L4.5,10.25 C4.5,10.6642136 4.16421356,11 3.75,11 C3.33578644,11 3,10.6642136 3,10.25 L3,7.75 C3,7.33578644 3.33578644,7 3.75,7 Z M14.25,7 C14.6642136,7 15,7.33578644 15,7.75 L15,10.25 C15,10.6642136 14.6642136,11 14.25,11 C13.8357864,11 13.5,10.6642136 13.5,10.25 L13.5,7.75 C13.5,7.33578644 13.8357864,7 14.25,7 Z M9,5.5 C7.72974508,5.5 6.68075921,6.44736547 6.52105111,7.67408771 L6.50531768,7.83562431 L6.5,8 L6.5,9 C6.5,9.82842712 7.61928813,10.5 9,10.5 C10.3179522,10.5 11.3977064,9.88809166 11.4931428,9.11194676 L11.5,9 L11.5,8 L11.4946823,7.83562431 C11.4100387,6.53153594 10.3254834,5.5 9,5.5 Z\" id=\"Bot\" fill=\"#FFFFFF\"/>\n    </g>\n</g>\n"}),define("text!templates/svg/ic-private-contact.html",[],function(){return"<g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <circle fill=\"#4a8e3d\" cx=\"9\" cy=\"9\" r=\"8\"/>\n    <g>\n        <circle fill=\"#000000\" cx=\"9\" cy=\"9\" r=\"7\"/>\n        <g transform=\"translate(1.000000, 1.000000)\">\n            <rect x=\"0\" y=\"0\" width=\"16\" height=\"16\"/>\n            <path d=\"M10.45296,9.00001406 C11.2484973,9.00015914 11.9605655,9.50273575 12.2400509,10.2613541 C12.5195363,11.0199725 12.3078467,11.8755937 11.7087696,12.4087226 C11.1096925,12.9418515 10.2488201,13.0407214 9.5482222,12.6568582 C8.84762429,12.272995 8.45417618,11.4868729 8.56077817,10.683913 C8.38677817,10.6450242 8.19859635,10.6155798 7.99841453,10.6144687 C7.79823271,10.6139132 7.61005089,10.6450242 7.43605089,10.683913 C7.54265288,11.4868729 7.14920477,12.272995 6.44860686,12.6568582 C5.74800895,13.0407214 4.88713659,12.9418515 4.28805949,12.4087226 C3.68898239,11.8755937 3.4772928,11.0199725 3.75677818,10.2613541 C4.03626356,9.50273575 4.74833179,9.00015914 5.54386908,9.00001406 C6.32349136,8.99699984 7.02602967,9.47872777 7.31659635,10.2155808 C7.49059635,10.1616921 7.69841453,10.1111366 7.99841453,10.1111366 C8.22964016,10.109582 8.45968538,10.1448214 8.68023271,10.2155808 C8.97079939,9.47872777 9.6733377,8.99699984 10.45296,9.00001406 Z M5.54386908,9.55558244 C4.79075351,9.55558244 4.18023271,10.1774076 4.18023271,10.9444679 C4.18023271,11.7115282 4.79075351,12.3333534 5.54386908,12.3333534 C6.29698464,12.3333534 6.90750544,11.7115282 6.90750544,10.9444679 C6.90750544,10.1774076 6.29698464,9.55558244 5.54386908,9.55558244 Z M10.45296,9.55558244 C9.69984442,9.55558244 9.08932362,10.1774076 9.08932362,10.9444679 C9.08932362,11.7115282 9.69984442,12.3333534 10.45296,12.3333534 C11.2060756,12.3333534 11.8165963,11.7115282 11.8165963,10.9444679 C11.8165963,10.1774076 11.2060756,9.55558244 10.45296,9.55558244 Z M8,7 C9.54036364,7 11.7330909,7.297 11.7330909,7.297 C12.2062901,7.40997808 12.6727414,7.54549536 13.1305455,7.703 C13.6858182,7.877 14,8 14,8 L14,8 L2,8 C2,8 2.31418182,7.877 2.86945455,7.703 C3.32163107,7.54577794 3.78243762,7.41026088 4.25,7.297 C4.39345455,7.268 6.512,7 8,7 Z M8,3 C9.46836364,3.001 10.5058182,3.6095 10.5058182,3.6095 L10.5058182,3.6095 L11.2727273,6 L4.72727273,6 L5.49418182,3.6095 C5.49418182,3.6095 6.53163636,3.0015 8,3 Z\" id=\"Private\" fill=\"#FFFFFF\" fill-rule=\"nonzero\"/>\n        </g>\n    </g>\n</g>"}),define("text!templates/svg/volume-off-variant.html",[],function(){return"<g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <g id=\"Mobile-Portrait\" transform=\"translate(-41.000000, -4.000000)\">\n        <g id=\"volume-off-variant\" transform=\"translate(34.000000, 0.000000)\">\n            <rect id=\"Bounds\" x=\"0\" y=\"0\" width=\"24\" height=\"24\"></rect>\n            <polygon id=\"Path-2\" points=\"7 9 7 15 11 15 16 20 16 16.5 8.5 9\"></polygon>\n            <polygon id=\"Path-3\" points=\"7 6 18.5 17.5 19.5 16.5 16 13 16 4 11.5 8.5 8 5\"></polygon>\n        </g>\n    </g>\n</g>\n"}),define("text!templates/svg/message-group.html",[],function(){return"<g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <g id=\"message-group-variant2\" fill=\"#000000\">\n        <path d=\"M14.2526206,6 L21.4947588,6 C22.3260806,6 23,6.6752491 23,7.49824524 L23,24 L19,20 L8.50524116,20 C7.67391942,20 7,19.3247509 7,18.5017548 L7,17 L17.0005775,17 C18.6556493,17 20,15.6542582 20,13.9942017 L20,6 L14.2526206,6 Z\" id=\"Message2\"></path>\n        <path d=\"M1,2.49824524 C1,1.67078724 1.66642015,1 2.50863659,1 L16.4913634,1 C17.3245604,1 18,1.6752491 18,2.49824524 L18,13.5017548 C18,14.3292128 17.3335799,15 16.4913634,15 L5,15 L1,19 L1,2.49824524 Z M4,10 L4,12 L12,12 L12,10 L4,10 Z M4,7 L4,9 L15,9 L15,7 L4,7 Z M4,4 L4,6 L15,6 L15,4 L4,4 Z\" id=\"Combined-Shape\"></path>\n    </g>\n</g>\n"}),define("text!templates/svg/xabber-offline.html",[],function(){return"<g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <g id=\"Xabber-Offline\" fill=\"#000000\">\n        <path d=\"M13.4146471,22.5 L14.009222,22.5 C14.5490248,22.5 15,22.0522847 15,21.5 C15,20.9438648 14.5564136,20.5 14.009222,20.5 L9.99077797,20.5 C9.45097518,20.5 9,20.9477153 9,21.5 C9,22.0561352 9.44358641,22.5 9.99077797,22.5 L10.5853529,22.5 C10.7912711,23.0825962 11.3468906,23.5 12,23.5 C12.6531094,23.5 13.2087289,23.0825962 13.4146471,22.5 Z\" id=\"Base\"></path>\n        <rect id=\"Middle-base\" x=\"8\" y=\"17.75\" width=\"8\" height=\"2\" rx=\"1\"></rect>\n        <path d=\"M17.5099945,14.8015103 L17.5099945,14.8015103 C17.1966102,15.1049344 17.0013821,15.5296633 17,16 C17,16.5522847 16.5443356,17 16.0046024,17 L7.99539757,17 C7.44565467,17 7,16.5561352 6.99998649,16 C6.99861167,15.5296664 6.80338616,15.10494 6.49000549,14.8015163 L6.49000549,14.8000192 C4.95622884,13.3424727 4,11.282906 4,9 C4,4.581722 7.581722,1 12,1 C16.418278,1 20,4.581722 20,9 C20,11.282906 19.0437712,13.3424727 17.5099945,14.8000192 L17.5099945,14.8015103 Z M8.86088543,15 L15.1391084,15 C15.3021338,14.4253123 15.6014858,13.895093 16,13.472213 C17.2274987,12.3735719 18,10.7769996 18,9 C18,5.6862915 15.3137085,3 12,3 C8.6862915,3 6,5.6862915 6,9 C6,10.7769996 6.77250128,12.3735719 8,13.472213 C8.39851111,13.8950917 8.69786083,14.4253152 8.86088543,15 Z\" id=\"Bulb-shape\"></path>\n    </g>\n</g>\n"}),define("text!templates/svg/xabber-online.html",[],function(){return"<g id=\"Page-1\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n    <g id=\"Xabber-Online\" fill=\"#000000\">\n        <path d=\"M13.4146471,22.5 L14.009222,22.5 C14.5490248,22.5 15,22.0522847 15,21.5 C15,20.9438648 14.5564136,20.5 14.009222,20.5 L9.99077797,20.5 C9.45097518,20.5 9,20.9477153 9,21.5 C9,22.0561352 9.44358641,22.5 9.99077797,22.5 L10.5853529,22.5 C10.7912711,23.0825962 11.3468906,23.5 12,23.5 C12.6531094,23.5 13.2087289,23.0825962 13.4146471,22.5 Z\" id=\"Base\"></path>\n        <rect id=\"Middle-base\" x=\"8\" y=\"17.75\" width=\"8\" height=\"2\" rx=\"1\"></rect>\n        <path d=\"M17.5099945,14.8015103 L17.5099945,14.8000192 C19.0437712,13.3424727 20,11.282906 20,9 C20,4.581722 16.418278,1 12,1 C7.581722,1 4,4.581722 4,9 C4,11.282906 4.95622884,13.3424727 6.49000549,14.8000192 L6.49000549,14.8015163 C6.80338616,15.10494 6.99861167,15.5296664 6.99998649,16 C7,16.5561352 7.44565467,17 7.99539757,17 L16.0046024,17 C16.5443356,17 17,16.5522847 17,16 C17.0013821,15.5296633 17.1966102,15.1049344 17.5099945,14.8015103 L17.5099945,14.8015103 Z\" id=\"Bulb-shape\"></path>\n    </g>\n</g>\n"}),define("xabber-templates",["underscore","jquery","text!templates/base/dialog.html","text!templates/base/jingle_message_calling.html","text!templates/base/input_widget.html","text!templates/base/toolbar.html","text!templates/base/settings.html","text!templates/base/about.html","text!templates/api_service/xabber_login.html","text!templates/api_service/xabber_login_by_email.html","text!templates/api_service/xabber_account.html","text!templates/api_service/linked_email_item.html","text!templates/api_service/add_xabber_account.html","text!templates/api_service/sync_settings.html","text!templates/api_service/sync_settings_account_item.html","text!templates/accounts/xmpp_login.html","text!templates/accounts/add_account.html","text!templates/accounts/change_password.html","text!templates/accounts/toolbar_item.html","text!templates/accounts/settings_left.html","text!templates/accounts/settings_right.html","text!templates/accounts/existing_groupchat_item.html","text!templates/accounts/resource.html","text!templates/accounts/global_settings_item.html","text!templates/accounts/change_status.html","text!templates/accounts/token_item.html","text!templates/accounts/current_token_item.html","text!templates/vcard/vcard.html","text!templates/vcard/vcard_edit.html","text!templates/searching/searching_wide.html","text!templates/searching/searching_account_item.html","text!templates/searching/existing_groupchat_item.html","text!templates/searching/existing_groupchat_details_view.html","text!templates/contacts/roster_right.html","text!templates/contacts/roster_left.html","text!templates/contacts/account_roster_right.html","text!templates/contacts/account_roster_left.html","text!templates/contacts/roster_left.html","text!templates/contacts/group_right.html","text!templates/contacts/group_left.html","text!templates/contacts/add_contact.html","text!templates/contacts/contact_right_item.html","text!templates/contacts/contact_left_item.html","text!templates/contacts/contact_blocked_item.html","text!templates/contacts/contact_details.html","text!templates/contacts/roster_settings.html","text!templates/contacts/group_settings.html","text!templates/contacts/groups_checkbox_list.html","text!templates/contacts/add_contact_account_item.html","text!templates/contacts/contact_placeholder.html","text!templates/contacts/groups.html","text!templates/contacts/preloader.html","text!templates/contacts/group_chats/group_chat_properties.html","text!templates/contacts/group_chats/group_chat_details.html","text!templates/contacts/group_chats/invitation.html","text!templates/contacts/group_chats/group_chat_properties_edit.html","text!templates/contacts/group_chats/default_restrictions.html","text!templates/contacts/group_chats/group_member_item.html","text!templates/contacts/group_chats/invited_member_item.html","text!templates/contacts/group_chats/participant_rights.html","text!templates/contacts/group_chats/restriction_item.html","text!templates/contacts/group_chats/right_expire_variants.html","text!templates/contacts/group_chats/pinned_message.html","text!templates/contacts/group_chats/participant_details_item.html","text!templates/contacts/group_chats/participant_placeholder.html","text!templates/contacts/group_chats/participants.html","text!templates/contacts/group_chats/badge_edit_view.html","text!templates/contacts/group_chats/private_participant_details.html","text!templates/contacts/group_chats/set_status.html","text!templates/contacts/group_chats/status_item.html","text!templates/contacts/group_chats/group_status.html","text!templates/chats/chats_panel.html","text!templates/chats/add_chat_account_item.html","text!templates/chats/chat_item.html","text!templates/chats/chat_head.html","text!templates/chats/chat_content.html","text!templates/chats/chat_bottom.html","text!templates/chats/subscription_buttons.html","text!templates/chats/forward_panel.html","text!templates/chats/chat_placeholder.html","text!templates/chats/message_item.html","text!templates/chats/messages/main.html","text!templates/chats/messages/forwarded.html","text!templates/chats/messages/system.html","text!templates/chats/messages/file_upload.html","text!templates/chats/messages/file.html","text!templates/chats/messages/audio_file.html","text!templates/chats/messages/audio_file_waveform.html","text!templates/chats/messages/auth_request.html","text!templates/chats/messages/group_request.html","text!templates/chats/messages/template-for-2.html","text!templates/chats/messages/template-for-3.html","text!templates/chats/messages/template-for-4.html","text!templates/chats/messages/template-for-5.html","text!templates/chats/messages/template-for-6.html","text!templates/chats/archive_placeholder.html","text!templates/chats/group_chats/pinned_message_panel.html","text!templates/chats/group_chats/add_group_chat.html","text!templates/chats/group_chats/invitation_panel_view.html","text!templates/chats/group_chats/mention_item.html","text!templates/mentions/mentions_panel.html","text!templates/mentions/mentions_placeholder.html","text!templates/mentions/mention_item.html","text!templates/svg/ic-jabber.html","text!templates/svg/xmpp.html","text!templates/svg/ic-at.html","text!templates/svg/ic-searching.html","text!templates/svg/ic-invitation-chat.html","text!templates/svg/ic-group-chat.html","text!templates/svg/ic-incognito-chat.html","text!templates/svg/ic-bot-chat.html","text!templates/svg/ic-private-chat.html","text!templates/svg/ic-group-contact.html","text!templates/svg/ic-blocked.html","text!templates/svg/ic-incognito-contact.html","text!templates/svg/ic-bot-contact.html","text!templates/svg/ic-private-contact.html","text!templates/svg/volume-off-variant.html","text!templates/svg/message-group.html","text!templates/svg/xabber-offline.html","text!templates/svg/xabber-online.html"],function(e,t){e.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g};var a={},i=function(e){var i=t("<div/>").html(e);return i.find(".mdi-svg-template").each(function(){var e=t(this),i=e.data("svgname");e.removeClass("mdi-svg-template").addClass("mdi-"+i).attr("data-svgname",null),e.html(a.svg[i]())}),i.html()},n=function(t,n){n||(n={});var s=t.split("."),o=e.template(require("text!templates/"+s.join("/")+".html")),d=s.pop(),c=a;e.each(s,function(e){c[e]||(c[e]={}),c=c[e]}),c[d]=n.is_svg?o:function(e){return i(o(e))}},s=function(e){n(e,{is_svg:!1})},o=function(e){n(e,{is_svg:!0})};return s("base.dialog"),s("base.jingle_message_calling"),s("base.input_widget"),s("base.toolbar"),s("base.settings"),s("base.about"),s("api_service.xabber_login"),s("api_service.xabber_login_by_email"),s("api_service.add_xabber_account"),s("api_service.xabber_account"),s("api_service.linked_email_item"),s("api_service.sync_settings"),s("api_service.sync_settings_account_item"),s("accounts.xmpp_login"),s("accounts.add_account"),s("accounts.change_password"),s("accounts.toolbar_item"),s("accounts.settings_left"),s("accounts.settings_right"),s("accounts.existing_groupchat_item"),s("accounts.resource"),s("accounts.global_settings_item"),s("accounts.change_status"),s("accounts.token_item"),s("accounts.current_token_item"),s("vcard.vcard"),s("vcard.vcard_edit"),s("searching.searching_wide"),s("searching.searching_account_item"),s("searching.existing_groupchat_item"),s("searching.existing_groupchat_details_view"),s("contacts.roster_right"),s("contacts.roster_left"),s("contacts.account_roster_right"),s("contacts.account_roster_left"),s("contacts.group_right"),s("contacts.group_left"),s("contacts.add_contact"),s("contacts.contact_right_item"),s("contacts.contact_left_item"),s("contacts.contact_blocked_item"),s("contacts.contact_details"),s("contacts.roster_settings"),s("contacts.group_settings"),s("contacts.groups_checkbox_list"),s("contacts.add_contact_account_item"),s("contacts.contact_placeholder"),s("contacts.groups"),s("contacts.preloader"),s("contacts.group_chats.group_chat_properties"),s("contacts.group_chats.group_chat_details"),s("contacts.group_chats.invitation"),s("contacts.group_chats.group_chat_properties_edit"),s("contacts.group_chats.default_restrictions"),s("contacts.group_chats.group_member_item"),s("contacts.group_chats.invited_member_item"),s("contacts.group_chats.participant_rights"),s("contacts.group_chats.restriction_item"),s("contacts.group_chats.right_expire_variants"),s("contacts.group_chats.pinned_message"),s("contacts.group_chats.participant_details_item"),s("contacts.group_chats.participant_placeholder"),s("contacts.group_chats.participants"),s("contacts.group_chats.badge_edit_view"),s("contacts.group_chats.private_participant_details"),s("contacts.group_chats.set_status"),s("contacts.group_chats.status_item"),s("contacts.group_chats.group_status"),s("chats.chats_panel"),s("chats.add_chat_account_item"),s("chats.chat_item"),s("chats.chat_head"),s("chats.chat_content"),s("chats.chat_bottom"),s("chats.subscription_buttons"),s("chats.forward_panel"),s("chats.chat_placeholder"),s("chats.message_item"),s("chats.messages.main"),s("chats.messages.forwarded"),s("chats.messages.system"),s("chats.messages.file_upload"),s("chats.messages.file"),s("chats.messages.audio_file"),s("chats.messages.audio_file_waveform"),s("chats.messages.auth_request"),s("chats.messages.group_request"),s("chats.messages.template-for-2"),s("chats.messages.template-for-3"),s("chats.messages.template-for-4"),s("chats.messages.template-for-5"),s("chats.messages.template-for-6"),s("chats.archive_placeholder"),s("chats.group_chats.pinned_message_panel"),s("chats.group_chats.add_group_chat"),s("chats.group_chats.invitation_panel_view"),s("chats.group_chats.mention_item"),s("mentions.mentions_panel"),s("mentions.mentions_placeholder"),s("mentions.mention_item"),o("svg.ic-jabber"),o("svg.xmpp"),o("svg.ic-at"),o("svg.ic-searching"),o("svg.ic-invitation-chat"),o("svg.ic-group-chat"),o("svg.ic-incognito-chat"),o("svg.ic-bot-chat"),o("svg.ic-private-chat"),o("svg.ic-group-contact"),o("svg.ic-blocked"),o("svg.ic-incognito-contact"),o("svg.ic-bot-contact"),o("svg.ic-private-contact"),o("svg.volume-off-variant"),o("svg.message-group"),o("svg.xabber-offline"),o("svg.xabber-online"),a}),define("xabber-emoji-utils",["jquery","underscore"],function(e,t){var a=String.prototype,i=String.fromCharCode,n={"smiles and people":[{code:128512,x:9,y:3},{code:128515,x:12,y:3},{code:128516,x:13,y:3},{code:128513,x:10,y:3},{code:128518,x:1,y:4},{code:128517,x:0,y:4},{code:129315,x:6,y:10},{code:128514,x:11,y:3},{code:128578,x:5,y:8},{code:128579,x:6,y:8},{code:128521,x:4,y:4},{code:128522,x:5,y:4},{code:128519,x:2,y:4},{code:128525,x:8,y:4},{code:129321,x:12,y:10},{code:128535,x:4,y:5},{code:9786,x:14,y:5},{code:128538,x:7,y:5},{code:128537,x:6,y:5},{code:128523,x:6,y:4},{code:128539,x:8,y:5},{code:128540,x:9,y:5},{code:129322,x:13,y:10},{code:128541,x:10,y:5},{code:129297,x:10,y:9},{code:129303,x:2,y:10},{code:129325,x:2,y:11},{code:129323,x:0,y:11},{code:129300,x:13,y:9},{code:129296,x:9,y:9},{code:129320,x:11,y:10},{code:128528,x:11,y:4},{code:128529,x:12,y:4},{code:128566,x:7,y:7},{code:128527,x:10,y:4},{code:128530,x:13,y:4},{code:128580,x:7,y:8},{code:128556,x:11,y:6},{code:129317,x:8,y:10},{code:128524,x:7,y:4},{code:128532,x:1,y:5},{code:128554,x:9,y:6},{code:129316,x:7,y:10},{code:128564,x:5,y:7},{code:128567,x:8,y:7},{code:129298,x:11,y:9},{code:129301,x:0,y:10},{code:129314,x:5,y:10},{code:129326,x:3,y:11},{code:129319,x:10,y:10},{code:129397,x:7,y:12},{code:129398,x:8,y:12},{code:129396,x:6,y:12},{code:128565,x:6,y:7},{code:129327,x:4,y:11},{code:129312,x:3,y:10},{code:129395,x:5,y:12},{code:128526,x:9,y:4},{code:129299,x:12,y:9},{code:129488,x:1,y:13},{code:128533,x:2,y:5},{code:128543,x:12,y:5},{code:128577,x:4,y:8},{code:9785,x:14,y:4},{code:128558,x:13,y:6},{code:128559,x:0,y:7},{code:128562,x:3,y:7},{code:128563,x:4,y:7},{code:129402,x:9,y:12},{code:128550,x:5,y:6},{code:128551,x:6,y:6},{code:128552,x:7,y:6},{code:128560,x:1,y:7},{code:128549,x:4,y:6},{code:128546,x:1,y:6},{code:128557,x:12,y:6},{code:128561,x:2,y:7},{code:128534,x:3,y:5},{code:128547,x:2,y:6},{code:128542,x:11,y:5},{code:128531,x:0,y:5},{code:128553,x:8,y:6},{code:128555,x:10,y:6},{code:128548,x:3,y:6},{code:128545,x:0,y:6},{code:128544,x:13,y:5},{code:129324,x:1,y:11},{code:128520,x:3,y:4},{code:128127,x:9,y:2},{code:128128,x:10,y:2},{code:9760,x:14,y:3},{code:128169,x:4,y:3},{code:129313,x:4,y:10},{code:128121,x:3,y:2},{code:128122,x:4,y:2},{code:128123,x:5,y:2},{code:128125,x:7,y:2},{code:128126,x:8,y:2},{code:129302,x:1,y:10},{code:128570,x:11,y:7},{code:128568,x:9,y:7},{code:128569,x:10,y:7},{code:128571,x:12,y:7},{code:128572,x:13,y:7},{code:128573,x:0,y:8},{code:128576,x:3,y:8},{code:128575,x:2,y:8},{code:128574,x:1,y:8},{code:128584,x:11,y:8},{code:128585,x:12,y:8},{code:128586,x:13,y:8},{code:128118,x:0,y:2},{code:129490,x:3,y:13},{code:128102,x:12,y:0},{code:128103,x:13,y:0},{code:128113,x:9,y:1},{code:129492,x:5,y:13},{code:129491,x:4,y:13},{code:128116,x:12,y:1},{code:128117,x:13,y:1},{code:128589,x:1,y:9},{code:128590,x:2,y:9},{code:128581,x:8,y:8},{code:128582,x:9,y:8},{code:128129,x:11,y:2},{code:128587,x:0,y:9},{code:128583,x:10,y:8},{code:129318,x:9,y:10},{code:129335,x:10,y:11},{code:128110,x:6,y:1},{code:128373,x:6,y:3},{code:128130,x:12,y:2},{code:128119,x:1,y:2},{code:129332,x:7,y:11},{code:128120,x:2,y:2},{code:128115,x:11,y:1},{code:128114,x:10,y:1},{code:129493,x:6,y:13},{code:129333,x:8,y:11},{code:128112,x:8,y:1},{code:129328,x:5,y:11},{code:129329,x:6,y:11},{code:128124,x:6,y:2},{code:127877,x:0,y:0},{code:129334,x:9,y:11},{code:129464,x:10,y:12},{code:129465,x:11,y:12},{code:129497,x:10,y:13},{code:129498,x:11,y:13},{code:129499,x:12,y:13},{code:129500,x:13,y:13},{code:129501,x:14,y:0},{code:129502,x:14,y:1},{code:129503,x:14,y:2},{code:128134,x:0,y:3},{code:128135,x:1,y:3},{code:128694,x:6,y:9},{code:127939,x:2,y:0},{code:128131,x:13,y:2},{code:128378,x:7,y:3},{code:128372,x:5,y:3},{code:128111,x:7,y:1},{code:129494,x:7,y:13},{code:129495,x:8,y:13},{code:129338,x:13,y:11},{code:127943,x:4,y:0},{code:9975,x:14,y:6},{code:127938,x:1,y:0},{code:127948,x:7,y:0},{code:127940,x:3,y:0},{code:128675,x:3,y:9},{code:127946,x:5,y:0},{code:9977,x:14,y:7},{code:127947,x:6,y:0},{code:128692,x:4,y:9},{code:128693,x:5,y:9},{code:129336,x:11,y:11},{code:129340,x:0,y:12},{code:129341,x:1,y:12},{code:129342,x:2,y:12},{code:129337,x:12,y:11},{code:129496,x:9,y:13},{code:128704,x:7,y:9},{code:128716,x:8,y:9},{code:128109,x:5,y:1},{code:128107,x:3,y:1},{code:128108,x:4,y:1},{code:128143,x:2,y:3},{code:128145,x:3,y:3},{code:128106,x:2,y:1},{code:128483,x:8,y:3},{code:128100,x:10,y:0},{code:128101,x:11,y:0},{code:128099,x:9,y:0}],"body and clothes":[{code:128075,x:3,y:1},{code:129306,x:10,y:7},{code:128400,x:7,y:6},{code:9995,x:9,y:10},{code:128406,x:9,y:6},{code:128076,x:4,y:1},{code:9996,x:10,y:10},{code:129310,x:3,y:8},{code:129311,x:4,y:8},{code:129304,x:8,y:7},{code:129305,x:9,y:7},{code:128072,x:0,y:1},{code:128073,x:1,y:1},{code:128070,x:9,y:0},{code:128405,x:8,y:6},{code:128071,x:10,y:0},{code:9757,x:6,y:10},{code:128077,x:5,y:1},{code:128078,x:6,y:1},{code:9994,x:8,y:10},{code:128074,x:2,y:1},{code:129307,x:0,y:8},{code:129308,x:1,y:8},{code:128079,x:7,y:1},{code:128588,x:2,y:7},{code:128080,x:8,y:1},{code:129330,x:5,y:8},{code:129309,x:2,y:8},{code:128591,x:3,y:7},{code:9997,x:11,y:0},{code:128133,x:6,y:3},{code:129331,x:6,y:8},{code:128170,x:9,y:5},{code:129461,x:2,y:9},{code:129462,x:3,y:9},{code:128066,x:5,y:0},{code:128067,x:6,y:0},{code:129504,x:6,y:9},{code:129463,x:4,y:9},{code:129460,x:1,y:9},{code:128064,x:3,y:0},{code:128069,x:8,y:0},{code:128068,x:7,y:0},{code:128139,x:7,y:3},{code:128140,x:8,y:3},{code:128152,x:5,y:4},{code:128157,x:10,y:4},{code:128150,x:3,y:4},{code:128151,x:4,y:4},{code:128147,x:0,y:4},{code:128158,x:0,y:5},{code:128149,x:2,y:4},{code:128159,x:1,y:5},{code:10083,x:11,y:1},{code:128148,x:1,y:4},{code:10084,x:11,y:2},{code:129505,x:7,y:9},{code:128155,x:8,y:4},{code:128154,x:7,y:4},{code:128153,x:6,y:4},{code:128156,x:9,y:4},{code:128420,x:10,y:6},{code:128175,x:3,y:6},{code:128162,x:2,y:5},{code:128165,x:5,y:5},{code:128171,x:10,y:5},{code:128166,x:6,y:5},{code:128168,x:8,y:5},{code:128371,x:5,y:6},{code:128163,x:3,y:5},{code:128172,x:0,y:6},{code:128065,x:4,y:0},{code:128488,x:0,y:7},{code:128495,x:1,y:7},{code:128173,x:1,y:6},{code:128164,x:4,y:5},{code:128083,x:0,y:2},{code:128374,x:6,y:6},{code:129405,x:9,y:8},{code:129404,x:8,y:8},{code:128084,x:1,y:2},{code:128085,x:2,y:2},{code:128086,x:3,y:2},{code:129507,x:9,y:9},{code:129508,x:10,y:9},{code:129509,x:0,y:10},{code:129510,x:1,y:10},{code:128087,x:4,y:2},{code:128088,x:5,y:2},{code:128089,x:6,y:2},{code:128090,x:7,y:2},{code:128091,x:8,y:2},{code:128092,x:9,y:2},{code:128093,x:10,y:2},{code:128717,x:4,y:7},{code:127890,x:0,y:0},{code:128094,x:0,y:3},{code:128095,x:1,y:3},{code:129406,x:10,y:8},{code:129407,x:0,y:9},{code:128096,x:2,y:3},{code:128097,x:3,y:3},{code:128098,x:4,y:3},{code:128081,x:9,y:1},{code:128082,x:10,y:1},{code:127913,x:2,y:0},{code:127891,x:1,y:0},{code:129506,x:8,y:9},{code:9937,x:7,y:10},{code:128255,x:4,y:6},{code:128132,x:5,y:3},{code:128141,x:9,y:3},{code:128142,x:10,y:3}],"animals and nature":[{code:128053,x:6,y:6},{code:128018,x:4,y:3},{code:129421,x:2,y:9},{code:128054,x:7,y:6},{code:128021,x:7,y:3},{code:128041,x:6,y:5},{code:128058,x:0,y:7},{code:129418,x:10,y:8},{code:129437,x:7,y:10},{code:128008,x:5,y:2},{code:129409,x:1,y:8},{code:128047,x:1,y:6},{code:128005,x:2,y:2},{code:128006,x:3,y:2},{code:128052,x:5,y:6},{code:128014,x:0,y:3},{code:129412,x:4,y:8},{code:129427,x:8,y:9},{code:129420,x:1,y:9},{code:128046,x:0,y:6},{code:128002,x:10,y:1},{code:128003,x:0,y:2},{code:128004,x:1,y:2},{code:128055,x:8,y:6},{code:128022,x:9,y:3},{code:128023,x:10,y:3},{code:128061,x:3,y:7},{code:128015,x:1,y:3},{code:128017,x:3,y:3},{code:128016,x:2,y:3},{code:128042,x:7,y:5},{code:128043,x:8,y:5},{code:129433,x:3,y:10},{code:129426,x:7,y:9},{code:128024,x:0,y:4},{code:129423,x:4,y:9},{code:129435,x:5,y:10},{code:128045,x:10,y:5},{code:128001,x:9,y:1},{code:128e3,x:8,y:1},{code:128057,x:10,y:6},{code:128048,x:2,y:6},{code:128007,x:4,y:2},{code:128063,x:5,y:7},{code:129428,x:9,y:9},{code:129415,x:7,y:8},{code:128059,x:1,y:7},{code:128040,x:5,y:5},{code:128060,x:2,y:7},{code:129432,x:2,y:10},{code:129441,x:11,y:0},{code:128062,x:4,y:7},{code:129411,x:3,y:8},{code:128020,x:6,y:3},{code:128019,x:5,y:3},{code:128035,x:0,y:5},{code:128036,x:1,y:5},{code:128037,x:2,y:5},{code:128038,x:3,y:5},{code:128039,x:4,y:5},{code:128330,x:7,y:7},{code:129413,x:5,y:8},{code:129414,x:6,y:8},{code:129442,x:11,y:1},{code:129417,x:9,y:8},{code:129434,x:4,y:10},{code:129436,x:6,y:10},{code:128056,x:9,y:6},{code:128010,x:7,y:2},{code:128034,x:10,y:4},{code:129422,x:3,y:9},{code:128013,x:10,y:2},{code:128050,x:3,y:6},{code:128009,x:6,y:2},{code:129429,x:10,y:9},{code:129430,x:0,y:10},{code:128051,x:4,y:6},{code:128011,x:8,y:2},{code:128044,x:9,y:5},{code:128031,x:7,y:4},{code:128032,x:8,y:4},{code:128033,x:9,y:4},{code:129416,x:8,y:8},{code:128025,x:1,y:4},{code:128026,x:2,y:4},{code:128012,x:9,y:2},{code:129419,x:0,y:9},{code:128027,x:3,y:4},{code:128028,x:4,y:4},{code:128029,x:5,y:4},{code:128030,x:6,y:4},{code:129431,x:1,y:10},{code:128375,x:8,y:7},{code:128376,x:9,y:7},{code:129410,x:2,y:8},{code:129439,x:9,y:10},{code:129440,x:10,y:10},{code:128144,x:6,y:7},{code:127800,x:6,y:0},{code:127989,x:7,y:1},{code:127801,x:7,y:0},{code:129344,x:10,y:7},{code:127802,x:8,y:0},{code:127803,x:9,y:0},{code:127804,x:10,y:0},{code:127799,x:5,y:0},{code:127793,x:0,y:0},{code:127812,x:6,y:1},{code:127794,x:1,y:0},{code:127795,x:2,y:0},{code:127796,x:3,y:0},{code:127797,x:4,y:0},{code:127806,x:0,y:1},{code:127807,x:1,y:1},{code:9752,x:11,y:8},{code:127808,x:2,y:1},{code:127809,x:3,y:1},{code:127810,x:4,y:1},{code:127811,x:5,y:1},{code:129408,x:0,y:8},{code:129438,x:8,y:10},{code:129424,x:5,y:9},{code:129425,x:6,y:9}],"food and drinks":[{code:127815,x:8,y:0},{code:127816,x:9,y:0},{code:127817,x:0,y:1},{code:127818,x:1,y:1},{code:127819,x:2,y:1},{code:127820,x:3,y:1},{code:127821,x:4,y:1},{code:129389,x:10,y:0},{code:127822,x:5,y:1},{code:127823,x:6,y:1},{code:127824,x:7,y:1},{code:127825,x:8,y:1},{code:127826,x:9,y:1},{code:127827,x:0,y:2},{code:129373,x:4,y:8},{code:127813,x:6,y:0},{code:129381,x:2,y:9},{code:129361,x:2,y:7},{code:127814,x:7,y:0},{code:129364,x:5,y:7},{code:129365,x:6,y:7},{code:127805,x:5,y:0},{code:127798,x:4,y:0},{code:129362,x:3,y:7},{code:129388,x:9,y:9},{code:129382,x:3,y:9},{code:129372,x:3,y:8},{code:127792,x:3,y:0},{code:127838,x:1,y:3},{code:129360,x:1,y:7},{code:129366,x:7,y:7},{code:129384,x:5,y:9},{code:129391,x:10,y:2},{code:129374,x:5,y:8},{code:129472,x:10,y:3},{code:127830,x:3,y:2},{code:127831,x:4,y:2},{code:129385,x:6,y:9},{code:129363,x:4,y:7},{code:127828,x:1,y:2},{code:127839,x:2,y:3},{code:127829,x:2,y:2},{code:127789,x:0,y:0},{code:129386,x:7,y:9},{code:127790,x:1,y:0},{code:127791,x:2,y:0},{code:129369,x:0,y:8},{code:129370,x:1,y:8},{code:127859,x:2,y:5},{code:129368,x:9,y:7},{code:127858,x:1,y:5},{code:129379,x:0,y:9},{code:129367,x:8,y:7},{code:127871,x:4,y:6},{code:129474,x:10,y:5},{code:129387,x:8,y:9},{code:127857,x:0,y:5},{code:127832,x:5,y:2},{code:127833,x:6,y:2},{code:127834,x:7,y:2},{code:127835,x:8,y:2},{code:127836,x:9,y:2},{code:127837,x:0,y:3},{code:127840,x:3,y:3},{code:127842,x:5,y:3},{code:127843,x:6,y:3},{code:127844,x:7,y:3},{code:127845,x:8,y:3},{code:129390,x:10,y:1},{code:127841,x:4,y:3},{code:129375,x:6,y:8},{code:129376,x:7,y:8},{code:129377,x:8,y:8},{code:127846,x:9,y:3},{code:127847,x:0,y:4},{code:127848,x:1,y:4},{code:127849,x:2,y:4},{code:127850,x:3,y:4},{code:127874,x:5,y:6},{code:127856,x:9,y:4},{code:129473,x:10,y:4},{code:129383,x:4,y:9},{code:127851,x:4,y:4},{code:127852,x:5,y:4},{code:127853,x:6,y:4},{code:127854,x:7,y:4},{code:127855,x:8,y:4},{code:127868,x:1,y:6},{code:129371,x:2,y:8},{code:9749,x:4,y:10},{code:127861,x:4,y:5},{code:127862,x:5,y:5},{code:127870,x:3,y:6},{code:127863,x:6,y:5},{code:127864,x:7,y:5},{code:127865,x:8,y:5},{code:127866,x:9,y:5},{code:127867,x:0,y:6},{code:129346,x:8,y:6},{code:129347,x:9,y:6},{code:129380,x:1,y:9},{code:129378,x:9,y:8},{code:127869,x:2,y:6},{code:127860,x:3,y:5},{code:129348,x:0,y:7},{code:128298,x:7,y:6},{code:127994,x:6,y:6}],"travel and places":[{code:127757,x:13,y:0},{code:127758,x:0,y:1},{code:127759,x:1,y:1},{code:127760,x:2,y:1},{code:128506,x:0,y:8},{code:128510,x:4,y:8},{code:129517,x:12,y:12},{code:127956,x:9,y:3},{code:9968,x:14,y:8},{code:127755,x:11,y:0},{code:128507,x:1,y:8},{code:127957,x:10,y:3},{code:127958,x:11,y:3},{code:127964,x:3,y:4},{code:127965,x:4,y:4},{code:127966,x:5,y:4},{code:127967,x:6,y:4},{code:127963,x:2,y:4},{code:127959,x:12,y:3},{code:129521,x:13,y:12},{code:127960,x:13,y:3},{code:127962,x:1,y:4},{code:127968,x:7,y:4},{code:127969,x:8,y:4},{code:127970,x:9,y:4},{code:127971,x:10,y:4},{code:127972,x:11,y:4},{code:127973,x:12,y:4},{code:127974,x:13,y:4},{code:127976,x:0,y:5},{code:127977,x:1,y:5},{code:127978,x:2,y:5},{code:127979,x:3,y:5},{code:127980,x:4,y:5},{code:127981,x:5,y:5},{code:127983,x:6,y:5},{code:127984,x:7,y:5},{code:128146,x:9,y:5},{code:128508,x:2,y:8},{code:128509,x:3,y:8},{code:9962,x:14,y:7},{code:128332,x:0,y:6},{code:128333,x:1,y:6},{code:9961,x:14,y:6},{code:128331,x:13,y:5},{code:9970,x:14,y:10},{code:9978,x:0,y:14},{code:127745,x:1,y:0},{code:127747,x:3,y:0},{code:127961,x:0,y:4},{code:127748,x:4,y:0},{code:127749,x:5,y:0},{code:127750,x:6,y:0},{code:127751,x:7,y:0},{code:127753,x:9,y:0},{code:9832,x:14,y:0},{code:127904,x:1,y:3},{code:127905,x:2,y:3},{code:127906,x:3,y:3},{code:128136,x:8,y:5},{code:127914,x:5,y:3},{code:128642,x:8,y:8},{code:128643,x:9,y:8},{code:128644,x:10,y:8},{code:128645,x:11,y:8},{code:128646,x:12,y:8},{code:128647,x:13,y:8},{code:128648,x:0,y:9},{code:128649,x:1,y:9},{code:128650,x:2,y:9},{code:128669,x:7,y:10},{code:128670,x:8,y:10},{code:128651,x:3,y:9},{code:128652,x:4,y:9},{code:128653,x:5,y:9},{code:128654,x:6,y:9},{code:128656,x:8,y:9},{code:128657,x:9,y:9},{code:128658,x:10,y:9},{code:128659,x:11,y:9},{code:128660,x:12,y:9},{code:128661,x:13,y:9},{code:128662,x:0,y:10},{code:128663,x:1,y:10},{code:128664,x:2,y:10},{code:128665,x:3,y:10},{code:128666,x:4,y:10},{code:128667,x:5,y:10},{code:128668,x:6,y:10},{code:127950,x:8,y:3},{code:127949,x:7,y:3},{code:128757,x:4,y:12},{code:128690,x:4,y:11},{code:128756,x:3,y:12},{code:128761,x:7,y:12},{code:128655,x:7,y:9},{code:128739,x:9,y:11},{code:128740,x:10,y:11},{code:128738,x:8,y:11},{code:9981,x:1,y:14},{code:128680,x:3,y:11},{code:128677,x:0,y:11},{code:128678,x:1,y:11},{code:128721,x:6,y:11},{code:128679,x:2,y:11},{code:9875,x:14,y:1},{code:9973,x:14,y:13},{code:128758,x:5,y:12},{code:127907,x:4,y:3},{code:128676,x:13,y:10},{code:128755,x:2,y:12},{code:9972,x:14,y:12},{code:128741,x:11,y:11},{code:128674,x:12,y:10},{code:9992,x:2,y:14},{code:128745,x:12,y:11},{code:128747,x:13,y:11},{code:128748,x:0,y:12},{code:128186,x:11,y:5},{code:128641,x:7,y:8},{code:128671,x:9,y:10},{code:128672,x:10,y:10},{code:128673,x:11,y:10},{code:128752,x:1,y:12},{code:128640,x:6,y:8},{code:128760,x:6,y:12},{code:128718,x:5,y:11},{code:129523,x:0,y:13},{code:8987,x:3,y:13},{code:9203,x:7,y:13},{code:8986,x:2,y:13},{code:9200,x:4,y:13},{code:9201,x:5,y:13},{code:9202,x:6,y:13},{code:128368,x:12,y:7},{code:128347,x:13,y:6},{code:128359,x:11,y:7},{code:128336,x:2,y:6},{code:128348,x:0,y:7},{code:128337,x:3,y:6},{code:128349,x:1,y:7},{code:128338,x:4,y:6},{code:128350,x:2,y:7},{code:128339,x:5,y:6},{code:128351,x:3,y:7},{code:128340,x:6,y:6},{code:128352,x:4,y:7},{code:128341,x:7,y:6},{code:128353,x:5,y:7},{code:128342,x:8,y:6},{code:128354,x:6,y:7},{code:128343,x:9,y:6},{code:128355,x:7,y:7},{code:128344,x:10,y:6},{code:128356,x:8,y:7},{code:128345,x:11,y:6},{code:128357,x:9,y:7},{code:128346,x:12,y:6},{code:128358,x:10,y:7},{code:127761,x:3,y:1},{code:127762,x:4,y:1},{code:127763,x:5,y:1},{code:127764,x:6,y:1},{code:127765,x:7,y:1},{code:127766,x:8,y:1},{code:127767,x:9,y:1},{code:127768,x:10,y:1},{code:127769,x:11,y:1},{code:127770,x:12,y:1},{code:127771,x:13,y:1},{code:127772,x:0,y:2},{code:127777,x:5,y:2},{code:9728,x:8,y:13},{code:127773,x:1,y:2},{code:127774,x:2,y:2},{code:11088,x:4,y:14},{code:127775,x:3,y:2},{code:127776,x:4,y:2},{code:127756,x:12,y:0},{code:9729,x:9,y:13},{code:9925,x:14,y:4},{code:9928,x:14,y:5},{code:127780,x:6,y:2},{code:127781,x:7,y:2},{code:127782,x:8,y:2},{code:127783,x:9,y:2},{code:127784,x:10,y:2},{code:127785,x:11,y:2},{code:127786,x:12,y:2},{code:127787,x:13,y:2},{code:127788,x:0,y:3},{code:127744,x:0,y:0},{code:127752,x:8,y:0},{code:127746,x:2,y:0},{code:9730,x:10,y:13},{code:9748,x:13,y:13},{code:9969,x:14,y:9},{code:9889,x:14,y:2},{code:10052,x:3,y:14},{code:9731,x:11,y:13},{code:9924,x:14,y:3},{code:9732,x:12,y:13},{code:128293,x:12,y:5},{code:128167,x:10,y:5},{code:127754,x:10,y:0}],events:[{code:127875,x:4,y:0},{code:127876,x:5,y:0},{code:127878,x:6,y:0},{code:127879,x:7,y:0},{code:129512,x:5,y:6},{code:10024,x:9,y:3},{code:127880,x:8,y:0},{code:127881,x:0,y:1},{code:127882,x:1,y:1},{code:127883,x:2,y:1},{code:127885,x:3,y:1},{code:127886,x:4,y:1},{code:127887,x:5,y:1},{code:127888,x:6,y:1},{code:127889,x:7,y:1},{code:129511,x:4,y:6},{code:127872,x:2,y:0},{code:127873,x:3,y:0},{code:127895,x:0,y:2},{code:127903,x:1,y:2},{code:127915,x:3,y:2},{code:127894,x:8,y:1},{code:127942,x:7,y:3},{code:127941,x:6,y:3},{code:129351,x:4,y:5},{code:129352,x:5,y:5},{code:129353,x:6,y:5},{code:9917,x:8,y:8},{code:9918,x:9,y:0},{code:129358,x:2,y:6},{code:127936,x:5,y:3},{code:127952,x:2,y:4},{code:127944,x:8,y:3},{code:127945,x:0,y:4},{code:127934,x:3,y:3},{code:129359,x:3,y:6},{code:127923,x:1,y:3},{code:127951,x:1,y:4},{code:127953,x:3,y:4},{code:127954,x:4,y:4},{code:129357,x:1,y:6},{code:127955,x:5,y:4},{code:127992,x:6,y:4},{code:129354,x:7,y:5},{code:129355,x:8,y:5},{code:129349,x:3,y:5},{code:9971,x:9,y:1},{code:9976,x:9,y:2},{code:127933,x:2,y:3},{code:127935,x:4,y:3},{code:128759,x:2,y:5},{code:129356,x:0,y:6},{code:127919,x:6,y:2},{code:127921,x:8,y:2},{code:128302,x:8,y:4},{code:129535,x:1,y:7},{code:127918,x:5,y:2},{code:128377,x:0,y:5},{code:127920,x:7,y:2},{code:127922,x:0,y:3},{code:129513,x:6,y:6},{code:129528,x:0,y:7},{code:9824,x:4,y:8},{code:9829,x:6,y:8},{code:9830,x:7,y:8},{code:9827,x:5,y:8},{code:9823,x:3,y:8},{code:127183,x:1,y:0},{code:126980,x:0,y:0},{code:127917,x:4,y:2},{code:128444,x:1,y:5},{code:127912,x:2,y:2},{code:129525,x:7,y:6},{code:129526,x:8,y:6}],objects:[{code:128263,x:1,y:7},{code:128264,x:2,y:7},{code:128265,x:3,y:7},{code:128266,x:4,y:7},{code:128226,x:3,y:5},{code:128227,x:4,y:5},{code:128239,x:3,y:6},{code:128276,x:1,y:8},{code:128277,x:2,y:8},{code:127932,x:2,y:1},{code:127925,x:8,y:0},{code:127926,x:9,y:0},{code:127897,x:0,y:0},{code:127898,x:1,y:0},{code:127899,x:2,y:0},{code:127908,x:4,y:0},{code:127911,x:6,y:0},{code:128251,x:11,y:6},{code:127927,x:10,y:0},{code:127928,x:11,y:0},{code:127929,x:12,y:0},{code:127930,x:0,y:1},{code:127931,x:1,y:1},{code:129345,x:6,y:11},{code:128241,x:5,y:6},{code:128242,x:6,y:6},{code:9742,x:13,y:3},{code:128222,x:12,y:4},{code:128223,x:0,y:5},{code:128224,x:1,y:5},{code:128267,x:5,y:7},{code:128268,x:6,y:7},{code:128187,x:4,y:2},{code:128421,x:5,y:9},{code:128424,x:6,y:9},{code:9e3,x:13,y:2},{code:128433,x:7,y:9},{code:128434,x:8,y:9},{code:128189,x:6,y:2},{code:128190,x:7,y:2},{code:128191,x:8,y:2},{code:128192,x:9,y:2},{code:129518,x:2,y:12},{code:127909,x:5,y:0},{code:127902,x:3,y:0},{code:128253,x:0,y:7},{code:127916,x:7,y:0},{code:128250,x:10,y:6},{code:128247,x:7,y:6},{code:128248,x:8,y:6},{code:128249,x:9,y:6},{code:128252,x:12,y:6},{code:128269,x:7,y:7},{code:128270,x:8,y:7},{code:128367,x:12,y:8},{code:128161,x:8,y:1},{code:128294,x:5,y:8},{code:127982,x:3,y:1},{code:128212,x:3,y:4},{code:128213,x:4,y:4},{code:128214,x:5,y:4},{code:128215,x:6,y:4},{code:128216,x:7,y:4},{code:128217,x:8,y:4},{code:128218,x:9,y:4},{code:128211,x:2,y:4},{code:128210,x:1,y:4},{code:128195,x:12,y:2},{code:128220,x:10,y:4},{code:128196,x:0,y:3},{code:128240,x:4,y:6},{code:128478,x:4,y:10},{code:128209,x:0,y:4},{code:128278,x:3,y:8},{code:127991,x:4,y:1},{code:128176,x:9,y:1},{code:128180,x:11,y:1},{code:128181,x:12,y:1},{code:128182,x:0,y:2},{code:128183,x:1,y:2},{code:128184,x:2,y:2},{code:128179,x:10,y:1},{code:129534,x:13,y:0},{code:128185,x:3,y:2},{code:9993,x:1,y:13},{code:128231,x:8,y:5},{code:128232,x:9,y:5},{code:128233,x:10,y:5},{code:128228,x:5,y:5},{code:128229,x:6,y:5},{code:128230,x:7,y:5},{code:128235,x:12,y:5},{code:128234,x:11,y:5},{code:128236,x:0,y:6},{code:128237,x:1,y:6},{code:128238,x:2,y:6},{code:128499,x:6,y:10},{code:9999,x:2,y:13},{code:10002,x:3,y:13},{code:128395,x:2,y:9},{code:128394,x:1,y:9},{code:128396,x:3,y:9},{code:128397,x:4,y:9},{code:128221,x:11,y:4},{code:128188,x:5,y:2},{code:128193,x:10,y:2},{code:128194,x:11,y:2},{code:128450,x:9,y:9},{code:128197,x:1,y:3},{code:128198,x:2,y:3},{code:128466,x:0,y:10},{code:128467,x:1,y:10},{code:128199,x:3,y:3},{code:128200,x:4,y:3},{code:128201,x:5,y:3},{code:128202,x:6,y:3},{code:128203,x:7,y:3},{code:128204,x:8,y:3},{code:128205,x:9,y:3},{code:128206,x:10,y:3},{code:128391,x:0,y:9},{code:128207,x:11,y:3},{code:128208,x:12,y:3},{code:9986,x:0,y:13},{code:128451,x:10,y:9},{code:128452,x:11,y:9},{code:128465,x:12,y:9},{code:128274,x:12,y:7},{code:128275,x:0,y:8},{code:128271,x:9,y:7},{code:128272,x:10,y:7},{code:128273,x:11,y:7},{code:128477,x:3,y:10},{code:128296,x:7,y:8},{code:9935,x:13,y:11},{code:9874,x:13,y:4},{code:128736,x:3,y:11},{code:128481,x:5,y:10},{code:9876,x:13,y:5},{code:128299,x:9,y:8},{code:127993,x:5,y:1},{code:128737,x:4,y:11},{code:128295,x:6,y:8},{code:128297,x:8,y:8},{code:9881,x:13,y:8},{code:128476,x:2,y:10},{code:9878,x:13,y:6},{code:128279,x:4,y:8},{code:9939,x:13,y:12},{code:129520,x:4,y:12},{code:129522,x:5,y:12},{code:9879,x:13,y:7},{code:129514,x:12,y:11},{code:129515,x:0,y:12},{code:129516,x:1,y:12},{code:128300,x:10,y:8},{code:128301,x:11,y:8},{code:128225,x:2,y:5},{code:128137,x:6,y:1},{code:128138,x:7,y:1},{code:128682,x:8,y:10},{code:128719,x:1,y:11},{code:128715,x:0,y:11},{code:128701,x:10,y:10},{code:128703,x:11,y:10},{code:128705,x:12,y:10},{code:129524,x:6,y:12},{code:129527,x:7,y:12},{code:129529,x:8,y:12},{code:129530,x:9,y:12},{code:129531,x:10,y:12},{code:129532,x:11,y:12},{code:129533,x:12,y:12},{code:129519,x:3,y:12},{code:128722,x:2,y:11},{code:128684,x:9,y:10},{code:9904,x:13,y:9},{code:9905,x:13,y:10},{code:128511,x:7,y:10}],signs:[{code:128686,x:4,y:8},{code:128688,x:6,y:8},{code:9855,x:3,y:13},{code:128697,x:11,y:8},{code:128698,x:12,y:8},{code:128699,x:13,y:8},{code:128700,x:14,y:8},{code:128702,x:0,y:9},{code:128706,x:1,y:9},{code:128707,x:2,y:9},{code:128708,x:3,y:9},{code:128709,x:4,y:9},{code:127975,x:13,y:4},{code:9888,x:7,y:13},{code:128696,x:10,y:8},{code:9940,x:11,y:13},{code:128683,x:2,y:8},{code:128691,x:8,y:8},{code:128685,x:3,y:8},{code:128687,x:5,y:8},{code:128689,x:7,y:8},{code:128695,x:9,y:8},{code:128245,x:7,y:5},{code:128286,x:7,y:6},{code:9762,x:10,y:11},{code:9763,x:11,y:11},{code:11014,x:15,y:5},{code:8599,x:14,y:9},{code:10145,x:14,y:14},{code:8600,x:0,y:10},{code:11015,x:15,y:6},{code:8601,x:1,y:10},{code:11013,x:15,y:4},{code:8598,x:13,y:9},{code:8597,x:12,y:9},{code:8596,x:11,y:9},{code:8617,x:2,y:10},{code:8618,x:3,y:10},{code:10548,x:15,y:2},{code:10549,x:15,y:3},{code:128259,x:12,y:5},{code:128260,x:13,y:5},{code:128281,x:2,y:6},{code:128282,x:3,y:6},{code:128283,x:4,y:6},{code:128284,x:5,y:6},{code:128285,x:6,y:6},{code:128720,x:5,y:9},{code:9883,x:5,y:13},{code:128329,x:14,y:7},{code:10017,x:1,y:14},{code:9784,x:1,y:12},{code:9775,x:0,y:12},{code:10013,x:0,y:14},{code:9766,x:12,y:11},{code:9770,x:13,y:11},{code:9774,x:14,y:11},{code:128334,x:0,y:8},{code:128303,x:14,y:6},{code:9800,x:4,y:12},{code:9801,x:5,y:12},{code:9802,x:6,y:12},{code:9803,x:7,y:12},{code:9804,x:8,y:12},{code:9805,x:9,y:12},{code:9806,x:10,y:12},{code:9807,x:11,y:12},{code:9808,x:12,y:12},{code:9809,x:13,y:12},{code:9810,x:14,y:12},{code:9811,x:0,y:13},{code:9934,x:10,y:13},{code:128256,x:9,y:5},{code:128257,x:10,y:5},{code:128258,x:11,y:5},{code:9654,x:3,y:11},{code:9193,x:5,y:10},{code:9197,x:9,y:10},{code:9199,x:11,y:10},{code:9664,x:4,y:11},{code:9194,x:6,y:10},{code:9198,x:10,y:10},{code:128316,x:12,y:7},{code:9195,x:7,y:10},{code:128317,x:13,y:7},{code:9196,x:8,y:10},{code:9208,x:12,y:10},{code:9209,x:13,y:10},{code:9210,x:14,y:10},{code:9167,x:4,y:10},{code:127910,x:11,y:4},{code:128261,x:14,y:5},{code:128262,x:0,y:6},{code:128246,x:8,y:5},{code:128243,x:5,y:5},{code:128244,x:6,y:5},{code:9792,x:2,y:12},{code:9794,x:3,y:12},{code:10006,x:14,y:13},{code:10133,x:11,y:14},{code:10134,x:12,y:14},{code:10135,x:13,y:14},{code:9854,x:2,y:13},{code:8252,x:6,y:9},{code:8265,x:7,y:9},{code:10067,x:7,y:14},{code:10068,x:8,y:14},{code:10069,x:9,y:14},{code:10071,x:10,y:14},{code:12336,x:15,y:10},{code:128177,x:2,y:5},{code:128178,x:3,y:5},{code:9877,x:4,y:13},{code:9851,x:1,y:13},{code:9884,x:6,y:13},{code:128305,x:1,y:7},{code:128219,x:4,y:5},{code:128304,x:0,y:7},{code:11093,x:15,y:9},{code:9989,x:12,y:13},{code:9745,x:9,y:11},{code:10004,x:13,y:13},{code:10060,x:5,y:14},{code:10062,x:6,y:14},{code:10160,x:15,y:0},{code:10175,x:15,y:1},{code:12349,x:15,y:11},{code:10035,x:2,y:14},{code:10036,x:3,y:14},{code:10055,x:4,y:14},{code:169,x:12,y:0},{code:174,x:13,y:0},{code:8482,x:9,y:9},{code:128288,x:9,y:6},{code:128289,x:10,y:6},{code:128290,x:11,y:6},{code:128291,x:12,y:6},{code:128292,x:13,y:6},{code:127344,x:14,y:0},{code:127374,x:3,y:1},{code:127345,x:0,y:1},{code:127377,x:4,y:1},{code:127378,x:5,y:1},{code:127379,x:6,y:1},{code:8505,x:10,y:9},{code:127380,x:7,y:1},{code:9410,x:0,y:11},{code:127381,x:8,y:1},{code:127382,x:9,y:1},{code:127358,x:1,y:1},{code:127383,x:10,y:1},{code:127359,x:2,y:1},{code:127384,x:11,y:1},{code:127385,x:12,y:1},{code:127386,x:13,y:1},{code:127489,x:10,y:3},{code:127490,x:11,y:3},{code:127543,x:4,y:4},{code:127542,x:3,y:4},{code:127535,x:13,y:3},{code:127568,x:8,y:4},{code:127545,x:6,y:4},{code:127514,x:12,y:3},{code:127538,x:14,y:3},{code:127569,x:9,y:4},{code:127544,x:5,y:4},{code:127540,x:1,y:4},{code:127539,x:0,y:4},{code:12951,x:15,y:12},{code:12953,x:15,y:13},{code:127546,x:7,y:4},{code:127541,x:2,y:4},{code:128308,x:4,y:7},{code:128309,x:5,y:7},{code:9899,x:9,y:13},{code:9898,x:8,y:13},{code:11036,x:15,y:8},{code:9724,x:6,y:11},{code:9723,x:5,y:11},{code:9726,x:8,y:11},{code:9725,x:7,y:11},{code:9642,x:1,y:11},{code:9643,x:2,y:11},{code:128310,x:6,y:7},{code:128311,x:7,y:7},{code:128312,x:8,y:7},{code:128313,x:9,y:7},{code:128314,x:10,y:7},{code:128315,x:11,y:7},{code:128160,x:1,y:5},{code:128280,x:1,y:6},{code:128307,x:3,y:7},{code:128306,x:2,y:7},{code:127937,x:12,y:4},{code:128681,x:1,y:8},{code:127884,x:10,y:4},{code:127988,x:0,y:5},{code:127987,x:14,y:4},{code:127462,x:14,y:1},{code:127463,x:0,y:2},{code:127464,x:1,y:2},{code:127465,x:2,y:2},{code:127466,x:3,y:2},{code:127467,x:4,y:2},{code:127468,x:5,y:2},{code:127469,x:6,y:2},{code:127470,x:7,y:2},{code:127471,x:8,y:2},{code:127472,x:9,y:2},{code:127473,x:10,y:2},{code:127474,x:11,y:2},{code:127475,x:12,y:2},{code:127476,x:13,y:2},{code:127477,x:14,y:2},{code:127478,x:0,y:3},{code:127479,x:1,y:3},{code:127480,x:2,y:3},{code:127481,x:3,y:3},{code:127482,x:4,y:3},{code:127483,x:5,y:3},{code:127484,x:6,y:3},{code:127485,x:7,y:3},{code:127486,x:8,y:3},{code:127487,x:9,y:3}]},s=function(e){if(65536>e)return i(e);var t=e-65536;return i(55296+(t>>10))+i(56320+(1023&t))},o={},d={};for(var c in n)t.each(n[c],function(e){var t=s(e.code);o[t]=e,d[c]||(d[c]=[]),d[c].push(t)});var r=/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/g;return a.emojify=function(e){e||(e={});var t=e.sprite,a=t?e.tag_name||"span":"img",i=e.emoji_size||20,n=e.href?` href="#${e.href}" `:"",s=e.title?` title="${e.title}" `:"";return this.replace(r,function(e){let d=o[e],c=d&&(+d.code).toString(16);if(d){4>c.length&&(c="0".repeat(4-c.length)+c);let o="img"===a?t?" src=\"images/emoji/blank.gif\"":"  src=\"images/emoji/svg32/emoji_u"+c+".svg\"":"";return"<"+a+o+n+s+" class=\"emoji emoji-w"+i+(t?" sprite-"+t+"\" style=\"background-position: -"+i*d.x+"px -"+i*d.y+"px;\" ":"\" ")+"alt=\""+e+"\" data-emoji=\""+e+"\"/>"}return e})},a.removeEmoji=function(){return this.replace(r,function(e){var t=o[e];return t?"":e})},a.replaceEmoji=function(){return this.replace(r,function(e){var t=o[e];return t?" ":e})},e.fn.emojify=function(t,a){return this.find(t).each(function(){var t=e(this).html();e(this).html(t.emojify(a))}),this},{all:d,get:s,getByIndex:function(e){var t;for(var a in n)if(n[a][e]){t=n[a][e];break}return s(t.code)}}}),define("xabber-image-utils",["xabber-dependencies"],function(e){var t=Math.floor,a=e._,i=e.$,n=e.SHA1.b64_sha1,s={},o=["#1abc9c","#16a085","#f1c40f","#f39c12","#2ecc71","#27ae60","#e67e22","#d35400","#3498db","#2980b9","#e74c3c","#c0392b","#9b59b6","#8e44ad","#bdc3c7","#34495e","#2c3e50","#95a5a6","#7f8c8d","#ec87bf","#d870ad","#f69785","#9ba37e","#b49255","#a94136"],d=function(e,t,a){t=t||"",a=a||512;for(var n=atob(e),s=[],o=0;o<n.length;o+=a){for(var d=n.slice(o,o+a),c=Array(d.length),r=0;r<d.length;r++)c[r]=d.charCodeAt(r);var l=new Uint8Array(c);s.push(l)}var p=new Blob(s,{type:t});return p},c=function(e){return this.url=window.URL.createObjectURL(d(e)),s[e]=this,this},r=function(e){return e instanceof c?e:s[e]||new c(e)},l=function(e){var a=e?e.trim():"",i=t(n(a).charCodeAt(0)%o.length);return o[i]},p=function(e,t){return e.width>e.height?e.width>t&&(e.height*=t/e.width,e.width=t):e.height>t&&(e.width*=t/e.height,e.height=t),e},u=function(e,t){var a=i(e),n={backgroundImage:"url(\""+t.url+"\")",backgroundSize:"cover",backgroundColor:"#FFF"};a.css(n)};return i.fn.setAvatar=function(e,t){var a=r(e);u(this,a,t)},{getCachedImage:r,getBlobImage:d,getDefaultAvatar:function(e,t){var a=document.createElement("canvas"),i=a.getContext("2d"),n=e?e.trim():"",s=n.split(" ",2),o,d,c,r;o=s[0],d=1<s.length?s[1]:"",c=o[0]||"",r=d?d[0]:1<o.length?o[1]:"",a.width=256,a.height=256,i.rect(0,0,256,256),i.fillStyle=t||l(e),i.fill(),i.font="bold 100px sans-serif",i.fillStyle="#FFF",i.textAlign="center",i.fillText(c.toUpperCase()+r.toUpperCase(),128,160);var p=a.toDataURL().replace(/^data:image\/(png|gif|jpg|webp|jpeg);base64,/,"");return p},getAvatarFromFile:function(e){var t=new Image,a=window.URL.createObjectURL(e),n=new i.Deferred;return t.onload=function(){t.onload=null;var i=document.createElement("canvas"),s=i.getContext("2d"),o=t.naturalWidth,d=t.naturalHeight,c=p({width:o,height:d},200),r,l;i.width=c.width,i.height=c.height,s.drawImage(t,0,0,i.width,i.height),r=i.toDataURL().replace(/^data:image\/(png|gif|jpg|webp|jpeg);base64,/,""),window.URL.revokeObjectURL(a),i.toBlob(e=>{var t=new FileReader;t.onload=function(){r=t.result.replace(/^data:image\/(png|gif|jpg|webp|jpeg);base64,/,"");let e=atob(r),a=new Uint8Array(e.length);for(let t=0;t<e.length;t++)a[t]=e.charCodeAt(t);l=sha1(a),n.resolve(r,l,e.length)}.bind(this),t.readAsDataURL(e)},e.type,.8)},t.onerror=function(){t.onerror=null,window.URL.revokeObjectURL(a),n.resolve(!1,!1,!1)},t.src=a,n.promise()},getDefaultColor:l,compressImage:function(e){var t=new Image,a=window.URL.createObjectURL(e),n=new i.Deferred;return t.onload=function(){t.onload=null;var i=document.createElement("canvas"),s=i.getContext("2d"),o=t.naturalWidth,d=t.naturalHeight,c=e.type,r=e.name,l=p({width:o,height:d},1280);"image/svg+xml"===e.type&&(e.width=o,e.height=d,n.resolve(e)),i.width=l.width,i.height=l.height,s.drawImage(t,0,0,l.width,l.height),i.toBlob(e=>{const t=new File([e],r,{type:c,lastModified:Date.now()});n.resolve(t)},c,.8),window.URL.revokeObjectURL(a)},t.onerror=function(){t.onerror=null,window.URL.revokeObjectURL(a),n.resolve(!1)},t.src=a,n.promise()}}}),define("xabber-modal-utils",["xabber-dependencies","xabber-templates"],function(e,t){var a=e._,i=e.$,n=i("<div>").attr("id","modals").appendTo("body"),s=[],o=function(e,t){this.$modal=e instanceof Function?i(e()):i(e),this.options=t||{},this.closed=new i.Deferred};return a.extend(o.prototype,{open:function(){return this.options.use_queue?(s.push(this),1===s.length&&this.throw()):this.throw(),document.addEventListener("keyup",this.clickHandler.bind(this)),this.closed.promise()},throw:function(){this.$modal.appendTo(n).prop("modal",this);var e=a.omit(this.options,["use_queue"]);a.extend(e,{is_default_complete:!0,complete_data:null}),this.options.use_queue&&this.$modal.one("modal_close",function(e,t){this.$modal.detach(),this.closed.resolve(t.value),s.shift(),s.length&&s[0].throw()}.bind(this)),this.$modal._openModal(e)},close:function(e){var t=a.omit(e,["use_queue","is_default_complete","complete_data"]);a.extend(t,{complete:function(){if(this.options.use_queue){var t=a.isUndefined(e.complete_data)?null:e.complete_data;this.complete(t)}e.is_default_complete?"function"==typeof this.options.complete&&this.options.complete():(this.options.use_queue&&this.complete(),"function"==typeof e.complete&&e.complete())}.bind(this)}),this.$modal.prop("modal",null),this.$modal._closeModal(t)},complete:function(e){document.removeEventListener("keyup",this.clickHandler),this.$modal.trigger("modal_close",{value:e})},clickHandler:function(e){13===e.keyCode&&(this.$modal.find(".modal-footer button.ok-button").click(),e.preventDefault())}}),i.fn._openModal=i.fn.openModal,i.fn.openModal=function(e){var t=new o(this,e);return t.open()},i.fn._closeModal=i.fn.closeModal,i.fn.closeModal=function(e){var t=this.prop("modal");t?t.close(e):this._closeModal(e)},{Modal:o,clear_queue:function(){s=[]},dialogs:{common:function(e,n,s,d,c){var r=new o(function(){s||(s={}),d||(d=[]);var a=s.ok_button,i=s.cancel_button,o=(s.optional_buttons||[]).reverse();return a&&(a={text:a.text||"Ok"}),i&&(i={text:i.text||"Cancel"}),t.base.dialog({header:e,text:n,ok_button:a,cancel_button:i,optional_buttons:o,dialog_options:d,flag:c||""})},{use_queue:!0});return d.blob_image_from_clipboard&&(r.$modal.find(".dialog-options-wrap").html(""),r.$modal.find(".img-from-clipboard")[0].src=d.blob_image_from_clipboard,r.$modal.find(".container-for-img").removeClass("hidden")),d.canvas&&(r.$modal.find(".dialog-options-wrap").html(""),r.$modal.find(".container-for-img").html("").removeClass("hidden")[0].appendChild(d.canvas),d.bottom_text&&i("<div class=\"dialog-bottom-text\"/>").html(d.bottom_text).appendTo(r.$modal.find(".container-for-img"))),(d.input_placeholder_value||d.input_value)&&r.$modal.find(".dialog-options-wrap").html(i("<input type=\"text\" placeholder=\""+d.input_placeholder_value+"\" id=\"user_value\"/>").val(d.input_value)),r.$modal.find(".modal-footer button").click(function(e){var t=i(e.target).data("option"),n=r.$modal.find(".dialog-option"),s=r.$modal.find("#user_value");if(t&&n.length){var o={};a.each(n,function(e){var t=i(e);o[t.data("name")]=t.find("input").prop("checked")}),r.close({complete_data:o})}else if(!s.length)r.close({complete_data:t});else if(i(e.target).hasClass("btn-cancel"))r.close({complete_data:!1});else if(i(e.target).hasClass("optional-button"))r.close({complete_data:t});else{var d=s.val();r.close({complete_data:d})}}),r.open()},warning:function(e,t){return this.common("Warning",e,{ok_button:!0},t)},error:function(e,t){return this.common("Error",e,{ok_button:!0},t)},ask:function(e,t,a,i){var n;return i&&(n=i.ok_button_text),this.common(e,t,{ok_button:{text:n},cancel_button:!0},a)},ask_extended:function(e,t,a,i){var n,s;return i&&(n=i.ok_button_text,s=!!i.optional_button&&[{value:i.optional_button,name:i.optional_button}]),this.common(e,t,{ok_button:{text:n},cancel_button:!0,optional_buttons:s},a,"extended")},ask_enter_value:function(e,t,a,i){var n,s;return i&&(n=i.ok_button_text,s=!!i.resend_button_text&&[{value:i.resend_to,name:i.resend_button_text}]),this.common(e,t,{ok_button:{text:n},optional_buttons:s,cancel_button:!0},a)},notify:function(e,t){return this.common(e,t,{ok_button:!0})}}}}),define("xabber-textarea-utils",["xabber-dependencies"],function(e){var t=e._,a=e.$;return a.fn.placeCaretAtEnd=function(){if(!this.length)return this;var e=this[0];if(e.focus(),!t.isUndefined(window.getSelection)&&!t.isUndefined(document.createRange)){var a=document.createRange();a.selectNodeContents(e),a.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(a)}else if(!t.isUndefined(document.body.createTextRange)){var n=document.body.createTextRange();n.moveToElementText(e),n.collapse(!1),n.select()}return this},a.fn.updateRichTextarea=function(){var e=this.getTextFromRichTextarea();return e||this.html(""),this},a.fn.flushRichTextarea=function(){return this.html(""),this},a.fn.pasteHtmlAtCaret=function(e){var t,a;if(this[0].focus(),!window.getSelection)document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(e);else if(t=window.getSelection(),t.getRangeAt&&t.rangeCount){a=t.getRangeAt(0),a.deleteContents();var i=document.createElement("div");i.innerHTML=e;for(var n=document.createDocumentFragment(),s,o;s=i.firstChild;)o=n.appendChild(s);a.insertNode(n),o&&(a=a.cloneRange(),a.setStartAfter(o),a.collapse(!0),t.removeAllRanges(),t.addRange(a))}return this},a.fn.getTextFromRichTextarea=function(){var e=a("<div>").html(this.html());return e.find(".emoji").each(function(){a(this).replaceWith(a(this).data("emoji"))}),e.find("p").each(function(){a(this).replaceWith(a(this).html()+"\n")}),e.find("span").each(function(){a(this).replaceWith(a(this).html())}),e.find("div").each(function(){var e=a(this);e.find("br").remove();var t=e.html();e.hasClass("emoji")?e.replaceWith(t):e.replaceWith("\n"+t)}),e.text()},null}),define("xabber-utils",["xabber-dependencies","xabber-emoji-utils","xabber-image-utils","xabber-modal-utils","xabber-constants","xabber-textarea-utils"],function(e,t,a,i,n){var s=Math.trunc,o=Math.floor,d=e.$,c=e._,r=e.moment;d.fn.switchClass=function(e,t){return 1===arguments.length&&(t=!this.hasClass(e)),t?this.addClass(e):this.removeClass(e),this},d.fn.showIf=function(e){return this.switchClass("hidden",!e)},d.fn.hideIf=function(e){return this.switchClass("hidden",e)};var l=function(e){var t=0===e.indexOf("http://")||0===e.indexOf("https://")?"":"http://",a=encodeURI(decodeURI(e)).replace(/[!'()]/g,escape).replace(/\*/g,"%2A");return"<a target='_blank' class='msg-hyperlink' href='"+t+a+"'>"+decodeURI(e)+"</a>"};d.fn.hyperlinkify=function(e){e||(e={});var t=e.selector?this.find(e.selector):this;return t.each(function(t,a){var n=d(a),s="";n[0].childNodes.forEach(function(a){let i=d(a),n=a.outerHTML;if("A"===a.tagName)return void(s+=n);else{"#text"===a.nodeName&&(n=c.escape(i.text()));let o=n&&n.match(/(((ftp|http|https):\/\/)|(www\.))(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g);if(!o)return void(s+=n);if(1===o.length&&o[0]===n)s+=e.decode_uri?decodeURI(n):l(n);else{for(t=0;t<o.length;t++)n=n.replace(o[t],e.decode_uri?decodeURI(o[t]):l(o[t]));s+=n}}}.bind(this)),n.html(s)}),this};var p={uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),a="x"==e?t:8|3&t;return a.toString(16)})},utoa:function(e){return window.btoa(unescape(encodeURIComponent(e)))},atou:function(e){return decodeURIComponent(escape(window.atob(e)))},now:function(){return o(r.now()/1e3)},pretty_time:function(e){var t=e?r(e):r();return t.format("HH:mm:ss")},pretty_date:function(e){var t=e?r(e):r();return t.format("dddd, MMMM D, YYYY")},pretty_datetime:function(e){var t=e?r(e):r();return t.format("MMMM D, YYYY HH:mm:ss")},pretty_short_datetime_recent_chat:function(e){return e=+(e?r(e):r()),r(e).startOf("day").isSame(r().startOf("day"))||+(r().subtract(12,"hours")<e)?r(e).format("HH:mm:ss"):+r().subtract(12,"hours")>e&&+r().subtract(7,"days")<=e?r(e).format("ddd"):+r().subtract(7,"days")>e&&+r().subtract(1,"year")<=e?r(e).format("MMM D"):e&&+r().subtract(1,"year")>e?r(e).format("D MMM YYYY"):void 0},pretty_short_datetime:function(e){var t=e?r(e):r(),a=r(t).startOf("day"),i=r(t).startOf("year");return a.isSame(r().startOf("day"))?t.format("HH:mm:ss"):i.isSame(r().startOf("year"))?t.format("MMM D"):t.format("DD/MM/gg")},pretty_short_month_date:function(e){var t=e?r(e):r(),a=r(t).startOf("day"),i=r(t).startOf("year");return a.isSame(r().startOf("day"))?t.format("HH:mm:ss"):i.isSame(r().startOf("year"))?t.format("MMM D, YYYY HH:mm:ss"):t.format("DD/MM/gg, HH:mm:ss")},pretty_timedelta:function(e){return 60>e?"just now":3600>e?o(e/60)+" minutes ago":86400>e?o(e/3600)+" hours ago":o(e/86400)+" days ago"},file_type_icon:function(e){let t=p.pretty_file_type(e);return"image"===t?"mdi-image":"audio"===t?"mdi-music-note":"video"===t?"mdi-filmstrip":"document"===t?"mdi-file-document-box":"presentation"===t?"mdi-presentation":"archive"===t?"mdi-zip-box":"file"===t?"mdi-file":"pdf"===t?"mdi-file-pdf":"mdi-file"},pretty_file_type:function(e){return n.MIME_TYPES.image.includes(e)?"image":n.MIME_TYPES.audio.includes(e)?"audio":n.MIME_TYPES.video.includes(e)?"video":n.MIME_TYPES.document.includes(e)?"document":n.MIME_TYPES.pdf.includes(e)?"pdf":n.MIME_TYPES.presentation.includes(e)?"presentation":n.MIME_TYPES.archive.includes(e)?"archive":n.MIME_TYPES.table.includes(e)?"electronic table":"file"},pretty_file_type_with_article:function(e){let t=p.pretty_file_type(e);return"pdf"===t&&(t="document"),["a","e","i","o","u"].includes(t[0])?"an "+t:"a "+t},pretty_size:function(e){return e?1024>e?e+" B":1048576>e?(e/1024).toFixed(2)+" KB":1073741824>e?(e/1048576).toFixed(2)+" MB":(e/1073741824).toFixed(2)+" GB":""},pretty_last_seen:function(e){return 0<=e&&60>e?"last seen just now":60<e&&3600>e?"last seen "+s(e/60)+(120>e?" minute ago":" minutes ago"):3600<=e&&7200>e?"last seen hour ago":345600<=e?"last seen "+r().subtract(e,"seconds").format("LL"):"last seen "+r().subtract(e,"seconds").calendar().toLowerCase()},pretty_duration:function(e){return c.isNaN(+e)?e:c.isUndefined(e)||""===e?"":10>e?"0:0"+e:60>e?"0:"+e:60<e?s(e/60)+":"+(10>e%60?"0"+e%60:e%60):void 0},pretty_name:function(e){return e?e[0].toUpperCase()+e.replace(/-/," ").substr(1).toLowerCase():""},slice_string:function(e,t,a){return a=c.isNumber(a)?a:[...e].length,e.length===[...e].length?e.slice(t,a):Array.from(e).slice(t,a).join("")},slice_pretty_body:function(t,a){if(!a||!a.length)return t;t=t||"",a=a.filter(e=>"groupchat"===e.type||"forward"===e.type);let i=Array.from(e.Strophe.xmlescape(t));return a&&a.forEach(function(e){for(let t=e.start;t<e.end;t++)i[t]=""}.bind(this)),e.Strophe.xmlunescape(i.join("").trim())},markupBodyMessage:function(t,a){let i=c.clone(t.attributes),s=i.mentions||[],o=i.markups||[],d=i.mutable_content||[],r=i.blockquotes||[],l=Array.from(e.Strophe.xmlescape(i.original_message||i.message||""));return a||(a="span"),d.forEach(function(e){for(let t=e.start;t<e.end;t++)l[t]=""}.bind(this)),s.forEach(function(e){let t=e.start,i=e.end>l.length-1?l.length-1:e.end-1,n=e.target;if(!(t>l.length-1)){if(e.is_gc){let t=n.match(/\?id=\w*/),a=n.match(/\?jid=.*/);t?n=t[0].slice(4):a?n=a[0].slice(5):(n="",e.me=!0)}else n=n.slice(5);l[t]="<"+a+" data-target=\""+n+"\" class=\"mention"+(e.me?" ground-color-100":"")+"\">"+l[t],l[i]+="</"+a+">"}}.bind(this)),o.forEach(function(e){let t=e.start,a=e.end>l.length-1?l.length-1:e.end-1;if(!(t>l.length-1)&&e.markup.length){let i="",n="";e.markup.forEach(function(e){"object"==typeof e?(i="<a target=\"_blank\" class=\"msg-hyperlink\" href=\""+e.uri+"\">"+i,n+="</a>"):(i="<"+e[0].toLowerCase()+">"+i,n+="</"+e[0].toLowerCase()+">")}.bind(this)),l[t]=i+l[t],l[a]+=n}}.bind(this)),r.forEach(function(e){let t=e.end>l.length-1?l.length-1:e.end-1;for(let a=e.start;a<e.start+n.QUOTE_MARKER.length;a++)l[a]=a===t?"<br>":"";for(let a=e.start;a<t;a++)if("\n"===l[a]){for(let e=a+1;e<=a+n.QUOTE_MARKER.length;e++)l[e]="";a+=n.QUOTE_MARKER.length-1}l[e.start]="<div class=\"quote\">",l[t]+="</div>"}.bind(this)),l.join("").trim()},render_data_form:function(e){let t=d("<div class=\"data-form\"/>");return e.fields.forEach(function(e){if("hidden"!==e.type){if("fixed"===e.type){let a=d("<div class=\"data-form-field fixed-field\"/>");e.label&&a.append(d("<div class=\"label\"/>").text(e.label)),e.values.forEach(function(e){let t=d("<div class=\"value\"/>").text(e);a.append(t)}.bind(this)),t.append(a)}if("boolean"===e.type){let a=d(`<button id=${e.var} class="data-form-field ground-color-100 btn-dark btn-flat btn-main boolean-field"/>`).text(e.label);t.append(a)}}}.bind(this)),t},copyTextToClipboard:function(e,t,a){window.navigator.clipboard&&window.navigator.clipboard.writeText(e).then(function(){if(t){this.callback_popup_message(t,1500)}}.bind(this),function(){if(a){this.callback_popup_message(a,1500)}}.bind(this))},callback_popup_message:function(e,t){let a=d(document.body),i=d("<div class=\"callback-popup-message\"/>").text(e);t=t||3e3,a.find(".callback-popup-message").remove(),a.append(i),setTimeout(function(){i.remove()},t)},emoji_size:function(e){let t;switch(e){case 1:t=56;break;case 2:t=44;break;case 3:t=32;break;case 4:t=24;break;case 5:t=22;break;default:t=20;}return t},openWindow:function(e,t){let a=window.open(e,"_blank");a?a.focus():t&&t()},clearSelection:function(){var e=window.getSelection();e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges()},isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}},emoji:t,images:a,modals:i,dialogs:i.dialogs};return p}),define("xabber-version",[],function(){return JSON.parse("{\"version_number\":\"2.0.2 (13)\",\"version_description\":\"\"}")}),define("xabber-environment",["xabber-dependencies","xabber-constants","xabber-templates","xabber-utils","xabber-version"],function(e,t,a,i,n){return _.extend({constants:t,templates:a,utils:i,uuid:i.uuid},n,e)}),function(e,t){define("xabber-core",["xabber-environment"],function(e){return t(e)})}(this,function(e){var t=e.constants,a=e._,i=e.$,n=e.uuid,s=e.utils,o=Backbone.Model.extend({defaults:{version_number:e.version_number,actual_version_number:e.version_number,audio:!1,video:!1,client_id:n().substring(0,8),client_name:"Xabber for Web "+e.version_number},initialize:function(){this.env=e,this.fetchURLParams(),this.cleanUpStorage(),this.detectMediaDevices(),window.navigator.mediaDevices.ondevicechange=this.detectMediaDevices.bind(this),this._settings=new this.Settings({id:"settings"},{storage_name:this.getStorageName(),fetch:"before"}),this.settings=this._settings.attributes,this._cache=new Backbone.ModelWithStorage({id:"cache"},{storage_name:this.getStorageName(),fetch:"before"}),this.cache=this._cache.attributes,this.cacheFavicons(),this.check_config=new i.Deferred,this.on("change:actual_version_number",this.throwNewVersion,this),this.on("quit",this.onQuit,this),this._version_interval=setInterval(this.readActualVersion.bind(this),6e5)},error:function(e){t.LOG_LEVEL>=t.LOG_LEVEL_ERROR&&console.error(e)},warn:function(e){t.LOG_LEVEL>=t.LOG_LEVEL_WARN&&console.warn(e)},info:function(e){t.LOG_LEVEL>=t.LOG_LEVEL_INFO&&console.log(e)},debug:function(e){t.LOG_LEVEL>=t.LOG_LEVEL_DEBUG&&console.log(e)},readActualVersion:function(){var e=new XMLHttpRequest;e.open("GET","version.js?"+n(),!0),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){e.onreadystatechange=null;try{var t=e.responseText,a=JSON.parse(t.split("\n")[1].slice(1,-1))}catch(t){return}this.set({actual_version_number:a.version_number,version_description:a.version_description})}}.bind(this),e.send()},onQuit:function(){var e=t.STORAGE_NAME+"-"+t.STORAGE_VERSION;for(var a in window.localStorage)a.startsWith(e)&&window.localStorage.removeItem(a)},cacheFavicons:async function(){this._cache.save("favicon",URL.createObjectURL(await fetch(t.FAVICON_DEFAULT).then(e=>e.blob()))),this._cache.save("favicon_message",URL.createObjectURL(await fetch(t.FAVICON_MESSAGE).then(e=>e.blob())))},detectMediaDevices:function(){this.getMediaDevices(function(e){this.set(e)}.bind(this))},getMediaDevices:function(e,t){window.navigator&&window.navigator.mediaDevices&&window.navigator.mediaDevices.enumerateDevices().then(function(t){let a={audio:!1,video:!1};t.find(e=>"audioinput"===e.kind)&&(a.audio=!0),t.find(e=>"videoinput"===e.kind)&&(a.video=!0),e&&e(a)}).catch(function(e){t&&t(e)})},throwNewVersion:function(){if(t.CHECK_VERSION){var e=this.get("actual_version_number"),a=this.get("version_description");s.dialogs.common("Update Xabber Web","New version "+e+" is available. <div class=\"new-version-description\">"+a+"</div> Reload page to fetch this changes?",{ok_button:{text:"yes"},cancel_button:{text:"not now"}}).done(function(e){e&&window.location.reload(!0)})}},Settings:Backbone.ModelWithStorage.extend({defaults:{max_connection_retries:-1,notifications:!0,message_preview:!1,sound:!0,sound_on_message:"beep_up",call_attention:!0,sound_on_attention:"attention",sound_on_auth_request:"beep_a",hotkeys:"enter",load_history:!0,mam_requests_limit:200,mam_messages_limit_start:1,mam_messages_limit:20,ping_interval:60,reconnect_interval:120}}),start:function(){this.check_config.done(function(e){this.check_config=void 0,e&&this.trigger("start")}.bind(this))},configure:function(i){a.extend(t,a.pick(i,["CONNECTION_URL","XMPP_SERVER_GROUPCHATS","PERSONAL_AREA_URL","LOG_LEVEL","DEBUG","XABBER_ACCOUNT_URL","API_SERVICE_URL","USE_SOCIAL_AUTH","CONTAINER","CHECK_VERSION","DEFAULT_LOGIN_SCREEN","STORAGE_NAME_ENDING","DISABLE_LOOKUP_WS"]));var n=t["LOG_LEVEL_"+t.LOG_LEVEL];if(t.LOG_LEVEL=n||t.LOG_LEVEL_ERROR,t.DEBUG&&(window.xabber=this,a.extend(window,e)),s.isMobile.any()){var o;return o=s.isMobile.iOS()?"Sorry, but Xabber for Web does not support iOS browsers. Go to <a href=\"www.xabber.com\">Xabber site</a> for more details.":s.isMobile.Android()?"Sorry, but Xabber for Web may not work correctly on your device. You should use Xabber for Android client.":"Sorry, but Xabber for Web may not work correctly on your device. Go to <a href=\"www.xabber.com\">Xabber site</a> for more details.",s.dialogs.error(o),void this.check_config.resolve(!1)}if(!t.CONNECTION_URL)return s.dialogs.error("Missing connection URL!"),void this.check_config.resolve(!1);var d=this;Backbone.useLocalStorage||this.cache.ignore_localstorage_warning||s.dialogs.warning("Your web browser does not support storing data locally. In Safari, the most common cause of this is using \"Private Browsing Mode\". So, you will need log in after page refresh again.",[{name:"ignore",text:"Don't show this message again"}]).done(function(e){e&&e.ignore&&d._cache.save("ignore_localstorage_warning",!0)}),this.requestNotifications().done(function(e){d._cache.save("notifications",e),e&&"serviceWorker"in navigator&&"PushManager"in window?d.setUpPushNotifications().done(function(e){!0!==e&&s.dialogs.error("Could not enable push notifications! "+e),d.check_config.resolve(!0)}):(e&&!d.cache.ignore_push_warning&&s.dialogs.warning("Push notifications are not supported",[{name:"ignore",text:"Don't show this message again"}]).done(function(e){e&&e.ignore&&d._cache.save("ignore_push_warning",!0)}),d._cache.save("endpoint_key",void 0),d.check_config.resolve(!0))})},fetchURLParams:function(){var e=window.location.href.split(/[?#]/);if(this.url_params={},1<e.length){var t=e[1].split("&"),a,i;for(a=0;a<t.length;a++)i=t[a].split("="),this.url_params[i[0]]=1===i.length?null:i[1]}window.history.pushState(null,null,window.location.pathname)},getStorageName:function(){var e=t.STORAGE_NAME+"-"+t.STORAGE_VERSION;return t.STORAGE_NAME_ENDING&&(e=e+"-"+t.STORAGE_NAME_ENDING),e},cleanUpStorage:function(){var e=t.STORAGE_NAME+"-"+t.STORAGE_VERSION;for(var a in window.localStorage)a.startsWith("xabber")&&!a.startsWith(e)&&window.localStorage.removeItem(a)},requestNotifications:function(){var e=new i.Deferred,t=this;return window.Notification?"granted"===window.Notification.permission?e.resolve(!0):window.Notification.requestPermission(function(a){"granted"===a||t.cache.ignore_push_warning||s.dialogs.warning("You should allow popup notifications for this site if you want to receive popups on new messages and some important push notifications.",[{name:"ignore",text:"Don't show this message again"}]).done(function(e){e&&e.ignore&&t._cache.save("ignore_push_warning",!0)}),e.resolve("granted"===a)}):(!t.cache.ignore_notifications_warning&&s.dialogs.warning("Notifications are not supported.",[{name:"ignore",text:"Don't show this message again"}]).done(function(e){e&&e.ignore&&t._cache.save("ignore_notifications_warning",!0)}),e.resolve(!1)),e.promise()},setUpPushNotifications:function(){var e=new i.Deferred,a=this;return firebase.initializeApp({apiKey:t.GCM_API_KEY,messagingSenderId:t.GCM_SENDER_ID}),navigator.serviceWorker.register("./firebase-messaging-sw.js").then(i=>{firebase.messaging().useServiceWorker(i),a.messaging=firebase.messaging(),a.messaging.requestPermission().then(function(){a.messaging.getToken().then(function(t){a._cache.save("endpoint_key",t||void 0),e.resolve(!!t||"No Instance ID token available.")}).catch(function(t){e.resolve(t)}),a.messaging.onTokenRefresh(function(){a.messaging.getToken().then(function(e){a._cache.save("endpoint_key",e)}).catch(function(){})}),navigator.serviceWorker.addEventListener("message",function(e){var i=e.data;if("push-msg-received"===i["firebase-messaging-msg-type"]){var n=i["firebase-messaging-msg-data"];if(n&&n.data&&n.from===t.GCM_SENDER_ID){var s;try{s=JSON.parse(atob(n.data.body))}catch(t){s=n.data}a.trigger("push_message",s)}}})}).catch(function(t){e.resolve({error:t})})}),e.promise()},extendWith:function(){return a.reduce(arguments,function(e,t){return t(e)},this)}});return new o}),define("xabber-views",[],function(){var e=Math.abs;return function(t){var a=t.env,i=a.constants,n=a.templates.base,s=a.utils,o=a.uuid,d=a.$,c=a._;return t.ViewPath=function(e){this.path=e.split("."),this.applyTo=function(e){for(var t=e,a=0;a<this.path.length;a++)if(!(t=c.result(t,this.path[a])))return null;return t}},t.BasicView=Backbone.View.extend({template:function(){return""},initialize:function(e){e||(e={}),this.parent=e.parent,this.vname=e.vname,this.children={},this.$el.addClass(e.classlist),e.el||this.$el.html(this.template(c.extend({view:this},i))),c.isUndefined(this.ps_selector)||(this.ps_container=this.$(this.ps_selector),this.ps_container.length&&this.ps_container.perfectScrollbar(c.extend(this.ps_settings||{},t.ps_settings))),this.data=new Backbone.Model({visible:!1}),this.data.on("change:visible",this.onChangedVisibility,this),t.on("update_css",function(e){this.updateCSS&&this.updateCSS(),e&&e.size_changed&&this.windowResized&&this.windowResized()},this),this._initialize&&this._initialize(e),this.__initialize&&this.__initialize(e)},isVisible:function(){return this.data.get("visible")},onChangedVisibility:function(){},show:function(){this.onShow.apply(this,arguments),this.data.set("visible",!0),this.trigger("after_show",this),this.updateScrollBar()},hide:function(){this.trigger("before_hide",this),this.data.set("visible",!1),this.onHide.apply(this,arguments)},onShow:function(){this.render.apply(this,arguments),c.each(this.children,function(e){e.render.apply(e,arguments)})},onHide:function(){c.each(this.children,function(e){e.onHide.apply(e,arguments)})},detach:function(){this.$el.detach()},child:function(e){return this.children[e]},addChild:function(e,t,a){var i;return t instanceof Backbone.View?(i=t,i.parent=this):i=new t(c.extend({parent:this,vname:e},a)),this.children[e]=i,i},removeChild:function(e,t){t||(t={});var a=this.children[e];a&&(delete this.children[e],t.soft?a.detach():a.trigger("remove")&&a.remove())},removeChildren:function(){c.each(c.keys(this.children),function(e){this.removeChild(e)}.bind(this))},setCustomCss:function(e){this.$el.css(e)},removeCustomCss:function(){this.$el.removeAttr("style")},saveScrollBarOffset:function(){if(this.ps_container&&this.isVisible()){var e=this.data.get("scroll_top");"undefined"==typeof e&&this.data.set("scroll_top",this.getScrollTop())}},updateScrollBar:function(){if(this.ps_container&&this.isVisible()){let e=this.data.get("scroll_top");"undefined"==typeof e?this.ps_container.perfectScrollbar("update"):(this.data.set("scroll_top",void 0),this.scrollTo(e))}return this},scrollTo:function(e){this.ps_container[0].scrollTop=e,this.ps_container.perfectScrollbar("update")},scrollToTop:function(){this.scrollTo(0)},scrollToBottom:function(){var e=this.ps_container[0].scrollHeight,t=this.ps_container[0].offsetHeight;this.scrollTo(e-t)},scrollToChild:function(e){var t=c.reduce(e.prevAll(),function(e,t){return e+t.offsetHeight+2},0);this.scrollTo(t)},getScrollTop:function(){return this.ps_container[0].scrollTop},getScrollBottom:function(){let e=this.ps_container[0].scrollTop,t=this.ps_container[0].scrollHeight,a=this.ps_container[0].offsetHeight;return t-(e+a)},getPercentScrolled:function(){if(this.isScrolledToTop())return 0;var e=this.ps_container[0].scrollTop,t=this.ps_container[0].scrollHeight,a=this.ps_container[0].offsetHeight;return e/(t-a)},isScrolledToTop:function(){return 0===this.getScrollTop()},isScrolledToBottom:function(){var e=this.ps_container[0].scrollTop,t=this.ps_container[0].scrollHeight,a=this.ps_container[0].offsetHeight;return t===e+a}}),t.NodeView=t.BasicView.extend({onShow:function(e,t){return c.each(this.children,function(e){e.hide()}),this.$el.children().detach(),t=this.patchTree(t,e)||t,c.each(this.children,function(a,i){c.has(t,i)&&("login"!==i&&this.$el.append(a.$el),this.$el.switchClass("hidden","login"===i),a.show(e,t[i]))}.bind(this)),this.render(e)},onHide:function(e){c.each(this.children,function(t){t.hide(e)})},patchTree:function(){}}),t.Container=t.BasicView.extend({className:"container",render:function(e,t){var a=t.applyTo(e);return this.$el.children().detach(),this.view!==a&&this.onHide(e),this.view=a,this.view&&(this.$el.append(this.view.$el),this.view.show(e)),this},onHide:function(e){this.view&&this.view.hide(e),this.view=null}}),t.SearchView=t.BasicView.extend({events:{"keydown .search-input":"keyUpOnSearch","focusout .search-input":"clearSearchSelection","click .close-search-icon":"clearSearch","click .list-item":"onClickItem"},keyUpOnSearch:function(e){e.stopPropagation(),this.ids=this.$(".list-item:not(.hidden)").map(function(){return d(this).data("id")}).toArray();var t=this.getSelectedItem();if(e.keyCode===i.KEY_ARROW_DOWN)return this.selectNextItem();if(e.keyCode===i.KEY_ARROW_UP)return this.selectPreviousItem();if(e.keyCode===i.KEY_ENTER&&t.length)return e.preventDefault(),this.onEnterPressed(t);if(e.keyCode===i.KEY_ESCAPE){if(e.preventDefault(),d(e.target).val())return this.clearSearch();this.close()}this.updateSearch()},getSelectedItem:function(){return this.$(".list-item[data-id=\""+this.selection_id+"\"]")},selectItem:function(e,t){if(e){this.clearSearchSelection();var a=this.$(".list-item[data-id=\""+e+"\"]");a.length?this.selection_id=e:(this.ps_container[0].scrollTop=0,a=this.$(".list-item:visible").first(),this.selection_id=a.data("id")),"down"===t&&(a[0].clientHeight+a[0].offsetTop>=this.ps_container[0].clientHeight+this.ps_container[0].scrollTop||a[0].clientHeight+a[0].offsetTop<this.ps_container[0].scrollTop)&&(this.ps_container[0].scrollTop=a[0].offsetTop),"up"===t&&(a[0].offsetTop<=this.ps_container[0].scrollTop||a[0].offsetTop>this.ps_container[0].scrollTop+this.ps_container[0].clientHeight)&&(this.ps_container[0].scrollTop=a[0].offsetTop),a.addClass("selected")}},selectNextItem:function(){this.selectItem(this.ids[this.ids.indexOf(this.selection_id)+1],"down")},selectPreviousItem:function(){this.selectItem(this.ids[this.ids.indexOf(this.selection_id)-1],"up")},updateSearch:function(){if(!this._update_search_timeout){var e=this.$(".search-input").val();this.$(".search-form").switchClass("active",e),this.clearSearchSelection(),e?this.search(e.toLowerCase()):(this.$(".list-item").removeClass("hidden"),this.onEmptyQuery()),this.updateScrollBar(),this.query=!1,this._update_search_timeout=setTimeout(function(){this._update_search_timeout=null,this.query&&this.updateSearch()}.bind(this),150)}else this.query=!0},clearSearch:function(e){e&&e.preventDefault(),this.$(".search-input").val(""),this.updateSearch()},clearSearchSelection:function(){this.selection_id=null,this.$(".list-item.selected").removeClass("selected")},searchAll:function(){this.$(".list-item").removeClass("hidden")},keyUpOnSearchWithQuery:function(){},close:function(){},search:function(){},onEnterPressed:function(){},onEmptyQuery:function(){},onClickItem:function(){}}),t.SearchPanelView=t.SearchView.extend({keyUpOnSearch:function(e){if(e.stopPropagation(),d(e.target).val())return void this.keyUpOnSearchWithQuery(e);this.ids=this.$(".list-item:not(.hidden)").map(function(){return d(this).data("id")}).toArray();var t=this.getSelectedItem();if(e.keyCode===i.KEY_ARROW_DOWN)return this.selectNextItem();if(e.keyCode===i.KEY_ARROW_UP)return this.selectPreviousItem();if(e.keyCode===i.KEY_ENTER&&t.length)return e.preventDefault(),this.onEnterPressed(t);if(e.keyCode===i.KEY_ESCAPE){if(e.preventDefault(),d(e.target).val())return this.clearSearch();this.close()}this.updateSearch()},onScrollY:function(e){if(t.all_searched_messages&&t.all_searched_messages.length&&this.queryid&&!this._loading_messages&&!this._messages_loaded&&this.isScrolledToBottom()){this._loading_messages=!0,e=e||{},this.queryid=o(),e.query_id=this.queryid;let a=t.accounts.connected;a.forEach(function(a){let i=t.all_searched_messages.find(e=>e.account.get("jid")===a.get("jid"));!i||a.searched_msgs_loaded||(e.account=a,e.before=i.get("archive_id"),this.MAMRequest(this.query_text,e,function(i){c.each(i,function(i){let n=a.chats.receiveChatMessage(i,c.extend({is_searched:!0},e)),s=t.all_searched_messages.indexOf(n),o;n&&(o=new t.MessageItemView({model:n}),0===s?o.$el.appendTo(this.$(".messages-list-wrap .messages-list")):o.$el.insertBefore(this.$(".messages-list-wrap .message-item").eq(-s)))}.bind(this)),this.$(".messages-list-wrap").switchClass("hidden",!this.$(".messages-list").children().length),this.updateScrollBar(),this._loading_messages=!1}.bind(this)))}.bind(this)),a.filter(e=>e.searched_msgs_loaded).length===a.length&&(this._messages_loaded=!0)}},onScroll:function(){},keyUpOnSearchWithQuery:function(e){e.stopPropagation(),this.ids=this.$(".searched-lists-wrap .list-item:not(.hidden)").map(function(){return d(this).data("id")}).toArray();var t=this.getSelectedItemWithQuery();if(e.keyCode===i.KEY_ARROW_DOWN)return this.selectNextItemWithQuery();if(e.keyCode===i.KEY_ARROW_UP)return this.selectPreviousItemWithQuery();if(e.keyCode===i.KEY_ENTER&&t.length)return e.preventDefault(),this.onEnterPressed(t);if(e.keyCode===i.KEY_ESCAPE){if(e.preventDefault(),d(e.target).val())return this.clearSearch();this.close()}this.updateSearch()},getSelectedItemWithQuery:function(){return this.$(".searched-lists-wrap .list-item[data-id=\""+this.selection_id+"\"]")},selectItemWithQuery:function(e,t){if(!e)return void(this.isScrolledToBottom()&&this.onScrollY());this.clearSearchSelection();var a=this.$(".searched-lists-wrap .list-item[data-id=\""+e+"\"]");a.length?this.selection_id=e:(this.ps_container[0].scrollTop=0,a=this.$(".searched-lists-wrap .list-item:visible").first(),this.selection_id=a.data("id")),"down"===t&&(a[0].clientHeight+a[0].offsetTop+a.parent().parent()[0].offsetTop>=this.ps_container[0].clientHeight+this.ps_container[0].scrollTop||a[0].clientHeight+a[0].offsetTop+a.parent().parent()[0].offsetTop<this.ps_container[0].scrollTop)&&(this.ps_container[0].scrollTop=a[0].offsetTop+a.parent().parent()[0].offsetTop),"up"===t&&(a[0].offsetTop+a.parent().parent()[0].offsetTop<=this.ps_container[0].scrollTop||a[0].offsetTop+a.parent().parent()[0].offsetTop>this.ps_container[0].scrollTop+this.ps_container[0].clientHeight)&&(this.ps_container[0].scrollTop=a[0].offsetTop+a.parent().parent()[0].offsetTop),a.addClass("selected")},selectNextItemWithQuery:function(){this.selectItemWithQuery(this.ids[this.ids.indexOf(this.selection_id)+1],"down")},selectPreviousItemWithQuery:function(){this.selectItemWithQuery(this.ids[this.ids.indexOf(this.selection_id)-1],"up")},search:function(e){this.$(this.main_container).addClass("hidden"),clearTimeout(this.keyup_timeout),this.keyup_timeout=null,this.query_text=e,this.$(".contacts-list").html(""),this.$(".chats-list").html("");let a=c.clone(t.chats);a.comparator="timestamp",a.sort("timestamp").forEach(function(a){let i=a.get("jid").toLowerCase(),n=a.contact.get("roster_name")||a.contact.get("name");if(n&&(n=n.toLowerCase()),a.get("timestamp")&&(-1<n.indexOf(e)||-1<i.indexOf(e))){let i=-1<n.indexOf(e)?"by-name":"by-jid",s=t.chats_view.child(a.get("id"));s&&(s=s.$el.clone().addClass(i)),s&&(this.$(".chats-list-wrap").removeClass("hidden"),"by-name"===i?this.$(".chats-list").prepend(s):this.$(".chats-list .by-jid").length?s.insertBefore(this.$(".chats-list .by-jid").first()):this.$(".chats-list").append(s),this.updateChatItem(s),s.click(function(){this.$(".list-item.active").removeClass("active"),t.chats_view.openChat(a.item_view,{screen:t.body.screen.get("name")}),s.addClass("active")}.bind(this)))}}.bind(this)),t.accounts.each(function(a){a.contacts.each(function(i){let n=i.get("jid").toLowerCase(),s=i.get("roster_name")||i.get("name"),o=a.chats.get(i.hash_id),c=o&&o.id;if(s&&(s=s.toLowerCase()),(!c||c&&!this.$(".chat-item[data-id=\""+c+"\"]").length)&&(-1<s.indexOf(e)||-1<n.indexOf(e))){let o=-1<s.indexOf(e)?"by-name":"by-jid",c=t.contacts_view.$(".account-roster-wrap[data-jid=\""+a.get("jid")+"\"] .list-item[data-jid=\""+n+"\"]").first().clone().data("account-jid",a.get("jid"));c.attr({"data-color":a.settings.get("color"),"data-account":a.get("jid")}).addClass(o).prepend(d("<div class=\"account-indicator ground-color-700\"/>")),"by-name"==o?this.$(".contacts-list").prepend(c):this.$(".contacts-list .by-jid").length?c.insertBefore(this.$(".contacts-list .by-jid").first()):this.$(".contacts-list").append(c),c.click(function(){this.$(".list-item.active").removeClass("active");let e=a.chats.get(i.hash_id);e&&t.chats_view.openChat(e.item_view,{clear_search:!1,screen:t.body.screen.get("name")}),c.addClass("active")}.bind(this))}}.bind(this))}.bind(this)),this.$(".chats-list-wrap").switchClass("hidden",!this.$(".chats-list").children().length),this.$(".contacts-list-wrap").switchClass("hidden",!this.$(".contacts-list").children().length),this.$(".messages-list-wrap").addClass("hidden").find(".messages-list").html(""),2<=e.length&&(this.keyup_timeout=setTimeout(function(){this.queryid=o(),this.searchMessages(e,{query_id:this.queryid})}.bind(this),1e3))},updateChatItem:function(){},searchMessages:function(e,a){this._loading_messages=!0,this._messages_loaded=!1,a=a||{},a.max||(a.max=t.settings.mam_messages_limit),a.before||(a.before=""),t.all_searched_messages=new t.SearchedMessages;let i=t.accounts.connected;i.forEach(function(i){i.searched_msgs_loaded=!1,a.account=i,this.MAMRequest(e,a,function(e){this.query_text&&(c.each(e,function(e){if(!this.query_text)return;let n=i.chats.receiveChatMessage(e,c.extend({is_searched:!0},a)),s=t.all_searched_messages.indexOf(n),o;n&&(o=new t.MessageItemView({model:n}),0===s?o.$el.appendTo(this.$(".messages-list-wrap .messages-list")):o.$el.insertBefore(this.$(".messages-list-wrap .message-item").eq(-s)))}.bind(this)),this.$(".messages-list-wrap").switchClass("hidden",!this.$(".messages-list").children().length),this.updateScrollBar(),this._loading_messages=!1)}.bind(this))}.bind(this)),i.filter(e=>e.searched_msgs_loaded).length===i.length&&(this._messages_loaded=!0)},MAMRequest:function(e,t,i,n){let s=[],c=t.account,r=o(),l=$iq({from:c.get("jid"),type:"set"}).c("query",{xmlns:Strophe.NS.MAM,queryid:r}).c("x",{xmlns:Strophe.NS.DATAFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Strophe.NS.MAM).up().up().c("field",{var:"withtext"}).c("value").t(e).up().up().up().cnode(new Strophe.RSM(t).toXML()),p=c.connection.addHandler(function(e){let a=d(e);return a.find("result").attr("queryid")===r&&t.query_id===this.queryid&&s.push(e),!0}.bind(this),a.Strophe.NS.MAM);c.sendIQ(l,function(e){c.connection.deleteHandler(p);var t=d(e).find("fin[xmlns=\""+Strophe.NS.MAM+"\"]");if(t.length&&t.attr("queryid")===r){var a="true"===t.attr("complete");a&&(c.searched_msgs_loaded=!0)}i&&i(s)},function(){c.connection.deleteHandler(p),n&&n()})},clearSearch:function(e){e&&e.preventDefault(),this.$(".search-input").val(""),this.updateSearch(),this.onEmptyQuery()},onEmptyQuery:function(){t.accounts.forEach(function(e){e.searched_msgs_loaded=!1}),this.query_text=null,this.queryid=null,this._messages_loaded=!1,this._loading_messages=!1,this.$(this.main_container).removeClass("hidden"),this.$(".chats-list-wrap").addClass("hidden"),this.$(".contacts-list-wrap").addClass("hidden"),this.$(".messages-list-wrap").addClass("hidden")}}),t.InputWidget=Backbone.View.extend({field_type:"text",template:n.input_widget,events:{"click .field-text":"showInput","click .btn-rename":"showInput","keydown .field-input":"keyDown","keyup .field-input":"keyUp","focusout .field-input":"changeValue"},initialize:function(){this.$el.html(this.template({field_name:this.field_name,field_type:this.field_type,placeholder:this.placeholder})),this.$value=this.$(".field-text"),this.$btn=this.$(".btn-rename"),this.$input=this.$(".field-input"),this.updateValue(),this.data=new Backbone.Model({input_mode:!1}),this.data.on("change:input_mode",this.onChangedInputMode,this),this.bindModelEvents()},bindModelEvents:function(){this.model.on("change:"+this.model_field,this.updateValue,this)},showInput:function(){this.data.set("input_mode",!0),this.updateValue()},onChangedInputMode:function(){var e=this.data.get("input_mode");this.$value.hideIf(e),this.$btn.hideIf(e),this.$input.showIf(e).focus()},keyDown:function(e){e.stopPropagation();var t=this.getValue();e.keyCode===i.KEY_ENTER?this.changeValue():e.keyCode===i.KEY_ESCAPE&&(this.$input.removeClass("changed").val(t),this.data.set("input_mode",!1))},keyUp:function(){var e=this.getValue();this.$input.switchClass("changed",this.$input.val()!==e)},getValue:function(){return this.model.get(this.model_field)},setValue:function(e){this.model.save(this.model_field,e)},changeValue:function(){var e=this.getValue(),t=this.$input.removeClass("changed").val();t!==e&&this.setValue(t),this.data.set("input_mode",!1)},updateValue:function(){var e=this.getValue();this.$value.text(e),this.$input.val(e)}}),t.Body=t.NodeView.extend({className:"client-body-wrap",_initialize:function(){this.vname="body",this.data.set("visible",!0),this.screen=new Backbone.Model,this.screen_map=new Backbone.Model,this.screen.on("change",this.update,this),this.screen_map.on("change",this.onScreenMapChanged,this),d("body").append(this.$el),d("#modals").insertAfter(this.$el)},addScreen:function(e,t){this.screen_map.set(e,t)},setScreen:function(e,t,a){d("body").switchClass("login","login"===e),d("body").switchClass("on-login","login"!==e);var i={stamp:c.uniqueId()};e&&!this.isScreen(e)&&(i.name=e),this.screen.set(c.extend(i,t),a)},isScreen:function(e){return this.screen.get("name")===e},onScreenMapChanged:function(){var e=this.screen.get("name");c.has(this.screen_map.changed,e)&&this.update()},update:function(){var e=this.screen.attributes,t=this.screen_map.get(e.name);"undefined"!=typeof t&&(this.onShow(e,t),this.model.trigger("update_screen",this.screen.get("name")),this.model.trigger("update_layout",{screen_changed:e.name}))}}),t.ToolbarView=t.BasicView.extend({className:"toolbar noselect",ps_selector:".accounts",ps_settings:{theme:"item-list"},template:n.toolbar,events:{"click .all-chats":"showAllChats","click .chats":"showChats","click .group-chats":"showGroupChats","click .contacts":"showContacts","click .search":"showSearch","click .archive-chats":"showArchive","click .mentions":"showMentions","click .settings":"showSettings","click .add-variant.contact":"showAddContactView","click .add-variant.account":"showAddAccountView","click .add-variant.groupchat":"showAddGroupChatView","click .about":"showAbout"},_initialize:function(){var e=d("<div class=\"lean-overlay toolbar-menu\"></div>");this.$(".add-something").on("change_state",function(t,a){d(this).switchClass("active",a).find(".mdi").switchClass("mdi-close",a).switchClass("mdi-plus",!a),a?e.appendTo("body"):e.detach()}),t.on("update_screen",this.onUpdatedScreen,this),this.data.on("change:add_menu_state",this.onChangedAddMenuState,this),this.data.on("change:all_msg_counter",this.onChangedAllMessageCounter,this),this.data.on("change:group_msg_counter",this.onChangedGroupMessageCounter,this),this.data.on("change:mentions_counter",this.onChangedMentionsCounter,this),this.data.on("change:msg_counter",this.onChangedMessageCounter,this),this.data.set({msg_counter:0}),this.data.set({group_msg_counter:0}),this.data.set({all_msg_counter:0}),this.data.set({mentions_counter:0})},render:function(){this.$(".add-something").dropdown({inDuration:50,outDuration:50,constrainWidth:!1,hover:!1,alignment:"left"})},onUpdatedScreen:function(e){"account_settings"===e||"all-chats"===e&&(this.$(".toolbar-item.all-chats").hasClass("active")||this.$(".toolbar-item.group-chats").hasClass("active")||this.$(".toolbar-item.chats").hasClass("active")||this.$(".toolbar-item.account-item").hasClass("active")||this.$(".toolbar-item.archive-chats").hasClass("active"))||(this.$(".toolbar-item").removeClass("active unread"),c.contains(["all-chats","contacts","mentions","settings","search","about"],e)&&this.$(".toolbar-item."+e).addClass("active"))},showAllChats:function(e){let a=d(e.target).closest(".toolbar-item"),i=a.hasClass("active")&&!a.hasClass("unread");this.$(".toolbar-item").removeClass("active unread").filter(".all-chats").addClass("active").switchClass("unread",i),t.body.setScreen("all-chats",{right:null})},showChats:function(e){let a=d(e.target).closest(".toolbar-item"),i=a.hasClass("active")&&!a.hasClass("unread");this.$(".toolbar-item").removeClass("active unread").filter(".chats").addClass("active").switchClass("unread",i),t.body.setScreen("all-chats",{right:null}),t.trigger("show_chats")},showGroupChats:function(e){let a=d(e.target).closest(".toolbar-item"),i=a.hasClass("active")&&!a.hasClass("unread");this.$(".toolbar-item").removeClass("active unread").filter(".group-chats").addClass("active").switchClass("unread",i),t.body.setScreen("all-chats",{right:null}),t.trigger("show_group_chats")},showArchive:function(){this.$(".toolbar-item").removeClass("active unread").filter(".archive-chats").addClass("active"),t.body.setScreen("all-chats",{right:null}),t.trigger("show_archive_chats")},showChatsByAccount:function(e){this.$(".toolbar-item").removeClass("active unread").filter(".account-item[data-jid=\""+e.get("jid")+"\"]").addClass("active"),t.body.setScreen("all-chats",{right:null}),t.trigger("show_account_chats",[e])},showSearch:function(){t.body.setScreen("search")},showContacts:function(){t.body.setScreen("contacts")},showMentions:function(){t.body.setScreen("mentions")},showSettings:function(){t.body.setScreen("settings")},showAddContactView:function(){t.trigger("add_contact",{right:null})},showAddAccountView:function(){t.trigger("add_account",{right:null})},showAddGroupChatView:function(){t.trigger("add_group_chat",{right:null})},showAbout:function(){t.body.setScreen("about")},setAllMessageCounter:function(){var e=0,a=0,i=0,n=0;return t.accounts.each(function(t){t.chats.each(function(t){t.contact.get("muted")||(a+=t.get("unread")+t.get("const_unread"),t.contact.get("group_chat")?i+=t.get("unread")+t.get("const_unread"):e+=t.get("unread")+t.get("const_unread"))}.bind(this)),n+=t.unreaded_mentions.length}.bind(this)),{msgs:e,all_msgs:a,group_msgs:i,mentions:n}},recountAllMessageCounter:function(){let e=this.setAllMessageCounter();this.data.set("all_msg_counter",e.all_msgs),this.data.set("msg_counter",e.msgs),this.data.set("group_msg_counter",e.group_msgs),this.data.set("mentions_counter",e.mentions)},onChangedMessageCounter:function(){var e=this.data.get("msg_counter");this.$(".msg-indicator").switchClass("unread",e).text()},onChangedGroupMessageCounter:function(){var e=this.data.get("group_msg_counter");this.$(".group-msg-indicator").switchClass("unread",e).text()},onChangedMentionsCounter:function(){var e=this.data.get("mentions_counter");this.$(".mentions-indicator").switchClass("unread",e).text()},onChangedAllMessageCounter:function(){var e=this.data.get("all_msg_counter");this.$(".all-msg-indicator").switchClass("unread",e).text(e)}}),t.JingleMessageView=t.BasicView.extend({className:"modal main-modal jingle-message-view",template:n.jingle_message_calling,avatar_size:i.AVATAR_SIZES.XABBER_VOICE_CALL_VIEW,events:{click:"clickOnWindow","click .btn-accept":"accept","click .btn-share-screen":"shareScreen","click .btn-microphone":"toggleMicrophone","click .btn-video":"videoCall","click .btn-volume":"toggleVolume","click .btn-collapse":"collapse","click .btn-cancel":"cancel","click .btn-full-screen":"setFullScreen"},_initialize:function(e){this.model=e.model,this.model.on("destroy",this.onDestroy,this),this.contact=this.model.contact,this.account=this.contact.account,this.model.on("change:state",this.updateCallingStatus,this),this.model.on("change:status",this.updateBackground,this),this.model.on("change:volume_on",this.updateButtons,this),this.model.on("change:video",this.updateButtons,this),this.model.on("change:video_live",this.updateButtons,this),this.model.on("change:video_in",this.updateCollapsedWindow,this),this.model.on("change:audio",this.updateButtons,this)},render:function(e){e=e||{},this.updateName(),this.updateCallingStatus(e.status),"in"===e.status?this.updateStatusText("Calling..."):this.model.set("status","calling"),this.updateAccountJid(),this.updateButtons(),this.$el.openModal({dismissible:!1,ready:function(){this.updateAvatar()}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1)}.bind(this)})},setFullScreen:function(){let e=this.$el.find(".webrtc-remote-video")[0],t=this.$el.find(".webrtc-local-video")[0],a=this.$el.find(".buttons-panel")[0];e&&(e.requestFullScreen?(e.requestFullScreen(),t.requestFullScreen(),a.requestFullScreen()):e.webkitRequestFullScreen?(e.webkitRequestFullScreen(),t.webkitRequestFullScreen(),a.webkitRequestFullScreen()):e.mozRequestFullScreen?(e.mozRequestFullScreen(),t.mozRequestFullScreen(),a.mozRequestFullScreen()):e.msRequestFullScreen&&(e.msRequestFullScreen(),t.msRequestFullScreen(),a.msRequestFullScreen()))},cancelFullScreen:function(){if(document.exitFullscreen){let e=document.fullscreenElement;e&&document.exitFullscreen().then(function(){document.fullscreenElement&&this.cancelFullScreen()}.bind(this))}else if(document.mozCancelFullScreen){let e=document.mozFullScreenElement;e&&document.mozCancelFullScreen(),document.mozFullScreenElement&&this.cancelFullScreen()}else if(document.webkitExitFullscreen){let e=document.webkitCurrentFullScreenElement;e&&document.webkitExitFullscreen(),document.webkitCurrentFullScreenElement&&this.cancelFullScreen()}else if(document.msExitFullscreen){let e=document.msFullscreenElement;e&&document.msExitFullscreen(),document.msFullscreenElement&&this.cancelFullScreen()}},windowResized:function(){this.$el.hasClass("collapsed")&&this.$el.css("right",parseInt(t.main_panel.$el.css("margin-right"))+8+"px")},updateButtons:function(){this.$(".btn-video .video").switchClass("hidden",!this.model.get("video")),this.$(".btn-share-screen").switchClass("active",this.model.get("video_screen")),this.$(".btn-full-screen").switchClass("hidden",!this.model.get("video_in")),this.$(".btn-video").switchClass("mdi-video",this.model.get("video_live")).switchClass("mdi-video-off",!this.model.get("video_live")),this.$(".btn-volume").switchClass("mdi-volume-high",this.model.get("volume_on")).switchClass("mdi-volume-off",!this.model.get("volume_on")),this.$(".btn-microphone").switchClass("mdi-microphone",this.model.get("audio")).switchClass("mdi-microphone-off",!this.model.get("audio"))},updateAvatar:function(){let e=this.contact.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateBackground:function(){let e=this.model.get("status");this.$el.attr("data-state",e)},updateCallingStatus:function(e){this.$(".buttons-wrap").switchClass("incoming","in"===e)},updateStatusText:function(e){this.$(".calling-status").text(e||"")},updateName:function(){this.$(".name").text(this.contact.get("name"))},updateAccountJid:function(){this.$(".modal-footer .contact-info .jid").text(this.contact.get("jid"))},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},shareScreen:function(){this.model.set("video_screen",!this.model.get("video_screen"))},isFullScreen:function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement||!!document.mozFullScreenElement},accept:function(){this.model.accept(),this.updateCallingStatus(i.JINGLE_MSG_ACCEPT),this.model.initSession()},clickOnWindow:function(){this.$el.hasClass("collapsed")&&this.$el.hasClass("collapsed-video")&&this.collapse()},collapse:function(e){if(e&&e.stopPropagation(),this.isFullScreen())return void this.cancelFullScreen();let t=this.$el.closest("#modals").siblings("#"+this.$el.data("overlayId"));t.toggle(),this.$el.toggleClass("collapsed"),this.$el.hasClass("collapsed")?(this.model.get("video")||this.model.get("video_in"))&&this.$el.addClass("collapsed-video"):this.$el.css("right",""),this.windowResized()},updateCollapsedWindow:function(){this.updateButtons(),this.$el.hasClass("collapsed")&&this.$el.switchClass("collapsed-video",this.model.get("video")||this.model.get("video_in"))},toggleMicrophone:function(){this.model.set("audio",!this.model.get("audio"))},onDestroy:function(){this.updateStatusText("Disconnected"),setTimeout(function(){this.close(),this.$el.detach()}.bind(this),3e3)},videoCall:function(){this.model.set("video_live",!this.model.get("video_live"))},toggleVolume:function(e){let t=d(e.target);t.switchClass(this.model.set("volume_on",!this.model.get("volume_on")))},cancel:function(){this.model.reject(),this.close()}}),t.SettingsView=t.BasicView.extend({className:"settings-panel",template:n.settings,ps_selector:".panel-content",events:{"click .settings-tabs-wrap .settings-tab":"jumpToBlock","mousedown .setting.notifications label":"setNotifications","mousedown .setting.message-preview label":"setMessagePreview","mousedown .setting.call-attention label":"setCallAttention","change .sound input[type=radio][name=sound]":"setSound","change .hotkeys input[type=radio][name=hotkeys]":"setHotkeys","click .settings-tab.delete-all-accounts":"deleteAllAccounts"},_initialize:function(){this.$(".xabber-info-wrap .version").text(t.get("version_number"))},render:function(){var e=this.model.attributes;this.$(".notifications input[type=checkbox]").prop({checked:e.notifications}),this.$(".message-preview input[type=checkbox]").prop({checked:e.message_preview}),this.$(".call-attention input[type=checkbox]").prop({checked:e.call_attention});var t=e.sound?e.sound_on_message:"";return this.$(".sound input[type=radio][name=sound][value=\""+t+"\"]").prop("checked",!0),this.$(".hotkeys input[type=radio][name=hotkeys][value="+e.hotkeys+"]").prop("checked",!0),this},jumpToBlock:function(e){var t=d(e.target).closest(".settings-tab"),a=this.$(".settings-block-wrap."+t.data("block-name"));return t.hasClass("link-button")?(t.parent().siblings().removeClass("active"),void this.scrollTo(0)):void(t.addClass("active").siblings().removeClass("active"),this.scrollToChild(a))},setNotifications:function(e){var t=!this.model.get("notifications");this.model.save("notifications",t),e.preventDefault(),d(e.target).closest("input").prop("checked",t)},setMessagePreview:function(e){var t=!this.model.get("message_preview");this.model.save("message_preview",t),e.preventDefault(),d(e.target).closest("input").prop("checked",t)},setCallAttention:function(e){var t=!this.model.get("call_attention");this.model.save("call_attention",t),e.preventDefault(),d(e.target).closest("input").prop("checked",t)},setSound:function(e){var a=e.target.value;a?(t.playAudio(a),this.model.save({sound:!0,sound_on_message:a})):this.model.save("sound",!1)},setHotkeys:function(e){this.model.save("hotkeys",e.target.value)},deleteAllAccounts:function(){s.dialogs.ask("Quit Xabber Web","Do you really want to quit Xabber? You will quit from all currently logged in XMPP accounts.",null,{ok_button_text:"quit"}).done(function(e){e&&t.trigger("quit")})}}),t.AboutView=t.BasicView.extend({className:"settings-panel about-panel",template:n.about,ps_selector:".panel-content",_initialize:function(){this.$(".xabber-info-wrap .version").text(this.model.get("version_number"))},render:function(){}}),t.DragManager=Backbone.Model.extend({initialize:function(){window.document.onmousedown=this.onMouseDown.bind(this),window.document.onmousemove=this.onMouseMove.bind(this),window.document.onmouseup=this.onMouseUp.bind(this)},onMouseDown:function(e){if(1==e.which){var t=e.target.closest(".drag-handle"),a=t&&t.closest(".draggable");return a?void this.set({elem:a,draghandle_elem:t,downX:e.pageX,downY:e.pageY}):this.resetElem()}},onMouseMove:function(t){if(this.get("elem")){var a=this.get("avatar");if(!a){if(3>e(t.pageX-this.get("downX"))&&3>e(t.pageY-this.get("downY")))return;if(a=this.createAvatar(t),!a)return this.resetElem();this.set("avatar",a);var i=this.getCoords(a);this.set({shiftX:this.get("downX")-i.left,shiftY:this.get("downY")-i.top}),this.startDrag(t)}a.style.left=t.pageX-this.get("shiftX")+"px",a.style.top=t.pageY-this.get("shiftY")+"px";var n=this.findDropElem(t);this.updateDropElem(n)}},onMouseUp:function(e){var t=document.querySelector(".recording");return t?void d(t).removeClass("recording"):void(this.get("avatar")&&this.finishDrag(e),this.resetElem())},resetElem:function(){this.set({elem:null,draghandle_elem:null,avatar:null})},getCoords:function(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset,left:t.left+window.pageXOffset}},createAvatar:function(){var e=this.get("elem"),t=d(e),a=this.get("draghandle_elem"),i={parent:e.parentNode,nextSibling:e.nextSibling,position:e.position||"",left:e.left||"",top:e.top||"",zIndex:e.zIndex||"",avatar_cursor:e.style.cursor||"",draghandle_elem_cursor:a.style.cursor||""};return t.addClass("dragging"),e.style.cursor="-webkit-grabbing",a.style.cursor="-webkit-grabbing",e.rollback=function(){i.parent.insertBefore(e,i.nextSibling),t.removeClass("dragging"),e.style.position=i.position,e.style.left=i.left,e.style.top=i.top,e.style.zIndex=i.zIndex,e.style.cursor=i.avatar_cursor,a.style.cursor=i.draghandle_elem_cursor},e},startDrag:function(){var e=this.get("avatar");window.document.body.appendChild(e),e.style.zIndex=9999,e.style.position="absolute"},finishDrag:function(e){var t=this.get("elem"),a=this.get("avatar"),i=this.findDropElem(e);a.rollback(),this.updateDropElem(null),t&&i&&(d(t).trigger("drag_to",i),d(i).trigger("drag_from",t))},findDropElem:function(e){var t=this.get("avatar");t.hidden=!0;var a=window.document.elementFromPoint(e.clientX,e.clientY);return t.hidden=!1,a?a.closest(".droppable"):null},updateDropElem:function(e){var t=this.get("drop_elem");this.set("drop_elem",e),t&&d(t).removeClass("drag-on"),e&&d(e).addClass("drag-on")}}),c.extend(t,{modal_settings:{open:{in_duration:50,out_duration:100,opacity:.4},close:{out_duration:100}},ps_settings:{minScrollbarLength:40,suppressScrollX:!0,wheelSpeed:.5},startBlinkingFavicon:function(){this._blink_interval||(this._blink_interval=setInterval(function(){var e=d("link[rel='shortcut icon']"),t;t=-1<e.attr("href").indexOf(this.cache.favicon)||-1<e.attr("href").indexOf(i.FAVICON_DEFAULT)?this.cache.favicon_message||i.FAVICON_MESSAGE:this.cache.favicon||i.FAVICON_DEFAULT,e.attr("href",t)}.bind(this),1e3))},stopBlinkingFavicon:function(){if(this._blink_interval){clearInterval(this._blink_interval),this._blink_interval=null;let e=this.cache.favicon||i.FAVICON_DEFAULT;d("link[rel='shortcut icon']").attr("href",e)}},onChangedAllMessageCounter:function(){this.get("all_msg_counter")?(this.startBlinkingFavicon(),window.document.title="Messages ("+this.get("all_msg_counter")+")"):(this.stopBlinkingFavicon(),window.document.title="Xabber Web")},setAllMessageCounter:function(){let e=0;return t.accounts.each(function(t){t.chats.each(function(t){t.contact.get("muted")||(e+=t.get("unread")+t.get("const_unread"))}.bind(this))}.bind(this)),e},recountAllMessageCounter:function(){this.set("all_msg_counter",this.setAllMessageCounter())},resetMessageCounter:function(){this.set("all_msg_counter",0)},onChangedFocusState:function(){this.get("focused")&&this.resetMessageCounter()},openWindow:function(e){s.openWindow(e,function(){s.dialogs.error("Could not open new tab. Please allow popups")}.bind(this))},popupNotification:function(e){var t=new window.Notification(e.title,{body:e.text,icon:e.icon});return setTimeout(t.close.bind(t),5e3),t},playAudio:function(e,t){t=t||!1;var a=i.SOUNDS[e];if(a){var n=new window.Audio(a);return n.loop=t,n.play(),n}},stopAudio:function(e){e&&(e.pause(),e.remove())},registerDOMEvents:function(){var e=this;d(window).on("blur focus",function(t){e.set("focused","focus"===t.type)}),d(window).on("resize",function(){e.set({width:window.innerWidth,height:window.innerHeight}),e.trigger("update_layout",{size_changed:!0})}),window.document.body.ondragover=function(e){e.preventDefault()},window.document.body.ondrop=function(e){e.preventDefault()}}}),t.once("start",function(){this.set("all_msg_counter",0),this.on("change:all_msg_counter",this.onChangedAllMessageCounter,this),this.on("change:focused",this.onChangedFocusState,this),this.set({focused:window.document.hasFocus(),width:window.innerWidth,height:window.innerHeight}),this.registerDOMEvents(),Materialize.modalSettings=this.modal_settings,this.drag_manager=new this.DragManager,this.body=new this.Body({model:this}),this.login_page=this.body.addChild("login",this.NodeView,{classlist:"login-page-wrap",el:d(document).find(".login-container")[0]}),this.toolbar_view=this.body.addChild("toolbar",this.ToolbarView),this.main_panel=this.body.addChild("main",this.NodeView,{classlist:"main-wrap"}),this.left_panel=this.main_panel.addChild("left",this.NodeView,{classlist:"panel-wrap left-panel-wrap"}),this.right_panel=this.main_panel.addChild("right",this.NodeView,{classlist:"panel-wrap right-panel-wrap"}),this.wide_panel=this.main_panel.addChild("wide",this.NodeView,{classlist:"panel-wrap wide-panel-wrap"}),this.settings_view=this.wide_panel.addChild("settings",this.SettingsView,{model:this._settings}),this.about_view=this.wide_panel.addChild("about",this.AboutView,{model:this})},t),t}}),define("xabber-api-service",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.api_service,n=t.utils,s=t.$,o=t._;return e.AccountSettings=Backbone.Model.extend({idAttribute:"jid",defaults:{timestamp:0,to_sync:!1,synced:!1,deleted:!1},update_timestamp:function(){this.save("timestamp",n.now())},update_settings:function(e){this.save(o.extend({timestamp:n.now()},e))},request_data:function(){return{jid:this.get("jid"),timestamp:this.get("timestamp"),settings:o.omit(this.attributes,["jid","timestamp","order","to_sync","synced","deleted"])}}}),e.AccountSettingsList=Backbone.CollectionWithStorage.extend({model:e.AccountSettings,create_from_server:function(e){var t=this.create(o.extend({jid:e.jid,timestamp:e.timestamp,to_sync:!0,synced:!0},e.settings));return this.trigger("add_settings",t),t}}),e.AccountsOrderTimestamp=Backbone.ModelWithStorage.extend({defaults:{timestamp:0}}),e.APIAccount=Backbone.ModelWithStorage.extend({defaults:{token:null,sync_all:!0},_initialize:function(t,a){if(this.list=a.settings_list,this.save({connected:!1,sync_request:"silent"}),this.on("change:connected",function(){this.get("connected")?this.fcm_subscribe():this.fcm_unsubscribe()},this),this.on("change:token",function(){null!==this.get("token")&&this.save({sync_all:!0,sync_request:this.list.length?"window":"silent"})},this),this.list.on("change:to_sync",function(e){this.get("sync_all")&&!e.get("to_sync")&&this.save("sync_all",!1)},this),e.on("push_message",function(e){this.get("connected")&&e.username===this.get("username")&&e.from_token!==this.get("token")&&"settings_updated"===e.action&&(this.synchronize_main_settings(),this.synchronize_order_settings()),this.get("connected")&&e.username===this.get("username")&&e.from_token!==this.get("token")&&"account_updated"===e.action&&this.get_settings()},this),this.ready=new s.Deferred,e.url_params.social_auth){var i=e.url_params.social_auth;delete e.url_params.social_auth;try{var n=JSON.parse(atob(i));return this.save("token",null),void this.social_login(n)}catch(t){}}e.url_params.token&&(this.save("token",e.url_params.token),delete e.url_params.token),this.get("token")?this.login_by_token():this.ready.resolve()},_call_method:function(e,t,i,n,o){var d={type:e,url:a.API_SERVICE_URL+t,headers:{Authorization:"Token "+this.get("token")},context:this,contentType:"application/json",dataType:"json",success:function(e){n&&n(e)},error:function(e){this.onAPIError(e,o)}.bind(this)};i&&(d.data=JSON.stringify(i)),s.ajax(d)},add_source:function(t){return o.extend({source:"Xabber Web "+e.get("version_number")},t)},get_settings:function(){null===this.get("token")?this.trigger("settings_result",null):this._call_method("GET","/accounts/current/",null,function(e){"registered"===e.account_status?(this.onUserData(e),this._call_method("GET","/accounts/current/client-settings/",null,this.onSettings.bind(this),this.onSettingsFailed.bind(this))):(n.dialogs.error("Your Xabber account has not permission to synchronize settings of XMPP accounts!"),this.save({token:null,connected:!1}),this.trigger("settings_result",null))}.bind(this),this.onSettingsFailed.bind(this))},delete_settings:function(e){this.get("connected")?this._call_method("DELETE","/accounts/current/client-settings/",{jid:e},this.onSettings.bind(this),this.onSettingsFailed.bind(this)):this.trigger("settings_result",null)},synchronize_main_settings:function(){if(this.get("connected")){var e=o.map(this.list.where({to_sync:!0}),function(e){return e.request_data()});e.length?this._call_method("PATCH","/accounts/current/client-settings/",{settings_data:e},this.onSettings.bind(this),this.onSettingsFailed.bind(this)):this.get_settings()}else this.trigger("settings_result",null)},synchronize_order_settings:function(){if(this.get("connected")&&this.get("sync_all")){var e=this.list.order_timestamp.get("timestamp"),t=this.list.map(function(e){return{jid:e.get("jid"),order:e.get("order")}});this._call_method("PATCH","/accounts/current/client-settings/",{order_data:{settings:t,timestamp:e}},this.onSettings.bind(this),this.onSettingsFailed.bind(this))}else this.trigger("settings_result",null)},fetch_from_server:function(e){var t=e.deleted,a=e.settings_data,i=e.order_data.timestamp,s=e.order_data.settings,d=this.list,c=this.get("sync_all");if(o.each(t,function(e){var t=d.get(e.jid);t&&t.get("to_sync")&&t.get("timestamp")<=e.timestamp&&t.trigger("delete_account",!0)}),o.each(a,function(e){var t=d.get(e.jid);t&&(t.get("to_sync")?t.save(o.extend({timestamp:e.timestamp,deleted:!1,synced:!0},e.settings)):t.save("synced",e.timestamp>=t.get("timestamp"))),!t&&c&&(t=d.create_from_server(e))}),c){var r={},l=1;o.each(s,function(e){r[e.jid]=e.order,e.order>l&&(l=e.order)}),d.order_timestamp.save("timestamp",i),d.each(function(e){var t=e.get("jid"),a=r[t];a||(l+=1,a=l),e.save("order",a)})}this.trigger("settings_result",e),this.save("last_sync",n.now())},onAPIError:function(e,t){var a=e.status,i=e.responseJSON;403===a&&(this.save({connected:!1,token:null}),"Invalid token"===i.detail&&("not_found"===i.reason||("revoked"===i.reason?o.each(this.list.where({to_sync:!0}),function(e){e.trigger("delete_account",!0)}):"expired"===i.reason&&n.dialogs.common("Error","Token for your Xabber account expired. Do you want relogin?",{ok_button:{text:"yes"},cancel_button:{text:"not now"}}).done(function(e){e&&this.trigger("relogin")}.bind(this))))),t&&t(i,a)},_login:function(e,t,i){var o={type:"POST",url:a.API_SERVICE_URL+"/accounts/login/",contentType:"application/json",dataType:"json",data:JSON.stringify(this.add_source()),success:t,error:function(e){this.onAPIError(e,i)}.bind(this)};if(e.token)o.headers={Authorization:"Token "+e.token};else{var d=e.username,c=e.password;o.headers={Authorization:"Basic "+n.utoa(d+":"+c)}}s.ajax(o)},login:function(e,t){this._login({username:e,password:t},this.onLogin.bind(this),this.onLoginFailed.bind(this))},login_by_token:function(){this._login({token:this.get("token")},this.onLoginByToken.bind(this),this.onLoginByTokenFailed.bind(this))},social_login:function(e){s.ajax({type:"POST",url:a.API_SERVICE_URL+"/accounts/social_auth/",contentType:"application/json",dataType:"json",data:JSON.stringify(this.add_source(e)),success:this.onSocialLogin.bind(this),error:function(e){this.onAPIError(e,this.onSocialLoginFailed.bind(this))}.bind(this)})},revoke_token:function(){var e=this.get("token");null!==e&&this._call_method("delete","/accounts/current/tokens/",{token:e}),this.save({connected:!1,token:null}),this.storage.clear()},onLoginByToken:function(e){this.save({token:e.token,connected:!0,sync_request:"silent"}),this.get_settings(),this.ready.resolve()},onLoginByTokenFailed:function(){this.save("connected",!1),this.ready.resolve()},onLogin:function(e){this.save({token:e.token,connected:!0}),this.get_settings()},onLoginFailed:function(e){this.save("connected",!1),this.trigger("login_failed",e)},onSocialLogin:function(t){this.save({token:t.token,connected:!0}),e.body.setScreen("settings"),this.ready.resolve()},onSocialLoginFailed:function(){this.save("connected",!1),e.body.setScreen("settings"),n.dialogs.error("Authentication failed for Xabber account."),this.ready.resolve()},onUserData:function(e){var t,a;t=e.first_name&&e.last_name?e.first_name+" "+e.last_name:e.username,e.xmpp_binding&&(a=e.xmpp_binding.jid),this.save({username:e.full_id,name:t,linked_email_list:e.email_list,linked_social:e.social_bindings,xmpp_binding:a})},onSettings:function(e){var t=this.get("sync_request");this.save("sync_request",void 0),"window"===t?this.trigger("open_sync_window",e):this.fetch_from_server(e)},onSettingsFailed:function(){this.trigger("settings_result",null)},logout:function(){n.dialogs.ask("Quit","You will quit from Xabber Account. You will not be able to use enhanced Xabber services, but basic XMPP will work as usual.",[{name:"delete_accounts",checked:!0,text:"Delete synced XMPP accounts"}],{ok_button_text:"quit"}).done(function(t){t&&(0<e.accounts.connected.length&&o.each(e.accounts.connected,function(e){e.set("auto_login_xa",!1),e.save("auto_login_xa",!1)}.bind(this)),this.revoke_token(),t.delete_accounts&&o.each(this.list.where({to_sync:!0}),function(e){e.trigger("delete_account",!0)}))}.bind(this))},start:function(){this.get("connected")||this.fcm_unsubscribe(),this.get_settings()},fcm_subscribe:function(){this._call_method("post","/fcm/subscription/",{endpoint_key:e.cache.endpoint_key})},fcm_unsubscribe:function(){s.ajax({type:"DELETE",url:a.API_SERVICE_URL+"/fcm/subscription/",contentType:"application/json",dataType:"json",data:JSON.stringify({endpoint_key:e.cache.endpoint_key})})}}),e.APIAccountAuthView=e.BasicView.extend({_initialize:function(){return this.$username_input=this.$("input[name=username]"),this.$password_input=this.$("input[name=password]"),this.data.on("change:authentication",this.onChangeAuthenticationState,this),this},onRender:function(){this.authFeedback({}),Materialize.updateTextFields(),this.$username_input.val("").focus(),this.$password_input.val(""),this.updateButtons()},keyUp:function(e){e.keyCode===a.KEY_ENTER&&this.submit()},submit:function(){if(this.data.get("authentication"))return void this.cancel();this.data.set("authentication",!0),this.authFeedback({});var e=this.$username_input.val(),t=this.$password_input.val();return e?t?void(this.authFeedback({password:"Authentication..."}),this.model.login(e,t)):this.errorFeedback({password:"Please input password!"}):this.errorFeedback({username:"Please input username!"})},cancel:function(){this.data.set("authentication",!1),this.onRender()},authFeedback:function(e){this.$username_input.switchClass("invalid",e.username).siblings("span.errors").text(e.username||""),this.$password_input.switchClass("invalid",e.password).siblings("span.errors").text(e.password||"")},errorFeedback:function(e){this.authFeedback(e),this.data.set("authentication",!1)},updateButtons:function(){var e=this.data.get("authentication");this.$(".btn-log-in").switchClass("disabled",e)},onChangeAuthenticationState:function(){this.updateButtons(),this.data.get("authentication")?(this.model.on("change:connected",this.onChangeConnected,this),this.model.on("login_failed",this.onLoginFailed,this)):(this.model.off("change:connected",this.onChangeConnected,this),this.model.off("login_failed",this.onLoginFailed,this))},onChangeConnected:function(){this.model.get("connected")&&this.successFeedback()},onLoginFailed:function(e){this.errorFeedback({password:e&&e.detail||"Authentication failed"})},socialAuth:function(t){var i=window.location.href,n=s(t.target).closest(".btn-social").data("provider");"email"==n?(this.closeModal(),e.email_auth_view.show()):window.location.href=a.XABBER_ACCOUNT_URL+"/social/login/"+n+"/?origin="+i+"&source=Xabber Web"}}),e.XabberLoginByEmailPanel=e.APIAccountAuthView.extend({className:"login-panel add-xabber-account-panel",template:i.xabber_login_by_email,events:{"click .btn-cancel":"close","click .btn-log-in":"submit","keyup input[name=password]":"keyUp"},render:function(){this.$el.openModal({opacity:.9,ready:this.onRender.bind(this),complete:this.close.bind(this)})},successFeedback:function(){this.authFeedback({}),this.data.set("authentication",!1),this.close()},onRender:function(){Materialize.updateTextFields(),this.$username_input.val("").focus(),this.$password_input.val("")},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.XabberLoginPanel=e.APIAccountAuthView.extend({className:"login-panel",template:i.xabber_login,events:{"click .login-type":"changeLoginType","click .btn-log-in":"submit","click .btn-social":"socialAuth","click .btn-escape":"openXmppLoginPanel","keyup input[name=password]":"keyUp"},render:function(){this.onRender()},successFeedback:function(){this.authFeedback({}),this.data.set("authentication",!1),e.body.setScreen("all-chats")},changeLoginType:function(){e.body.setScreen("login",{login_screen:"xmpp"})},openXmppLoginPanel:function(){e.body.setScreen("login",{login_screen:"xmpp"})}}),e.AddAPIAccountView=e.APIAccountAuthView.extend({className:"login-panel add-xabber-account-panel",template:i.add_xabber_account,events:{"click .account-field .dropdown-content":"selectAccount","click .btn-add":"loginXabberAccount","keyup input[name=password]":"keyUp","click .btn-social":"socialAuth","click .btn-cancel":"closeModal"},render:function(t){if(!e.accounts.connected.length)return void n.dialogs.error("No connected accounts found.");t||(t={});var a=e.accounts.connected,i=t.jid||"";return this.$("input[name=\"username\"]").val(i).attr("readonly",!!i).removeClass("invalid"),this.$(".single-acc").showIf(1===a.length),this.$(".multiple-acc").hideIf(1===a.length),this.$(".account-field .dropdown-content").empty(),o.each(a,function(e){this.$(".account-field .dropdown-content").append(this.renderAccountItem(e))}.bind(this)),this.bindAccount(a[0]),this.$("span.errors").text(""),this.$el.openModal({opacity:.9,ready:function(){this.onRender.bind(this),this.$(".account-field .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"})}.bind(this),complete:this.closeModal.bind(this)}),this},bindAccount:function(e){this.$(".account-field .dropdown-button .account-item-wrap").replaceWith(this.renderAccountItem(e))},renderAccountItem:function(e){var a=s(t.templates.contacts.add_contact_account_item({jid:e.get("jid")}));return a.find(".circle-avatar").setAvatar(e.cached_image,this.avatar_size),a},selectAccount:function(t){var a=s(t.target).closest(".account-item-wrap"),i=e.accounts.get(a.data("jid"));this.bindAccount(i),this.loginXabberAccount(i)},loginXabberAccount:function(e){e.set("auto_login_xa",!0),e.authXabberAccount(),this.closeModal()},successFeedback:function(){this.authFeedback({}),this.data.set("authentication",!1),this.closeModal()},onHide:function(){this.$el.detach()},closeModal:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.SyncSettingsView=e.BasicView.extend({className:"modal main-modal sync-settings-modal noselect",template:i.sync_settings,ps_selector:".modal-content",avatar_size:a.AVATAR_SIZES.SYNCHRONIZE_ACCOUNT_ITEM,events:{"click .btn-sync":"syncSettings","click .btn-cancel":"close","change .sync-all":"changeSyncAll","change .sync-one":"changeSyncOne","click .sync-icon":"changeSyncWay"},_initialize:function(){this.settings=null,this.to_sync_map=null,this.model.on("open_sync_window",this.render,this)},render:function(e){this.settings=e,this.sync_all=this.model.get("sync_all"),this.accounts=[],this.$el.openModal({ready:this.onRender.bind(this),complete:this.close.bind(this)})},onRender:function(){this.$(".accounts-wrap").empty();var e=this.model.list,t={},a={},i={},n={};o.each(this.settings.settings_data,function(e){i[e.jid]=e}),this.settings_map=i,o.each(this.settings.order_data.settings,function(e){n[e.jid]=e.order}),o.each(this.settings.deleted,function(e){a[e.jid]=e.timestamp}),o.each(i,function(a,i){e.get(i)||(t[i]=o.extend({jid:i,to_sync:this.sync_all,sync_way:"from_server"},a))}.bind(this)),e.each(function(e){var n=e.get("jid"),s=i[n],d;o.has(a,n)?(d=a[n]>=e.get("timestamp")?"delete":"to_server",t[n]=o.extend({sync_way:d,sync_choose:["delete","to_server"]},o.omit(e.attributes,["order"])),e.save("synced",!1)):s?(d=s.timestamp>e.get("timestamp")?"from_server":s.timestamp<e.get("timestamp")?"to_server":"no",t[n]=o.extend({jid:n,to_sync:e.get("to_sync"),sync_way:d,sync_choose:"no"!==d&&["from_server","to_server"]},s.settings),e.save("synced","no"===d)):(t[n]=o.extend({sync_way:"to_server"},o.omit(e.attributes,["order"])),e.save("synced",!1))}.bind(this));var s=o.max(n)||0;o.each(n,function(e,a){t[a].order=e}),e.each(function(e){var a=e.get("jid");t[a].order||(t[a].order=++s)}),this.accounts_map=t,this.accounts=o.map(t,function(e){return e}),this.accounts.sort(function(e,t){return e.order-t.order}),o.each(this.accounts,this.addAccountHtml.bind(this)),this.updateSyncOptions()},addAccountHtml:function(e){var t=e.jid,a=s(i.sync_settings_account_item({jid:t,view:this}));this.$(".accounts-wrap").append(a)},updateAccountHtml:function(e){var t=s(e),i=t.data("jid"),n=this.accounts_map[i];this.sync_all&&(n.to_sync=!0),t.switchClass("sync",n.to_sync),t.find(".sync-one").prop("checked",n.to_sync);var o=n.to_sync?n.sync_way:this.model.list.get(i)?"off_local":"off_remote";var d=a.SYNC_WAY_DATA[o].icon,c=t.find(".sync-icon");c.removeClass(c.attr("data-mdiclass")).attr("data-mdiclass",d).addClass(d),t.find(".sync-tip").text(a.SYNC_WAY_DATA[o].tip)},updateSyncOptions:function(){var e=this.model.list,t=this.sync_all,a=this.accounts_map;this.$(".sync-all").prop("checked",t?"checked":""),this.$(".sync-one").prop("disabled",t?"disabled":""),this.$(".account-wrap").each(function(e,t){this.updateAccountHtml(t)}.bind(this))},changeSyncAll:function(e){var t=s(e.target),a=t.prop("checked");this.sync_all=a,this.$(".sync-one").prop("disabled",a?"disabled":""),a&&(o.each(this.accounts,function(e){e.to_sync=!0}),this.$(".account-wrap").each(function(e,t){this.updateAccountHtml(t)}.bind(this)))},changeSyncOne:function(e){var t=s(e.target),a=t.prop("checked"),i=t.closest(".account-wrap"),n=i.data("jid");this.accounts_map[n].to_sync=a,this.updateAccountHtml(i)},changeSyncWay:function(e){var t=s(e.target).closest(".account-wrap"),a=t.data("jid"),i=this.accounts_map[a];if(i.to_sync&&i.sync_choose){var n=i.sync_choose,o=n.indexOf(i.sync_way)+1;o===n.length&&(o=0),i.sync_way=n[o],this.updateAccountHtml(t)}},syncSettings:function(){var e=this.model.list,t=this.sync_all;this.model.save("sync_all",this.sync_all),o.each(this.accounts,function(a){var i=a.jid,n=e.get(i);if(n){n.save("to_sync",a.to_sync),t&&n.save("order",a.order);var s=a.sync_way;"to_server"===s?n.update_timestamp():("from_server"===s||"delete"===s)&&n.save("timestamp",0)}!n&&a.to_sync&&(n=e.create_from_server(o.omit(a,["sync_way","sync_choose"])))}),this.model.synchronize_main_settings(),this.do_sync=!0,this.close()},onHide:function(){this.$el.detach(),e.body.isScreen("blank")&&e.body.setScreen("all-chats")},close:function(){this.do_sync||this.model.trigger("settings_result",null),this.do_sync=null,this.settings=null,this.settings_map=null,this.closeModal()},closeModal:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.APIAccountView=e.BasicView.extend({className:"setting xabber-account",template:i.xabber_account,avatar_size:a.AVATAR_SIZES.XABBER_ACCOUNT,events:{"click .account-info-wrap":"openAccount","click .btn-login":"login","click .btn-logout":"logout","click .btn-set-password":"setPassword","click .btn-sync-settings":"synchronize","click .social-linked-header":"changeExpanded","click .btn-unlink":"unlinkSocial","click .btn-link":"linkSocial","click .btn-verify-email":"verifyEmail"},_initialize:function(){this.$el.appendTo(this.parent.$(".settings-block-wrap.xabber-account")),this.$tab=this.parent.$(".xabber-account-tab"),this.updateForConnectedStatus(),this.default_color=n.images.getDefaultColor(this.model.get("username")),this.model.on("change:username",this.updateName,this),this.model.on("change:name",this.updateAvatar,this),this.model.on("change:connected",this.updateForConnectedStatus,this),this.model.on("change:last_sync",this.updateLastSyncInfo,this),this.model.on("change:linked_email_list",this.updateSocialBindings,this),this.model.on("change:linked_social",this.updateSocialBindings,this),this.model.on("relogin",this.login,this),this.data.on("change:sync",this.updateSyncButton,this),this.data.on("change:expanded",this.updateExpanded,this),this.data.set("expanded",!1)},render:function(){this.data.set("sync",!1),this.$("span.errors ").html(""),this.updateLastSyncInfo(),this.updateSocialBindings(),this.$(".btn-more").dropdown({inDuration:100,outDuration:100,hover:!1})},changeExpanded:function(){this.data.set("expanded",!this.data.get("expanded"))},updateExpanded:function(){var e=this.data.get("expanded");this.$(".arrow").switchClass("mdi-chevron-down",e),this.$(".arrow").switchClass("mdi-chevron-right",!e),this.$(".social-linked-wrap").showIf(e)},updateSocialBindings:function(){var e=this.model.get("linked_email_list"),t=this.model.get("linked_social");this.$(".email-linked").remove(),this.$(".social-account").each(function(e,t){var a=s(t);a.addClass("not-linked"),a.find(".synced-info").text("Not linked"),a.find(".btn-link").text("link").removeClass("btn-unlink")}),o.each(e,function(e){var t=e.id,a=e.email,n=e.verified,o=n?"Verified":"Unverified",d=s(i.linked_email_item({email_id:t,email:a,verified:n,verified_status:o,color:this.default_color}));d.insertBefore(this.$("#email.not-linked"))}.bind(this)),o.each(t,function(e){var t=e.provider,a=e.first_name+" "+e.last_name;this.$("."+t+"-linked").removeClass("not-linked"),this.$("."+t+"-linked .btn-link").text("unlink").addClass("btn-unlink"),this.$("."+t+"-linked .synced-info").html(s("<div class=\"name one-line\">"+a+"</div><div class=\"verified-status one-line\">Linked "+t+" account</div>"))}.bind(this))},linkSocial:function(e){if(this.model.get("token")&&!s(e.target).hasClass("btn-unlink")){var t=s(e.target).closest(".social-linked-item-wrap"),a=t.attr("id");"email"===a?n.dialogs.ask_enter_value("Add email",null,{input_placeholder_value:"Enter email address"},{ok_button_text:"link"}).done(function(e){e&&this.model._call_method("POST","/accounts/current/email_list/",{email:e},function(e){var t=this.model.get("linked_email_list");t.push(e),this.model.set("linked_email_list",t),this.updateSocialBindings()}.bind(this),function(e){this.$("span.errors ").text(e.email[0])}.bind(this))}.bind(this)):this.openAccount()}},verifyEmail:function(e){var t=s(e.target),a=t.closest(".social-linked-item-wrap"),i=a.data("email");n.dialogs.ask_enter_value("Confirm email",null,{input_placeholder_value:"Enter verification code"},{ok_button_text:"verify",resend_button_text:"resend code",resend_to:i}).done(function(e){e&&(e===i?this.model._call_method("POST","/accounts/current/email_list/",{email:e}):this.model._call_method("POST","/accounts/email_confirmation/",{code:e},function(e){var t=e.email_list;this.model.set("linked_email_list",t),this.updateSocialBindings()}.bind(this),function(e){this.$("span.errors ").text(e.code[0])}.bind(this)))}.bind(this))},unlinkSocial:function(e){var t=s(e.target);if(!t.hasClass("btn-verify-email")){var a=t.closest(".social-linked-item-wrap"),i=a.attr("id"),o=a.data("email");if(o){var d=a.data("email");n.dialogs.ask("Unlink email","Do you want to unlink email "+d+"?",null,{ok_button_text:"unlink"}).done(function(e){e&&this.model._call_method("DELETE","/accounts/current/email_list/"+a.data("id")+"/",null,function(){var e=this.model.get("linked_email_list"),t=e.indexOf(e.find(e=>e.id===a.data("id")));e.splice(t,1),this.model.set("linked_email_list",e),this.updateSocialBindings()}.bind(this),function(){this.model.get_settings()}.bind(this))}.bind(this))}else"email"!==i&&n.dialogs.ask("Unlink social account","Do you want to unlink "+i+" account?",null,{ok_button_text:"unlink"}).done(function(e){e&&this.model._call_method("POST","/accounts/current/social_unbind/",{provider:i},function(){var e=this.model.get("linked_social"),t=e.indexOf(e.find(e=>e.provider===i));e.splice(t,1),this.model.set("linked_social",e),this.updateSocialBindings()}.bind(this),function(){this.model.get_settings()}.bind(this))}.bind(this))}},updateName:function(){this.$(".account-info-wrap .name").text(this.model.get("username")),this.default_color=n.images.getDefaultColor(this.model.get("username"))},updateAvatar:function(){var e=this.model.get("name"),t=this.model.get("image")||n.images.getDefaultAvatar(e);this.$(".circle-avatar").setAvatar(n.images.getCachedImage(t),this.avatar_size)},updateForConnectedStatus:function(){var e=this.model.get("connected");this.$tab.switchClass("online",e).switchClass("offline",!e),this.$(".linked-social-accounts-and-emails").showIf(e),this.$(".account-info-wrap").showIf(e),this.$(".sync-wrap").showIf(e),e&&(this.updateName(),this.updateAvatar(),this.updateSyncButton(),this.updateLastSyncInfo()),this.$(".btn-login").hideIf(e),this.$(".btn-more").showIf(e)},updateSyncButton:function(){var e=this.data.get("sync");this.$(".btn-sync .button").hideIf(e),this.$(".btn-sync .preloader-wrapper").showIf(e)},updateLastSyncInfo:function(){var e=this.model.get("last_sync");if(e){var t=n.now()-e;this.$(".last-sync-info").text("Synced "+n.pretty_timedelta(t))}else this.$(".last-sync-info").text("Not synced")},synchronize:function(){this.data.get("sync")||(this.data.set("sync",!0),this.model.once("settings_result",function(){this.data.set("sync",!1)},this),this.model.save("sync_request","window"),this.model.get_settings())},login:function(){if(1<e.accounts.connected.length)e.add_api_account_view.show();else{var t=e.accounts.connected[0];t&&(t.set("auto_login_xa",!0),t.authXabberAccount())}},logout:function(){this.model.logout()},onPasswordResetFailed:function(){n.dialogs.error("For reset password need at least one confirmed email")},setPassword:function(){var e=this.model.get("linked_email_list");if(e){var t=e.find(e=>!0===e.verified);-1==e.indexOf(t)?this.onPasswordResetFailed():s.ajax({type:"POST",url:a.API_SERVICE_URL+"/accounts/password_reset_request/",contentType:"application/json",dataType:"json",data:JSON.stringify({email:t.email}),success:function(){n.dialogs.notify("Set password","Request for set password sent on email "+t.email)}.bind(this),error:this.onPasswordResetFailed.bind(this)})}else this.onPasswordResetFailed()},openAccount:function(){n.openWindow(a.XABBER_ACCOUNT_URL+"/?token="+this.model.get("token"))}}),e.once("start",function(){this.account_settings_list=new this.AccountSettingsList(null,{storage_name:this.getStorageName()+"-account-settings"}),this.account_settings_list.fetch(),this.account_settings_list.order_timestamp=new this.AccountsOrderTimestamp({id:"accounts-order-timestamp"},{storage_name:this.getStorageName(),fetch:"after"}),this.api_account=new this.APIAccount({id:"api-account"},{storage_name:this.getStorageName(),fetch:"before",settings_list:this.account_settings_list}),this.xabber_login_panel=e.login_page.addChild("xabber_login",this.XabberLoginPanel,{model:this.api_account}),this.sync_settings_view=new this.SyncSettingsView({model:this.api_account}),this.settings_view.addChild("api-account",this.APIAccountView,{model:this.api_account}),this.add_api_account_view=new this.AddAPIAccountView({model:this.api_account}),this.email_auth_view=new e.XabberLoginByEmailPanel({parent:this.add_api_account_view,model:this.api_account})},e),e}}),define("xabber-strophe",[],function(){var e=String.fromCharCode;return function(t){var a=t.env,i=a.uuid,n=a.$iq,s=a.Strophe,o=a.constants;s.log=function(e,t){var a=o.LOG_LEVEL===o.LOG_LEVEL_DEBUG||o.LOG_LEVEL>=o.LOG_LEVEL_WARN&&e>=s.LogLevel.WARN||o.LOG_LEVEL>=o.LOG_LEVEL_ERROR&&e>=s.LogLevel.ERROR;a&&(console.info("Strophe log: "),console.info(t))};var d=function(t){var a="",n=t.length,s,o;for(s=0;s<n;s++)o=t.charCodeAt(s),0<=o&&127>=o?a+=t.charAt(s):2047<o?(a+=e(224|15&o>>12),a+=e(128|63&o>>6),a+=e(128|63&o>>0)):(a+=e(192|31&o>>6),a+=e(128|63&o>>0));return a};return s.SASLXTOKEN=function(){},s.SASLXTOKEN.prototype=new s.SASLMechanism("X-TOKEN",!0,100),s.SASLXTOKEN.prototype.test=function(){return!0},s.SASLXTOKEN.prototype.onChallenge=function(t){var a=e(0)+t.authcid+e(0)+t.pass;return d(a)},s.ConnectionManager=function(e){this.connection=new s.Connection(e)},s.ConnectionManager.prototype={connect:function(e,t,a,i){this.connection.mechanisms={},this.auth_type=e||"password","password"===this.auth_type?this.connection.registerSASLMechanisms([s.SASLAnonymous,s.SASLExternal,s.SASLMD5,s.SASLPlain,s.SASLSHA1]):"x-token"===this.auth_type?(this.connection.registerSASLMechanism(s.SASLXTOKEN),delete this.connection._sasl_data["server-signature"]):(this.connection.registerSASLMechanisms([s.SASLXOAuth2]),delete this.connection._sasl_data["server-signature"]),this.connection.connect(t,a,i)},reconnect:function(e){"x-token"!==this.auth_type||this.connection.mechanisms["X-TOKEN"]||(this.connection.registerSASLMechanism(s.SASLXTOKEN),delete this.connection._sasl_data["server-signature"]),this.connection.connect(this.connection.jid,this.connection.pass,e)}},_.extend(s.Connection.prototype,{_sasl_auth1_cb:function(e){this.features=e;var t,n;for(t=0;t<e.childNodes.length;t++)n=e.childNodes[t],"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0),"x-token"===n.nodeName&&n.namespaceURI===s.NS.AUTH_TOKENS&&(this.x_token_auth=!0),"synchronization"===n.nodeName&&n.namespaceURI===s.NS.SYNCHRONIZATION&&(this.do_synchronization=!0);return this.do_bind?(this.x_token_auth&&(!this.x_token||1e3*parseInt(this.x_token.expire)<a.moment.now())?this.getXToken(function(e){let t=$(e).find("token").text(),a=$(e).find("expire").text(),i=$(e).find("token-uid").text();this.x_token={token:t,expire:a,token_uid:i},this.pass=t,this._send_auth_bind()}.bind(this),function(){this._send_auth_bind()}.bind(this)):this._send_auth_bind(),!1):(this._changeConnectStatus(s.Status.AUTHFAIL,null),!1)},_send_auth_bind(){this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var e=s.getResourceFromJid(this.jid);e?this.send(n({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:s.NS.BIND}).c("resource",{}).t(e).tree()):this.send(n({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:s.NS.BIND}).tree())},getXToken:function(e,a){let o=i(),d=n({type:"set",to:this.domain,id:o}).c("issue",{xmlns:s.NS.AUTH_TOKENS}).c("client").t(t.get("client_name")).up().c("device").t("PC, "+navigator.platform);handler=function(t){var i=t.getAttribute("type");if("result"==i)e&&e(t);else if("error"==i)a&&a(t);else throw{name:"StropheError",message:"Got bad IQ type of "+i}},this._addSysHandler(handler.bind(this),s.NS.AUTH_TOKENS,"iq","result",o),this.send(d.tree())}}),s.xmlunescape=function(e){let t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":"\"","&apos;":"'"};let a="(?:"+_.keys(t).join("|")+")",i=RegExp(a),n=RegExp(a,"g");return e=null==e?"":""+e,i.test(e)?e.replace(n,function(e){return t[e]}):e},s.addNamespace("ATTENTION","urn:xmpp:attention:0"),s.addNamespace("CARBONS","urn:xmpp:carbons:2"),s.addNamespace("FORWARD","urn:xmpp:forward:0"),s.addNamespace("HASH","urn:xmpp:hashes:2"),s.addNamespace("HINTS","urn:xmpp:hints"),s.addNamespace("RECEIPTS","urn:xmpp:receipts"),s.addNamespace("JINGLE","urn:xmpp:jingle:1"),s.addNamespace("JINGLE_SECURITY_STUB","urn:xmpp:jingle:security:stub:0"),s.addNamespace("JINGLE_MSG","urn:xmpp:jingle-message:0"),s.addNamespace("JINGLE_RTP","urn:xmpp:jingle:apps:rtp:1"),s.addNamespace("JINGLE_TRANSPORTS_ICE","urn:xmpp:jingle:transports:ice-udp:1"),s.addNamespace("ADDRESS","http://jabber.org/protocol/address"),s.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),s.addNamespace("EXTENDED_CHATSTATES","https://xabber.com/protocol/extended-chatstates"),s.addNamespace("HTTP_AUTH","http://jabber.org/protocol/http-auth"),s.addNamespace("AUTH_TOKENS","http://xabber.com/protocol/auth-tokens"),s.addNamespace("SYNCHRONIZATION","http://xabber.com/protocol/synchronization"),s.addNamespace("DELIVERY","http://xabber.com/protocol/delivery"),s.addNamespace("MAM","urn:xmpp:mam:1"),s.addNamespace("RSM","http://jabber.org/protocol/rsm"),s.addNamespace("DATAFORM","jabber:x:data"),s.addNamespace("CHAT_MARKERS","urn:xmpp:chat-markers:0"),s.addNamespace("VCARD_UPDATE","vcard-temp:x:update"),s.addNamespace("HTTP_UPLOAD","urn:xmpp:http:upload"),s.addNamespace("BLOCKING","urn:xmpp:blocking"),s.addNamespace("SEARCH","jabber:iq:search"),s.addNamespace("PRIVATE_STORAGE","jabber:iq:private"),s.addNamespace("MEDIA","urn:xmpp:media-element"),s.addNamespace("LAST","jabber:iq:last"),s.addNamespace("GROUP_CHAT","http://xabber.com/protocol/groupchat"),s.addNamespace("WEBCHAT","http://xabber.com/protocol/webchat"),s.addNamespace("INDEX","http://xabber.com/protocol/index"),s.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),s.addNamespace("PUBSUB_AVATAR_DATA","urn:xmpp:avatar:data"),s.addNamespace("PUBSUB_AVATAR_METADATA","urn:xmpp:avatar:metadata"),s.addNamespace("REWRITE","http://xabber.com/protocol/rewrite"),s.addNamespace("REFERENCE","https://xabber.com/protocol/reference"),s.addNamespace("MARKUP","https://xabber.com/protocol/markup"),s.addNamespace("VOICE_MESSAGE","https://xabber.com/protocol/voice-message"),s.addNamespace("OTB","https://xabber.com/protocol/otb"),t}}),define("xabber-vcard",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.vcard,n=t.$,s=t._,o=t.moment,d=t.Strophe,c=t.$iq,r=t.$build,l=t.utils,p=function(e){var t={nickname:e.find("NICKNAME").text().trim(),fullname:e.find("FN").text().trim(),first_name:e.find("N GIVEN").text().trim(),middle_name:e.find("N MIDDLE").text().trim(),last_name:e.find("N FAMILY").text().trim(),birthday:e.find("BDAY").text().trim(),job_title:e.find("TITLE").text().trim(),role:e.find("ROLE").text().trim(),url:e.find("URL").text().trim(),description:e.find("DESC").text().trim(),jabber_id:e.find("JABBERID").text().trim(),org:{},photo:{},phone:{},address:{},email:{}},a=e.find("ORG");a.length&&(t.org.name=a.find("ORGNAME").text().trim(),t.org.unit=a.find("ORGUNIT").text().trim());var i=e.find("PHOTO");return i.length&&(t.photo.image=i.find("BINVAL").text().trim(),t.photo.type=i.find("TYPE").text().trim()),e.find("TEL").each(function(){var e=n(this),a=e.find("NUMBER").text().trim();a&&(e.find("WORK").length?t.phone.work=a:e.find("HOME").length?t.phone.home=a:e.find("MOBILE").length?t.phone.mobile=a:t.phone.default=a)}),e.find("EMAIL").each(function(){var e=n(this),a=e.find("USERID").text().trim();a&&(e.find("WORK").length?t.email.work=a:e.find("HOME").length?t.email.home=a:t.email.default=a)}),e.find("ADR").each(function(){var e=n(this),a={pobox:e.find("POBOX").text().trim(),extadd:e.find("EXTADR").text().trim(),street:e.find("STREET").text().trim(),locality:e.find("LOCALITY").text().trim(),region:e.find("REGION").text().trim(),pcode:e.find("PCODE").text().trim(),country:e.find("CTRY").text().trim()};e.find("WORK").length?t.address.work=a:e.find("HOME").length?t.address.home=a:t.address.default=a}),t},u=function(e){var t=r("vCard",{xmlns:d.NS.VCARD});return e.nickname&&t.c("NICKNAME").t(e.nickname).up(),e.fullname&&t.c("FN").t(e.fullname).up(),(e.first_name||e.last_name||e.middle_name)&&(t.c("N"),e.first_name&&t.c("GIVEN").t(e.first_name).up(),e.last_name&&t.c("FAMILY").t(e.last_name).up(),e.middle_name&&t.c("MIDDLE").t(e.middle_name).up(),t.up()),e.birthday&&t.c("BDAY").t(e.birthday).up(),e.job_title&&t.c("TITLE").t(e.job_title).up(),e.role&&t.c("ROLE").t(e.role).up(),(e.org.name||e.org.unit)&&(t.c("ORG"),e.org.name&&t.c("ORGNAME").t(e.org.name).up(),e.org.unit&&t.c("ORGUNIT").t(e.org.unit).up(),t.up()),e.url&&t.c("URL").t(e.url).up(),e.photo.image&&(t.c("PHOTO").c("BINVAL").t(e.photo.image).up(),t.c("TYPE").t(e.photo.type||"image/jpeg").up(),t.up()),e.description&&t.c("DESC").t(e.description).up(),e.jabber_id&&t.c("JABBERID").t(e.jabber_id).up(),s.each(e.phone,function(e,a){t.c("TEL").c("NUMBER").t(e).up(),"default"!==a&&t.c(a.toUpperCase()).up(),t.up()}),s.each(e.email,function(e,a){t.c("EMAIL").c("USERID").t(e).up(),"default"!==a&&t.c(a.toUpperCase()).up(),t.up()}),s.each(e.address,function(e,a){t.c("ADR"),"default"!==a&&t.c(a.toUpperCase()).up(),e.pobox&&t.c("POBOX").t(e.pobox).up(),e.extadd&&t.c("EXTADR").t(e.extadd).up(),e.street&&t.c("STREET").t(e.street).up(),e.locality&&t.c("LOCALITY").t(e.locality).up(),e.region&&t.c("REGION").t(e.region).up(),e.pcode&&t.c("PCODE").t(e.pcode).up(),e.country&&t.c("CTRY").t(e.country).up(),t.up()}),t.tree()};return d.addConnectionPlugin("vcard",{_connection:null,init:function(e){return this._connection=e,d.addNamespace("VCARD","vcard-temp")},get:function(e,t,a){var i=c({type:"get",to:e}).c("vCard",{xmlns:d.NS.VCARD});this._connection.sendIQ(i,function(a){if(t){var i=p(n(a).find("vCard[xmlns="+d.NS.VCARD+"]"));return i.jabber_id||(i.jabber_id=e),t(i)}},a)},set:function(e,t,a,i){t.jabber_id||(t.jabber_id=e);var n=c({type:"set",to:e}).cnode(u(t));this._connection.sendIQ(n,a,i)}}),l.vcard={getBlank:function(e){var t=p(n("<div/>"));return t.jabber_id=e,t}},e.VCardView=e.BasicView.extend({template:i.vcard,_initialize:function(){this.$el.html(this.template()),this.model.on("change:vcard_updated",this.update,this),this.data.on("change:refresh",this.updateRefreshButton,this)},render:function(){this.$(".block-header .block-name").text(this.model.get("group_chat")?"Group chat details":"Contact details"),this.data.set("refresh",!1),this.update()},update:function(){var e=this.model.get("vcard"),t;t=this.$(".jid-info-wrap"),t.find(".jabber-id").showIf(e.jabber_id).find(".value").text(e.jabber_id),t.showIf(e.jabber_id),t=this.$(".personal-info-wrap"),t.find(".fullname").showIf(e.fullname).find(".value").text(e.fullname),t.find(".first-name").showIf(e.first_name).find(".value").text(e.first_name),t.find(".middle-name").showIf(e.middle_name).find(".value").text(e.middle_name),t.find(".last-name").showIf(e.last_name).find(".value").text(e.last_name),t.showIf(e.fullname||e.first_name||e.middle_name||e.last_name),t=this.$(".nickname-info-wrap"),t.find(".nickname").showIf(e.nickname).find(".value").text(e.nickname),t.showIf(e.nickname),t=this.$(".birthday-info-wrap"),t.find(".birthday").showIf(e.birthday).find(".value").text(e.birthday),t.showIf(e.birthday),t=this.$(".job-info-wrap"),t.find(".role").showIf(e.role).find(".value").text(e.role),t.find(".job-title").showIf(e.job_title).find(".value").text(e.job_title),t.find(".org-name").showIf(e.org.name).find(".value").text(e.org.name),t.find(".org-unit").showIf(e.org.unit).find(".value").text(e.org.unit),t.showIf(e.role||e.job_title||e.org.name||e.org.unit),t=this.$(".site-info-wrap"),t.find(".url").showIf(e.url).find(".value").text(e.url).hyperlinkify(),t.showIf(e.url),t=this.$(".description-info-wrap"),t.find(".description").showIf(e.description).find(".value").text(e.description),t.showIf(e.description);var a=this.$(".address-info-wrap"),i=s.clone(e.address),n=!1;a.find(".info").addClass("hidden"),s.each(i,function(e,i){t=a.find(".address-"+i),t.find(".pobox").showIf(e.pobox).text(e.pobox),t.find(".extadd").showIf(e.extadd).text(e.extadd),t.find(".street").showIf(e.street).text(e.street),t.find(".locality").showIf(e.locality).text(e.locality),t.find(".region").showIf(e.region).text(e.region),t.find(".pcode").showIf(e.pcode).text(e.pcode),t.find(".country").showIf(e.country).text(e.country);var s=e.pobox||e.extadd||e.street||e.locality||e.region||e.pcode||e.country;s&&(n=!0),t.showIf(s)}),a.showIf(n),t=this.$(".phone-info-wrap");var o=e.phone;o&&(t.find(".phone-work").showIf(o.work).find(".value").text(o.work),t.find(".phone-home").showIf(o.home).find(".value").text(o.home),t.find(".phone-mobile").showIf(o.mobile).find(".value").text(o.mobile),t.find(".phone-default").showIf(o.default).find(".value").text(o.default)),t.showIf(o&&(o.work||o.home||o.mobile||o.default)),t=this.$(".email-info-wrap");var d=e.email;d&&(t.find(".email-work").showIf(d.work).find(".value").text(d.work),t.find(".email-home").showIf(d.home).find(".value").text(d.home),t.find(".email-default").showIf(d.default).find(".value").text(d.default)),t.showIf(d&&(d.work||d.home||d.default)),this.parent.updateScrollBar()},onClickIcon:function(e){let t=n(e.target).closest(".info-wrap"),a=t.find(".value"),i="";a.each(function(e,t){let a=n(t),s=a.text();s&&""!=i&&(i+="\n"),s&&(i+=s),i&&l.copyTextToClipboard(i,"Copied in clipboard","ERROR: Not copied in clipboard")}.bind(this))},updateRefreshButton:function(){this.$(".btn-vcard-refresh .button").hideIf(this.data.get("refresh")),this.$(".btn-vcard-refresh .preloader-wrapper").showIf(this.data.get("refresh"))},refresh:function(){this.data.get("refresh")||(this.data.set("refresh",!0),this.model.getVCard(function(){this.data.set("refresh",!1)}.bind(this)))}}),e.VCardEditView=e.BasicView.extend({className:"account-vcard-edit-wrap",template:i.vcard_edit,ps_selector:".panel-content",events:{"input .first-name input":"changePlaceholder","input .middle-name input":"changePlaceholder","input .last-name input":"changePlaceholder","click .btn-vcard-save":"save","click .btn-vcard-back":"back"},_initialize:function(){this.$(".datepicker").pickadate({selectMonths:!0,selectYears:100,min:new Date(o.now()-31536e8),max:new Date(o.now()-864e5),format:"dd.mm.yyyy",today:"",klass:{weekday_display:"picker__weekday-display ground-color-700",date_display:"picker__date-display ground-color-500",navPrev:"picker__nav--prev hover-ground-color-100",navNext:"picker__nav--next hover-ground-color-100",selected:"picker__day--selected ground-color-500",now:"picker__day--today text-color-700",buttonClear:"btn-flat btn-main btn-dark",buttonClose:"btn-flat btn-main text-color-700"}}),this.data.on("change:saving",this.updateSaveButton,this)},render:function(){this.data.set("saving",!1),this.setData(),Materialize.updateTextFields(),this.changePlaceholder(),this.updateScrollBar()},changePlaceholder:function(){let e=((this.$(".first-name input").val()+" "+this.$(".middle-name input").val()).trim()+" "+this.$(".last-name input").val()).trim()||this.model.get("jid");this.$(".nickname input").attr("placeholder",e)},setData:function(){var e=this.model.get("vcard");this.$(".nickname input").val(e.nickname),this.$(".fullname input").val(e.fullname),this.$(".first-name input").val(e.first_name),this.$(".last-name input").val(e.last_name),this.$(".middle-name input").val(e.middle_name),this.$(".birthday input").val(e.birthday),this.$(".role input").val(e.role),this.$(".job-title input").val(e.job_title),this.$(".org-name input").val(e.org.name),this.$(".org-unit input").val(e.org.unit),this.$(".url input").val(e.url),this.$(".description textarea").val(e.description),this.$(".phone-work input").val(e.phone.work),this.$(".phone-home input").val(e.phone.home),this.$(".phone-mobile input").val(e.phone.mobile),this.$(".email-work input").val(e.email.work),this.$(".email-home input").val(e.email.home);var t=e.address.work||{},a=this.$(".address-work-wrap");a.find(".pobox input").val(t.pobox),a.find(".extadd input").val(t.extadd),a.find(".street input").val(t.street),a.find(".locality input").val(t.locality),a.find(".region input").val(t.region),a.find(".pcode input").val(t.pcode),a.find(".country input").val(t.country),t=e.address.home||{},a=this.$(".address-home-wrap"),a.find(".pobox input").val(t.pobox),a.find(".extadd input").val(t.extadd),a.find(".street input").val(t.street),a.find(".locality input").val(t.locality),a.find(".region input").val(t.region),a.find(".pcode input").val(t.pcode),a.find(".country input").val(t.country)},getData:function(){var e=l.vcard.getBlank(this.model.get("jid"));e.nickname=this.$(".nickname input").val(),e.fullname=this.$(".fullname input").val(),e.first_name=this.$(".first-name input").val(),e.last_name=this.$(".last-name input").val(),e.middle_name=this.$(".middle-name input").val(),e.birthday=this.$(".birthday input").val(),e.role=this.$(".role input").val(),e.job_title=this.$(".job-title input").val(),e.org.name=this.$(".org-name input").val(),e.org.unit=this.$(".org-unit input").val(),e.url=this.$(".url input").val(),e.description=this.$(".description textarea").val(),e.phone.work=this.$(".phone-work input").val(),e.phone.home=this.$(".phone-home input").val(),e.phone.mobile=this.$(".phone-mobile input").val(),e.email.work=this.$(".email-work input").val(),e.email.home=this.$(".email-home input").val(),e.address.work={};var t=e.address.work,a=this.$(".address-work-wrap");return t.pobox=a.find(".pobox input").val(),t.extadd=a.find(".extadd input").val(),t.street=a.find(".street input").val(),t.locality=a.find(".locality input").val(),t.region=a.find(".region input").val(),t.pcode=a.find(".pcode input").val(),t.country=a.find(".country input").val(),e.address.home={},t=e.address.home,a=this.$(".address-home-wrap"),t.pobox=a.find(".pobox input").val(),t.extadd=a.find(".extadd input").val(),t.street=a.find(".street input").val(),t.locality=a.find(".locality input").val(),t.region=a.find(".region input").val(),t.pcode=a.find(".pcode input").val(),t.country=a.find(".country input").val(),e},updateSaveButton:function(){this.$(".btn-vcard-save").text(this.data.get("saving")?"Saving...":"Save")},save:function(){this.data.get("saving")||(this.data.set("saving",!0),this.model.setVCard(this.getData(),function(){this.model.getVCard(),this.data.set("saving",!1)}.bind(this),function(){l.dialogs.error("Could not save vCard."),this.data.set("saving",!1)}))},back:function(){this.model.showSettings(null,"vcard")}}),e}}),define("xabber-accounts",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.accounts,n=t.utils,s=t.$,o=t.$iq,d=t.$msg,c=t.$pres,r=t.Strophe,l=t._,p=t.moment,u=n.images;return e.Account=Backbone.Model.extend({idAttribute:"jid",defaults:{enabled:!0,auth_type:"password",status:"online",status_message:"",priority:0,auto_login_xa:!0,groupchat_servers_list:[]},initialize:function(t,i){if(i||(i={}),t.is_new&&!i.auth_view)return this.is_invalid=!0,void this.on("destroy",this.onDestroy,this);this.last_msg_timestamp=0,this.settings=e.account_settings_list.get(t.jid),this.settings||(this.settings=e.account_settings_list.create({jid:t.jid,timestamp:n.now(),auto_login_xa:this.get("auto_login_xa"),to_sync:e.api_account.get("sync_all")}));var o=l.clone(this.settings.attributes);o.color||(o.color=this.collection.getDefaultColor()),o.order||(o.order=this.collection.getLastOrder()+1),this.settings.save(o),this.settings.on("delete_account",this.deleteAccount,this);var d=l.clone(t);d.name||(d.name=d.jid),d.image||(d.image=u.getDefaultAvatar(d.name)),this.cached_image=u.getCachedImage(d.image),d.vcard=n.vcard.getBlank(d.jid),d.photo_hash="",this.save(d),this.auth_view=i.auth_view||null,this.session=new Backbone.Model({connected:!1,reconnected:!1,conn_retries:0,conn_feedback:"Disconnected"}),this._waiting_code=!1,this.code_requests=[],this.xabber_auth={},this.session.on("change:connected",this.onChangedConnected,this),this.CONNECTION_URL=t.websocket_connection_url||a.CONNECTION_URL,this.conn_manager=new r.ConnectionManager(this.CONNECTION_URL),this.connection=this.conn_manager.connection,this.get("x_token")&&(this.connection.x_token=this.get("x_token")),this.on("destroy",this.onDestroy,this),this._added_pres_handlers=[],this._pending_stanzas=[],this._pending_messages=[],this.dfd_presence=new s.Deferred,this.resources=new e.AccountResources(null,{account:this}),this.password_view=new e.ChangePasswordView({model:this}),this.settings_left=new e.AccountSettingsLeftView({model:this}),this.settings_right=new e.AccountSettingsRightView({model:this}),this.vcard_edit=new e.VCardEditView({model:this}),this.updateColorScheme(),this.settings.on("change:color",this.updateColorScheme,this),this.on("change:photo_hash",this.getVCard,this),l.each(this._init_plugins,function(e){e.call(this)}.bind(this)),this.connection.xmlInput=function(t){e.info("input"),e.info(t)},this.connection.xmlOutput=function(t){e.info("output"),e.info(t)},this.once("start",this.start,this),e.api_account.on("settings_result",function(e){e&&this.settings.get("token")&&this.save({auth_type:"token",password:""}),this.trigger("start")},this)},start:function(){this.get("enabled")&&this.isOnline()&&this.connect()},_init_plugins:[],getPassword:function(){try{return n.atou(this.get("password"))}catch(t){return""}},isConnected:function(){return this.session&&this.session.get("connected")},isOnline:function(){return"offline"!==this.get("status")},sendMsg:function(e,t){var a=this.connection.authenticated&&"offline"!==this.get("status");return a?(this.connection.send(e),t&&t()):this._pending_stanzas.push({stanza:e,callback:t}),a},pubAvatar:function(e,t,a){if(!e)return void this.removeAvatar(t,a);var i=e.hash||sha1(e.base64),n=o({from:this.get("jid"),type:"set"}).c("pubsub",{xmlns:r.NS.PUBSUB}).c("publish",{node:r.NS.PUBSUB_AVATAR_DATA}).c("item",{id:i}).c("data",{xmlns:r.NS.PUBSUB_AVATAR_DATA}).t(e.base64),s=o({from:this.get("jid"),type:"set"}).c("pubsub",{xmlns:r.NS.PUBSUB}).c("publish",{node:r.NS.PUBSUB_AVATAR_METADATA}).c("item",{id:i}).c("metadata",{xmlns:r.NS.PUBSUB_AVATAR_METADATA}).c("info",{bytes:e.size,id:i,type:e.type});this.sendIQ(n,function(){this.sendIQ(s,function(){t&&t(i)}.bind(this),function(e){a&&a(e)})}.bind(this),function(e){a&&a(e)}.bind(this))},removeAvatar:function(e,t){let a=o({from:this.get("jid"),type:"set"}).c("pubsub",{xmlns:r.NS.PUBSUB}).c("publish",{node:r.NS.PUBSUB_AVATAR_METADATA}).c("item").c("metadata",{xmlns:r.NS.PUBSUB_AVATAR_METADATA});this.sendIQ(a,function(){e&&e()}.bind(this),function(){t&&t()})},getAvatar:function(e,t,a){var i=o({from:this.get("jid"),type:"get",to:this.get("jid")}).c("pubsub",{xmlns:r.NS.PUBSUB}).c("items",{node:r.NS.PUBSUB_AVATAR_DATA}).c("item",{id:e});this.sendIQ(i,function(e){var i=s(e).find("data").text();""==i?a&&a("Node is empty"):t&&t(i)}.bind(this))},sendIQ:function(){var e=this.connection.authenticated&&"offline"!==this.get("status");return e?this.connection.sendIQ.apply(this.connection,arguments):this._pending_stanzas.push({stanza:arguments}),e},parseDataForm:function(e,t){t=t||{};let a=e.attr("type"),i=e.children("title").text(),n=e.children("instructions").text(),o=[],d={};return e.children("field").each(function(e,t){let a=s(t),i={},n=a.attr("var"),d=a.attr("type"),c=a.attr("label"),r=[],l=[];a.children("value").each(function(e,t){r.push(s(t).text())}.bind(this)),a.children("option").each(function(e,t){let a=s(t),i=a.children("value").text(),n=a.attr("label");l.push({value:i,label:n})}.bind(this)),n&&(i.var=n),d&&(i.type=d),c&&(i.label=c),r.length&&(i.values=r),l.length&&(i.options=l),o.push(i)}.bind(this)),a&&(d.type=a),i&&(d.title=i),n&&(d.instructions=n),o.length&&(d.fields=o),d},addDataFormToStanza:function(e,t){return e.c("x",{xmlns:r.NS.DATAFORM,type:"submit"}),t.title&&e.c("title").t(t.title).up(),t.instructions&&e.c("instructions").t(t.instructions).up(),t.fields.forEach(function(t){let a=l.clone(t);delete a.values,delete a.options,e.c("field",a),t.values&&t.values.forEach(function(t){e.c("value").t(t).up()}.bind(this)),e.up()}.bind(this)),e},sendPres:function(e){return this.connection.authenticated?this.connection.send(e):this._pending_stanzas.push({stanza:e}),this.connection.authenticated},verifyXabberAccount:function(e,t){var i={type:"POST",url:a.API_SERVICE_URL+"/accounts/xmpp_auth/",contentType:"application/json",dataType:"json",data:JSON.stringify({code:e,jid:this.connection.jid}),success:function(e){t&&t(e.token)}};s.ajax(i)},connect:function(t){t=t||{};var a=this.get("jid"),i=this.get("auth_type"),n;if(a+="/xabber-web-"+e.get("client_id"),this.connection.x_token=this.get("x_token"),n="token"===i?this.settings.get("token"):"x-token"===i?this.get("x_token")&&(1e3*parseInt(this.get("x_token").expire)>p.now()||!this.get("x_token").expire)?this.get("x_token").token:void 0:this.getPassword(),!n){let e={login:!0};return t.token_invalidated&&(e.token_invalidated=!0),void this.password_view.show(e)}this.session.set({connected:!1,reconnected:!1,reconnecting:!1,conn_retries:0,conn_feedback:"Connecting...",auth_failed:!1}),this.restoreStatus(),this.conn_manager.connect(i,a,n,this.connectionCallback.bind(this))},reconnect:function(){var e=this.session.get("conn_retries"),t=3>e?a.RECONNECTION_TIMEOUTS[e]:2e4;this.connection.reset(),this.session.set({connected:!1,reconnected:!1,reconnecting:!0,conn_retries:++e,conn_feedback:"Reconnect after "+t/1e3+" seconds...",auth_failed:!1}),setTimeout(function(){this.connFeedback("Connecting..."),this.restoreStatus(),this.conn_manager.reconnect(this.reconnectionCallback.bind(this))}.bind(this),t)},connectionCallback:function(t,i){if(this.session.get("reconnecting"))return void e.info("ignore connection callback for status: "+a.CONN_STATUSES[t]);if(this.auth_view&&this.loginCallback(t,i),this.session.set({conn_status:t,conn_condition:i}),t!==r.Status.ERROR||"conflict"!==i||this.session.get("delete")||("x-token"===this.get("auth_type")?this.onTokenRevoked():this.onAuthFailed()),t===r.Status.CONNECTED)this.session.set("on_token_revoked",!1),this.connection.x_token&&(this.save({auth_type:"x-token",x_token:this.connection.x_token,password:null}),this.conn_manager.auth_type="x-token"),this.session.set({connected:!0,reconnected:!1}),e.api_account.get("connected")||!this.get("auto_login_xa")||e.api_account.get("token")||this.connectXabberAccount();else if(t===r.Status.AUTHFAIL)"x-token"===this.get("auth_type")||this.connection.x_token?this.onTokenRevoked():this.onAuthFailed();else if(t===r.Status.DISCONNECTED){if(this.session.get("on_token_revoked"))return;this.connection.flush(),this.session.set({connected:!1})}},connectXabberAccount:function(){var e=o({type:"get"}).c("query",{xmlns:r.NS.PRIVATE_STORAGE}).c("storage",{xmlns:"xabber:options"});this.sendIQ(e,function(e){"bind"==s(e).find("option").attr("type")&&1==s(e).find("option").text()&&this.authXabberAccount()}.bind(this))},authXabberAccount:function(t){this.requestPassword(function(a){if(this.xabber_auth={api_jid:a.api_jid,request_id:a.request_id},0<this.code_requests.length){let a=this.code_requests.find(e=>e.jid===this.xabber_auth.api_jid&&e.id===this.xabber_auth.request_id);if(a){let i=this.code_requests.indexOf(a);-1<i&&this.code_requests.splice(i,1),this.verifyXabberAccount(a.code,function(a){this._waiting_code=!1;let i=o({type:"set"}).c("query",{xmlns:r.NS.PRIVATE_STORAGE}).c("storage",{xmlns:"xabber:options"}).c("option",{type:"bind"}).t(1);e.api_account.save("token",a),e.api_account.login_by_token(),this.sendIQ(i),t&&t()}.bind(this))}if(this.code_requests.length){({from_jid:this.code_requests[0].jid,message:"Verification code is "+this.code_requests[0].code,is_archived:!1});this.createMessageFromIQ(msg_attr)}}}.bind(this))},requestPassword:function(e){var t={type:"POST",url:a.API_SERVICE_URL+"/accounts/xmpp_code_request/",contentType:"application/json",dataType:"json",data:JSON.stringify({jid:this.connection.jid,type:"iq"}),success:function(t){e&&e(t)}};this._waiting_code=!0,s.ajax(t)},reconnectionCallback:function(t,i){if(!this.session.get("reconnecting"))return void e.info("ignore reconnection callback for status: "+a.CONN_STATUSES[t]);if(this.session.set({conn_status:t,conn_condition:i}),t===r.Status.CONNECTED)this.session.set("on_token_revoked",!1),this.connection.connect_callback=this.connectionCallback.bind(this),this.session.set({connected:!0,reconnected:!0,reconnecting:!1,conn_retries:0});else if(t===r.Status.AUTHFAIL)"x-token"===this.get("auth_type")||this.connection.x_token?this.onTokenRevoked():this.onAuthFailed();else if(t===r.Status.DISCONNECTED){if(this.session.get("on_token_revoked"))return;this.connection.flush();var n=e.settings.max_connection_retries;-1===n||this.session.get("conn_retries")<n?this.reconnect():this.connFeedback("Connection lost!")}},loginCallback:function(e,t){e===r.Status.CONNECTED?(this.save("is_new",void 0),this.auth_view.successFeedback(this),this.auth_view=null):l.contains(a.BAD_CONN_STATUSES,e)&&(e===r.Status.ERROR?e="Connection error":e===r.Status.CONNFAIL?e="Connection failed":e===r.Status.AUTHFAIL?e="Authentication failed":e===r.Status.DISCONNECTED?e="Disconnected":e===r.Status.CONNTIMEOUT&&(e="Connection timeout expired"),t=t?": "+t:"",this.auth_view.errorFeedback({password:e+t}),this.get("is_new")&&this.destroy())},onAuthFailed:function(){this.auth_view||n.dialogs.error("Authentication failed for account "+this.get("jid")),this.session.set({auth_failed:!0,no_reconnect:!0}),this.trigger("deactivate",this),this.connFeedback("Authentication failed")},getAllXTokens:function(){var e=[],t=o({from:this.get("jid"),type:"get",to:this.connection.domain}).c("query",{xmlns:r.NS.AUTH_TOKENS+"#items"});this.sendIQ(t,function(t){s(t).find("field").each(function(t,a){var i=s(a),n=i.find("client").text(),o=i.find("device").text(),d=i.find("token-uid").text(),c=1e3*parseInt(i.find("expire").text()),r=1e3*parseInt(i.find("last-auth").text()),l=i.find("ip").text();e.push({client:n,device:o,token_uid:d,last_auth:r,expire:c,ip:l})}.bind(this)),this.x_tokens_list=e,this.settings_right.updateXTokens()}.bind(this))},onTokenRevoked:function(){return e.api_account.get("xmpp_binding")===this.get("jid")?void e.trigger("quit"):void(!this.auth_view&&n.dialogs.error("Token was invalidated for account "+this.get("jid")),this.session.set({on_token_revoked:!0,auth_failed:!0,connected:!1,no_reconnect:!0}),this.set({auth_type:"password",password:null,x_token:null}),this.connection.pass="",this.trigger("deactivate",this),this.connFeedback("Token was invalidated"),this.connect({token_invalidated:!0}))},onChangedConnected:function(){this.isConnected()?this.session.get("reconnected")?this.onReconnected():this.onConnected():this.onDisconnected()},onConnected:function(){this.connFeedback("Connected"),this.jid=this.connection.jid,this.resource=r.getResourceFromJid(this.jid),this.domain=r.getDomainFromJid(this.jid),this.trigger("activate",this),this.session.get("no_reconnect")&&this.session.set("no_reconnect",!1),this.afterConnected(),l.each(this._after_connected_plugins,function(e){e.call(this)}.bind(this))},onReconnected:function(){this.connFeedback("Connected"),this.afterConnected(),l.each(this._after_reconnected_plugins,function(e){e.call(this)}.bind(this))},afterConnected:function(){this.registerPresenceHandler(),this.enableCarbons(),this.getVCard(),this.sendPendingStanzas()},activateXabberRewrite:function(){var e=o({from:this.get("jid"),type:"set",to:this.get("jid")}).c("activate",{xmlns:r.NS.XABBER_REWRITE});this.sendIQ(e)},sendPendingStanzas:function(){l.each(this._pending_stanzas,function(e){e.stanza instanceof r.Builder?(this.connection.send(e.stanza),e.callback&&e.callback()):this.connection.sendIQ.apply(this.connection,e.stanza)}.bind(this)),this._pending_stanzas=[]},sendPendingMessages:function(){l.each(this._pending_messages,function(e){let t=this.messages.get(e.msg_id),i;t&&(i=t.get("xml"))&&t.set("state",a.MSG_PENDING),i&&this.sendMsg(i)}.bind(this))},_after_connected_plugins:[],_after_reconnected_plugins:[],onDisconnected:function(){if(this.disconnected_timestamp=this.last_stanza_timestamp,this.session.get("delete"))return void this.destroy();var e=this.session.get("deactivate");e?(this.connFeedback("Disconnected"),this.session.set("deactivate",null),"set_off"===e&&this.trigger("deactivate",this)):this.session.get("no_reconnect")?this.session.set("no_reconnect",!1):this.reconnect()},connFeedback:function(e){this.session.set("conn_feedback",e)},enableCarbons:function(){var e=o({type:"set"}).c("enable",{xmlns:r.NS.CARBONS});this.sendIQ(e)},getVCard:function(e){var t=this.get("jid"),i=l.isFunction(e);this.connection.vcard.get(t,function(n){var s={vcard:n,vcard_updated:p.now()};s.name=n.nickname||(n.first_name+" "+n.last_name).trim()||n.fullname||t,(!this.get("avatar_priority")||this.get("avatar_priority")<=a.AVATAR_PRIORITIES.VCARD_AVATAR)&&(n.photo.image?(s.avatar_priority=a.AVATAR_PRIORITIES.VCARD_AVATAR,s.image=n.photo.image):s.image=u.getDefaultAvatar(s.name),this.cached_image=u.getCachedImage(s.image)),this.save(s),i&&e(n)}.bind(this),function(){i&&e(null)})},setVCard:function(e,t,a){var i=l.extend(l.clone(this.get("vcard")),e);this.connection.vcard.set(this.get("jid"),i,function(){this.vcardPhotoUpdated(i.photo.image),t&&t()}.bind(this),a)},getStatusMessage:function(){return this.get("status_message")||a.STATUSES[this.get("status")]},setStatus:function(e,t){var a={status_updated:p.now()};null!==e&&(a.status=e),null!==t&&(a.status_message=t||""),"offline"===e&&"offline"!==this.get("status")&&(a.status_prev=this.get("status")),this.save(a),this.get("enabled")&&("offline"===e?this.deactivate("set_offline"):this.isConnected()?this.sendPresence():this.activate())},restoreStatus:function(){"offline"===this.get("status")&&this.save({status_updated:p.now(),status:this.get("status_prev")||"online",status_prev:void 0})},getAvatarHash:function(e){var t=e||this.get("vcard").photo.image;if(t){var a=atob(t),i=Uint8Array.from(Array.prototype.map.call(a,function(e){return e.charCodeAt(0)}));return sha1(i)}return""},vcardPhotoUpdated:function(e){let t=c().c("x",{xmlns:r.NS.VCARD_UPDATE}).c("photo").t(this.getAvatarHash(e)).up().up();return this.sendPres(t)},sendPresence:function(e,t){var e=e||this.get("status"),a=t||this.get("status_message"),i=c();return"offline"===e?i.attrs({type:"unavailable"}):("online"!==e&&i.c("show").t(e).up(),i.c("status").t(a).up(),i.c("priority").t(this.get("priority")).up()),i.cnode(this.connection.caps.createCapsNode({node:"https://www.xabber.com/"}).tree()),this.sendPres(i)},showSettings:function(t,a){e.body.setScreen("account_settings",{account:this,right:t,block_name:a}),this.trigger("open_settings")},updateColorScheme:function(){let e=this.settings.get("color");this.settings_left.$el.attr("data-color",e),this.settings_right.$el.attr("data-color",e),this.settings_right.$(".account-color .current-color-name").text(e),this.vcard_edit.$el.attr("data-color",e)},revokeXToken:function(e,t){let a=o({from:this.get("jid"),type:"set",to:this.connection.domain}).c("revoke",{xmlns:r.NS.AUTH_TOKENS});for(var i=0;i<e.length;i++)a.c("token-uid").t(e[i]).up();this.sendIQ(a,function(){t&&t()}.bind(this))},revokeAllXTokens:function(e,t){let a=o({from:this.get("jid"),type:"set",to:this.connection.domain}).c("revoke-all",{xmlns:r.NS.AUTH_TOKENS});this.sendIQ(a,function(t){e&e(t)}.bind(this),function(e){t&&t(e)})},deleteAccount:function(t){this.show_settings_after_delete=t,this.get("x_token")&&this.revokeXToken([this.get("x_token").token_uid]),this.session.set("delete",!0),this.deactivate(),e.api_account.get("xmpp_binding")===this.get("jid")&&e.trigger("quit")},activate:function(){this.isConnected()||this.connect()},deactivate:function(e){e||(e="set_off"),this.session.set("deactivate",e),this.isConnected()?(this.connFeedback("Disconnecting..."),this.sendPresence("offline"),this.connection.disconnect()):this.onDisconnected()},onDestroy:function(){this.connection.connect_callback=null,this.settings.destroy()},registerIQHandler:function(){this.connection.deleteHandler(this._stanza_handler),this._stanza_handler=this.connection.addHandler(function(e){return this.onGetIQ(e),!0}.bind(this),null,"iq","get")},registerSyncedIQHandler:function(){this.connection.deleteHandler(this._synced_stanza_handler),this._synced_stanza_handler=this.connection.addHandler(this.onSyncedIQ.bind(this),r.NS.SYNCHRONIZATION,"iq","set")},registerPresenceHandler:function(){this.connection.deleteHandler(this._pres_handler),this._pres_handler=this.connection.addHandler(function(e){return this.onPresence(e),!0}.bind(this),null,"presence",null)},onSyncedIQ:function(t){let a=s(t),i=a.find("conversation"),n=i.attr("jid"),o=i.children("deleted").length;if(o){let t=this.contacts.mergeContact(n),a=this.chats.getChat(t);a.set("opened",!1),e.chats_view.clearSearch()}return!0},onGetIQ:function(t){let i=s(t),n=i.find("confirm[xmlns=\""+r.NS.HTTP_AUTH+"\"]"),d=i.find("query[xmlns=\""+r.NS.JINGLE_MSG+"\"]"),c=i.attr("from"),l;if(n.length)if(l=n.attr("id"),this._waiting_code&&n.attr("url")===a.XABBER_ACCOUNT_URL+"/auth/login/")this.xabber_auth.api_jid&&this.xabber_auth.request_id?i.attr("id")===this.xabber_auth.request_id&&c===this.xabber_auth.api_jid&&this.verifyXabberAccount(l,function(t){this._waiting_code=!1,this.get("auto_login_xa")&&(e.api_account.save("token",t),e.api_account.login_by_token())}.bind(this)):this.code_requests.push({jid:c,id:i.attr("id"),code:l});else{this.createMessageFromIQ(msg_attr)}if(d.length){let t=d.children("session").attr("id"),a;t&&e.current_voip_call&&t===e.current_voip_call.get("session_id")&&!e.current_voip_call.get("state")?(a=o({from:this.get("jid"),to:c,type:"result",id:i.attr("id")}).c("query",{xmlns:r.NS.JINGLE_MSG}).c("session",{id:t}),e.current_voip_call.updateStatus("Calling...")):a=o({from:this.get("jid"),to:c,type:"error",id:i.attr("id")}).c("error",{xmlns:r.NS.JINGLE_MSG}),this.sendIQ(a)}},createMessageFromIQ:function(e){let t=this.contacts.mergeContact(e.from_jid),a=this.chats.getChat(t);a.messages.create(e)},onPresence:function(e){var t=s(e),i=e.getAttribute("type");if("error"!==i){var n=e.getAttribute("from"),o=r.getBareJidFromJid(n);if(o!==this.get("jid"))return void l.each(this._added_pres_handlers,function(t){t(e,o)});var d=r.getResourceFromJid(n),c=+t.find("priority").text(),p=t.find("show").text()||"online",u=t.find("status").text();l.isNaN(c)&&(c=0);var m=t.find("x[xmlns=\""+r.NS.VCARD_UPDATE+"\"]");if(m.length&&this.get("avatar_priority")&&this.get("avatar_priority")<=a.AVATAR_PRIORITIES.VCARD_AVATAR&&this.save("photo_hash",m.find("photo").text()),d&&d!==this.resource){var g=this.resources.get(d);if("unavailable"===i)g&&g.destroy();else{var h={resource:d,priority:c,status:p,status_message:u};g?g.set(h):g=this.resources.create(h)}}}}},{addInitPlugin:function(e){this.prototype._init_plugins.push(e)},addConnPlugin:function(e,t,a){t&&this.prototype._after_connected_plugins.push(e),a&&this.prototype._after_reconnected_plugins.push(e)}}),e.Accounts=Backbone.CollectionWithStorage.extend({model:e.Account,comparator:function(e,t){return e.settings.get("order")<t.settings.get("order")?-1:1},_initialize:function(){this.settings_list=e.account_settings_list,this.getEnabledList(),this.getConnectedList(),this.on("add",this.onAdd,this),this.on("destroy",this.onDestroy,this),this.on("change:enabled",this.getEnabledList,this),this.on("update_order",this.onUpdatedOrder,this),this.on("add destroy activate deactivate",this.onListChanged,this),this.on("destroy deactivate",this.onAccountDisconnected,this),e.on("quit",this.onQuit,this),this.settings_list.on("add_settings",this.onSettingsAdded,this),e.api_account.on("settings_result",function(e){e&&this.trigger("update_order")},this)},onQuit:function(){e.api_account.revoke_token(),this.models.length||e.body.setScreen("login"),l.each(l.clone(this.models),function(e){e.deleteAccount(),e.password_view.closeModal(),n.modals.clear_queue()})},getEnabledList:function(){this.enabled=this.filter(function(e){return e.get("enabled")})},getConnectedList:function(){this.connected=this.filter(function(e){return e.isConnected()})},onListChanged:function(){this.getEnabledList(),this.getConnectedList(),this.trigger("list_changed",this)},onAdd:function(e){e.is_invalid&&e.destroy()},onDestroy:function(t){if(!t.get("is_new")){var a=!(this.length||e.api_account.get("connected"));a?e.body.setScreen("login"):t.show_settings_after_delete?e.body.setScreen("settings"):(e.body.setScreen("all-chats"),e.chats_view.showAllChats())}},onAccountDisconnected:function(){e.toolbar_view.recountAllMessageCounter(),e.recountAllMessageCounter()},onSettingsAdded:function(e){var t=e.get("jid");this.get(t)||this.create({jid:t})},onUpdatedOrder:function(){this.sort(),this.getEnabledList(),this.getConnectedList()},getLastOrder:function(){return this.length?this.last().settings.get("order"):0},getDefaultColor:function(){var e={},t=a.ACCOUNT_COLORS;this.each(function(t){e[t.settings.get("color")]=!0});for(var i=0;i<t.length;i++)if(!e[t[i]])return t[i];return"red"},moveBefore:function(e,t){var a=this.indexOf(t),i=0<a?this.at(a-1).settings.get("order"):0;e.settings.save("order",(t.settings.get("order")+i)/2),this._updateOrder()},moveToBottom:function(e){e.settings.save("order",this.getLastOrder()+1),this._updateOrder()},_updateOrder:function(){this.sort(),this.each(function(e,t){e.settings.save({order:t+1})}),this.trigger("update_order"),e.api_account.get("connected")&&(this.settings_list.order_timestamp.save("timestamp",n.now()),e.api_account.synchronize_order_settings())}}),e.AccountToolbarItemView=e.BasicView.extend({className:"toolbar-item account-item",template:i.toolbar_item,avatar_size:a.AVATAR_SIZES.TOOLBAR_ACCOUNT_ITEM,events:{"click .filter-chats":"filterChats","click .circle-avatar":"showSettings"},_initialize:function(){this.updateConnected(),this.updateAuthState(),this.updateStatus(),this.updateAvatar(),this.updateColorScheme(),this.$el.attr("data-jid",this.model.get("jid")),this.model.session.on("change:auth_failed",this.updateAuthState,this),this.model.session.on("change:connected",this.updateConnected,this),this.model.on("change:status",this.updateStatus,this),this.model.on("change:image",this.updateAvatar,this),this.model.settings.on("change:color",this.updateColorScheme,this),this.model.on("filter_chats",this.setActive,this),this.model.on("open_settings",this.setActive,this)},updateConnected:function(){this.$el.switchClass("disconnected",!this.model.isConnected())},updateAuthState:function(){var e=this.model.session.get("auth_failed");this.$(".status").hideIf(e),this.$(".auth-failed").showIf(e)},updateStatus:function(){this.$(".status").attr("data-status",this.model.get("status"))},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateColorScheme:function(){this.$el.attr("data-color",this.model.settings.get("color"))},showSettings:function(){let t=e.toolbar_view.getScrollTop();this.model.showSettings(),e.toolbar_view.scrollTo(t)},filterChats:function(t){let a=e.toolbar_view.getScrollTop();t.stopPropagation(),e.chats_view.showChatsByAccount(this.model),this.model.trigger("filter_chats"),e.toolbar_view.scrollTo(a)},setActive:function(){e.toolbar_view.$(".toolbar-item").removeClass("active"),this.$el.addClass("active")}}),e.ToolbarAccountsBlockView=e.BasicView.extend({_initialize:function(){this.updateList(),this.model.on("add change:enabled",this.updateOneInList,this),this.model.on("update_order",this.updateList,this),this.model.on("destroy",this.onAccountRemoved,this)},updateList:function(){l.each(this.children,function(e){e.detach()}),l.each(this.model.enabled,function(t){var a=t.get("jid"),i=this.child(a);i||(i=this.addChild(a,e.AccountToolbarItemView,{model:t})),this.$el.append(i.$el)}.bind(this)),this.parent.updateScrollBar()},updateOneInList:function(t){var a=t.get("jid");if(t.get("enabled")){var i=this.child(a);i?i.$el.detach():i=this.addChild(a,e.AccountToolbarItemView,{model:t});var n=this.model.enabled.indexOf(t);0===n?this.$el.prepend(i.$el):this.$(".account-item").eq(n-1).after(i.$el)}else t.last_msg_timestamp=0,this.removeChild(a);this.parent.updateScrollBar()},onAccountRemoved:function(e){this.removeChild(e.get("jid")),this.parent.updateScrollBar()}}),e.Resource=Backbone.Model.extend({idAttribute:"resource",defaults:{priority:0}}),e.ResourceView=e.BasicView.extend({className:"resource-wrap",template:i.resource,_initialize:function(){this.update(),this.model.on("change",this.update,this)},update:function(){var e=this.model.attributes;return this.$(".status").attr("data-status",e.status),this.$(".status-message").text(e.status_message||a.STATUSES[e.status]),this.$(".client").text(e.client||"Wait please..."),this.$(".resource").text(e.resource),this.$(".priority").text(e.priority),this}}),e.Resources=Backbone.Collection.extend({model:e.Resource,comparator:function(e,t){var a=e.get("priority"),i=t.get("priority");return a>i?-1:a<i?1:0},requestInfo:function(e,t){var a=this.jid+"/"+e.get("resource");this.connection.disco.info(a,null,function(a){var i=s(a).find("identity[category=client]");i.length&&e.set("client",i.attr("name")),this.attention_supported=this.isFeatureSupported(a,r.NS.ATTENTION),t&&t()}.bind(this))},isFeatureSupported:function(e,t){let a=s(e),i=!1;return a.find("feature").each(function(){let e=s(this).attr("var");e===t&&(i=!0)}),i}}),e.ResourcesView=e.BasicView.extend({_initialize:function(){this.model.on("add",this.onResourceAdded,this),this.model.on("remove",this.onResourceRemoved,this),this.model.on("reset",this.onReset,this),this.model.on("change:priority",this.onPriorityChanged,this)},onResourceAdded:function(t){this.model.requestInfo(t),this.addChild(t.get("resource"),e.ResourceView,{model:t}),this.updatePosition(t),this.$el.removeClass("hidden"),this.parent.updateScrollBar()},onPriorityChanged:function(e){this.model.sort(),this.updatePosition(e)}}),e.AccountResources=e.Resources.extend({initialize:function(e,t){this.jid=t.account.get("jid"),this.connection=t.account.connection}}),e.AccountResourcesView=e.ResourcesView.extend({onResourceRemoved:function(e){this.removeChild(e.get("resource")),this.parent.updateScrollBar()},onReset:function(){this.removeChildren(),this.parent.updateScrollBar()},updatePosition:function(e){var t=this.child(e.get("resource"));if(t){t.$el.detach();var a=this.model.indexOf(e);0===a?this.$(".main-resource").after(t.$el):this.$(".resource-wrap").eq(a).after(t.$el),this.updateScrollBar()}}}),e.AccountVCardView=e.VCardView.extend({events:{"click .btn-vcard-refresh":"refresh","click .btn-vcard-edit":"showEditView","click .details-icon":"onClickIcon"},__initialize:function(){this.updateButtons(),this.model.on("activate deactivate",this.updateButtons,this)},updateButtons:function(){var e=this.model.isConnected();this.$(".btn-vcard-edit").showIf(e),this.$(".btn-vcard-refresh").showIf(e)},showEditView:function(){this.model.showSettings("vcard_edit")}}),e.AccountSettingsLeftView=e.BasicView.extend({className:"account-settings-left-wrap",template:i.settings_left,avatar_size:a.AVATAR_SIZES.ACCOUNT_SETTINGS_LEFT,events:{"change .main-info-wrap .circle-avatar input":"changeAvatar","click .main-info-wrap .status":"openChangeStatus","click .settings-tabs-wrap .settings-tab":"jumpToBlock","click .settings-tab.delete-account":"deleteAccount"},_initialize:function(){this.status_field=new e.StatusMessageWidget({el:this.$(".status-wrap")[0],model:this.model}),this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateBlocks(),this.model.on("change:name",this.updateName,this),this.model.on("change:status_updated",this.updateStatus,this),this.model.on("change:image",this.updateAvatar,this),this.model.on("activate deactivate",this.updateBlocks,this),this.model.on("destroy",this.remove,this)},render:function(e){return this.$el.switchClass("vcard-edit","vcard_edit"==e.right),this.$(".settings-tab[data-block-name=\"tokens\"]").hideIf("x-token"!==this.model.get("auth_type")),this.$(".settings-tab").removeClass("active"),this.$(".settings-tab[data-block-name=\""+e.block_name+"\"]").addClass("active"),this.updateCSS(),this},updateName:function(){this.$(".name").text(this.model.get("name")),this.updateNameCSS()},updateStatus:function(){this.$(".main-info-wrap .status").attr("data-status",this.model.get("status"))},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateBlocks:function(){var e=this.model.isConnected();this.$(".main-info-wrap").switchClass("disconnected",!e),this.$(".settings-tab[data-block-name=\"xmpp-resources\"]").showIf(e),this.$(".settings-tab[data-block-name=\"server-info\"]").showIf(e),this.$(".settings-tab[data-block-name=\"blocklist\"]").showIf(e),this.$(".settings-tab[data-block-name=\"groups-info\"]").showIf(e),this.updateScrollBar()},updateNameCSS:function(){if(this.isVisible()){var e=this.$(".name");e.removeAttr("style");for(var t=this.$(".name-wrap").width(),a=e.width(),i=22;a>t&&12<i;)e.css({"font-size":i}),a=e.width(),i-=2;e.css({"margin-left":(t-a)/2})}},changeAvatar:function(e){this.$(".circle-avatar").find(".preloader-wrap").addClass("visible").find(".preloader-wrapper").addClass("active");var t=e.target;if(t.files.length){var i=t.files[0];return(t.value="",i.size>a.MAX_AVATAR_FILE_SIZE)?void n.dialogs.error("File is too large"):i.type.startsWith("image")?void n.images.getAvatarFromFile(i).done(function(e,t,a){e?this.model.pubAvatar({base64:e,hash:t,size:a,type:i.type},function(){this.$(".circle-avatar").setAvatar(e,this.avatar_size),this.$(".circle-avatar").find(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active")}.bind(this),function(){this.$(".circle-avatar").find(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active"),n.dialogs.error("Wrong image")}.bind(this)):n.dialogs.error("Wrong image")}.bind(this)):void n.dialogs.error("Wrong image")}},updateCSS:function(){this.updateNameCSS()},openChangeStatus:function(){e.change_status_view.open(this.model)},jumpToBlock:function(e){var t=s(e.target).closest(".settings-tab"),a=t.data("block-name");this.model.showSettings(null,a)},deleteAccount:function(){var t=[];e.api_account.get("connected")&&(t=[{name:"delete_settings",checked:this.model.settings.get("to_sync"),text:"Delete synced settings"}]),n.dialogs.ask("Quit account","Do you want to quit this account from Xabber Web? Account will not be deleted from the server.",t,{ok_button_text:"quit"}).done(function(t){t&&(t.delete_settings&&(e.api_account.get("xmpp_binding")===this.model.get("jid")?e.api_account._call_method("DELETE","/accounts/current/client-settings/",{jid:this.model.get("jid")}):e.api_account.delete_settings(this.model.get("jid"))),this.model.deleteAccount())}.bind(this))}}),e.AccountSettingsRightView=e.BasicView.extend({className:"account-settings-right-wrap",template:i.settings_right,ps_selector:".panel-content",events:{"change .enabled-state input":"setEnabled","click .btn-change-password":"showPasswordView","click .btn-reconnect":"reconnect","change .sync-account":"changeSyncSetting","click .btn-delete-settings":"deleteSettings","click .color-values .color-value":"changeColor","click .token-wrap .btn-revoke-token":"revokeXToken","click .tokens .btn-revoke-all-tokens":"revokeAllXTokens"},_initialize:function(){this.resources_view=this.addChild("resources",e.AccountResourcesView,{model:this.model.resources,el:this.$(".xmpp-resources")[0]}),this.vcard_view=this.addChild("vcard",e.AccountVCardView,{model:this.model,el:this.$(".vcard")[0]}),this.$(".account-name .value").text(this.model.get("jid")),this.updateStatus(),this.updateView(),this.showConnectionStatus(),this.updateSynchronizationBlock(),this.model.session.on("change:reconnecting",this.updateReconnectButton,this),this.model.session.on("change:conn_feedback",this.showConnectionStatus,this),this.model.settings.on("change:to_sync",this.updateSyncOption,this),this.model.settings.on("change:deleted",this.updateDelSettingsButton,this),this.model.settings.on("change:to_sync change:synced",this.updateSyncState,this),e.api_account.on("change:connected",this.updateSynchronizationBlock,this),this.model.on("change:enabled",this.updateEnabled,this),this.model.on("change:status_updated",this.updateStatus,this),this.model.on("activate deactivate",this.updateView,this),this.model.on("destroy",this.remove,this)},render:function(t){return this.updateEnabled(),this.updateXTokens(),this.$(".connection-wrap .buttons-wrap").hideIf("x-token"===this.model.get("auth_type")),this.$(".main-resource .client").text(e.get("client_name")),this.$(".main-resource .resource").text(this.model.resource),this.$(".main-resource .priority").text(this.model.get("priority")),this.$(".account-color .dropdown-button").dropdown({inDuration:100,outDuration:100,belowOrigin:!0,hover:!1}),this.$(".account-color .dropdown-content").hide(),this.scrollToChild(this.$(".settings-block-wrap."+t.block_name)),this.$(".panel-content-wrap").removeClass("hidden"),this},updateStatus:function(){var e=this.model,t=e.get("status"),a=e.getStatusMessage();this.$(".main-resource .status").attr("data-status",t),this.$(".main-resource .status-message").text(a)},updateView:function(){var e=this.model.isConnected();this.$(".xmpp-resources").showIf(e),this.$(".server-info").showIf(e),this.$(".blocklist").showIf(e),this.$(".groups-info").showIf(e),this.updateScrollBar()},updateSynchronizationBlock:function(){this.$(".xabber-account-features-wrap").showIf(e.api_account.get("connected")),this.updateSyncState(),this.updateSyncOption(),this.updateDelSettingsButton()},renderAllXTokens:function(){this.$(".panel-content-wrap .tokens .sessions-wrap").html(""),s(l.sortBy(this.model.x_tokens_list),"last_auth").each(function(e,t){let a={client:t.client,device:t.device,token_uid:t.token_uid,ip:t.ip,last_auth:n.pretty_datetime(t.last_auth),expire:n.pretty_datetime(t.expire)};if(this.model.get("x_token")&&this.model.get("x_token").token_uid==t.token_uid){let e=s(i.current_token_item(a));return void this.$(".panel-content-wrap .tokens .current-session").append(e)}let o=s(i.token_item(a));this.$(".panel-content-wrap .tokens .all-sessions").append(o)}.bind(this)),this.$(".panel-content-wrap .tokens .all-sessions").children().length?this.$(".panel-content-wrap .tokens .all-sessions-wrap").removeClass("hidden"):this.$(".panel-content-wrap .tokens .all-sessions-wrap").addClass("hidden")},updateXTokens:function(){if("x-token"!==this.model.get("auth_type"))return this.$(".panel-content-wrap .tokens").addClass("hidden"),void this.$(".panel-content-wrap .tokens .sessions-wrap").children().html("");if(this.$(".panel-content-wrap .tokens .sessions-wrap").html(""),this.model.x_tokens_list&&this.model.x_tokens_list.length)if(this.$(".panel-content-wrap .tokens").removeClass("hidden"),this.model.get("x_token")&&!this.model.get("x_token").token_uid){let e=o({from:this.model.get("jid"),to:this.model.domain,type:"get"}).c("query",{xmlns:r.NS.AUTH_TOKENS+"#items"}).c("token").t(this.model.get("x_token").token);this.model.sendIQ(e,function(e){let t=s(e),a=t.find("token-uid").text(),i=t.find("expire").text();this.model.get("x_token").token_uid=a,this.model.get("x_token").expire=i,this.renderAllXTokens()}.bind(this))}else this.renderAllXTokens()},revokeXToken:function(e){var t=s(e.target).closest(".token-wrap"),a=t.data("token-uid");this.model.revokeXToken([a],function(){this.model.get("x_token")&&this.model.get("x_token").token_uid===a&&this.model.destroy()}.bind(this))},revokeAllXTokens:function(){this.model.x_tokens_list&&this.model.revokeAllXTokens(function(){}.bind(this))},updateSyncState:function(){var e;e=this.model.settings.get("to_sync")?this.model.settings.get("synced")?"yes":"no":"off",this.$(".sync-status").text(a.SYNCED_STATUS_DATA[e].tip);var t=a.SYNCED_STATUS_DATA[e].icon,i=this.$(".sync-status-icon");i.removeClass(i.attr("data-mdiclass")).attr("data-mdiclass",t).addClass(t)},updateSyncOption:function(){this.$(".sync-account").prop("checked",this.model.settings.get("to_sync"))},updateDelSettingsButton:function(){this.$(".btn-delete-settings").hideIf(this.model.settings.get("deleted"))},updateEnabled:function(){var e=this.model.get("enabled");this.$(".enabled-state input[type=checkbox]").prop("checked",e)},updateReconnectButton:function(){this.$(".btn-reconnect").switchClass("disabled",this.model.session.get("reconnecting"))},setEnabled:function(){var e=this.$(".enabled-state input").prop("checked");this.model.save("enabled",e),e?this.model.activate():this.model.deactivate()},showConnectionStatus:function(){this.$(".conn-status").text(this.model.session.get("conn_feedback"))},showPasswordView:function(){this.model.password_view.show()},reconnect:function(){this.model.session.get("reconnecting")||(this.model.save("enabled",!0),this.model.connection.connected?this.model.connection.disconnect():this.model.connect())},changeSyncSetting:function(t){var a=s(t.target).prop("checked"),i=this.model.settings;i.save("to_sync",a),a&&(i.update_timestamp(),e.api_account.synchronize_main_settings())},deleteSettings:function(){n.dialogs.ask("Delete settings","Settings for this XMPP account will be deleted from Xabber account",[{name:"delete_account",checked:this.model.settings.get("to_sync"),text:"Delete synced XMPP account"}],{ok_button_text:"delete"}).done(function(t){t&&(t.delete_account?!this.model.settings.get("to_sync")&&this.model.deleteAccount(!0):this.model.settings.save("to_sync",!1),e.api_account.delete_settings(this.model.get("jid")))}.bind(this))},changeColor:function(t){var a=s(t.target).closest(".color-value");this.model.settings.update_settings({color:a.data("value")}),e.api_account.synchronize_main_settings()}}),e.StatusMessageWidget=e.InputWidget.extend({field_name:"status-message",placeholder:"Set custom status",bindModelEvents:function(){this.model.on("change:status_updated",this.updateValue,this)},getValue:function(){return this.model.getStatusMessage()},setValue:function(e){this.model.setStatus(null,e)}}),e.AccountSettingsItemView=e.BasicView.extend({className:"xmpp-account draggable droppable",template:i.global_settings_item,avatar_size:a.AVATAR_SIZES.SETTINGS_ACCOUNT_ITEM,events:{"click .account-info-wrap":"showSettings","change .enabled-state input":"setEnabled"},_initialize:function(){this.$(".jid").text(this.model.get("jid")),this.updateEnabled(),this.updateAvatar(),this.updateColorScheme(),this.updateSyncState(),this.showConnectionStatus(),this.model.on("change:enabled",this.updateEnabled,this),this.model.on("change:image",this.updateAvatar,this),this.model.settings.on("change:color",this.updateColorScheme,this),this.model.session.on("change:conn_feedback",this.showConnectionStatus,this),this.$el.on("drag_to",this.onDragTo.bind(this)),this.$(".move-account-to-this").on("move_xmpp_account",this.onMoveAccount.bind(this)),this.model.settings.on("change:to_sync",this.updateSyncState,this)},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateColorScheme:function(){this.$el.attr("data-color",this.model.settings.get("color"))},showConnectionStatus:function(){this.$(".conn-status").text(this.model.session.get("conn_feedback"))},updateEnabled:function(){var e=this.model.get("enabled");this.$el.switchClass("disabled",!e),this.$(".enabled-state input[type=checkbox]").prop("checked",e)},setEnabled:function(){var e=this.$(".enabled-state input").prop("checked");this.model.save("enabled",e),e?this.model.activate():this.model.deactivate()},onDragTo:function(e,t){t&&s(t).trigger("move_xmpp_account",this.model)},onMoveAccount:function(e,t){this.model.collection.moveBefore(t,this.model)},updateSyncState:function(){var t=e.api_account.get("connected");this.$(".sync-marker-wrap").showIf(t),this.$el.find(".sync-marker").showIf(this.model.settings.get("to_sync"))},showSettings:function(){this.model.showSettings()}}),e.SettingsAccountsBlockView=e.BasicView.extend({_initialize:function(){this.updateList(),this.updateSyncState(),this.model.on("add",this.updateOneInList,this),this.model.on("update_order",this.updateList,this),this.model.on("destroy",this.onAccountRemoved,this),e.api_account.on("change:connected",this.updateSyncState,this),this.$(".move-account-to-bottom").on("move_xmpp_account",this.onMoveAccountToBottom.bind(this))},updateList:function(){l.each(this.children,function(e){e.detach()}),this.model.each(function(t){var a=t.get("jid"),i=this.child(a);i||(i=this.addChild(a,e.AccountSettingsItemView,{model:t})),this.$(".no-accounts-tip").before(i.$el)}.bind(this)),this.updateHtml(),this.parent.updateScrollBar()},updateOneInList:function(t){var a=t.get("jid"),i=this.child(a);i?i.$el.detach():i=this.addChild(a,e.AccountSettingsItemView,{model:t});var n=this.model.indexOf(t);0===n?this.$(".accounts-head-wrap").after(i.$el):this.$(".xmpp-account").eq(n-1).after(i.$el),this.updateHtml(),this.parent.updateScrollBar()},onAccountRemoved:function(e){this.removeChild(e.get("jid")),this.updateHtml(),this.parent.updateScrollBar()},render:function(){this.updateHtml(),l.each(this.children,function(e){e.updateEnabled()})},updateHtml:function(){this.$(".no-accounts-tip").hideIf(this.model.length),this.$(".accounts-head-wrap").showIf(this.model.length),this.updateCSS()},updateCSS:function(){var t=0;this.$(".jid").addClass("inline").each(function(){this.offsetWidth>t&&(t=this.offsetWidth)}).removeClass("inline"),t+=150,e.api_account.get("connected")&&(t+=45),this.$(".xmpp-account-list").css("width",t+48),l.each(this.children,function(e){e.$el.css("width",t)})},updateSyncState:function(){var t=e.api_account.get("connected");this.$(".sync-head").showIf(t),this.$(".sync-marker-wrap").showIf(t),this.$(".sync-head").hideIf(!t),this.$(".sync-marker-wrap").hideIf(!t),this.updateCSS()},onMoveAccountToBottom:function(e,t){this.model.moveToBottom(t)}}),e.ChangeStatusView=e.BasicView.extend({className:"modal main-modal change-status-modal",template:i.change_status,events:{"click .status-values li":"changeStatus","click .status-message-wrap .clear-input":"clearStatusMessageInput","keyup .status-message":"keyUp","change .apply-to-all":"changeApplyToAll"},open:function(e){this.account=e,this.highlightStatus(e.get("status")),this.restoreStatusMessageInput(),this.show()},highlightStatus:function(e){this.$(".status-values li[data-value=\""+e+"\"]").addClass("active").siblings().removeClass("active")},changeStatus:function(e){var t=s(e.target).closest("li").data("value");this.highlightStatus(t),this.do_change(),this.closeModal()},restoreStatusMessageInput:function(){var e=this.account.get("status_message");this.$(".status-message").val(e).switchClass("filled",e),e||this.$(".status-message").attr("placeholder",this.account.getStatusMessage())},clearStatusMessageInput:function(){var e=a.STATUSES[this.account.get("status")];this.$(".status-message").val("").attr("placeholder",e).removeClass("filled")},keyUp:function(e){if(e.keyCode===a.KEY_ENTER)this.do_change(),this.closeModal();else{var t=this.$(".status-message").val();this.$(".status-message").switchClass("filled",t)}},do_change:function(){var t=this.$(".status-values li.active").data("value"),a=this.$(".status-message").val();this.apply_to_all?e.accounts.each(function(e){e.setStatus(t,a)}):this.account.setStatus(t,a)},changeApplyToAll:function(e){this.apply_to_all=s(e.target).prop("checked")},render:function(){this.$el.openModal({ready:this.onRender.bind(this),complete:this.close.bind(this)})},onRender:function(){Materialize.updateTextFields()},onHide:function(){this.$el.detach()},close:function(){var e=this.$(".status-message").val();e||this.do_change(),this.closeModal()},closeModal:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.ChangePasswordView=e.BasicView.extend({className:"modal main-modal change-password-modal",template:i.change_password,events:{"click .btn-change":"submit","click .btn-cancel":"close","keyup input[name=password]":"keyUp"},_initialize:function(){return this.$("input[name=jid]").val(this.model.get("jid")),this.$password_input=this.$("input[name=password]"),this.data.on("change:authentication",this.updateButtons,this),e.on("quit",this.onQuit,this),this},render:function(e){e||(e={}),this.is_login=e.login,this.token_invalidated=e.token_invalidated,this.$(".modal-header span").text(this.is_login?"Log In":"Set password"),this.$(".btn-cancel").text(this.is_login?"Skip":"Cancel"),this.$(".btn-change").text(this.is_login?"Log In":"Set"),this.$el.openModal({use_queue:!0,ready:this.onRender.bind(this),complete:this.close.bind(this)})},onRender:function(){Materialize.updateTextFields(),this.authFeedback({}),this.$password_input.val("").focus()},getActionName:function(){return this.is_login?"Login":"Set"},keyUp:function(e){e.keyCode===a.KEY_ENTER&&this.submit()},submit:function(){if(this.data.get("authentication"))return void this.cancel();this.data.set("authentication",!0),this.authFeedback({});var e=this.model.get("jid"),t=this.$password_input.val();return t?void(this.authFeedback({password:"Authentication with password..."}),this.model.connection.connected?(this.model.once("deactivate",function(){this.setPassword(t)}.bind(this)),this.model.deactivate()):this.setPassword(t)):this.errorFeedback({password:"Please input password!"})},setPassword:function(e){this.model.last_msg_timestamp=0,this.model.save({auth_type:"password",password:n.utoa(e),enabled:!0}),this.model.auth_view=this,this.model.connect()},cancel:function(){this.data.set("authentication",!1)},updateButtons:function(){var e=this.data.get("authentication");this.$(".btn-change").text(e?"Stop":this.getActionName())},authFeedback:function(e){this.$password_input.switchClass("invalid",e.password).siblings("span.errors").text(e.password||"")},errorFeedback:function(e){this.authFeedback(e),this.data.set("authentication",!1)},successFeedback:function(){this.data.set("authentication",!1),this.closeModal()},onHide:function(){this.$el.detach()},onQuit:function(){this.closeModal()},close:function(){this.is_login&&this.model.save("enabled",!1),this.token_invalidated&&this.model.deleteAccount(),this.cancel(),this.closeModal()},closeModal:function(){this.model.auth_view=null,this.$el.closeModal({complete:this.hide.bind(this)})}}),e.AuthView=e.BasicView.extend({_initialize:function(){return this.$jid_input=this.$("input[name=jid]"),this.$password_input=this.$("input[name=password]"),this.data.on("change:authentication",this.updateButtons,this),this},render:function(){this.onRender()},onRender:function(){this.account=null,this.authFeedback({}),Materialize.updateTextFields(),this.$jid_input.val("").focus(),this.$password_input.val(""),this.updateButtons(),this.updateOptions&&this.updateOptions()},keyUp:function(e){e.keyCode===a.KEY_ENTER&&this.submit()},submit:function(){if(this.data.get("authentication"))return void this.cancel();this.data.set("authentication",!0),this.authFeedback({});var t=this.$jid_input.val(),i=this.$password_input.val();if(!t)return this.errorFeedback({jid:"Please input username!"});if(!i)return this.errorFeedback({password:"Please input password!"});var s=t.indexOf("@");if(0>=s||s===t.length-1)return this.errorFeedback({jid:"Wrong username format!"});t=r.getBareJidFromJid(t).toLowerCase();var o=e.accounts.get(t);o?this.errorFeedback({jid:"This account already added to Xabber web"}):(this.authFeedback({password:"Authentication..."}),this.getWebsocketURL(t,function(s){this.account=e.accounts.create({jid:t,websocket_connection_url:s||a.CONNECTION_URL,password:n.utoa(i),is_new:!0},{auth_view:this}),this.account.trigger("start")}.bind(this)))},getWebsocketURL:function(e,t){if(!a.DISABLE_LOOKUP_WS){let a=r.getDomainFromJid(e),i={type:"GET",url:window.location.protocol+"//"+a+"/.well-known/host-meta",dataType:"xml",success:function(e){let a=s(e).find("Link").attr("href");a?t&&t(a):t&&t(null)}.bind(this),error:function(){t&&t(null)}.bind(this)};s.ajax(i)}else t&&t(null)},cancel:function(){this.data.set("authentication",!1),this.onRender(),this.account&&(this.account.destroy(),this.account=null)},authFeedback:function(e){this.$jid_input.switchClass("invalid",e.jid).siblings("span.errors").text(e.jid||""),this.$password_input.switchClass("invalid",e.password).siblings("span.errors").text(e.password||"")},errorFeedback:function(e){this.authFeedback(e),this.data.set("authentication",!1)},socialAuth:function(t){var i=window.location.href,n=s(t.target).closest(".btn-social").data("provider");"email"==n?e.body.setScreen("login",{login_screen:"xabber"}):window.location.href=a.XABBER_ACCOUNT_URL+"/social/login/"+n+"/?origin="+i+"&source=Xabber Web"}}),e.XmppLoginPanel=e.AuthView.extend({className:"login-panel",template:i.xmpp_login,events:{"click .login-type":"changeLoginType","click .btn-log-in":"submit","click .btn-social":"socialAuth","click .btn-cancel":"cancel","keyup input[name=password]":"keyUp"},changeLoginType:function(){e.body.setScreen("login",{login_screen:"xabber"})},updateButtons:function(){var e=this.data.get("authentication");this.$(".btn-log-in").switchClass("disabled",e),this.$(".btn-cancel").showIf(e)},successFeedback:function(t){t.auth_view=null,this.data.set("authentication",!1),e.body.setScreen("all-chats",{right:null})}}),e.AddAccountView=e.AuthView.extend({className:"modal main-modal add-account-modal",template:i.add_account,events:{"click .btn-add":"submit","click .btn-cancel":"close","keyup input[name=password]":"keyUp"},render:function(){this.$el.openModal({ready:this.onRender.bind(this),complete:this.close.bind(this)})},updateOptions:function(){this.$(".sync-option").showIf(e.api_account.get("connected")).find("input").prop("checked",e.api_account.get("sync_all"))},updateButtons:function(){var e=this.data.get("authentication");this.$(".btn-add").text(e?"Stop":"Add")},successFeedback:function(t){this.data.set("authentication",!1),this.$(".sync-option input").prop("checked")?(t.settings.update_timestamp(),e.api_account.synchronize_main_settings()):t.settings.save("to_sync",!1),e.body.setScreen("all-chats",{right:null}),this.closeModal()},onHide:function(){this.$el.detach()},close:function(){this.cancel(),this.closeModal()},closeModal:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),e.once("start",function(){this.xmpp_login_panel=e.login_page.addChild("xmpp_login",this.XmppLoginPanel),this.account_settings=e.wide_panel.addChild("account_settings",this.NodeView,{classlist:"settings-panel account-settings-panel"}),this.acc_settings_left=e.account_settings.addChild("left",this.Container,{classlist:"account-settings-left-container"}),this.acc_settings_right=e.account_settings.addChild("right",this.Container,{classlist:"account-settings-right-container"}),this.accounts=new this.Accounts(null,{storage_name:this.getStorageName()+"-accounts"}),this.accounts.fetch(),this.toolbar_view.addChild("accounts",this.ToolbarAccountsBlockView,{model:this.accounts,el:this.toolbar_view.$(".accounts")[0]}),this.settings_view.addChild("accounts",this.SettingsAccountsBlockView,{model:this.accounts,el:this.settings_view.$(".xmpp-accounts")[0]}),this.add_account_view=new this.AddAccountView,this.change_status_view=new this.ChangeStatusView,this.on("add_account",function(){this.add_account_view.show()},this),s(window).bind("beforeunload",function(){e.current_voip_call&&e.current_voip_call.reject()}),window.onbeforeunload=function(){l.each(this.accounts.connected,function(e){e.sendPresence("offline")})}.bind(this),this.login_page.patchTree=function(e,t){var i=t.login_screen||a.DEFAULT_LOGIN_SCREEN;return"xmpp"===i?{xmpp_login:null}:{xabber_login:null}},this.servers=new e.Servers},e),e}}),define("xabber-discovery",[],function(){return function(e){var t=e.env,a=t.constants,i=t.$,n=t._,s=t.moment,o=t.Strophe,d=t.$iq;return e.ClientFeature=Backbone.Model.extend({idAttribute:"namespace"}),e.FeatureView=e.BasicView.extend({className:"client-feature",template:function(){this.$el.append("<div class=\"feature-name one-line\"/>").append("<div class=\"supports\"/>")},_initialize:function(){this.render(),this.$el.appendTo(this.model.collection.account.settings_right.$(".capabilities")),this.model.on("change",this.render,this),this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.get("verbose_name"),t=this.model.get("supports");this.$(".feature-name").text(e),this.$(".supports").text(t?"Available":"Unavailable")}}),e.ClientFeatures=Backbone.Collection.extend({model:e.ClientFeature,initialize:function(t,a){this.account=a.account,this.connection=this.account.connection,this.connection.disco.addIdentity("client","web",e.get("client_name"),"en"),this.addFeature(o.NS.LAST,"XEP-0012: Last Activity"),this.addFeature(o.NS.VCARD,"XEP-0054: vCard-temp"),this.addFeature(o.NS.RSM,"XEP-0059: Result Set Management"),this.connection.disco.addFeature(o.NS.CHATSTATES),this.addFeature(o.NS.BLOCKING,"XEP-0191: Blocking Command"),this.addFeature(o.NS.PING,"XEP-0199: XMPP Ping"),this.addFeature(o.NS.ATTENTION,"XEP-0244: Attention"),this.addFeature(o.NS.CARBONS,"XEP-0280: Message carbons"),this.addFeature(o.NS.MAM,"XEP-0313: Message archive management"),this.connection.disco.addFeature(o.NS.CHAT_MARKERS),this.connection.disco.addFeature(o.NS.PUBSUB_AVATAR_METADATA+"+notify"),this.addFeature(o.NS.HTTP_UPLOAD,"XEP-0363: HTTP File Upload")},addFeature:function(t,a){var i=this.create({namespace:t,verbose_name:a});this.connection.disco.addFeature(t);new e.FeatureView({model:i})}}),e.ServerFeature=Backbone.Model.extend({idAttribute:"var"}),e.ServerFeatures=Backbone.Collection.extend({model:e.ServerFeature,initialize:function(e,t){this.account=t.account,this.connection=this.account.connection,this.on("add",this.onFeatureAdded,this)},request:function(){this.connection.disco.info(this.account.domain,null,this.onInfo.bind(this)),this.connection.disco.items(this.account.domain,null,this.onItems.bind(this))},onItems:function(e){let t=[];i(e).find("query item").each(function(e,a){if(i(a).attr("node")===o.NS.GROUP_CHAT){let e=i(a).attr("jid");t.push(e),this.account.set("groupchat_servers_list",t)}this.connection.disco.info(i(a).attr("jid"),null,this.onInfo.bind(this))}.bind(this))},onInfo:function(e){var t=i(e),a=t.attr("from"),n=this;t.find("feature").each(function(){var e=i(this).attr("var");n.create({var:e,from:a}),e===o.NS.AUTH_TOKENS&&n.account.getAllXTokens()})},onFeatureAdded:function(e){var t=e.get("var"),a=this.account.client_features.get(t);a&&a.set("supports",!0);var i=e.get("preferences")||{};t===o.NS.MAM&&"always"!==i.default&&this.account.sendIQ(d({type:"get"}).c("prefs",{xmlns:o.NS.MAM}),n.bind(this.receiveMAMPreferences,this,e))},receiveMAMPreferences:function(e,t){var a=i(t).find("prefs[xmlns=\""+o.NS.MAM+"\"]"),n=a.attr("default");if("always"!==n){var s=d({type:"set"}).c("prefs",{xmlns:o.NS.MAM,default:"always"});a.children().each(function(e,t){s.cnode(t).up()}),this.account.sendIQ(s,function(){e.set("preferences",{default:"always"})})}else e.set("preferences",{default:"always"})}}),e.ServerInfo=Backbone.Collection.extend({model:e.ServerFeature,initialize:function(e){this.domain=e.domain,this.account=e.account,this.connection=this.account.connection},request:function(){this.connection.disco.info(this.domain,null,this.onInfo.bind(this))},onInfo:function(e){var t=i(e),a=t.attr("from"),n=this;t.find("feature").each(function(){var e=i(this).attr("var");n.create({var:e,from:a})})}}),e.Server=Backbone.Model.extend({idAttribute:"domain",initialize:function(t){this.account=t.account,this.set("domain",t.domain||this.account.domain),this.server_features=new e.ServerInfo({account:this.account,domain:this.get("domain")}),this.getServerInfo()},getServerInfo:function(){this.server_features.request()}}),e.Servers=Backbone.Collection.extend({model:e.Server}),e.Account.addInitPlugin(function(){this.client_features=new e.ClientFeatures(null,{account:this}),this.server_features=new e.ServerFeatures(null,{account:this})}),e.Account.addConnPlugin(function(){this.last_stanza_timestamp=s.now(),this.connection.deleteHandler(this._last_stanza_handler),this._last_stanza_handler=this.connection.addHandler(function(){return this.last_stanza_timestamp=s.now(),!0}.bind(this)),this.connection.deleteHandler(this._pong_handler),this._pong_handler=this.connection.ping.addPingHandler(function(e){return this.last_stanza_timestamp=s.now(),this.connection.ping.pong(e),!0}.bind(this)),this.connection.deleteTimedHandler(this._ping_handler),this._ping_handler=this.connection.addTimedHandler(3e4,function(){var t=s.now()-this.last_stanza_timestamp;return t/1e3>(e.settings.reconnect_interval||120)?(this.connection.connected?this.connection.disconnect():this.connect(),!1):(t/1e3>(e.settings.ping_interval||60)&&this.connection.ping.ping(this.get("jid")),!0)}.bind(this)),this.server_features.request()},!0,!0),e.Account.addConnPlugin(function(){var e=this.connection.disco;this.connection.addHandler(e._onDiscoInfo.bind(e),o.NS.DISCO_INFO,"iq","get",null,null),this.connection.addHandler(e._onDiscoItems.bind(e),o.NS.DISCO_ITEMS,"iq","get",null,null)},!1,!0),e}}),define("xabber-contacts",[],function(){var e=Math.trunc,t=Math.round;return function(a){var i=a.env,n=i.constants,s=i.templates.contacts,o=i.utils,d=i.$,c=i.$iq,r=i.$pres,l=i.Strophe,p=i._,u=i.moment,m=i.uuid,g=o.images,h=o.emoji;return a.Contact=Backbone.Model.extend({idAttribute:"jid",defaults:{status:"offline",status_message:"",subscription:void 0,subscription_request_in:!1,subscription_request_out:!1,groups:[],group_chat:!1},initialize:function(e,t){this.on("change:group_chat",this.onChangedGroupchat,this),this.account=t.account;var n=p.clone(e);this.account&&this.account.domain===n.jid&&p.extend(n,{is_server:!0,bot:!0}),n.name=n.roster_name||n.jid,n.image||(n.photo_hash="",n.image=g.getDefaultAvatar(n.name)),this.cached_image=g.getCachedImage(n.image),n.vcard=o.vcard.getBlank(n.jid),this.set(n),this.domain=l.getDomainFromJid(this.get("jid")),this.set("group_chat",p.contains(this.account.chat_settings.get("group_chat"),this.get("jid"))),this.hash_id=i.b64_sha1(this.account.get("jid")+"-"+n.jid),this.resources=new a.ContactResources(null,{contact:this}),this.details_view=this.get("group_chat")?new a.GroupChatDetailsView({model:this}):new a.ContactDetailsView({model:this}),this.on("change:photo_hash",this.getContactInfo,this),this.on("change:roster_name",this.updateName,this),a.servers.get(this.domain)||a.servers.create({domain:this.domain,account:this.account}),this.account.dfd_presence.done(function(){this.get("blocked")||this.getContactInfo()}.bind(this))},getStatusMessage:function(){let e=this.get("subscription"),t=this.get("subscription_request_in"),a=this.get("subscription_request_out"),i="";return this.get("blocked")?i="Contact blocked":"from"===e?a?i="Subscription request pending":i="Subscribed to your status":e?this.get("group_info")?(i=this.get("group_info").members_num,i+=1<this.get("group_info").members_num?" participants":" participant",0<this.get("group_info").online_members_num&&(i+=", "+this.get("group_info").online_members_num+" online")):i=this.get("status_message")||n.STATUSES[this.get("status")]:a?i="Subscription request pending":t?i="Incoming subscription request":p.isNull(e)?i="No subscriptions":i="Not in your contacts",i},getIcon:function(){return this.get("blocked")?"ic-blocked":this.get("invitation")?"ic-invitation-chat":this.get("group_chat")?this.get("private_chat")?"ic-private-chat":this.get("incognito_chat")?"ic-incognito-chat":"ic-group-chat":this.get("bot")?"ic-bot-chat":void 0},getContactInfo:function(){a.cached_contacts_info.getContactInfo(this.get("jid"),function(e){return p.isNull(e)?void(!this.get("group_chat")&&this.getVCard()):(e.hash!==this.get("photo_hash")&&(!e.hash||this.get("photo_hash")||p.isNull(this.get("photo_hash")))||(this.cached_image=g.getCachedImage(e.avatar),e.avatar_priority&&this.set("avatar_priority",e.avatar_priority),this.set("photo_hash",e.hash),this.set("image",e.avatar)),void(!this.get("roster_name")&&e.name&&this.set("name",e.name)))}.bind(this))},getVCard:function(e){var t=this.get("jid"),i=p.isFunction(e);this.account.connection.vcard.get(t,function(s){var o={vcard:s,vcard_updated:u.now(),name:this.get("roster_name")};o.name||(this.get("group_chat")?o.name=s.nickname||this.get("name"):o.name=s.nickname||(s.first_name+" "+s.last_name).trim()||s.fullname||t),(!this.get("avatar_priority")||this.get("avatar_priority")<=n.AVATAR_PRIORITIES.VCARD_AVATAR)&&(s.photo.image?(o.avatar_priority=n.AVATAR_PRIORITIES.VCARD_AVATAR,o.image=s.photo.image):o.image=g.getDefaultAvatar(o.name),this.cached_image=g.getCachedImage(o.image)),this.set(o);let d={jid:this.get("jid"),name:this.get("name")};(this.get("photo_hash")||s.photo.image)&&p.extend(d,{hash:this.get("photo_hash")||this.account.getAvatarHash(s.photo.image),avatar_priority:this.get("avatar_priority"),avatar:this.get("image")}),a.cached_contacts_info.putContactInfo(d),i&&e(s)}.bind(this),function(){i&&e(null)})},onChangedGroupchat:function(){this.get("group_chat")&&(this.updateCounters(),this.participants=new a.Participants(null,{contact:this}))},updateCounters:function(){a.toolbar_view.recountAllMessageCounter()},getLastSeen:function(){if("offline"==this.get("status")){if(!l.getNodeFromJid(this.get("jid")))return void this.set({status_message:"Server"});var e=c({from:this.account.get("jid"),type:"get",to:this.get("jid")}).c("query",{xmlns:l.NS.LAST});this.account.sendIQ(e,function(e){var t=this.getLastSeenStatus(e);return"offline"==this.get("status")&&this.set({status_message:t}),this}.bind(this))}},membersRequest:function(e,t){e=e||{};let a=e.id,i=e.version||0;var n=c({from:this.account.get("jid"),to:this.get("jid"),type:"get"});null==a?n.c("query",{xmlns:l.NS.GROUP_CHAT+"#members",version:i}):a?n.c("query",{xmlns:l.NS.GROUP_CHAT+"#rights"}).c("user",{xmlns:l.NS.GROUP_CHAT,id:a}):e.properties?n.c("query",{xmlns:l.NS.GROUP_CHAT+"#members",id:a}):n.c("query",{xmlns:l.NS.GROUP_CHAT+"#rights"}).c("user",{xmlns:l.NS.GROUP_CHAT,id:a}),this.account.sendIQ(n,function(e){t&&t(e)})},getMyInfo:function(e){this.membersRequest({id:"",properties:!0},function(t){let a=d(d(t).find("query user")),i=this.account.chat_settings.getAvatarInfoById(a.find("id").text());a.length&&this.participants&&this.participants.createFromStanza(a),i&&i.avatar_hash==this.my_info.get("avatar")&&this.my_info.set("b64_avatar",i.avatar_b64),this.trigger("update_my_info"),this.membersRequest({id:""},function(t){let a=this.account.parseDataForm(d(t).find("x[xmlns=\""+l.NS.DATAFORM+"\"]"));this.my_rights=a,this.trigger("permissions_changed"),e&&e()}.bind(this))}.bind(this))},getAvatar:function(e,t,a,i){var n=c({from:this.account.get("jid"),type:"get",to:this.get("jid")}).c("pubsub",{xmlns:l.NS.PUBSUB}).c("items",{node:t}).c("item",{id:e});this.account.sendIQ(n,function(e){var t=d(e).find("data").text();""==t?i&&i("Node is empty"):a&&a(t)}.bind(this))},pubAvatar:function(e,t,a,i){var n=sha1(e.base64),s=c({from:this.account.get("jid"),type:"set",to:this.get("jid")}).c("pubsub",{xmlns:l.NS.PUBSUB}).c("publish",{node:l.NS.PUBSUB_AVATAR_DATA+t}).c("item",{id:n}).c("data",{xmlns:l.NS.PUBSUB_AVATAR_DATA}).t(e.base64),o=c({from:this.account.get("jid"),type:"set",to:this.get("jid")}).c("pubsub",{xmlns:l.NS.PUBSUB}).c("publish",{node:l.NS.PUBSUB_AVATAR_METADATA+t}).c("item",{id:n}).c("metadata",{xmlns:l.NS.PUBSUB_AVATAR_METADATA}).c("info",{bytes:e.size,id:n,type:e.type});this.account.sendIQ(s,function(){this.account.sendIQ(o,function(){a&&a(n)}.bind(this),function(e){i&&i(e)})}.bind(this),function(e){i&&i(e)}.bind(this))},getLastSeenStatus:function(e){var t=d(e).children("query").attr("seconds"),a=u.now()-1e3*t;return this.set({last_seen:a}),o.pretty_last_seen(t)},pres:function(e){var t=r({to:this.get("jid"),type:e});return this.account.sendPres(t),this},pushInRoster:function(e,t,a){e||(e={});var i=e.name||this.get("roster_name"),n=e.groups||this.get("groups"),s=c({type:"set"}).c("query",{xmlns:l.NS.ROSTER}).c("item",{jid:this.get("jid"),name:i});return p.each(n,function(e){s.c("group").t(e).up()}),this.account.sendIQ(s,t,a),this.set("known",!0),this},removeFromRoster:function(e,t){var a=c({type:"set"}).c("query",{xmlns:l.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return this.account.cached_roster.removeFromCachedRoster(this.get("jid")),this.account.sendIQ(a,e,t),this.set("known",!1),this},acceptRequest:function(e){this.pres("subscribed"),e&&e()},askRequest:function(e){this.pres("subscribe"),e&&e()},blockRequest:function(e){this.pres("unsubscribed"),this.block(e)},declineRequest:function(e){this.pres("unsubscribed"),this.removeFromRoster(e)},declineSubscription:function(){this.pres("unsubscribe"),this.set("subscription_request_out",!1)},declineSubscribe:function(){this.pres("unsubscribed")},block:function(e,t){var a=c({type:"set"}).c("block",{xmlns:l.NS.BLOCKING}).c("item",{jid:this.get("jid")});this.account.sendIQ(a,e,t),this.set("known",!1)},unblock:function(e,t){var a=c({type:"set"}).c("unblock",{xmlns:l.NS.BLOCKING}).c("item",{jid:this.get("jid")});this.account.sendIQ(a,e,t)},sendPresent:function(){var e=r({from:this.account.connection.jid,to:this.get("jid")}).c("x",{xmlns:l.NS.GROUP_CHAT+"#present"});this.account.sendPres(e)},sendNotPresent:function(){var e=r({from:this.account.connection.jid,to:this.get("jid")}).c("x",{xmlns:l.NS.GROUP_CHAT+"#not-present"});this.account.sendPres(e)},handlePresence:function(e){var t=d(e),i=e.getAttribute("type"),s=t.find("x[xmlns=\""+l.NS.VCARD_UPDATE+"\"]");if(s.length&&this.get("avatar_priority")&&this.get("avatar_priority")<=n.AVATAR_PRIORITIES.VCARD_AVATAR&&this.set("photo_hash",s.find("photo").text()),"subscribe"===i)this.set("subscription_request_in",!0),this.get("in_roster")||this.get("subscription_preapproved")?this.pres("subscribed"):this.trigger("presence",this,"subscribe");else if("subscribed"===i)"to"===this.get("subscription"),this.trigger("presence",this,"subscribed");else if("unsubscribe"===i){if(this.get("group_chat")){this.removeFromRoster();let e=this.account.chats.getChat(this);e.deleteFromSynchronization(function(){e.trigger("close_chat"),this.destroy()}.bind(this),function(){e.trigger("close_chat"),this.destroy()}.bind(this))}}else if("unsubscribed"===i);else{var o=e.getAttribute("from"),c=l.getResourceFromJid(o),r=+t.find("priority").text(),m=t.find("show").text()||"online",g=t.find("status"),h=g.text();p.isNaN(r)&&(r=0),clearTimeout(this._reset_status_timeout);let a=this.resources.get(c);if("unavailable"===i)this.set({last_seen:u.now()}),a&&a.destroy();else{this.set({last_seen:void 0});var v={resource:c,priority:r,status:m};g.length&&(v.status_message=h),a?a.set(v):a=this.resources.create(v)}}let A=d(e).find("x[xmlns=\""+l.NS.GROUP_CHAT+"\"]");if(0<A.length&&A.children().length){this.get("group_chat")||(this.set("group_chat",!0),this.account.chat_settings.updateGroupChatsList(this.get("jid"),this.get("group_chat"))),this.details_view.child("participants")||(this.details_view=new a.GroupChatDetailsView({model:this}));let t=this.parseGroupInfo(d(e));this.set("group_info",t),this.get("roster_name")||t.name===this.get("name")||this.set("name",t.name),this.set({status:t.status,status_updated:u.now(),status_message:t.members_num+" participants, "+t.online_members_num+" online"})}},parseGroupInfo:function(e){var t=e.find("x[xmlns=\""+l.NS.GROUP_CHAT+"\"]"),a=t.find("name").text(),i=t.find("membership").text(),n=e.children("show").text()||("unavailable"===e.attr("type")?"inactive":"active"),s=e.children("status").text(),o=t.find("privacy").text(),d=t.find("index").text(),c=t.find("description").text(),r=+t.find("pinned-message").text(),p=t.find("parent-chat").text()||!1,u=parseInt(t.find("members").text()),m=parseInt(t.find("present").text()),g={jid:this.get("jid"),name:a,anonymous:o,searchable:d,model:i,status:n,status_msg:s||n,description:c,members_num:u,online_members_num:m};p&&this.set("private_chat",p),"incognito"===o&&this.set("incognito_chat",!0);var h=this.account.chats.get(this.hash_id),v;return h&&(v=h.item_view.content.$pinned_message),v&&(r?this.getMessageByStanzaId(r,function(e){this.parsePinnedMessage(e,v)}.bind(this)):(this.set("pinned_message",void 0),this.parsePinnedMessage(void 0,v))),g},getAllRights:function(e){let t=iq=c({from:this.account.get("jid"),type:"get",to:this.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#rights"});this.account.sendIQ(t,function(t){var a=d(t).find("permission"),i=d(t).find("restriction");this.all_rights={permissions:a,restrictions:i},e&&e()}.bind(this))},getMessageByStanzaId:function(e,t){var a=m(),i=c({type:"set",to:this.get("jid")}).c("query",{xmlns:l.NS.MAM,queryid:a}).c("x",{xmlns:l.NS.DATAFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(l.NS.MAM).up().up().c("field",{var:"{urn:xmpp:sid:0}stanza-id"}).c("value").t(e),n=this.account.connection.addHandler(function(e){var i=d(e);return i.find("result").attr("queryid")===a&&t&&t(i),!0}.bind(this),l.NS.MAM);this.account.sendIQ(i,function(){this.account.connection.deleteHandler(n)}.bind(this),function(){this.account.connection.deleteHandler(n)}.bind(this))},parsePinnedMessage:function(e,t){if(!e)this.renderPinnedMessage(null,t);else{var a=e.find("result message").first();if(this.get("pinned_message")&&this.get("pinned_message").stanza_id===a.find("stanza-id").attr("id"))return;var i=this.account.chats.receiveChatMessage(e,{pinned_message:!0});this.set("pinned_message",i),this.renderPinnedMessage(i,t)}},renderPinnedMessage:function(e,t){if(!e)t.html(""),t.siblings(".chat-content").css({height:"100%"});else{var a=e.get("images"),i=e.get("files"),n=e.get("forwarded_message"),c=null,r=p.escape(e.get("message"));if(n){let e=n[0].get("user_info")||{};r||(1<n.length?r=n.length+" forwarded messages":(r=n[0].get("message")||n[0].get("forwarded_message")&&n[0].get("forwarded_message").length+" forwarded messages",c=e.nickname||n[0].get("from_jid")||e.id))}a&&(1==a.length&&(r="<span class=text-color-500>Image: </span>"+a[0].name),1<a.length&&(r="<span class=text-color-500>"+a.length+" images</span>")),i&&(1==i.length&&(r="<span class=text-color-500>File: </span>"+i[0].name+" ("+i[0].size+")"),1<i.length&&(r="<span class=text-color-500>"+i.length+" files</span>"));let u=e.get("user_info")||{},m=this.account.chats.get(this.hash_id).item_view.content,g=m.isScrolledToBottom(),h=u.nickname||e.get("from_jid")||u.id,v={author:h,time:o.pretty_datetime(e.get("time")),message:r,fwd_author:c},A=d(s.group_chats.pinned_message(v));t.html(A).emojify(".chat-msg-content",{emoji_size:18});var l=t.height();t.siblings(".chat-content").css({height:"calc(100% - "+l+"px)"}),g&&m.scrollToBottom(),t.attr("data-uniqueid",e.get("unique_id"))}},resetStatus:function(e){clearTimeout(this._reset_status_timeout),this._reset_status_timeout=setTimeout(function(){this.set({status_updated:u.now(),status:"offline",status_message:""})}.bind(this),e||5e3)},searchByParticipants:function(e,t){let a=[];this.participants.forEach(function(t){let i=t.get("jid");if(e){e=e.toLowerCase();let n=t.get("nickname"),s=t.get("id");(i&&-1<i.toLowerCase().indexOf(e)||n&&-1<n.toLowerCase().indexOf(e))&&a.push(t)}else a.push(t)}.bind(this)),t&&t(a)},updateName:function(){this.get("roster_name")&&this.get("name")!==this.get("roster_name")&&this.set("name",this.get("roster_name"))},showDetails:function(e){e||(e="contacts"),a.body.setScreen(e,{right:"contact_details",contact:this})}}),a.SetGroupchatStatusView=a.BasicView.extend({className:"modal main-modal change-status-modal",template:s.group_chats.set_status,events:{"click .status-values li":"changeStatus"},open:function(e){this.contact=e,this.account=this.contact.account,this.show(),this.getStatuses()},highlightStatus:function(e){this.$(".status-values li[data-value=\""+e+"\"]").addClass("active").siblings().removeClass("active")},getStatuses:function(){let e=c({to:this.contact.get("jid"),type:"get"}).c("query",{xmlns:l.NS.GROUP_CHAT});this.account.sendIQ(e,function(e){this.data_form=this.account.parseDataForm(d(e).find("x[xmlns=\""+l.NS.DATAFORM+"\"]"));let t=this.data_form.fields.find(e=>"status"==e.var).options||[];return t.length?void this.renderStatuses(t):(this.closeModal(),void o.dialogs.error("You have no permission to set group chat's status"))}.bind(this))},renderStatuses:function(e){this.$(".status-values").html(""),e.forEach(function(e){let t=d(s.group_chats.status_item({option:e}));this.$(".status-values").append(t)}.bind(this)),this.highlightStatus(this.contact.get("group_info").status)},changeStatus:function(e){var t=d(e.target).closest("li").data("value");this.highlightStatus(t),this.do_change(),this.closeModal()},do_change:function(){var e=this.$(".status-values li.active").data("value");this.setStatus(e)},render:function(){this.$el.openModal({complete:this.close.bind(this)})},setStatus:function(e){if(!this.data_form||this.contact.get("group_info").status===e)return;let t=c({to:this.contact.get("jid"),type:"set"}).c("query",{xmlns:l.NS.GROUP_CHAT}),a=this.data_form.fields.find(e=>"status"===e.var),i=this.data_form.fields.indexOf(a);a.values=[e],this.data_form.fields[i]=a,t=this.account.addDataFormToStanza(t,this.data_form),this.account.sendIQ(t)},onHide:function(){this.$el.detach()},close:function(){var e=this.$(".status-message").val();e||this.do_change(),this.closeModal()},closeModal:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),a.ContactItemView=a.BasicView.extend({className:"roster-contact list-item",_initialize:function(){this.account=this.model.account,this.$el.attr({"data-id":m(),"data-jid":this.model.get("jid")}),this.$(".jid").text(this.model.get("jid")),this.interval_last,this.updateName(),this.updateStatus(),this.updateAvatar(),this.selectView(),this.updateGroupChat(),this.updateIcon(),this.model.on("change:name",this.updateName,this),this.model.on("change:image",this.updateAvatar,this),this.model.on("change:status_updated",this.updateStatus,this),this.model.on("change:private_chat",this.updateIcon,this),this.model.on("change:incognito_chat",this.updateIcon,this),this.model.on("change:bot",this.updateIcon,this),this.model.on("change:status_message",this.updateStatusMsg,this),this.model.on("change:last_seen",this.lastSeenUpdated,this),this.model.on("change:group_chat",this.updateGroupChat,this)},updateName:function(){this.$(".name").text(this.model.get("name"))},updateAvatar:function(){this.$(".circle-avatar").setAvatar(this.model.cached_image,this.avatar_size)},updateStatus:function(){if(this.$(".status").attr("data-status",this.model.get("status")),this.$(".chat-icon").attr("data-status",this.model.get("status")),this.$(".status-message").text(this.model.getStatusMessage()),"offline"==this.model.get("status")){if(!l.getNodeFromJid(this.model.get("jid")))return void this.model.set({status_message:"Server"});if(this.model.get("last_seen")){var e=(u.now()-this.model.get("last_seen"))/1e3,t=o.pretty_last_seen(e);this.model.set({status_message:t})}}},selectView:function(){this.model.get("group_chat")&&(this.$(".private-chat").addClass("hidden"),this.$(".group_chat").removeClass("hidden"))},lastSeenUpdated:function(){"offline"==this.model.get("status")&&this.model.get("last_seen")&&p.isUndefined(this.interval_last)?this.interval_last=setInterval(function(){var e=(u.now()-this.model.get("last_seen"))/1e3,t=o.pretty_last_seen(e);this.model.set({status_message:t})}.bind(this),6e4):clearInterval(this.interval_last)},updateGroupChat:function(){var e=this.model.get("group_chat");this.$(".status").hideIf(e),this.updateIcon()},updateIcon:function(){let e;if(this.$(".chat-icon").addClass("hidden"),this.model.get("blocked"))e="ic-blocked";else{if(this.model.get("invitation"))return;this.model.get("group_chat")?e=this.model.get("private_chat")?"ic-private-contact":this.model.get("incognito_chat")?"ic-incognito-contact":"ic-group-contact":this.model.get("bot")&&(e="ic-bot-contact")}e&&this.$(".chat-icon").removeClass("hidden").children("svg").html(i.templates.svg[e]())},updateStatusMsg:function(){this.$(".status-message").text(this.model.getStatusMessage())}}),a.ContactItemRightView=a.ContactItemView.extend({template:s.contact_right_item,avatar_size:n.AVATAR_SIZES.CONTACT_RIGHT_ITEM,events:{click:"clickOnItem",mouseover:"showJid",mouseleave:"hideJid"},showJid:function(){this.$(".name").text()!==this.model.get("jid")&&(this.$(".status-message").addClass("hidden"),this.$(".jid").removeClass("hidden"))},hideJid:function(){this.$(".jid").addClass("hidden"),this.$(".status-message").removeClass("hidden")},clickOnItem:function(){this.model.trigger("open_chat",this.model)}}),a.ContactItemLeftView=a.ContactItemView.extend({template:s.contact_left_item,avatar_size:n.AVATAR_SIZES.CONTACT_LEFT_ITEM,events:{click:"clickOnItem"},__initialize:function(){this.updateDisplayStatus(),this.updateBlockedState(),this.updateMutedState(),this.model.on("change:display",this.updateDisplayStatus,this),this.model.on("change:blocked",this.updateBlockedState,this),this.model.on("change:muted",this.updateMutedState,this),this.model.on("change:group_chat",this.updateGroupChat,this)},updateDisplayStatus:function(){this.$el.switchClass("active",this.model.get("display"))},updateBlockedState:function(){this.$el.switchClass("blocked",this.model.get("blocked"))},updateMutedState:function(){this.$(".muted-icon").showIf(this.model.get("muted"))},clickOnItem:function(){this.model.showDetails()}}),a.ContactResources=a.Resources.extend({initialize:function(e,t){this.contact=t.contact,this.jid=t.contact.get("jid"),this.connection=t.contact.account.connection,this.on("add change",this.onResourceUpdated,this),this.on("remove",this.onResourceRemoved,this)},onResourceUpdated:function(e){e===this.first()&&this.contact.set({status_updated:u.now(),status:e.get("status"),status_message:e.get("status_message")})},onResourceRemoved:function(){let e={status_updated:u.now()};this.length?(e.status=this.first().get("status"),e.status_message=this.first().get("status_message")):(e.status="offline",e.status_message=""),this.contact.set(e)}}),a.ContactResourcesView=a.ResourcesView.extend({onResourceAdded:function(e){this.addChild(e.get("resource"),a.ResourceView,{model:e}),this.updatePosition(e),this.$el.removeClass("hidden"),this.parent.updateScrollBar()},onResourceRemoved:function(e){this.removeChild(e.get("resource")),this.$el.showIf(this.model.length),this.parent.updateScrollBar()},onReset:function(){this.removeChildren(),this.$el.addClass("hidden"),this.parent.updateScrollBar()},updatePosition:function(e){var t=this.child(e.get("resource"));if(t){t.$el.detach();var a=this.model.indexOf(e);0===a?this.$(".resources-wrap").prepend(t.$el):this.$(".resource-wrap").eq(a-1).after(t.$el),this.updateScrollBar()}}}),a.ContactVCardView=a.VCardView.extend({events:{"click .btn-vcard-refresh":"refresh","click .details-icon":"onClickIcon"}}),a.ContactDetailsView=a.BasicView.extend({className:"details-panel contact-details-panel",template:s.contact_details,ps_selector:".panel-content-wrap",avatar_size:n.AVATAR_SIZES.CONTACT_DETAILS,events:{"click .btn-escape":"openChat","click .btn-chat":"openChat","click .btn-voice-call":"voiceCall","click .btn-add":"addContact","click .btn-delete":"deleteContact","click .btn-block":"blockContact","click .btn-qr-code":"showQRCode","click .btn-unblock":"unblockContact","click .btn-mute":"changeNotifications","click .btn-auth-request":"requestAuthorization","change .subscription-info-wrap input":"onChangedSubscription"},_initialize:function(){this.account=this.model.account,this.name_field=new a.ContactNameWidget({el:this.$(".name-wrap")[0],model:this.model}),this.resources_view=this.addChild("resources",a.ContactResourcesView,{model:this.model.resources,el:this.$(".resources-block-wrap")[0]}),this.vcard_view=this.addChild("vcard",a.ContactVCardView,{model:this.model,el:this.$(".vcard")[0]}),this.edit_groups_view=this.addChild("groups",a.ContactEditGroupsView,{el:this.$(".groups-block-wrap")[0]}),this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateButtons(),this.model.on("change",this.update,this),a.on("change:video",this.updateJingleButtons,this),a.on("change:audio",this.updateJingleButtons,this)},render:function(){this.model.get("vcard_updated")||this.vcard_view.refresh();this.$(".main-info .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"right"}),this.updateSubscriptions(),this.updateJingleButtons(),this.updateStatusMsg(),this.updateName(),this.model.resources.models.forEach(function(e){this.model.resources.requestInfo(e)}.bind(this))},onChangedVisibility:function(){this.model.set("display",this.isVisible())},updateJingleButtons:function(){this.$(".btn-voice-call").switchClass("non-active",!a.get("audio"))},update:function(){var e=this.model.changed;p.has(e,"name")&&this.updateName(),p.has(e,"image")&&this.updateAvatar(),p.has(e,"status_updated")&&this.updateStatus(),p.has(e,"muted")&&this.updateNotifications(),p.has(e,"subscription")&&this.updateSubscriptions(),p.has(e,"subscription_request_in")&&this.updateSubscriptions(),p.has(e,"blocked")&&this.updateStatusMsg(),p.has(e,"status_message")&&this.updateStatusMsg(),(p.has(e,"in_roster")||p.has(e,"blocked")||p.has(e,"subscription"))&&this.updateButtons()},updateName:function(){this.$(".main-info .contact-name").text(this.model.get("name")),this.model.get("name")==this.model.get("roster_name")?this.$(".main-info .contact-name").removeClass("name-is-custom"):this.$(".main-info .contact-name").addClass("name-is-custom")},updateStatus:function(){this.$(".main-info .status").attr("data-status",this.model.get("status")),this.$(".main-info .status-message").text(this.model.getStatusMessage())},updateStatusMsg:function(){this.$(".main-info .status-message").text(this.model.getStatusMessage())},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateButtons:function(){var e=this.model.get("in_roster"),t=this.model.get("blocked"),a=this.model.get("is_server"),i=this.model.get("subscription");this.$(".btn-add").hideIf(e),this.$(".btn-delete").showIf(e),this.$(".btn-block-wrap i").switchClass("btn-block",!t).switchClass("btn-unblock",t),this.$(".btn-block-wrap .btn-name").text(t?"Unblock":"Block"),this.$(".buttons-wrap .button-wrap:not(.btn-block-wrap)").switchClass("non-active",t),this.$(".btn-auth-request").showIf(!a&&e&&!t&&"both"!==i&&"to"!==i)},updateNotifications:function(){this.$(".btn-mute").switchClass("mdi-bell-off",this.model.get("muted")),this.$(".btn-mute").switchClass("mdi-bell",!this.model.get("muted"))},showQRCode:function(){let e=new VanillaQR({url:"xmpp:"+this.model.get("jid"),noBorder:!0});o.dialogs.ask("QR-code",null,{canvas:e.domElement,bottom_text:"<div class=\"name\">"+this.model.get("name")+"</div><div class=\"jid\">"+this.model.get("jid")+"</div>"},{ok_button_text:"copy"}).done(function(t){t&&e.domElement.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})]))}.bind(this))},updateSubscriptions:function(){let e=this.model.get("subscription"),t=this.model.get("subscription_request_in"),a=this.model.get("subscription_request_out"),i=this.$("label[for=\"outcoming-subscription\"]"),n=this.$("label[for=\"incoming-subscription\"]");"both"===e?(n.text("Send presence updates").prev("input").prop("checked",!0),i.text("Receive presence updates").prev("input").prop("checked",!0)):"from"===e?(n.text("Send presence updates").prev("input").prop("checked",!0),i.text("Ask for presence updates").prev("input").prop("checked",!1)):"to"===e?(n.text("Preemptively grant subscription request").prev("input").prop("checked",!!this.model.get("subscription_preapproved")),i.text("Receive presence updates").prev("input").prop("checked",!0)):!e&&(n.text("Preemptively grant subscription request").prev("input").prop("checked",!!this.model.get("subscription_preapproved")),i.text("Ask for presence updates").prev("input").prop("checked",!1)),t&&n.text("Send presence updates").prev("input").prop("checked",!1),a&&i.text("Ask for presence updates").prev("input").prop("checked",!0)},onChangedSubscription:function(e){let t=this.model,a=d(e.target),i=a.prop("checked");i?"outcoming-subscription"===a.attr("id")?t.askRequest():(t.acceptRequest(),t.set("subscription_preapproved",!0)):"outcoming-subscription"===a.attr("id")?t.declineSubscription():t.declineSubscribe()},openChat:function(e){e&&(d(e.target).closest(".button-wrap").hasClass("non-active")||d(e.target).closest(".button-wrap").length&&this.model.get("blocked"))||this.model.trigger("open_chat",this.model)},voiceCall:function(e){d(e.target).closest(".button-wrap").hasClass("non-active")||this.model.get("blocked")||a.get("audio")&&this.initCall(e)},initCall:function(){if(a.current_voip_call)return void o.callback_popup_message("Voice call is already in progress",1e3);this.openChat();let e=this.account.chats.getChat(this.model);e.item_view.content.initJingleMessage()},changeNotifications:function(e){if(!(d(e.target).closest(".button-wrap").hasClass("non-active")||this.model.get("blocked"))){var t=!this.model.get("muted");this.model.set("muted",t),this.account.chat_settings.updateMutedList(this.model.get("jid"),t)}},addContact:function(){a.add_contact_view.show({account:this.account,jid:this.model.get("jid")})},deleteContact:function(){var e=this.model;o.dialogs.ask("Delete contact","Do you really want to delete contact "+e.get("name").bold()+" from account "+this.account.get("jid").bold()+"?",[{name:"delete_history",checked:!1,text:"Delete chat history"}],{ok_button_text:"delete"}).done(function(t){if(t){if(e.removeFromRoster(),t.delete_history){let t=this.account.chats.getChat(e);t.retractAllMessages(!1),t.deleteFromSynchronization(),a.body.setScreen("all-chats",{right:void 0})}a.trigger("clear_search")}}.bind(this))},blockContact:function(){var e=this.model;o.dialogs.ask_extended("Block contact","Do you really want to block "+e.get("name").bold()+" from account "+this.account.get("jid").bold()+"?\nYou will be unable to exchange messages and presence updates with "+e.get("jid").bold(),null,{ok_button_text:"block",optional_button:"block & delete"}).done(function(t){if(t){let i=this.account.chats.getChat(e);"block & delete"===t&&(e.removeFromRoster(),i.retractAllMessages(!1),i.deleteFromSynchronization()),e.blockRequest(),a.trigger("clear_search"),a.body.setScreen("all-chats",{right:void 0}),i.set("active",!1)}}.bind(this))},unblockContact:function(){var e=this.model;o.dialogs.ask("Unblock contact","Do you really want to unblock  from account "+this.account.get("jid").bold()+"?",null,{ok_button_text:"unblock"}).done(function(t){t&&(e.unblock(),a.trigger("clear_search"))})},requestAuthorization:function(){this.model.pres("subscribe"),this.model.trigger("presence",this.model,"subscribe_from"),this.openChat()}}),a.GroupChatDetailsView=a.BasicView.extend({className:"details-panel groupchat-details-panel",template:s.group_chats.group_chat_details,ps_selector:".panel-content-wrap",avatar_size:n.AVATAR_SIZES.CONTACT_DETAILS,member_avatar_size:n.AVATAR_SIZES.GROUPCHAT_MEMBER_ITEM,events:{"click .btn-mute":"changeNotifications","click .btn-qr-code":"showQRCode","click .btn-leave":"leaveGroupChat","click .btn-invite":"inviteUser","click .btn-delete-group":"deleteGroupChat","click .btn-edit-settings":"editProperties","click .btn-default-restrictions":"editDefaultRestrictions","click .btn-chat":"openChat","click .btn-escape":"openChat","click .btn-clear-history":"retractAllMessages","change .circle-avatar input":"changeAvatar","click .list-variant":"changeList"},_initialize:function(){this.account=this.model.account,this.name_field=new a.ContactNameWidget({el:this.$(".name-wrap")[0],model:this.model}),this.participants=this.addChild("participants",a.ParticipantsView,{model:this.model,el:this.$(".participants-wrap")[0]}),this.edit_groups_view=this.addChild("groups",a.ContactEditGroupsView,{el:this.$(".groups-block-wrap")[0]}),this.group_chat_properties=this.addChild("properties_view",a.GroupChatPropertiesView,{model:this.model,el:this.$(".group-chat-properties-wrap")[0]}),this.group_chat_status=this.addChild("status_view",a.GroupChatStatusView,{model:this.model,el:this.$(".status-block-wrap")[0]}),this.group_chat_properties_edit=new a.GroupChatPropertiesEditView({model:this.model}),this.default_restrictions_edit=new a.DefaultRestrictionsView({model:this.model}),this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateColorScheme(),this.account.settings.on("change:color",this.updateColorScheme,this),this.model.on("change",this.update,this),this.model.on("permissions_changed",this.updateButtons,this)},render:function(){this.updateName(),this.updateButtons(),this.model.my_rights||this.model.getMyInfo(function(){this.updateButtons()}.bind(this)),this.$(".btn-delete").showIf("both"===this.model.get("subscription")),this.$(".btn-join").showIf("both"!==this.model.get("subscription"));let e={inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"right"};return this.$(".select-users-list-wrap .dropdown-button").dropdown(e),this.$(".main-info .dropdown-button").dropdown(e),this.updateList("participants"),this.$(".tabs .indicator").remove(),this.$(".tabs").tabs(),this.$(".indicator").addClass("ground-color-500"),this},update:function(){var e=this.model.changed;p.has(e,"name")&&this.updateName(),p.has(e,"image")&&this.updateAvatar(),p.has(e,"muted")&&this.updateNotifications(),(p.has(e,"status_updated")||p.has(e,"status_message"))&&this.updateStatus()},updateColorScheme:function(){this.$el.attr("data-color",this.account.settings.get("color"))},updateButtons:function(){let e=this.model.my_rights&&this.model.my_rights.fields.find(e=>("owner"==e.var||"administrator"==e.var)&&e.values),t=this.model.get("blocked");this.$(".btn-settings-wrap").switchClass("non-active",!e),this.$(".btn-default-restrictions-wrap").switchClass("non-active",!e),this.$(".btn-invite-wrap").switchClass("non-active",this.model.get("private_chat")),this.$(".btn-block").hideIf(t),this.$(".btn-unblock").showIf(t)},updateName:function(){this.$(".main-info .contact-name").text(this.model.get("name")),this.model.get("name")==this.model.get("roster_name")?this.$(".main-info .contact-name").removeClass("name-is-custom"):this.$(".main-info .contact-name").addClass("name-is-custom")},changeNotifications:function(e){if(!(d(e.target).closest(".button-wrap").hasClass("non-active")||this.model.get("blocked"))){var t=!this.model.get("muted");this.model.set("muted",t),this.account.chat_settings.updateMutedList(this.model.get("jid"),t)}},updateNotifications:function(){this.$(".btn-mute").switchClass("mdi-bell-off",this.model.get("muted")),this.$(".btn-mute").switchClass("mdi-bell",!this.model.get("muted"))},deleteGroupChat:function(){var e=this.model;o.dialogs.ask("Delete groupchat","Do you want to delete groupchat "+e.get("name")+"?",null,{ok_button_text:"delete"}).done(function(t){if(t){let t=e.get("jid"),i=l.getDomainFromJid(t),n=l.getNodeFromJid(t),s=c({to:i,type:"set"}).c("query",{xmlns:l.NS.GROUP_CHAT+"#delete"}).t(n);this.account.sendIQ(s,function(){e.declineSubscription(),e.removeFromRoster();let t=this.account.chats.getChat(e);t.trigger("close_chat"),a.body.setScreen("all-chats",{right:void 0})}.bind(this))}}.bind(this))},showQRCode:function(){let e=new VanillaQR({url:"xmpp:"+this.model.get("jid"),noBorder:!0});o.dialogs.ask("QR-code",null,{canvas:e.domElement,bottom_text:"<div class=\"name\">"+this.model.get("name")+"</div><div class=\"jid\">"+this.model.get("jid")+"</div>"},{ok_button_text:"copy"}).done(function(t){t&&e.domElement.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})]))}.bind(this))},editProperties:function(e){if(!d(e.target).closest(".button-wrap").hasClass("non-active")){let e=c({to:this.model.get("jid"),type:"get"}).c("query",{xmlns:l.NS.GROUP_CHAT});this.account.sendIQ(e,function(e){let t=this.account.parseDataForm(d(e).find("x[xmlns=\""+l.NS.DATAFORM+"\"]"));this.group_chat_properties_edit.open(t)}.bind(this))}},editDefaultRestrictions:function(e){d(e.target).closest(".button-wrap").hasClass("non-active")||this.default_restrictions_edit.open()},leaveGroupChat:function(){var e=this.model;o.dialogs.ask("Leave groupchat","Do you want to leave groupchat "+e.get("name")+"?",null,{ok_button_text:"leave"}).done(function(t){if(t){e.declineSubscription(),e.removeFromRoster();let t=this.account.chats.getChat(e);t.deleteFromSynchronization(function(){t.trigger("close_chat"),a.body.setScreen("all-chats",{right:void 0})}.bind(this),function(){t.trigger("close_chat"),a.body.setScreen("all-chats",{right:void 0})}.bind(this))}}.bind(this))},inviteUser:function(e){d(e.target).closest(".button-wrap").hasClass("non-active")||a.invite_panel.open(this.account,this.model)},changeList:function(e){let t=d(e.target).closest(".list-variant"),a=t.data("value");this.updateList(a)},updateList:function(e){let t=this.child(e);t||(t=this.addList(e)),t&&(this.$(".tabs .list-variant a").removeClass("active"),this.$(".tabs .list-variant[data-value=\""+e+"\"] a").addClass("active"),t._render())},addList:function(e){let t;return"blocked"===e?t=a.BlockedView:"invitations"===e?t=a.InvitationsView:void 0,t?this.addChild(e,t,{model:this.model,el:this.$(".participants-wrap")[0]}):void 0},deleteContact:function(){var e=this.model;o.dialogs.ask("Delete contact","Do you want to delete "+e.get("name")+" from contacts?",null,{ok_button_text:"delete"}).done(function(t){t&&(e.removeFromRoster(),e.trigger("archive_chat"),a.trigger("clear_search"))})},blockContact:function(){var e=this.model;o.dialogs.ask("Block group chat","Do you want to block "+e.get("name")+"?",null,{ok_button_text:"block"}).done(function(t){t&&(e.blockRequest(),a.trigger("clear_search"))})},unblockContact:function(){var e=this.model;o.dialogs.ask("Unblock contact","Do you want to unblock "+e.get("name")+"?",null,{ok_button_text:"unblock"}).done(function(t){t&&(e.unblock(),a.trigger("clear_search"))})},updateStatus:function(){this.$(".main-info .status-message").text(this.model.getStatusMessage())},updateAvatar:function(){let e=this.model.cached_image;this.$(".main-info .circle-avatar").setAvatar(e,this.avatar_size)},openChat:function(){this.model.trigger("open_chat",this.model)},changeAvatar:function(e){var t=e.target;if(t.files.length){d(t).siblings(".preloader-wrap").addClass("visible").find(".preloader-wrapper").addClass("active");var a=t.files[0];t.value="",a.size>n.MAX_AVATAR_FILE_SIZE?o.dialogs.error("File is too large"):!a.type.startsWith("image")&&o.dialogs.error("Wrong image"),o.images.getAvatarFromFile(a).done(function(e){e&&(a.base64=e,this.model.pubAvatar(a,"",function(){d(t).siblings(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active")},function(e){d(t).siblings(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active");let a=d(e).find("text").text()||"You have no permissions to change avatar";o.dialogs.error(a)}))}.bind(this))}},retractAllMessages:function(){var e=this.account.chats.getChat(this.model);o.dialogs.ask("Clear message archive","Do you want to delete all messages from archive?",null,{ok_button_text:"delete"}).done(function(t){t&&e.retractAllMessages(!0)}.bind(this))}}),a.GroupChatStatusView=a.BasicView.extend({template:s.group_chats.group_status,events:{"click .status-wrap":"setStatus","click .btn-edit-status":"setStatus"},_initialize:function(){this.$el.html(this.template()),this.render(),this.model.on("change:group_info",this.render,this)},render:function(){let e;this.model.get("group_info")&&(e=this.model.get("group_info")),e&&(this.$(".status").attr("data-status",e.status),this.$(".status-message").text(e.status_msg))},setStatus:function(){let e=new a.SetGroupchatStatusView;e.open(this.model)}}),a.GroupChatPropertiesView=a.BasicView.extend({template:s.group_chats.group_chat_properties,events:{"click .group-chat-properties .details-icon":"onClickIcon"},_initialize:function(){this.$el.html(this.template()),this.contact=this.model,this.account=this.model.account,this.model.on("change:name",this.updateName,this),this.model.on("change:group_info",this.update,this)},render:function(){this.update()},update:function(){let e=this.model.get("group_info")||{};this.$(".block-name").text(this.contact.get("group_info").anonymous+" group"),this.$(".jabber-id .value").text(e.jid),this.$(".name .value").text(e.name),this.$(".description .value").text(e.description),this.$(".model .value").text(o.pretty_name(e.model)),this.$(".status .value").text(o.pretty_name(e.status)),this.$(".searchable .value").text("none"===e.searchable?"No":o.pretty_name(e.searchable)),this.$(".name-info-wrap").switchClass("hidden",!e.name),this.$(".description-info-wrap").switchClass("hidden",!e.description),this.$(".model-info-wrap").switchClass("hidden",!e.model),this.$(".status-info-wrap").switchClass("hidden",!e.status),this.$(".searchable-info-wrap").switchClass("hidden",!e.searchable)},onClickIcon:function(e){let t=d(e.target).closest(".info-wrap"),a=t.find(".value"),i="";a.each(function(e,a){let n=d(a),s=n.text();if(t.hasClass("searchable-info-wrap")){let e=t.find(".label").first().text();"No"===s?s+=" "+e.toLowerCase():"Yes"===s&&(s=e)}s&&""!=i&&(i+="\n"),s&&(i+=s),i&&o.copyTextToClipboard(i,"Copied in clipboard","ERROR: Not copied in clipboard")}.bind(this))}}),a.GroupChatPropertiesEditView=a.BasicView.extend({className:"modal dialog-modal group-chat-properties-edit",events:{"click .btn-save":"saveChanges","click .btn-cancel":"close","change input":"updateSaveButton","keyup .property-wrap .text-field":"updateSaveButton"},_initialize:function(){this.account=this.model.account,this.contact=this.model,this.model.on("change:name",this.updateName,this)},open:function(e){this.data_form=e,this.$el.html(s.group_chats.group_chat_properties_edit({fields:e.fields,anonymous:o.pretty_name(this.contact.get("group_info").anonymous),jid:this.model.get("jid")})),this.$el.openModal({ready:function(){this.$(".modal-content").css("height",this.$el.height()-115).perfectScrollbar({theme:"item-list"}),this.updateScrollBar()}.bind(this),complete:function(){this.$el.detach(),this.$(".modal-content").css("height","100%"),this.data.set("visible",!1)}.bind(this)})},close:function(){this.$el.closeModal({complete:function(){this.hide.bind(this)}.bind(this)})},updateName:function(){this.$(".name-info-wrap").find(".name").find(".value").text(this.model.get("name"))},saveChanges:function(){if(this.$(".btn-save").hasClass("non-active"))return;let e=!1,t=c({type:"set",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT});this.data_form.fields.forEach(function(t){if("hidden"!==t.type&&"fixed"!==t.type){var a=t.values?t.values[0]:null,i=this.$("."+t.var+"-field input:checked"),n=this.$("."+t.var+"-field input[type=\"text\"]"),s=this.$("."+t.var+"-field textarea"),o="";if(i.length&&(o=i[0].id),n.length&&(o=n.val()),s.length&&(o=s.val()),a!==o){let a=this.data_form.fields.indexOf(t);t.values=[o],this.data_form.fields[a]=t,e=!0}}}.bind(this)),e?(t=this.account.addDataFormToStanza(t,this.data_form),this.account.sendIQ(t,function(e){let t=d(e),a=p.clone(this.contact.get("group_info")),i={name:t.find("field[var=\"name\"] value").text(),searchable:t.find("field[var=\"index\"]").children("value").text(),model:t.find("field[var=\"membership\"]").children("value").text(),description:t.find("field[var=\"description\"] value").text(),status:t.find("field[var=\"status\"]").children("value").text()};this.$("button").addClass("non-active"),this.close(),p.extend(a,i),this.model.set("group_info",a)}.bind(this),function(e){this.$("button").addClass("non-active");let t=d(e).find("error text").text()||"You have no permission to change chat properties";this.close(),o.dialogs.error(t)}.bind(this))):this.$("button").removeClass("non-active")},updateSaveButton:function(){let e=!1;this.data_form.fields.forEach(function(t){if("hidden"!==t.type&&"fixed"!==t.type){var a=t.values?t.values[0]:null,i=this.$("."+t.var+"-field input:checked"),n=this.$("."+t.var+"-field input[type=\"text\"]"),s=this.$("."+t.var+"-field textarea"),o="";i.length&&(o=i[0].id),n.length&&(o=n.val()),s.length&&(o=s.val()),a!==o&&(e=!0)}}.bind(this)),this.$(".btn-save").switchClass("non-active",!e)}}),a.InvitationsView=a.BasicView.extend({events:{"click .revoke-invitation":"revokeInvitation"},status:"invitations",member_avatar_size:n.AVATAR_SIZES.GROUPCHAT_MEMBER_ITEM,_initialize:function(e){this.contact=e.model,this.account=this.contact.account,this.$error=d("<p class=\"errors\"/>")},_render:function(){this.$el.html(d(s.preloader())),this.getInvitations()},getInvitations:function(){let e=c({from:this.account.get("jid"),type:"get",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#invite"});this.account.sendIQ(e,function(e){this.$el.prev().find(".list-variant[data-value=\""+this.status+"\"] a").hasClass("active")&&(this.$el.html(""),d(e).find("query").find("user").each(function(e,t){let a={jid:d(t).attr("jid"),status:this.status},i=d(s.group_chats.invited_member_item(a)),n=g.getDefaultAvatar(a.jid);this.$el.append(i),i.find(".circle-avatar").setAvatar(n,this.member_avatar_size)}.bind(this)),!d(e).find("query").find("user").length&&this.$el.html(this.$error.text("No pending invitations")))}.bind(this),function(e){this.$el.prev().find(".list-variant[data-value=\""+this.status+"\"] a").hasClass("active")&&this.$el.html(this.$error.text(d(e).find("text").text()||"You nave no permission to see invitations list"))}.bind(this))},revokeInvitation:function(e){let t=d(e.target).closest(".invitations-user"),a=t.data("jid"),i=c({from:this.account.get("jid"),to:this.contact.get("jid"),type:"set"}).c("revoke",{xmlns:l.NS.GROUP_CHAT+"#invite"}).c("jid").t(a);this.account.sendIQ(i,function(){t.remove(),this.$el.children().length||this.$el.html(this.$error.text("No pending invitations"))}.bind(this))}}),a.BlockedView=a.BasicView.extend({events:{"click .unblock-user":"unblockUser"},status:"blocked",member_avatar_size:n.AVATAR_SIZES.GROUPCHAT_MEMBER_ITEM,_initialize:function(e){this.contact=e.model,this.account=this.contact.account,this.$error=d("<p class=\"errors\"/>")},_render:function(){this.$el.html(d(s.preloader())),this.getBlockedParticipants()},getBlockedParticipants:function(){let e=c({from:this.account.get("jid"),type:"get",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#block"});this.account.sendIQ(e,function(e){this.$el.prev().find(".list-variant[data-value=\""+this.status+"\"] a").hasClass("active")&&(this.$el.html(""),d(e).find("query").find("user").each(function(e,t){let a={jid:d(t).attr("jid"),status:this.status},i=d(s.group_chats.invited_member_item(a)),n=g.getDefaultAvatar(a.jid);this.$el.append(i),i.find(".circle-avatar").setAvatar(n,this.member_avatar_size)}.bind(this)),!d(e).find("query").find("user").length&&this.$el.html(this.$error.text("Block list is empty")))}.bind(this),function(e){this.$el.prev().find(".list-variant[data-value=\""+this.status+"\"] a").hasClass("active")&&this.$el.html(this.$error.text(d(e).find("text").text()||"You nave no permission to see blocked list"))}.bind(this))},unblockUser:function(e){var t=d(e.target).closest(".blocked-user"),a=t.data("jid"),i=c({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("unblock",{xmlns:l.NS.GROUP_CHAT+"#block"}).c("jid").t(a);this.account.sendIQ(i,function(){t.remove(),this.$el.children().length||this.$el.html(this.$error.text("Block list is empty"))}.bind(this))}}),a.ParticipantsView=a.BasicView.extend({className:"overflow-visible",ps_selector:".members-list-wrap",ps_settings:{theme:"item-list"},template:s.group_chats.participants,member_avatar_size:n.AVATAR_SIZES.GROUPCHAT_MEMBER_ITEM,events:{"click .participant-wrap":"showParticipantProperties","keyup .participants-search-form":"keyUpSearch","click .close-search-icon":"clearSearch","click .btn-block":"blockParticipant","click .btn-kick":"kickParticipant"},_initialize:function(){this.account=this.model.account,this.participants=this.model.participants,this.model.on("update_participants",this.updateParticipants,this),this.$(this.ps_selector).perfectScrollbar(this.ps_settings)},_render:function(){return this.$el.html(this.template()).addClass("request-waiting"),this.participant_properties_panel=new a.ParticipantPropertiesView({model:this}),this.updateParticipants(),this.$(".members-list-wrap").perfectScrollbar({theme:"item-list"}),this.model.all_rights||this.model.getAllRights(),this},updateParticipants:function(){this.participantsRequest(function(e){if(this.model.get("group_info")){if(0===this.participants.version&&(this.model.get("group_info").members_num=this.participants.length),"inactive"===this.model.get("group_info").status)return;if(this.participants.length!=this.model.get("group_info").members_num)return this.account.groupchat_settings.resetParticipantsList(this.model.get("jid")),this.participants.resetParticipants(),this.model.get("group_info").members_num=0,void this.updateParticipants()}this.participants.version>e||(e&&this.account.groupchat_settings.setParticipantsListVersion(this.model.get("jid"),e),this.participants.version<e&&this.participants.updateVersion(),this.participants.each(function(e){this.renderMemberItem(e)}.bind(this)),this.$el.removeClass("request-waiting"))}.bind(this))},blockParticipant:function(e){let t=d(e.target).closest(".participant-wrap");o.dialogs.ask("Block participant","Do you want to block "+t.find(".participant-info .nickname").text()+"?",null,{ok_button_text:"block"}).done(function(e){if(e){let e=c({type:"set",to:this.model.get("jid")}).c("block",{xmlns:l.NS.GROUP_CHAT+"#block"}).c("id").t(t.attr("data-id"));this.account.sendIQ(e,function(){t.remove(),this.parent.updateScrollBar()}.bind(this),function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to block participants")})}}.bind(this))},kickParticipant:function(e){let t=d(e.target).closest(".participant-wrap");o.dialogs.ask("Kick participant","Do you want to kick "+t.find(".participant-info .nickname").text()+"?",null,{ok_button_text:"kick"}).done(function(e){if(e){let e=c({type:"set",to:this.model.get("jid")}).c("kick",{xmlns:l.NS.GROUP_CHAT}).c("id").t(t.attr("data-id"));this.account.sendIQ(e,function(){t.remove(),this.paren.updateScrollBar()}.bind(this),function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to kick participants")})}}.bind(this))},participantsRequest:function(e){this.model.membersRequest({version:this.participants.version},function(t){let a=d(t),i=a.find("query").attr("version");0===this.participants.version&&this.participants.resetParticipants(),a.find("query user").each(function(e,t){let a=d(t),i=a.find("subscription").text(),n=a.find("id").text();"none"===i?(this.participants.get(n)&&this.participants.get(n).destroy(),this.account.groupchat_settings.removeParticipantFromList(this.model.get("jid"),n)):this.participants.createFromStanza(a)}.bind(this)),e&&e(i)}.bind(this))},renderMemberItem:function(e){let t=p.clone(e.attributes);t.nickname=p.escape(t.nickname),t.badge=p.escape(t.badge),t.is_me=t.jid==this.account.get("jid"),t.pretty_present=t.present?u(t.present).fromNow():"";let a=d(s.group_chats.group_member_item(t)),i=this.$("tr[data-id=\""+t.id+"\"]");a.emojify(".badge",{emoji_size:16}),i.length?(i.hasClass("active")&&a.addClass("active"),a.insertBefore(i),i.detach()):t.is_me?a.prependTo(this.$(".members-list-wrap tbody")):a.appendTo(this.$(".members-list-wrap tbody")),this.updateMemberAvatar(t)},updateMemberAvatar:function(e){let t=g.getDefaultAvatar(e.nickname||e.jid||e.id);var a=e.id?this.$("tr[data-id=\""+e.id+"\"] .circle-avatar"):this.$(".list-item[data-jid=\""+e.jid+"\"] .circle-avatar");if(a.setAvatar(t,this.member_avatar_size),e.avatar){let t=this.account.chat_settings.getB64Avatar(e.id);if(this.account.chat_settings.getHashAvatar(e.id)==e.avatar&&t)a.setAvatar(t,this.member_avatar_size);else{var i=l.NS.PUBSUB_AVATAR_DATA+"#"+e.id;this.model.getAvatar(e.avatar,i,function(t){this.account.chat_settings.updateCachedAvatars(e.id,e.avatar,t),this.$(".list-item[data-id=\""+e.id+"\"] .circle-avatar").setAvatar(t,this.member_avatar_size),this.account.get("jid")===e.jid&&(this.model.my_info.set("b64_avatar",t),this.model.trigger("update_my_info"))}.bind(this))}}},showParticipantProperties:function(e){let t=d(e.target);if(t.closest(".buttons-wrap").length)return;let a=t.closest(".participant-wrap"),i=a.attr("data-id"),n=this.model.participants.get(i);a.attr("data-jid")&&a.attr("data-jid")===this.account.get("jid")&&(i=""),this.model.membersRequest({id:i},function(e){let t=this.account.parseDataForm(d(e).find("x[xmlns=\""+l.NS.DATAFORM+"\"]"));this.participant_properties_panel.open(n,t)}.bind(this))},keyUpSearch:function(e){e.keyCode===n.KEY_ESCAPE?this.clearSearch(e):this.searchParticipant()},searchParticipant:function(){let e=this.$(".participants-search-form input").val().toLowerCase();this.$(".members-list-wrap .participant-wrap").each(function(t,a){let i=d(a),n=i.data("id"),s=this.model.participants.find(e=>e.get("id")===n);var o=s.get("jid").toLowerCase(),c=s.get("nickname").toLowerCase();i.hideIf(0>c.indexOf(e)&&0>o.indexOf(e))}.bind(this)),e?this.$(".close-search-icon").show():this.$(".close-search-icon").hide()},clearSearch:function(e){e&&e&&e.preventDefault(),this.$(".search-input").val(""),this.searchParticipant()}}),a.ParticipantPropertiesView=a.BasicView.extend({className:"modal dialog-modal edit-rights",template:s.group_chats.participant_rights,member_details_avatar_size:n.AVATAR_SIZES.PARTICIPANT_DETAILS_ITEM,ps_selector:".modal-content",ps_settings:{theme:"item-list"},events:{"click .btn-cancel-changes":"close","change .clickable-field input":"changeRights","click .btn-save-user-rights":"saveRights","click .nickname":"editNickname","change .circle-avatar input":"changeAvatar","click .btn-block-participant":"block","click .btn-kick-participant":"kick","click .btn-set-badge":"editBadge","click .btn-participant-messages":"getMessages","click .btn-chat":"getPrivateChat","click .property-variant":"changeTimerValue","keydown .rich-textarea":"checkKeydown","keyup .rich-textarea":"checkKeyup"},_initialize:function(){this.account=this.model.account,this.contact=this.model.model},open:function(e,t){e&&(this.participant=e,this.data_form=t,this.render(),this.$el.openModal({ready:function(){this.$el.css("height",""),.1*d(window).height()+this.$el.height()>d(window).height()&&this.$el.css("height",.9*d(window).height()),this.$(".modal-content").css("max-height","calc(100% - "+(64+this.$(".header").height())+"px)"),this.scrollToTop(),this.updateSaveButton();let e={inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"};this.$(".select-timer .dropdown-button").dropdown(e),this.$(".participant-details-item .dropdown-button").dropdown(p.extend(e,{alignment:"right"}))}.bind(this),complete:function(){this.render(),this.$el.detach(),this.data.set("visible",!1)}.bind(this)}))},close:function(){this.$el.closeModal({complete:function(){this.render(),this.$el.detach(),this.data.set("visible",!1)}.bind(this)})},render:function(){this.new_avatar="";let e=p.clone(this.participant.attributes);e.nickname=p.escape(e.nickname),e.badge=p.escape(e.badge),e.is_myself=e.jid===this.account.get("jid"),e.incognito_chat=!!(this.contact.get("group_info")&&"incognito"===this.contact.get("group_info").anonymous);let t;this.contact.get("private_chat")?(this.$el.addClass("edit-rights-private"),t=d(s.group_chats.private_participant_details(e))):t=d(s.group_chats.participant_details_item(e)),this.$(".header").html(t),this.$(".btn-chat-wrap").switchClass("non-active",this.participant.get("jid")===this.account.get("jid")),this.updateMemberAvatar(this.participant),this.participant_messages=[],this.actual_rights=[],this.contact.get("private_chat")?(this.$(".modal-content").addClass("hidden"),this.$(".modal-footer").switchClass("hidden",this.participant.get("jid")!==this.account.get("jid"))):this.setActualRights(),this.updateScrollBar(),this.$(".participant-info #edit-nickname").on("focusout",function(){let e=this.$("#edit-nickname").getTextFromRichTextarea().trim();""===e&&(e=this.participant.get("nickname")),this.$(".participant-info #edit-nickname").hide(),this.$(".participant-info .nickname").show(),this.updateNickname(e)}.bind(this)),this.$(".content").perfectScrollbar({theme:"item-list"})},updateMemberAvatar:function(e){let t=e.get("id"),a=this.$(".participant-details-item[data-id=\""+t+"\"] .circle-avatar");if(e.image=g.getDefaultAvatar(e.get("nickname")||e.get("jid")||t),a.setAvatar(e.image,this.member_details_avatar_size),this.$(".participant-details-item[data-id=\""+e.id+"\"]").emojify(".badge",{emoji_size:18}),!e.get("avatar"))this.account.chat_settings.getHashAvatar(t)&&a.setAvatar(this.account.chat_settings.getB64Avatar(t),this.member_details_avatar_size);else if(this.account.chat_settings.getHashAvatar(t)==e.get("avatar")&&this.account.chat_settings.getB64Avatar(t))a.setAvatar(this.account.chat_settings.getB64Avatar(t),this.member_details_avatar_size);else{let a=l.NS.PUBSUB_AVATAR_DATA+"#"+t;this.contact.getAvatar(e.avatar,a,function(e){this.$(".participant-details-item[data-id=\""+t+"\"] .circle-avatar").setAvatar(e,this.member_details_avatar_size)}.bind(this))}},updateRightsView:function(e){d(e.target).hasClass("non-active")||this.render(this.participant)},getMessages:function(e){this.contact.messages_view=new a.ParticipantMessagesView({contact:this.contact,model:this.participant.attributes}),this.contact.messages_view.messagesRequest(e,function(){this.close(),a.body.setScreen("all-chats",{right:"participant_messages",contact:this.contact})}.bind(this))},changeAvatar:function(e){var t=e.target;if(t.files.length){var a=t.files[0];t.value="",a.size>n.MAX_AVATAR_FILE_SIZE?o.dialogs.error("File is too large"):!a.type.startsWith("image")&&o.dialogs.error("Wrong image"),o.images.getAvatarFromFile(a).done(function(e){e&&(a.base64=e,this.new_avatar=a,this.$(".circle-avatar").addClass("changed").setAvatar(e,this.member_details_avatar_size),this.updateSaveButton())}.bind(this))}},changeTimerValue:function(e){let t=d(e.target),a=t.closest(".select-timer").find(".property-value"),i=t.closest(".right-item").find("input");t.attr("data-value")!==a.attr("data-value")&&(t.closest(".right-item").addClass("changed-timer changed"),this.updateSaveButton()),a.text(t.text()),a.attr("data-value",t.attr("data-value")),"0"===t.attr("data-value")?a.addClass("default-value").text("set timer"):a.hasClass("default-value")&&a.removeClass("default-value"),i.prop("checked")||i.click()},updateBadge:function(e){this.$(".badge").html(e).switchClass("hidden",!e),this.$(".participant-info").emojify(".badge")},updateButtons:function(e){this.$(".btn-save-user-rights").switchClass("non-active",!e)},updateSaveButton:function(){let e=this.$(".changed").length;this.updateButtons(e)},updateNickname:function(e){let t=this.$(".participant-details-item[data-id=\""+this.participant.get("id")+"\"]"),a=t.find(".nickname");a.html(l.xmlescape(e)),t.emojify(".nickname"),e===this.participant.get("nickname")?a.removeClass("changed"):a.addClass("changed"),this.updateSaveButton()},editNickname:function(){this.contact.get("private_chat")&&this.account.get("jid")!==this.participant.get("jid")||(this.$(".participant-info .nickname").hide(),this.$(".participant-info #edit-nickname").text(this.$(".participant-info .nickname").text()).show().placeCaretAtEnd())},editBadge:function(){this.edit_badge_panel=new a.EditBadgeView({model:this})},checkKeydown:function(e){e.keyCode===n.KEY_ENTER&&(e.preventDefault(),d(document.activeElement).blur())},checkKeyup:function(e){let t=d(e.target),a=t.getTextFromRichTextarea().trim();if("edit-nickname"===e.target.id){let e=a!==this.participant.get("nickname");this.updateButtons(e)}},retractUserMessages:function(){o.dialogs.ask("User messages retraction","Do you want to delete all messages of "+(this.participant.get("nickname")||this.participant.get("jid")||this.participant.get("id"))+" in this groupchat?",null,{ok_button_text:"delete"}).done(function(e){if(e&&this.participant.get("id")){let e=this.account.chats.getChat(this.model.model);e.retractMessagesByUser(this.participant.get("id"))}}.bind(this))},block:function(){o.dialogs.ask("Block participant","Do you want to block "+this.participant.get("nickname")+"?",null,{ok_button_text:"block"}).done(function(e){e&&this.participant.block(function(){this.close(),this.model.$el.find(".members-list-wrap .participant-wrap[data-id=\""+this.participant.get("id")+"\"]").remove(),this.model.$el.find(".members-list-wrap").perfectScrollbar("update")}.bind(this),function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to block participants")})}.bind(this))},kick:function(){o.dialogs.ask("Kick participant","Do you want to kick "+this.participant.get("nickname")+"?",null,{ok_button_text:"kick"}).done(function(e){e&&this.participant.kick(function(){this.close(),this.model.$el.find(".members-list-wrap .participant-wrap[data-id=\""+this.participant.get("id")+"\"]").remove(),this.model.$el.find(".members-list-wrap").perfectScrollbar("update")}.bind(this),function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to kick participants")})}.bind(this))},setActualRights:function(){this.$(".rights-wrap").html(""),this.data_form.fields.forEach(function(e){if(e=p.clone(e),"list-single"===e.type||"fixed"===e.type&&(!e.values||0==e.values[0])){e.values||(e.values=[]);let t={pretty_name:e.label,name:e.var,expires:e.values?e.values[0]:void 0},a=d(s.group_chats.restriction_item({name:t.name,pretty_name:t.pretty_name,type:e.type})),i;if(e.options&&(i=d(s.group_chats.right_expire_variants({right_name:"default-"+t.name,expire_options:e.options})),a.append(i)),this.$(".rights-wrap").append(a),t.expires&&(this.actual_rights.push({name:t.name,expires:t.expires}),this.$(".right-item #"+t.name).prop("checked",!0).addClass(t.expires),0!=t.expires)){let e=this.$(".right-item.restriction-"+t.name);e.find(".select-timer .property-value").attr("data-value",t.expires).removeClass("default-value").text(u(1e3*+t.expires).fromNow())}}else"fixed"===e.type&&e.values&&this.$(".rights-wrap").append(d("<div class=\"rights-header\"/>").text(e.values[0]))}.bind(this))},getPrivateChat:function(e){if(d(e.target).closest(".button-wrap").hasClass("non-active"))return;let t=this.participant.get("jid"),i=this.account.contacts.get(t);if(!t){let e=c({from:this.account.get("jid"),to:this.account.domain,type:"set"}).c("create",{xmlns:l.NS.GROUP_CHAT}).c("peer-to-peer",{jid:this.contact.get("jid"),id:this.participant.get("id")});this.account.sendIQ(e,function(e){let t=d(e).find("created jid").text(),a=this.account.contacts.mergeContact(t);a.set("group_chat",!0),a.pres("subscribed"),a.pushInRoster(null,function(){a.pres("subscribe"),a.getMyInfo(),this.close(),a.sendPresent(),this.account.chats.openChat(a);let e=this.account.chats.getChat(a);e.messages.createSystemMessage({from_jid:t,message:"Initiating private chat with "+this.participant.get("nickname")+" from "+this.contact.get("jid")+". If your invitation is accepted, you won't see each other's real XMPP IDs."})}.bind(this))}.bind(this),function(e){let t=d(e),a=t.find("x[xmlns=\""+l.NS.GROUP_CHAT+"\"] jid").text();if(a){let e=this.account.contacts.mergeContact(a),t=this.account.chats.getChat(e);return this.close(),void(t&&t.trigger("open"))}let i=d(e).find("text[lang=\"en\"]").text()||d(e).find("text").first().text()||"You have already sent an invitation to peer-to-peer chat";this.close(),o.dialogs.error(i)}.bind(this))}else{if(i&&i.get("in_roster"))return this.close(),void i.trigger("open_chat",i);this.close(),a.add_contact_view.show({account:this.account,jid:t})}},changeRights:function(e){let t=d(e.target),a=t.closest(".right-item"),i=t.prop("id");t.prop("checked")?this.actual_rights.find(e=>e.name===i)?a.hasClass("changed-timer")?a.addClass("changed"):a.removeClass("changed"):a.addClass("changed"):this.actual_rights.find(e=>e.name===i)?a.addClass("changed"):(a.removeClass("changed"),a.hasClass("changed-timer")&&a.find(".timer-item-wrap .property-value").addClass("default-value").text("set timer").attr("data-value","")),this.updateSaveButton()},saveRights:function(e){if(d(e.target).hasClass("non-active"))return;let t=d(e.target),a=this.account.get("jid"),i=this.participant.get("id"),n=this.$(".participant-details-item .circle-avatar"),s=this.$(".participant-info .nickname").text(),r=this.new_avatar,p=!1,u=!1,m=c({from:a,type:"set",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#members"}).c("user",{xmlns:l.NS.GROUP_CHAT,id:i});if(this.$(".buttons-wrap .btn-save-user-rights").addClass("non-active"),r&&n.find(".preloader-wrap").addClass("visible").find(".preloader-wrapper").addClass("active"),s!=this.participant.get("nickname")&&(u=!0,m.c("nickname").t(s).up()),this.$(".right-item").each(function(e,t){if(d(t).hasClass("changed")){var a=d(t),i=a.find(".field input")[0].id;if(a.find(".field input:checked").val()){let e=a.find(".select-timer .timer-item-wrap .property-value").attr("data-value"),t=this.data_form.fields.find(e=>e.var===i),n=this.data_form.fields.indexOf(t);t.values=[e],this.data_form.fields[n]=t,p=!0}else{let e=this.data_form.fields.find(e=>e.var===i);if(e.values.length){let t=this.data_form.fields.indexOf(e);e.values=[],this.data_form.fields[t]=e,p=!0}}}}.bind(this)),r&&this.contact.pubAvatar(r,"#"+i,function(){this.$(".buttons-wrap button").removeClass("non-active"),n.find(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active"),this.model.$(".members-list-wrap .list-item[data-id=\""+i+"\"] .circle-avatar").setAvatar(r.base64,this.member_avatar_size),this.$(".participant-details-item[data-id=\""+i+"\"] .circle-avatar").setAvatar(r.base64,this.member_details_avatar_size),this.close()}.bind(this),function(e){this.$(".buttons-wrap button").removeClass("non-active"),n.find(".preloader-wrap").removeClass("visible").find(".preloader-wrapper").removeClass("active");let t=d(e).find("text").text()||"You have no permissions to change avatar";u||o.dialogs.error(t)}),u&&this.account.sendIQ(m,function(){this.$(".buttons-wrap button").removeClass("non-active"),this.participant.set("nickname",s),this.close()}.bind(this),function(e){this.$(".buttons-wrap button").removeClass("non-active"),this.close(),d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to change participant's info")}.bind(this)),p){let e=c({from:a,type:"set",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#rights"});e=this.account.addDataFormToStanza(e,this.data_form),this.account.sendIQ(e,function(){this.close()}.bind(this),function(e){this.close(),d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to change participant's info")}.bind(this))}t.blur()}}),a.EditBadgeView=a.BasicView.extend({className:"modal edit-badge",template:s.group_chats.badge_edit_view,events:{"click .btn-cancel":"close","click .btn-save":"saveNewBadge","keydown .badge-text":"checkKey"},_initialize:function(){this.account=this.model.account,this.contact=this.model.contact,this.participant=this.model.participant,this.$el.openModal({ready:function(){this.participant.get("badge")?this.typeEmoticon(this.participant.get("badge")):this.$(".badge-text").focus()}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1)}.bind(this)});var e=this.$(".insert-emoticon"),t=this.$(".emoticons-panel-wrap"),i=this.$(".emoticons-panel"),s;for(var o in h.all){let e=d(`<div class="emoji-list-wrap"/>`),t=o.replace(/ /g,"_");d(`<div id=${t} class="emoji-list-header">${n.EMOJI_LIST_NAME(o)}</div>`).appendTo(e),p.each(h.all[o],function(a){d("<div class=\"emoji-wrap\"/>").html(a.emojify({emoji_size:24,sprite:t})).appendTo(e)}),e.appendTo(i),i.siblings(".emoji-menu").append(h.all[o][0].emojify({href:t,title:n.EMOJI_LIST_NAME(o),tag_name:"a",emoji_size:20}))}i.perfectScrollbar(p.extend({theme:"item-list"},a.ps_settings)),this.$(".emoji-menu .emoji").click(function(e){i[0].scrollTop=this.$(".emoji-list-wrap "+e.target.attributes.href.value)[0].offsetTop-4}.bind(this)),e.hover(function(e){e&&e.preventDefault&&e.preventDefault(),t.addClass("opened"),s&&clearTimeout(s),i.perfectScrollbar("update")}.bind(this),function(e){e&&e.preventDefault&&e.preventDefault(),s&&clearTimeout(s),s=setTimeout(function(){t.is(":hover")||t.removeClass("opened")},800)}.bind(this)),t.hover(null,function(e){e&&e.preventDefault&&e.preventDefault(),s&&clearTimeout(s),s=setTimeout(function(){t.removeClass("opened")},200)}.bind(this)),t.mousedown(function(e){if(e&&e.preventDefault&&e.preventDefault(),!e.button){var t=d(e.target).closest(".emoji-wrap").find(".emoji");t.length&&this.typeEmoticon(t.data("emoji"))}}.bind(this))},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},saveNewBadge:function(){let e=this.$(".badge-text").getTextFromRichTextarea();if(32<Array.from(e).length)this.$(".modal-content .error").text("Badge can't be longer than 32 symbols");else if(e!=this.participant.get("badge")){let t=c({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#members"}).c("user",{xmlns:l.NS.GROUP_CHAT,id:this.participant.get("id")}).c("badge").t(e);this.account.sendIQ(t,function(){this.model.updateBadge(e),this.close()}.bind(this),function(){this.$(".modal-content .error").text("You have no permission")}.bind(this))}},typeEmoticon:function(e){var t=e.emojify({tag_name:"span"}),a=this.$(".badge-text");a.focus().pasteHtmlAtCaret(t)},checkKey:function(e){e.keyCode===n.KEY_ENTER&&(e.preventDefault(),this.saveNewBadge())}}),a.DefaultRestrictionsView=a.BasicView.extend({className:"modal dialog-modal edit-default-restrictions",template:s.group_chats.default_restrictions,events:{"click .btn-default-restrictions-save":"saveChanges","click .btn-default-restrictions-cancel":"close","change #default_restriction_expires":"changeExpiresTime","click .group-info-editor .property-variant":"changePropertyValue","click .select-timer .property-variant":"changeTimerValue","click .clickable-field input":"changeRestriction","keyup .clickable-field input":"keyUpInput","change .clickable-field input":"updateSaveButton"},_initialize:function(){this.contact=this.model,this.account=this.contact.account},open:function(){this.update(function(){this.$el.openModal({ready:function(){this.updateScrollBar()}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1)}.bind(this)})}.bind(this))},close:function(){this.$el.closeModal({complete:function(){this.hide.bind(this)}.bind(this)})},update:function(e){this.$(".btn-default-restrictions-save").addClass("non-active"),this.default_restrictions=[],this.actual_default_restrictions=[],this.$("button").blur();let t=c({from:this.account.get("jid"),type:"get",to:this.contact.get("jid")}).c("query",{xmlns:l.NS.GROUP_CHAT+"#default-rights"});this.account.sendIQ(t,function(t){this.showDefaultRestrictions(t);this.$(".property-field .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"}),e&&e()}.bind(this),function(){o.callback_popup_message("You have no permission to change default restrictions",3e3)}.bind(this))},updateSaveButton:function(){let e=!1;this.$(".default-restrictions-list-wrap .right-item").each(function(t,a){let i=d(a),n=i.find("input").attr("id"),s=i.find(".select-timer .property-value").attr("data-value");n=n.slice(8,n.length),this.actual_default_restrictions.find(e=>e.name==n&&e.expires==s)||(i.find("input").prop("checked")?e=!0:this.actual_default_restrictions.find(e=>e.name==n)&&(e=!0))}.bind(this)),this.$(".btn-default-restrictions-save").switchClass("non-active",!e)},changeRestriction:function(e){let t=d(e.target);t.prop("checked")||t.closest(".right-item").find(".select-timer .property-value").attr("data-value","").addClass("default-value").text("set timer")},keyUpInput:function(e){e.keyCode===n.KEY_ENTER&&d(e.target).click()},changePropertyValue:function(e){let t=d(e.target),a=t.closest(".property-field").find(".property-value");a.text(t.text()),a.attr("data-value",t.attr("data-value"))},changeTimerValue:function(e){let t=d(e.target),a=t.closest(".select-timer").find(".property-value"),i=t.closest(".right-item").find("input");a.text(t.text()),a.attr("data-value",t.attr("data-value")),0==t.attr("data-value")?(a.addClass("default-value"),a.text("set timer")):a.hasClass("default-value")&&a.removeClass("default-value"),i.prop("checked")||i.prop("checked",!0),this.updateSaveButton()},showDefaultRestrictions:function(e){let t=this.account.parseDataForm(d(e).find("x[xmlns=\""+l.NS.DATAFORM+"\"]"));t&&(this.default_restrictions=p.clone(t)),t.fields.forEach(function(e){if("fixed"!==e.type&&"hidden"!==e.type){let t={pretty_name:e.label,name:e.var,expires:e.values?e.values[0]:void 0},a=this.$(".default-restrictions-list-wrap .right-item.restriction-default-"+t.name),i=d(s.group_chats.restriction_item({name:"default-"+t.name,pretty_name:t.pretty_name,type:e.type})),n=d(s.group_chats.right_expire_variants({right_name:"default-"+t.name,expire_options:e.options}));if(a.length&&a.detach(),i.append(n),this.$(".default-restrictions-list-wrap").append(i),t.expires&&(this.actual_default_restrictions.push({name:t.name,expires:t.expires}),this.$(".right-item #default-"+t.name).prop("checked",!0).addClass(t.expires),0!=t.expires)){let e=this.$(".right-item.restriction-default-"+t.name);e.find(".select-timer .property-value").attr("data-value",t.expires).removeClass("default-value").text(t.expires)}}}.bind(this)),this.$(".select-timer .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"})},saveChanges:function(){if(this.$(".btn-default-restrictions-save").hasClass("non-active"))return;this.$("button").blur();let e=c({from:this.account.get("jid"),to:this.contact.get("jid"),type:"set"}).c("query",{xmlns:l.NS.GROUP_CHAT+"#default-rights"}),t=!1,a=p.clone(this.default_restrictions);this.$(".default-restrictions-list-wrap .right-item").each(function(e,i){let n=d(i),s=n.find("input").attr("id"),o=n.find(".select-timer .property-value").attr("data-value");if(s=s.slice(8,s.length),!this.actual_default_restrictions.find(e=>e.name==s&&e.expires==o))if(n.find("input").prop("checked")){let e=a.fields.find(e=>e.var===s),i=a.fields.indexOf(e);e.values=[o],a.fields[i]=e,t=!0}else if(this.actual_default_restrictions.find(e=>e.name==s)){let e=a.fields.find(e=>e.var===s),i=a.fields.indexOf(e);e.values=[""],a.fields[i]=e,t=!0}}.bind(this)),t&&(this.account.addDataFormToStanza(e,a),this.account.sendIQ(e,function(){this.close()}.bind(this),function(e){let t=d(e).find("error text").text()||"You have no permission to change default restrictions";o.dialogs.error(t),this.close()}.bind(this)))},changeExpiresTime:function(e){var t=d(e.target),a=t.val(),i=t.prev();"0"==t.val()?i.find(".restriction-description").text("Indefinitely"):i.find(".restriction-description").text("For "+a),i.find("input").removeClass().addClass(a),t.remove()}}),a.Participant=Backbone.Model.extend({idAttribute:"id",initialize:function(e,t){let a=p.clone(e);this.contact=t.contact,this.account=this.contact.account,this.on("change:avatar",this.getBase64Avatar,this),this.set(a),this.getBase64Avatar()},getBase64Avatar:function(){if(this.get("avatar")){let e=this.account.chat_settings.getAvatarInfoById(this.get("id"));if(e&&e.avatar_hash==this.get("avatar"))return this.set("b64_avatar",e.avatar_b64),void(this.get("jid")===this.account.get("jid")&&this.contact.trigger("update_my_info"));let t=l.NS.PUBSUB_AVATAR_DATA+"#"+this.get("id");this.contact.getAvatar(this.get("avatar"),t,function(e){this.account.chat_settings.updateCachedAvatars(this.get("id"),this.get("avatar"),e),this.set("b64_avatar",e),this.get("jid")===this.account.get("jid")&&this.contact.trigger("update_my_info")}.bind(this))}},kick:function(e,t){let a=this.get("id"),i=this.get("jid"),n=c({type:"set",to:this.contact.get("jid")}).c("kick",{xmlns:l.NS.GROUP_CHAT});i?n.c("jid").t(i):n.c("id").t(a),this.account.sendIQ(n,function(){e&&e()}.bind(this),function(e){t&&t(e)})},block:function(e,t){let a=this.get("id"),i=c({type:"set",to:this.contact.get("jid")}).c("block",{xmlns:l.NS.GROUP_CHAT+"#block"}).c("id").t(a);this.account.sendIQ(i,function(){e&&e()}.bind(this),function(e){t&&t(e)})}}),a.Participants=Backbone.Collection.extend({model:a.Participant,comparator:"nickname",initialize:function(e,t){this.contact=t.contact,this.account=this.contact.account,this.version=this.account.groupchat_settings.getParticipantsListVersion(this.contact.get("jid")),this.getCachedParticipants(),this.on("change:nickname",this.sort,this)},updateVersion:function(){this.version=this.account.groupchat_settings.getParticipantsListVersion(this.contact.get("jid"))||this.version},getCachedParticipants:function(){this.account.groupchat_settings.getParticipantsList(this.contact.get("jid")).forEach(function(e){this.mergeParticipant(e)}.bind(this))},mergeParticipant:function(e){"object"!=typeof e&&(e={id:e});let t=this.get(e.id);return t?t.set(e):t=this.create(e,{contact:this.contact}),t},resetParticipants:function(){this.version=0,p.each(p.clone(this.models),function(e){e.destroy()})},getRights:function(e){let t=[];return d(e).each(function(e,a){let i=d(a).attr("name"),n=d(a).attr("translation"),s=d(a).attr("issued-at"),o=d(a).attr("expires");t.push({name:i,pretty_name:n,issued_time:s,expires_time:o})}.bind(this)),t},createFromStanza:function(e){let t=e.find("jid").text(),a=e.find("nickname").text(),i=e.attr("id"),n=e.find("badge").text(),s=e.find("present").text(),o=e.find("metadata[xmlns=\""+l.NS.PUBSUB_AVATAR_METADATA+"\"]").find("info").attr("id"),d=e.find("role").text();a.trim().length||(a=t||i);let c={jid:t,id:i,avatar:o,nickname:a,badge:n,present:s,role:d},r=this.mergeParticipant(c);return this.account.get("jid")===r.get("jid")&&(this.contact.my_info=r)&&this.contact.trigger("update_my_info"),this.account.groupchat_settings.updateParticipant(this.contact.get("jid"),c),r}}),a.GroupChatSettings=Backbone.ModelWithStorage.extend({defaults:{participants_lists:[]},getParticipantsListVersion:function(e){let t=p.clone(this.get("participants_lists")),a=t.find(t=>t.jid===e);return a?a.version:0},setParticipantsListVersion:function(e,t){let a=p.clone(this.get("participants_lists")),i=a.find(t=>t.jid===e),n=a.indexOf(i);-1!=n&&a.splice(n,1),i?i.version=t:i={jid:e,participants_list:[],version:0},a.push(i),this.save("participants_lists",a)},getParticipantsList:function(e){let t=p.clone(this.get("participants_lists")),a=t.find(t=>t.jid===e);return a&&a.participants_list?a.participants_list:[]},updateParticipant:function(e,t){let a=p.clone(this.get("participants_lists")),i=a.find(t=>t.jid===e),n=i&&i.version||0,s=i&&i.participants_list||[],o=a.indexOf(i);if(s.length){let e=s.find(e=>e.id===t.id),a=s.indexOf(e);-1==a?s.push(t):s[a]=t}else s.push(t);-1!=o&&a.splice(o,1),a.push({jid:e,participants_list:s,version:n}),this.save("participants_lists",a)},setParticipantsList:function(e,t){let a=p.clone(this.get("participants_lists")),i=a.find(t=>t.jid===e)||[],n=a.indexOf(i);-1!=n&&a.splice(n,1),a.push({jid:e,participants_list:t,version:i.version}),this.save("participants_lists",a)},removeParticipantFromList:function(e,t){let a=this.getParticipantsList(e);if(a.length){var i=a.indexOf(a.find(e=>e.id===t));-1!=i&&a.splice(i,1),this.setParticipantsList(e,a)}},resetParticipantsList:function(e){let t=p.clone(this.get("participants_lists")),a=t.indexOf(t.find(t=>t.jid===e));-1!=a&&t.splice(a,1),t.push({jid:e,participants_list:[],version:0}),this.save("participants_lists",t)}}),a.GroupchatInvitationView=a.BasicView.extend({className:"details-panel invitation-view",template:s.group_chats.invitation,ps_selector:".panel-content",avatar_size:n.AVATAR_SIZES.CONTACT_DETAILS,events:{"click .btn-chat":"openChat","click .btn-accept":"joinGroupChat","click .btn-join":"joinGroupChat","click .btn-decline":"declineContact","click .btn-decline-all":"declineAll","click .btn-block":"blockContact","click .btn-escape":"closeInvitationView"},_initialize:function(e){this.account=this.model.account,this.$(".invite-msg-text").text("You are invited to group chat. If you accept, "+this.account.get("jid")+" username shall be visible to group chat participants"),this.message=e.message,this.model.on("change",this.update,this)},render:function(){this.updateAvatar(),this.updateName(),this.renderButtons()},update:function(){var e=this.model.changed;p.has(e,"name")&&this.updateName(),p.has(e,"image")&&this.updateAvatar()},openChat:function(){this.model.set("in_roster",!0),this.model.trigger("open_chat",this.model)},closeChat:function(){let e=this.account.chats.getChat(this.model);e.set({opened:!1,display:!1,active:!1}),e.deleteFromSynchronization(function(){a.body.setScreen("all-chats",{right:void 0})}.bind(this))},updateAvatar:function(){var e=this.model.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateName:function(){this.$(".main-info  .name-wrap").text(this.model.get("name")),this.model.get("name-wrap")==this.model.get("jid")?(this.$(".main-info .name-wrap").addClass("name-is-jid"),this.$(".main-info  .jid").text("")):(this.$(".main-info .name-wrap").removeClass("name-is-jid"),this.$(".main-info  .jid").text(this.model.get("jid")))},renderButtons:function(){this.$(".buttons-wrap .btn-accept").hideIf(!this.private_invite),this.$(".buttons-wrap .btn-block").hideIf(this.private_invite),this.$(".buttons-wrap .btn-join").showIf(!this.private_invite),this.$(".buttons-wrap .btn-decline-all").showIf(this.private_invite)},blockInvitation:function(){let e=this.model.get("jid"),t=c({type:"get"}).c("blocklist",{xmlns:l.NS.BLOCKING}),a=c({type:"set"}).c("unblock",{xmlns:l.NS.BLOCKING}),i=c({type:"set"}).c("block",{xmlns:l.NS.BLOCKING}).c("item",{jid:this.model.get("jid")+"/"+u.now()});this.account.sendIQ(t,function(t){let n=d(t).find("item");0<n.length&&n.each(function(t,i){let n=d(i).attr("jid");-1<n.indexOf(e)&&a.c("item",{jid:n}).up()}),d(a.nodeTree).find("item").length?this.account.sendIQ(a,function(){this.account.sendIQ(i)}.bind(this)):this.account.sendIQ(i)}.bind(this))},joinGroupChat:function(){var e=this.model;e.acceptRequest(),e.pushInRoster(null,function(){e.askRequest(),this.blockInvitation(),e.getMyInfo(),e.sendPresent()}.bind(this)),e.trigger("remove_invite",e),this.openChat()},declineContact:function(){var e=this.model;e.declineRequest(),this.blockInvitation(),e.trigger("remove_invite",e),this.closeChat()},declineAll:function(){if(this.model.get("private_chat")&&!0!==this.model.get("private_chat")){let e=r({from:this.account.connection.jid,to:this.model.get("private_chat")}).c("peer-to-peer").t(!1);this.account.sendPres(e)}this.model.trigger("remove_invite",this.model),this.closeChat()},blockContact:function(){var e=this.model;o.dialogs.ask("Block contact","Do you want to block "+e.get("name")+"?",null,{ok_button_text:"block"}).done(function(t){t&&(e.trigger("remove_invite",e),e.block(),a.trigger("clear_search"))}),this.blockInvitation(),this.closeChat()}}),a.ContactNameWidget=a.InputWidget.extend({field_name:"contact-name",placeholder:"",model_field:"name",setValue:function(e){if(""===name){this.model.set("roster_name",null);let e=this.getDefaultName();this.model.set("name",e)}this.model.pushInRoster({name:e})},getDefaultName:function(){let e=null;if(this.model.get("group_chat"))e=this.model.get("group_info")?this.model.get("group_info").name:this.model.get("jid");else{let t=this.model.get("vcard");e=t.nickname||(t.first_name+" "+t.last_name).trim()||t.fullname||this.model.get("jid")}return e},keyUp:function(){var e=this.getValue();this.$input.switchClass("changed",this.$input.val()!==e),this.$input.val()||this.$input.prop("placeholder",this.getDefaultName()||"Set contact name")}}),a.ContactEditGroupsView=a.BasicView.extend({template:s.groups,events:{"click .existing-group-field label":"editGroup","change .new-group-name input":"checkNewGroup","keyup .new-group-name input":"checkNewGroup","click .new-group-checkbox":"addNewGroup"},_initialize:function(){this.account=this.parent.account,this.model=this.parent.model,this.model.on("change:in_roster update_groups",this.render,this)},render:function(){if(this.$el.html(this.template()),this.model.get("in_roster")){var e=p.clone(this.model.get("groups")),t=p.map(this.account.groups.notSpecial(),function(t){var a=t.get("name");return{name:a,checked:p.contains(e,a),id:m()}});this.$(".groups").html(s.groups_checkbox_list({groups:t})).appendTo(this.$(".groups-wrap"))}this.$el.showIf(this.model.get("in_roster")),this.parent.updateScrollBar()},editGroup:function(e){var t=d(e.target),a=t.siblings("input"),i=!a.prop("checked"),n=a.attr("data-groupname"),s=p.clone(this.model.get("groups")),o=s.indexOf(n);a.prop("checked",i),i?s.push(n):0<=o&&s.splice(o,1),this.model.pushInRoster({groups:s})},checkNewGroup:function(e){var t=d(e.target).val(),a=this.$(".new-group-checkbox");a.showIf(t&&!this.account.groups.get(t))},addNewGroup:function(){var e=this.$(".new-group-name input"),t=e.val(),a=p.clone(this.model.get("groups")),i=a.indexOf(t);0>i&&a.push(t),this.model.pushInRoster({groups:a})}}),a.ContactsBase=Backbone.Collection.extend({model:a.Contact}),a.GroupContacts=a.ContactsBase.extend({initialize:function(e,t){this.group=t.group,this.on("change",this.onContactChanged,this)},comparator:function(e,t){if("online-first"===a.settings.roster.sorting){var i=e.get("status"),s=t.get("status"),o=n.STATUS_WEIGHTS[i],d=n.STATUS_WEIGHTS[s],c=o>=n.STATUS_WEIGHTS.offline,r=d>=n.STATUS_WEIGHTS.offline;if(c^r)return c?1:-1}var l,p;return l=e.get("name").toLowerCase(),p=t.get("name").toLowerCase(),l<p?-1:l>p?1:0},onContactChanged:function(e){var t=e.changed;(p.has(t,"name")||p.has(t,"status_updated"))&&(this.sort(),this.trigger("update_contact_item",e))}}),a.Group=Backbone.Model.extend({defaults:{counter:{all:0,online:0}},initialize:function(e,t){this.account=t.account,e.name||(e.name=e.id),this.set(e),this._settings=this.account.groups_settings.get(e.name),this._settings||(this._settings=this.account.groups_settings.create({name:e.name})),this.settings=this._settings.attributes,this.contacts=new a.GroupContacts(null,{group:this}),this.settings_view=new a.GroupSettingsView({model:this}),this.contacts.on("add update_contact_item",this.updateCounter,this),this.contacts.on("destroy",this.onContactRemoved,this),a._roster_settings.on("change",this.onChangedRosterSettings,this)},isSpecial:function(){return p.isNumber(this.get("id"))},updateCounter:function(){var e=this.contacts.length,t=e-this.contacts.where({status:"offline"}).length;this.set("counter",{all:e,online:t})},renameGroup:function(e){var t=this.get("name"),a=p.clone(this.settings);a.name=e,this._settings.destroy(),this._settings=this.account.groups_settings.create(a),this.settings=this._settings.attributes,this.set({id:e,name:e}),this.trigger("rename",this,t),p.each(p.clone(this.contacts.models),function(a){var i=p.clone(a.get("groups")),n=i.indexOf(t);0<=n&&i.splice(n,1),n=i.indexOf(e),0>n&&i.push(e),a.pushInRoster({groups:i})})},deleteGroup:function(){var e=this.get("name");this._settings.destroy(),p.each(p.clone(this.contacts.models),function(t){var a=p.clone(t.get("groups")),i=a.indexOf(e);0<=i&&a.splice(i,1),t.pushInRoster({groups:a})})},removeContact:function(e){this.contacts.get(e)&&(this.contacts.remove(e),this.onContactRemoved(e))},onContactRemoved:function(e){this.updateCounter(),this.trigger("remove_contact",e),this.contacts.length||this.destroy()},onChangedRosterSettings:function(){var e=a._roster_settings.changed;p.has(e,"show_offline")&&this._settings.trigger("change:show_offline"),p.has(e,"sorting")&&(this.contacts.sort(),this._settings.trigger("change:sorting"))},showSettings:function(){this.settings_view.show()}}),a.GroupView=a.BasicView.extend({className:"roster-group",events:{"click .group-head":"toggle","click .group-head .group-icon":"showGroupSettings","mouseover .group-head":"showSettingsIcon","mouseleave .group-head":"updateGroupIcon"},_initialize:function(){this.account=this.model.account,this.updateName(),this.updateGroupIcon(),this.updateMembersCounter(),this.model.contacts.on("add",this.onContactAdded,this),this.model.on("remove_contact",this.onContactRemoved,this),this.model.contacts.on("update_contact_item",this.updateContactItem,this),this.model.on("change:name",this.updateName,this),this.model.on("change:counter",this.updateMembersCounter,this),this.model._settings.on("change:show_offline",this.onChangedOfflineSetting,this),this.model._settings.on("change:sorting",this.onChangedSortingSetting,this),this.data.on("change:expanded",this.updateExpanded,this)},updateExpanded:function(){var e=this.data.get("expanded");this.$el.switchClass("shrank",!e),this.$(".arrow").switchClass("mdi-chevron-down",e),this.$(".arrow").switchClass("mdi-chevron-right",!e),this.$(".roster-contact").showIf(e),this.parent.parent.onListChanged()},updateGroupIcon:function(){var e=this.model.settings.show_offline,t;"default"===e?t="settings":"yes"===e?t="group-filled":"no"===e&&(t="group-outline"),this.$(".group-icon").attr("data-mdi",t).hideIf("settings"===t)},updateName:function(){this.$(".group-name").text(this.model.get("name"))},updateMembersCounter:function(){var e=this.model.get("counter");this.$(".participant-counter").text("("+e.online+"/"+e.all+")")},onContactAdded:function(e){this.addChild(e.get("jid"),this.item_view,{model:e});this.updateContactItem(e)},onContactRemoved:function(e){this.removeChild(e.get("jid")),this.parent.parent.onListChanged()},updateContactItem:function(e){var t=this.child(e.get("jid"));if(t){var i=a.settings.roster,s=this.model.settings,o="default"===s.show_offline,d="yes"===s.show_offline||o&&"yes"===i.show_offline,c=6<=n.STATUS_WEIGHTS[e.get("status")];t.$el.switchClass("invisible",c&&!d).detach();var r=this.model.contacts.indexOf(e);return 0===r?this.$(".group-head").after(t.$el):this.$(".roster-contact").eq(r-1).after(t.$el),t.$el.showIf(this.data.get("expanded")),this.parent.parent.onListChanged(),t}},showSettingsIcon:function(){this.$(".group-icon").attr("data-mdi","settings").removeClass("hidden")},showGroupSettings:function(e){e.stopPropagation(),this.model.showSettings()},onChangedOfflineSetting:function(){this.updateGroupIcon();var e=a.settings.roster,t=this.model.settings,i="default"===t.show_offline,s="yes"===t.show_offline||i&&"yes"===e.show_offline;p.each(this.children,function(e){var t=6<=n.STATUS_WEIGHTS[e.model.get("status")];e.$el.switchClass("invisible",t&&!s)}),this.parent.parent.onListChanged()},onChangedSortingSetting:function(){p.each(this.children,function(e){e.$el.detach()}),this.model.contacts.each(function(e){this.updateContactItem(e)}.bind(this)),this.parent.parent.onListChanged()}}),a.GroupRightView=a.GroupView.extend({template:s.group_right,item_view:a.ContactItemRightView,__initialize:function(){this.data.set("expanded",this.model.settings.expanded)},toggle:function(){var e=!this.data.get("expanded");this.data.set("expanded",e),this.model._settings.save("expanded",e)}}),a.GroupLeftView=a.GroupView.extend({template:s.group_left,item_view:a.ContactItemLeftView,__initialize:function(){this.data.set("expanded",!0)},toggle:function(e){e.stopPropagation(),this.data.set("expanded",!this.data.get("expanded"))}}),a.GroupSettingsView=a.BasicView.extend({className:"modal main-modal group-settings",template:s.group_settings,ps_selector:".modal-content",avatar_size:n.AVATAR_SIZES.GROUP_SETTINGS,events:{"change .offline input[type=radio][name=offline]":"setOffline","click .btn-apply":"applySettings","click .btn-delete":"deleteGroup","click .btn-cancel":"close"},_initialize:function(){this._settings=this.model._settings;this.model.get("name");this.model.isSpecial()&&(this.$(".group-name input").attr("readonly",!0),this.$(".btn-delete").addClass("hidden")),this.model.on("destroy",this.onDestroy,this)},render:function(){this.$(".group-name input").val(this.model.get("name")),this.$(".group-name .errors").addClass("hidden"),this.$(".offline input[type=radio][name=offline][value="+this.model.settings.show_offline+"]").prop("checked",!0),this.$el.openModal({ready:function(){Materialize.updateTextFields()},complete:this.hide.bind(this)})},setOffline:function(e){this.model._settings.save("show_offline",e.target.value)},validateName:function(e){return e?this.model.collection.get(e)?"Wrong name":void 0:"Please input name!"},applySettings:function(){var e=this.$(".group-name input").val();if(e!==this.model.get("name")){var t=this.validateName(e);if(t)return void this.$(".group-name .errors").text(t).removeClass("hidden");this.model.renameGroup(e)}this.close()},deleteGroup:function(){var e=this.model.get("name");o.dialogs.ask("Remove group","Do you want to remove group "+e+"?",null,{ok_button_text:"remove"}).done(function(e){e&&this.model.deleteGroup()}.bind(this))},onHide:function(){this.$el.detach()},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},onDestroy:function(){this.$el.closeModal({complete:this.remove.bind(this)})}}),a.Groups=Backbone.Collection.extend({model:a.Group,initialize:function(e,t){this.account=t.account,this.on("add",this.onGroupAdded,this),this.on("change:id",this.sort,this)},comparator:function(e,t){return e.isSpecial()===t.isSpecial()?e.get("id")<t.get("id")?-1:1:e.isSpecial()?1:-1},notSpecial:function(){return this.filter(function(e){return!e.isSpecial()})},onGroupAdded:function(e){e.acc_view=new a.AccountGroupView({model:e})}}),a.Contacts=a.ContactsBase.extend({initialize:function(e,t){this.account=t.account,this.account.on("deactivate destroy",this.removeAllContacts,this),this.collections=[],this.on("add",p.bind(this.updateInCollections,this,"add")),this.on("change",p.bind(this.updateInCollections,this,"change"))},addCollection:function(e){this.collections.push(e)},updateInCollections:function(e,t){p.each(this.collections,function(a){a.update(t,e)})},mergeContact:function(e){"object"!=typeof e&&(e={jid:e});var t=this.get(e.jid);return t?t.set(e):t=this.create(e,{account:this.account}),t},removeAllContacts:function(){p.each(p.clone(this.models),function(e){e.destroy()})},handlePresence:function(e,t){var a=this.mergeContact(t);a.handlePresence(e)}}),a.BlockList=a.ContactsBase.extend({initialize:function(e,t){this.account=t.account,this.contacts=this.account.contacts,this.contacts.on("remove_from_blocklist",this.onContactRemoved,this)},update:function(e){var t=e.get("blocked");t?!this.get(e)&&(this.add(e),e.trigger("add_to_blocklist",e)):this.get(e)&&(this.remove(e),e.trigger("remove_from_blocklist",e))},onContactRemoved:function(e){e.getVCard()},registerHandler:function(){this.account.connection.deleteHandler(this._stanza_handler),this._stanza_handler=this.account.connection.addHandler(this.onBlockingIQ.bind(this),l.NS.BLOCKING,"iq","set",null,this.account.get("jid"))},getFromServer:function(){var e=c({type:"get"}).c("blocklist",{xmlns:l.NS.BLOCKING});this.account.sendIQ(e,this.onBlockingIQ.bind(this))},onBlockingIQ:function(e){var t=d(e).find("[xmlns=\""+l.NS.BLOCKING+"\"]"),a=t[0].tagName.toLowerCase(),i=a.startsWith("block");return t.find("item").each(function(e,t){var a=t.getAttribute("jid"),n=l.getResourceFromJid(a),s=l.getDomainFromJid(a),o={jid:a,blocked:i};n&&(o.resource=!0),s===a&&(o.domain=!0),this.account.contacts.mergeContact(o)}.bind(this)),!0}}),a.Roster=a.ContactsBase.extend({initialize:function(e,t){this.account=t.account,this.roster_version=this.account.get("roster_version")||0,this.groups=this.account.groups,this.contacts=this.account.contacts,this.contacts.on("add_to_roster",this.onContactAdded,this),this.contacts.on("change_in_roster",this.onContactChanged,this),this.contacts.on("remove_from_roster",this.onContactRemoved,this)},update:function(e,t){var a=e.get("in_roster")||e.get("known");a?this.get(e)?"change"===t&&e.trigger("change_in_roster",e):(this.add(e),e.trigger("add_to_roster",e)):this.get(e)&&(this.remove(e),e.trigger("remove_from_roster",e))},onContactAdded:function(e){if(!e.get("in_roster"))return void this.addContactToGroup(e,n.NON_ROSTER_GROUP_ID);var t=e.get("groups");t.length?p.each(t,p.bind(this.addContactToGroup,this,e)):this.addContactToGroup(e,n.GENERAL_GROUP_ID)},onContactChanged:function(e){var t=e.changed,a=p.has(t,"known"),i=p.has(t,"in_roster"),s=p.has(t,"groups");if(i||a||s){var o;e.get("in_roster")?(o=p.clone(e.get("groups")),!o.length&&o.push(n.GENERAL_GROUP_ID)):e.get("known")?o=[n.NON_ROSTER_GROUP_ID]:o=[];var d=this.groups.filter(function(e){return!p.contains(o,e.get("id"))});p.each(d,function(t){t.removeContact(e)}),p.each(o,p.bind(this.addContactToGroup,this,e)),e.trigger("update_groups")}},onContactRemoved:function(e){p.each(this.groups.filter(),function(t){t.removeContact(e)})},getGroup:function(e){var t=this.groups.get(e);if(t)return t;var i={id:e};return e===n.GENERAL_GROUP_ID?i.name=a.settings.roster.general_group_name:e===n.NON_ROSTER_GROUP_ID&&(i.name=a.settings.roster.non_roster_group_name),this.groups.create(i,{account:this.account})},addContactToGroup:function(e,t){var a=this.getGroup(t);a.contacts.add(e)},registerHandler:function(){this.account.connection.deleteHandler(this._stanza_handler),this._stanza_handler=this.account.connection.addHandler(this.onRosterIQ.bind(this),l.NS.ROSTER,"iq","set",null,this.account.get("jid"))},syncFromServer:function(e){e=e||{};let t={xmlns:l.NS.SYNCHRONIZATION};e.after||(e.stamp?t.stamp=e.stamp:this.account.last_msg_timestamp&&(t.stamp=1e3*this.account.last_msg_timestamp)),delete e.stamp;let a=c({type:"get"}).c("query",t).cnode(new l.RSM(e).toXML());this.account.sendIQ(a,function(e){this.onSyncIQ(e,t.stamp)}.bind(this))},onSyncIQ:function(i,n){this.account.last_msg_timestamp=t(d(i).children("synchronization").attr("stamp")/1e3);let s=d(i).find("set last");return(n||(s.length?this.last_chat_msg_id=s.text():this.conversations_loaded=!0),!d(i).find("conversation").length&&!a.accounts.connected.find(e=>!e.roster.conversations_loaded))?void a.chats_view.$(".load-chats-feedback").text("All chats loaded"):(d(i).find("conversation").each(function(t,i){let s=d(i),o=s.attr("jid");if(o===this.account.get("jid"))return;let c=s.children("metadata[node=\""+l.NS.SYNCHRONIZATION+"\"]"),r=this.contacts.mergeContact(o),u="groupchat"===s.attr("type"),m=this.account.chats.getChat(r),g=c.children("last-message").children("message"),h=s.children("metadata[node=\""+l.NS.JINGLE_MSG+"\"]").children("call"),v=c.children("unread"),A=c.children("delivered").attr("id"),f=c.children("displayed").attr("id"),b=parseInt(v.attr("count")),x=s.children("metadata[node=\""+l.NS.REWRITE+"\"]").children("retract").attr("version"),w={synced_msg:!0,stanza_id:(u?g.children("stanza-id[by=\""+o+"\"]"):g.children("stanza-id[by=\""+this.account.get("jid")+"\"]")).attr("id")},C;if(r.set("group_chat",u),c.children("deleted").length&&(m.set("opened",!1),m.set("const_unread",0),a.toolbar_view.recountAllMessageCounter(),a.chats_view.clearSearch()),h.length){let e=h.children("message"),t=e.attr("from"),a=e.children("propose").attr("id");m.initIncomingCall(t,a)}if(g.length||(m.set("timestamp",e(+s.attr("stamp"))/1e3),m.item_view.updateEmptyChat()),n){let e=p.clone(m.messages_unread.models);m.trigger("get_missed_history",n/1e3),m.set("unread",0),m.set("const_unread",0),p.each(e,function(e){e.set("is_unread",!1)}.bind(this)),m.message_retraction_version!=x&&m.trigger("get_retractions_list")}else m.message_retraction_version=x;m.set("last_delivered_id",A),m.set("last_displayed_id",f),b&&(w.is_unread=!0),w.delay=g.children("time"),b&&b--,g.length&&(C=this.account.chats.receiveChatMessage(g,w)),m.set("const_unread",b),C&&(0<v.attr("count")&&!C.isSenderMe()&&(v.attr("after")<C.get("stanza_id")||v.attr("after")<C.get("contact_stanza_id"))&&C.set("is_unread",!0),m.set("first_archive_id",C.get("stanza_id"))),a.toolbar_view.recountAllMessageCounter()}.bind(this)),a.chats_view.hideChatsFeedback(),!0)},getFromServer:function(){let e=this.roster_version,t=c({type:"get"}).c("query",{xmlns:l.NS.ROSTER,ver:e});this.account.sendIQ(t,function(t){this.onRosterIQ(t),this.account.sendPresence(),d(t).children("query").find("item").length||this.account.cached_roster.getAllFromRoster(function(t){d(t).each(function(e,t){this.contacts.mergeContact(t)}.bind(this)),t.length||0==e||(this.roster_version=0,this.getFromServer())}.bind(this)),this.account.dfd_presence.resolve()}.bind(this))},onRosterIQ:function(e){let t=d(e).children("query").attr("ver");return"set"===e.getAttribute("type")?this.account.sendIQ(c({type:"result",id:e.getAttribute("id"),from:this.account.jid})):t&&this.roster_version!=t&&this.account.cached_roster.clearDataBase(),t&&(this.roster_version=t),this.account.save("roster_version",this.roster_version),d(e).children("query").find("item").each(function(e,t){this.onRosterItem(t)}.bind(this)),!0},onRosterItem:function(e){var t=e.getAttribute("jid");if(t!==this.account.get("jid")){var a=this.contacts.mergeContact(t),i=e.getAttribute("subscription"),n=e.getAttribute("ask");if(a.get("invitation")&&("both"===i||"to"===i)&&(a.set("invitation",!1),a.trigger("remove_invite")),"remove"===i)return a.get("group_chat")||a.trigger("roster_push",a,"remove"),a.set({in_roster:!1,known:!1,name:a.get("jid"),subscription:void 0,subscription_request_out:!1}),void this.account.cached_roster.removeFromCachedRoster(t);var s=[];d(e).find("group").each(function(){var e=d(this).text();0>s.indexOf(e)&&s.push(e)});var o={subscription:i,in_roster:!0,roster_name:e.getAttribute("name"),groups:s};"both"===i&&(o.subscription_request_out=!1,o.subscription_request_in=!1),"from"===i&&(o.subscription_request_in=!1),"to"===i&&(o.subscription_request_out=!1),"subscribe"===n&&(o.subscription_request_out=!0),this.account.cached_roster.putInRoster(p.extend(p.clone(o),{jid:t})),o.roster_name&&(o.name=o.roster_name),a.set(o)}}}),a.AccountRosterView=a.BasicView.extend({className:"account-roster-wrap",events:{"click .roster-account-info-wrap .status-button":"openChangeStatus","click .roster-account-info":"toggle"},_initialize:function(e){this.account=e.account,this.groups=this.account.groups,this.roster=this.account.roster,this.contacts=this.account.contacts,this.$el.attr("data-jid",this.account.get("jid")),this.$el.appendTo(this.parent.$(".contact-list")),this.$info=this.$(".roster-account-info-wrap"),this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateColorScheme(),this.account.on("change:name",this.updateName,this),this.account.on("change:image",this.updateAvatar,this),this.account.on("change:status_updated",this.updateStatus,this),this.account.settings.on("change:color",this.updateColorScheme,this),this.groups.on("add",this.onGroupAdded,this),this.groups.on("rename",this.onGroupRenamed,this),this.groups.on("destroy",this.onGroupRemoved,this),this.data.on("change:expanded",this.updateExpanded,this),this.data.set("expanded",!0)},updateName:function(){this.$info.find(".name").text(this.account.get("name"))},updateStatus:function(){this.$info.find(".status").attr("data-status",this.account.get("status")),this.$info.find(".status-message").text(this.account.getStatusMessage())},updateAvatar:function(){var e=this.account.cached_image;this.$info.find(".circle-avatar").setAvatar(e,this.avatar_size)},updateColorScheme:function(){this.$el.attr("data-color",this.account.settings.get("color"))},updateExpanded:function(){var e=this.data.get("expanded");this.$el.switchClass("shrank",!e),this.parent.updateScrollBar()},updateGroupPosition:function(e){e.$el.detach();var t=this.groups.indexOf(e.model);0===t?this.$info.after(e.$el):this.$(".roster-group").eq(t-1).after(e.$el),this.parent.updateScrollBar()},onGroupAdded:function(e){var t=this.addChild(e.get("id"),this.group_view,{model:e});this.updateGroupPosition(t)},onGroupRenamed:function(e,t){var a=this.child(t);delete this.children[t],this.children[e.get("name")]=a,a&&this.updateGroupPosition(a)},onGroupRemoved:function(e){this.removeChild(e.get("id"))},toggle:function(){this.data.set("expanded",!this.data.get("expanded"))},openChangeStatus:function(){a.change_status_view.open(this.account)}}),a.AccountRosterRightView=a.AccountRosterView.extend({template:s.account_roster_right,group_view:a.GroupRightView,avatar_size:n.AVATAR_SIZES.ROSTER_RIGHT_ACCOUNT_ITEM,__initialize:function(){this.contacts.on("add_to_roster change_in_roster remove_from_roster",this.updateCounter,this),this.contacts.on("add_to_roster remove_from_roster",this.updateGlobalCounter,this)},updateCounter:function(){var e=this.roster.length,t=e-this.roster.where({status:"offline"}).length;this.$info.find(".counter").text(t+"/"+e)},updateGlobalCounter:function(){this.parent.updateCounter()}}),a.AccountRosterLeftView=a.AccountRosterView.extend({template:s.account_roster_left,group_view:a.GroupLeftView,avatar_size:n.AVATAR_SIZES.ROSTER_LEFT_ACCOUNT_ITEM,__initialize:function(){this.$info.find(".jid").text(this.account.get("jid"))},search:function(e){this.$el.removeClass("shrank"),this.$(".group-head").addClass("hidden");var t=0,a={};this.$(".roster-contact").each(function(i,n){var s=d(n),o=s.data("jid"),c=this.roster.get(o);if(c){if(a[c.hash_id])return void s.addClass("hidden");a[c.hash_id]=!0;var r=c.get("name").toLowerCase(),l=0>r.indexOf(e)&&0>o.indexOf(e);s.hideIf(l),l||t++}}.bind(this)),this.$(".roster-account-info-wrap").showIf(t)},searchAll:function(){this.$el.switchClass("shrank",!this.data.get("expanded")),this.$(".roster-account-info-wrap").removeClass("hidden"),this.$(".group-head").removeClass("hidden"),this.$(".list-item").removeClass("hidden")}}),a.BlockedItemView=a.BasicView.extend({className:"blocked-contact",template:s.contact_blocked_item,avatar_size:n.AVATAR_SIZES.CONTACT_BLOCKED_ITEM,events:{"click .btn-unblock":"unblockContact",click:"showDetails"},_initialize:function(){if(this.model.get("resource"))this.parent.$(".blocked-invitations-wrap").removeClass("hidden"),this.$el.appendTo(this.parent.$(".blocked-invitations"));else if(this.model.get("domain")){this.parent.$(".blocked-domains-wrap").removeClass("hidden");let e=this.parent.$(".blocked-domains-wrap .blocked-item-description");e.text(e.text()+(e.text()?", ":"")+this.model.get("jid")),this.parent.$(".blocked-item-description").text(),this.$el.appendTo(this.parent.$(".blocked-domains"))}else{this.parent.$(".blocked-contacts-wrap").removeClass("hidden");let e=this.parent.$(".blocked-contacts-wrap .blocked-item-description");e.text(e.text()+(e.text()?", ":"")+this.model.get("jid")),this.$el.appendTo(this.parent.$(".blocked-contacts"))}this.$el.attr({"data-jid":this.model.get("jid")}),this.$(".jid").text(this.model.get("jid")),this.$(".circle-avatar").setAvatar(this.model.cached_image,this.avatar_size),this.on("remove",this.onRemoved,this)},unblockContact:function(e){e.stopPropagation(),this.model.unblock()},showDetails:function(e){d(e.target).closest(".blocked-invitations-wrap").length||this.model.showDetails()},onRemoved:function(){let e=this.$el.closest(".blocked-list"),t=this.model.get("jid"),a=new RegExp("\\,\\s"+t+"|"+t+"\\,\\s|"+t),i=this.$el.closest(".blocked-contacts-wrap").showIf(1<e.children().length).find(".blocked-item-description"),n=this.$el.closest(".blocked-domains-wrap").showIf(1<e.children().length).find(".blocked-item-description");this.$el.closest(".blocked-invitations-wrap").showIf(1<e.children().length),i.text(i.text().replace(a,"")),n.text(n.text().replace(a,""))}}),a.BlockListView=a.BasicView.extend({events:{"click .blocked-item":"toggleItems","click .btn-block":"openBlockWindow"},_initialize:function(e){this.account=e.account,this.account.contacts.on("add_to_blocklist",this.onContactAdded,this),this.account.contacts.on("remove_from_blocklist",this.onContactRemoved,this)},toggleItems:function(e){let t=d(e.target).closest(".blocked-item"),a=t.siblings(".blocked-list"),i=a.hasClass("hidden");a.switchClass("hidden",!i),t.find(".toggle-items").switchClass("mdi-chevron-right",!i).switchClass("mdi-chevron-down",i),this.parent.updateScrollBar()},onContactAdded:function(e){e.get("group_chat")||(this.addChild(e.get("jid"),a.BlockedItemView,{model:e}),this.$(".placeholder").addClass("hidden"),this.parent.updateScrollBar())},onContactRemoved:function(e){this.removeChild(e.get("jid")),this.$(".placeholder").hideIf(this.account.blocklist.length),this.parent.updateScrollBar()},openBlockWindow:function(){o.dialogs.ask_enter_value("Block","Block a specific xmpp address",{input_placeholder_value:"name@example.com"},{ok_button_text:"block"}).done(function(e){if(e){let t=this.account.contacts.mergeContact(e);t.block()}}.bind(this))}}),a.RosterView=a.SearchPanelView.extend({ps_selector:".contact-list-wrap",_initialize:function(){this._settings=a._roster_settings,this.model.on("activate",this.updateOneRosterView,this),this.model.on("update_order",this.updateRosterViews,this),this.model.on("deactivate destroy",this.removeRosterView,this),this.on("before_hide",this.saveScrollBarOffset,this),this.$("input").on("input",this.updateSearch.bind(this))},updateOneRosterView:function(e){var t=e.get("jid"),a=this.child(t);if(a)a.$el.detach();else if(e.isConnected())a=this.addChild(t,this.account_roster_view,{account:e});else return;var i=this.model.connected.indexOf(e);0===i?this.$(".contact-list").prepend(a.$el):this.$(".contact-list").children().eq(i-1).after(a.$el),this.updateScrollBar()},updateRosterViews:function(){p.each(this.children,function(e){e.detach()}),this.model.each(function(e){var t=e.get("jid"),a=this.child(t);a&&this.$(".contact-list").append(a.$el)}.bind(this)),this.updateScrollBar()},removeRosterView:function(e){this.removeChild(e.get("jid")),this.updateScrollBar()}}),a.RosterRightView=a.RosterView.extend({className:"roster-right-container container",template:s.roster_right,ps_settings:{theme:"roster-right"},account_roster_view:a.AccountRosterRightView,events:{"mouseover .collapsed-wrap":"expand","mouseleave .expanded-wrap":"collaps","click .btn-pin":"pinUnpin"},__initialize:function(){this.updateCounter(),this.model.on("activate deactivate destroy",this.updateCounter,this),this.data.on("change",this.updateLayout,this);var e=this._settings.get("pinned");this.data.set({expanded:e,pinned:e})},expand:function(){this.data.set("expanded",!0)},collaps:function(){this.data.get("pinned")||this.data.set("expanded",!1)},pinUnpin:function(){var e=!this.data.get("pinned");this._settings.save("pinned",e),this.data.set("pinned",e)},updateLayout:function(){var e=this.data.changed;(p.has(e,"expanded")||p.has(e,"pinned"))&&a.trigger("update_layout",{roster_state_changed:!0})},updateCounter:function(){this.$(".all-contacts-counter").text(p.reduce(this.children,function(e,t){return e+t.roster.length},0))},onListChanged:function(){this.updateScrollBar()}}),a.RosterLeftView=a.RosterView.extend({className:"roster-left-container container",template:s.roster_left,ps_settings:{theme:"item-list"},main_container:".contact-list",account_roster_view:a.AccountRosterLeftView,__initialize:function(){this.model.on("list_changed",this.updateLeftIndicator,this),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this))},updateLeftIndicator:function(){this.$el.attr("data-indicator",1<this.model.connected.length)},getContactForItem:function(e){var t=d(e),a=t.parent().parent().data("jid"),i=t.data("jid"),n=this.child(a);return n&&n.roster.get(i)},render:function(e){("chat"!==e.right&&"contact_details"!==e.right&&"message_context"!==e.right&&"participant_messages"!==e.right||e.clear_search&&"chat"===e.right)&&this.clearSearch()},searchAll:function(){p.each(this.children,function(e){e.searchAll()})},selectItem:function(e,t){if(!e)return void("up"===t&&(this.ps_container[0].scrollTop=0));this.clearSearchSelection();var a=this.$(".list-item[data-id=\""+e+"\"]");a.length?this.selection_id=e:(this.ps_container[0].scrollTop=0,a=this.$(".list-item:visible").first(),this.selection_id=a.data("id")),a.length&&"down"===t&&(a[0].clientHeight+a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop>=this.ps_container[0].clientHeight+this.ps_container[0].scrollTop||a[0].clientHeight+a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop<this.ps_container[0].scrollTop)&&(this.ps_container[0].scrollTop=a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop),a.length&&"up"===t&&(a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop<=this.ps_container[0].scrollTop||a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop>this.ps_container[0].scrollTop+this.ps_container[0].clientHeight)&&(this.ps_container[0].scrollTop=a[0].offsetTop+a.parent()[0].offsetTop+a.closest(".account-roster-wrap")[0].offsetTop),a.addClass("selected")},onEnterPressed:function(e){let t;if(e.closest(".searched-lists-wrap").length)this.clearSearch(),this.$(".list-item.active").removeClass("active"),e.hasClass("chat-item")&&(t=a.chats_view.child(e.data("id")),t&&t.open({screen:a.body.screen.get("name"),clear_search:!1}),e.addClass("active")),e.hasClass("roster-contact")&&(t=a.accounts.get(e.data("account")).chats.get(a.accounts.get(e.data("account")).contacts.get(e.data("jid")).hash_id),t&&(t=t.item_view),t&&a.chats_view.openChat(t,{clear_search:!1,screen:a.body.screen.get("name")}),e.addClass("active")),e.hasClass("message-item")&&e.click();else{var i=this.getContactForItem(e);i&&i.showDetails()}},onListChanged:function(){this.updateSearch()}}),a.RosterSettingsView=a.BasicView.extend({className:"roster-settings-wrap",template:s.roster_settings,events:{"change .offline-contacts input":"setOfflineSetting","change .sorting-contacts input":"setSortingSetting"},_initialize:function(){this.$el.appendTo(this.parent.$(".settings-block-wrap.contact-list"))},render:function(){this.$(".offline-contacts input[type=radio][name=offline-contacts][value="+this.model.get("show_offline")+"]").prop("checked",!0),this.$(".sorting-contacts input[type=radio][name=sorting-contacts][value="+this.model.get("sorting")+"]").prop("checked",!0)},setOfflineSetting:function(){this.model.save("show_offline",this.$(".offline-contacts input[type=radio][name=offline-contacts]:checked").val())},setSortingSetting:function(){this.model.save("sorting",this.$(".sorting-contacts input[type=radio][name=sorting-contacts]:checked").val())}}),a.AccountGroupView=a.BasicView.extend({className:"group",template:function(){this.$el.append("<span class=\"group-name\"/>")},events:{"click .group-name":"showGroupSettings"},_initialize:function(){this.$(".group-name").text(this.model.get("name"));var e=this.model.collection.indexOf(this.model),t=this.model.account.settings_right.$(".groups");0===e?t.prepend(this.$el):t.children().eq(e-1).after(this.$el),this.model.on("destroy",this.remove,this)},showGroupSettings:function(){this.model.showSettings()}}),a.ContactPlaceholderView=a.BasicView.extend({className:"placeholder-wrap contact-placeholder-wrap noselect",template:s.contact_placeholder}),a.AddContactView=a.BasicView.extend({className:"modal main-modal add-contact-modal",template:s.add_contact,ps_selector:".modal-content",avatar_size:n.AVATAR_SIZES.SYNCHRONIZE_ACCOUNT_ITEM,events:{"click .account-field .dropdown-content":"selectAccount","click .existing-group-field label":"editGroup","change .new-group-name input":"checkNewGroup","keyup .new-group-name input":"checkNewGroup","keyup .name-field #new_contact_username":"checkJid","focusout .name-field #new_contact_username":"focusoutInputField","click .new-group-checkbox":"addNewGroup","click .btn-add":"addContact","click .btn-cancel":"close"},_initialize:function(){this.group_data=new Backbone.Model,this.group_data.on("change",this.updateGroups,this)},render:function(e){if(!a.accounts.connected.length)return void o.dialogs.error("No connected accounts found.");e||(e={});var t=e.account?[e.account]:a.accounts.connected,i=e.jid||"";return this.$("input[name=\"username\"]").val(i).attr("readonly",!!i).removeClass("invalid"),this.$(".single-acc").showIf(1===t.length),this.$(".multiple-acc").hideIf(1===t.length),this.$(".account-field .dropdown-content").empty(),p.each(t,function(e){this.$(".account-field .dropdown-content").append(this.renderAccountItem(e))}.bind(this)),this.bindAccount(t[0]),this.$("span.errors").text(""),this.$el.openModal({ready:function(){Materialize.updateTextFields(),this.$(".account-field .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"})}.bind(this),complete:this.hide.bind(this)}),this},bindAccount:function(e){this.account=e,this.$(".account-field .dropdown-button .account-item-wrap").replaceWith(this.renderAccountItem(e)),this.renderGroupsForAccount(e)},renderAccountItem:function(e){var t=d(s.add_contact_account_item({jid:e.get("jid")}));return t.find(".circle-avatar").setAvatar(e.cached_image,this.avatar_size),t},renderGroupsForAccount:function(e){this.group_data.set({selected:[],groups:p.map(e.groups.notSpecial(),function(e){return e.get("name")})},{silent:!0}),this.updateGroups()},updateGroups:function(){var e=this.group_data.get("selected");this.$(".groups").html(s.groups_checkbox_list({groups:p.map(this.group_data.get("groups"),function(t){return{name:t,id:m(),checked:p.contains(e,t)}})})),this.updateScrollBar()},selectAccount:function(e){var t=d(e.target).closest(".account-item-wrap"),i=a.accounts.get(t.data("jid"));this.bindAccount(i)},editGroup:function(e){e.preventDefault();var t=d(e.target),a=t.siblings("input"),i=!a.prop("checked"),n=a.attr("data-groupname"),s=p.clone(this.group_data.get("selected")),o=s.indexOf(n);a.prop("checked",i),i?0>o&&s.push(n):0<=o&&s.splice(o,1),this.group_data.set("selected",s)},checkNewGroup:function(e){var t=d(e.target).val(),a=this.$(".new-group-checkbox");a.showIf(t&&!p.contains(this.group_data.get("groups"),t))},addNewGroup:function(e){e.preventDefault();var t=this.$(".new-group-name input"),a=t.val(),i=p.clone(this.group_data.get("groups")),n=i.indexOf(a);if(0>n){var s=p.clone(this.group_data.get("selected"));s.push(a),i.push(a),this.group_data.set({groups:i,selected:s})}this.scrollToBottom()},focusoutInputField:function(){this.$("input[name=username]").val().trim()||(this.$("input[name=username]").removeClass("invalid"),this.$("span.errors").text("").addClass("hidden"))},checkJid:function(){let e=this.$("input[name=username]").val().trim(),t;!/^(([^<>()[\]\\.,;:\s%@\"]+(\.[^<>()[\]\\.,;:\s%@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([^<>()[\]\\.,;:\s%@\"]+(\.[^<>()[\]\\.,;:\s%@\"]+)*)|(\".+\"))|(([0-9]{1,3}\.){3}[0-9]{1,3})|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)&&e&&(t="Invalid jid"),t?this.$("input[name=username]").addClass("invalid").siblings(".errors").text(t):(this.$("input[name=username]").removeClass("invalid"),this.$("span.errors").text("").addClass("hidden"))},addContact:function(){this.$("span.errors").text("").addClass("hidden");var e=this.$("input[name=username]").removeClass("invalid").val().trim(),t=this.$("input[name=contact_name]").removeClass("invalid").val(),a=this.group_data.get("selected"),i,n;e=l.getBareJidFromJid(e),e?e===this.account.get("jid")?n="Can not add yourself to contacts!":/^(([^<>()[\]\\.,;:\s%@\"]+(\.[^<>()[\]\\.,;:\s%@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)?(i=this.account.contacts.mergeContact(e),i.get("in_roster")&&(n="Contact is already in your roster!")):n="Invalid jid":n="Input username!",n?this.$("input[name=username]").addClass("invalid").siblings(".errors").text(n):(i.pres("subscribed"),i.pushInRoster({name:t,groups:a},function(){i.pres("subscribe"),i.trigger("open_chat",i)}.bind(this),function(){i.destroy()}),this.close())},onHide:function(){this.$el.detach()},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})}}),a.GroupSettings=Backbone.Model.extend({idAttribute:"name",defaults:{expanded:!0,show_offline:"default",sorting:"default",custom_notifications:!1,notifications:!1,message_preview:!1}}),a.GroupsSettings=Backbone.CollectionWithStorage.extend({model:a.GroupSettings,_initialize:function(e,t){this.account=t.account,this.account.on("destroy",this.clearStorage,this),this.fetch()}}),a.RosterSettings=Backbone.ModelWithStorage.extend({defaults:{pinned:!0,show_offline:"yes",sorting:"online-first",general_group_name:"General",non_roster_group_name:"Not in roster"}}),a.CachedContactsInfo=Backbone.ModelWithDataBase.extend({defaults:{contacts:[]},putContactInfo:function(e,t){this.database.put("contacts",e,function(e){t&&t(e)})},getContactInfo:function(e,t){this.database.get("contacts",e,function(e){t&&t(e)})}}),a.CachedRoster=Backbone.ModelWithDataBase.extend({putInRoster:function(e,t){this.database.put("roster_items",e,function(e){t&&t(e)})},getItemFromRoster:function(e,t){this.database.get("roster_items",e,function(e){t&&t(e)})},getAllFromRoster:function(e){this.database.get_all("roster_items",null,function(t){e&&e(t||[])})},removeFromCachedRoster:function(e,t){this.database.remove("roster_items",e,function(e){t&&t(e)})},clearDataBase:function(){this.database.clear_database("roster_items")}}),a.Account.addInitPlugin(function(){this.groups_settings=new a.GroupsSettings(null,{account:this,storage_name:a.getStorageName()+"-groups-settings-"+this.get("jid")}),this.cached_roster=new a.CachedRoster(null,{name:"cached-roster-list-"+this.get("jid"),objStoreName:"roster_items",primKey:"jid"}),this.groupchat_settings=new a.GroupChatSettings({id:"group-chat-settings"},{account:this,storage_name:a.getStorageName()+"-group-chat-settings-"+this.get("jid"),fetch:"after"}),this.groups=new a.Groups(null,{account:this}),this.contacts=new a.Contacts(null,{account:this}),this.contacts.addCollection(this.roster=new a.Roster(null,{account:this})),this.contacts.addCollection(this.blocklist=new a.BlockList(null,{account:this})),this.settings_right.addChild("blocklist",a.BlockListView,{account:this,el:this.settings_right.$(".blocklist-info")[0]}),this._added_pres_handlers.push(this.contacts.handlePresence.bind(this.contacts)),this.on("ready_to_get_roster",function(){if(this.resources.reset(),this.contacts.each(function(e){e.resources.reset(),e.resetStatus()}),this.connection&&this.connection.do_synchronization){let t={},i=20<e(a.chats_view.$el[0].clientHeight/56)?e(a.chats_view.$el[0].clientHeight/56):20;this.roster.last_chat_msg_id||(t.max=i),this.roster.syncFromServer(t)}this.roster.getFromServer(),this.blocklist.getFromServer()},this)}),a.Account.addConnPlugin(function(){this.registerIQHandler(),this.registerSyncedIQHandler(),this.roster.registerHandler(),this.blocklist.registerHandler()},!0,!0),a.once("start",function(){this._roster_settings=new this.RosterSettings({id:"roster-settings"},{storage_name:this.getStorageName(),fetch:"after"}),this.settings.roster=this._roster_settings.attributes,this.roster_settings_view=a.settings_view.addChild("roster_settings",this.RosterSettingsView,{model:this._roster_settings}),this.cached_contacts_info=new a.CachedContactsInfo(null,{name:"cached-contacts-list",objStoreName:"contacts",primKey:"jid"}),this.contacts_view=this.left_panel.addChild("contacts",this.RosterLeftView,{model:this.accounts}),this.roster_view=this.body.addChild("roster",this.RosterRightView,{model:this.accounts}),this.details_container=this.right_panel.addChild("details",this.Container),this.contact_placeholder=this.right_panel.addChild("contact_placeholder",this.ContactPlaceholderView),this.add_contact_view=new this.AddContactView,this.on("add_contact",function(){this.add_contact_view.show()},this)},a),a}}),define("xabber-chats",[],function(){var e=Math.round,t=Math.max;return function(a){var i=a.env,n=i.constants,s=i.templates.chats,o=i.utils,d=i.$,c=i.$iq,r=i.$msg,l=i.Strophe,u=i._,p=i.moment,m=i.uuid,g=o.images,h=o.emoji;return a.Message=Backbone.Model.extend({idAttribute:"unique_id",defaults:function(){let e=m();return{msgid:e,unique_id:e,type:"main",state:n.MSG_PENDING}},initialize:function(){var e=this.get("time"),t={};e?t.timestamp=+p(e):(t.timestamp=p.now(),t.time=p(t.timestamp).format()),this.get("origin_id")||!this.isSenderMe()||this.get("synced_from_server")||this.get("carbon_copied")||this.get("is_archived")||this.set("origin_id",this.get("msgid")),this.updateUniqueId(),this.set(t),this.on("change:origin_id stanza_id archived_id",this.updateUniqueId,this)},updateUniqueId:function(){this.set("unique_id",this.get("origin_id")||this.get("stanza_id")||this.get("archived_id")||this.get("msgid"))},getText:function(){var e=this.get("forwarded_message");return e?e.get("message"):this.get("message")},getState:function(){return n.MSG_STATE[this.get("state")]},getVerboseState:function(){var e=n.MSG_VERBOSE_STATE[this.get("state")];return this.account?!this.account.isOnline()&&(e="Message will be sent when you get online."):!this.collection.account.isOnline()&&(e="Message will be sent when you get online."),e},isSenderMe:function(){return this.account?this.account.get("jid")===this.get("from_jid"):this.collection.account?this.collection.account.get("jid")===this.get("from_jid"):void 0}}),a.MessagesBase=Backbone.Collection.extend({model:a.Message}),a.SearchedMessages=a.MessagesBase.extend({comparator:"timestamp",initialize:function(){this.collections=[],this.on("add",u.bind(this.updateInCollections,this,"add")),this.on("change",u.bind(this.updateInCollections,this,"change"))},addCollection:function(e){this.collections.push(e)},updateInCollections:function(e,t){u.each(this.collections,function(a){a.update(t,e)})}}),a.Messages=Backbone.Collection.extend({model:a.Message,comparator:"timestamp",initialize:function(e,t){this.account=t.account},createInvitationFromStanza:function(e,t){t=t||{};let a=e.find("invite"),i=a.attr("jid")||e.attr("from"),n=t.delay||e.children("delay"),s=l.getBareJidFromJid(i),o=e.children("body").text(),d=0<e.find("markable").length,c=e.attr("id"),r=e.children("archived").attr("id"),p=e.children("origin-id").attr("id"),m=p||t.stanza_id||r||c,g=m&&this.get(m),h=e.children("x[xmlns=\""+l.NS.GROUP_CHAT+"\"]"),v={},A;if(g)return g;if(s){let a={xml:t.xml||e[0],carbon_copied:t.carbon_copied&&!t.is_archived,markable:d,msgid:c,is_forwarded:t.is_forwarded,forwarded_message:t.forwarded_message||null,from_jid:s,origin_id:p,stanza_id:t.stanza_id,archive_id:r,contact_stanza_id:t.contact_stanza_id,is_archived:t.is_archived};n.length&&(a.time=n.attr("stamp")),o&&(a.message=o);let i=this.account.contacts.mergeContact(l.getBareJidFromJid(s)),m=this.account.chats.getChat(i);if(i.set("group_chat",!0),i.set("in_roster",!1),i.getVCard(),h.length){let e=h.find("name").text(),t=h.find("membership").text(),a=h.find("privacy").text(),n=h.find("index").text(),s=h.find("parent-chat").text(),o=h.find("description").text();e&&(v.name=e),t&&(v.model=e),a&&(v.anonymous=a),n&&(v.searchable=n),o&&(v.description=o),s.length&&(A=!0),A&&i.set("private_chat",!0),"incognito"===a&&i.set("incognito_chat",!0),i.set("group_info",v)}let g=m.messages.createSystemMessage(u.extend(a,{from_jid:s,auth_request:!0,invite:!0,private_invite:A||!1,is_accepted:!1,silent:!1,message:e.find("reason").text()}));return g}},createFromStanza:function(e,t){t||(t={});let i=t.delay||e.children("delay"),s=e.attr("from")||t.from_jid,c=l.getBareJidFromJid(s),r=e.children("body").text(),m=0<e.find("markable").length,g=e.children("archived").attr("id"),h=e.children("origin-id").attr("id"),v=e.attr("id"),A=h||t.stanza_id||g||v,f=A&&this.get(A);if(t.replaced){e=e.children("replace").children("message"),r=e.children("body").text();let a=e.children("stanza-id").first().attr("id");if(f=this.find(e=>e.get("stanza_id")===a||e.get("contact_stanza_id")===a),!f)return;c=f.get("from_jid"),v=f.get("msgid");let i=f.get("xml");i.innerHTML=e[0].innerHTML,t.xml=i,t.forwarded_message=f.get("forwarded_message")}if(f&&!t.replaced&&!t.context_message&&!t.searched_message&&!t.pinned_message&&!t.participant_message&&!t.echo_msg&&!t.is_searched)return f;let b={xml:t.xml||e[0],original_message:r,carbon_copied:t.carbon_copied&&!t.is_archived,markable:m,msgid:v,is_forwarded:t.is_forwarded,forwarded_message:t.forwarded_message||null,from_jid:c,contact_stanza_id:t.contact_stanza_id,is_archived:t.is_archived},x=[],w=[],C=[],S=[],k=[],E=[];if(e.children("reference[xmlns=\""+l.NS.REFERENCE+"\"]").each(function(e,t){let a=d(t),i=a.attr("type"),s=parseInt(a.attr("begin")),o=parseInt(a.attr("end"));if("decoration"===i){if(a.children("mention[xmlns=\""+l.NS.MARKUP+"\"]").length){let e=a.children("mention[xmlns=\""+l.NS.MARKUP+"\"]"),t=e.text(),i=e.attr("node")===l.NS.GROUP_CHAT;x.push({start:s,end:o,target:t,is_gc:i})}else{let e=[];a.children().each(function(t,a){-1<n.MARKUP_TAGS.indexOf(a.tagName)&&d(a).attr("xmlns")===l.NS.MARKUP&&("link"===a.tagName?e.push({type:a.tagName,uri:d(a).text()}):"quote"===a.tagName?w.push({start:s,end:o}):e.push(a.tagName))}.bind(this)),e.length&&C.push({start:s,end:o,markup:e})}}else if("mutable"===i){let e=a.find("file-sharing[xmlns=\""+l.NS.OTB+"\"]").first();if(a.children("forwarded").length)S.push({start:s,end:o,type:"forward"});else if(e.length){let t=e.parent("voice-message[xmlns=\""+l.NS.VOICE_MESSAGE+"\"]").length?"voice":"file",a=e.children("file"),i={},n=[];S.push({start:s,end:o,type:t}),e.children("sources").children("uri").each(function(e,t){n.push(d(t).text())}.bind(this)),i={name:a.children("name").text(),hash:a.children("hash[xmlns=\""+l.NS.HASH+"\"]").text(),size:a.children("size").text(),type:a.children("media-type").text(),duration:a.children("duration").text(),description:a.children("desc").text(),height:a.children("height").text(),width:a.children("width").text(),voice:"voice"==t,sources:n},"image"===this.getFileType(a.children("media-type").text())?E.push(i):k.push(i)}}else if("data"===i);}.bind(this)),e.children("x[xmlns=\""+l.NS.GROUP_CHAT+"\"]").each(function(a,i){let n=d(i).children("reference[type=\"mutable\"][xmlns=\""+l.NS.REFERENCE+"\"]"),s=n.children("user[xmlns=\""+l.NS.GROUP_CHAT+"\"]").first();if(n.length){let a=parseInt(n.attr("begin")),i=parseInt(n.attr("end"));S.push({start:a,end:i,type:"groupchat"});let o=s.attr("id"),d=s.children("jid").text();u.extend(b,{user_info:{id:o,jid:d,nickname:s.children("nickname").text()||d||o,role:s.children("role").text(),avatar:s.children("metadata[xmlns=\""+l.NS.PUBSUB_AVATAR_METADATA+"\"]").children("info").attr("id"),badge:s.children("badge").text()},from_jid:d||o,groupchat_jid:l.getBareJidFromJid(t.is_sender?e.attr("to"):e.attr("from"))})}}.bind(this)),w.length&&(b.blockquotes=w),x.length&&(b.mentions=x),C.length&&(b.markups=C),E.length&&(b.images=E),k.length&&(b.files=k),S.length&&(b.mutable_content=S),t.stanza_id&&(b.stanza_id=t.stanza_id),h&&(b.origin_id=h),g&&(b.archive_id=g),(t.replaced||x.length)&&(b.mentions=x),(t.replaced||C.length)&&(b.markups=C),e.children("x[xmlns=\""+l.NS.GROUP_CHAT+"#system-message\"]").length&&(b.type="system",b.participants_version=e.children("x[xmlns=\""+l.NS.GROUP_CHAT+"#system-message\"]").attr("version")),e.find("x[xmlns=\""+l.NS.DATAFORM+"\"]").length&&e.find("x[xmlns=\""+l.NS.DATAFORM+"\"] field[var=\"FORM_TYPE\"][type=\"hidden\"] value").text()===l.NS.WEBCHAT){let t=[];e.children(`addresses[xmlns="${l.NS.ADDRESS}"]`).children("address").each(function(e,a){let i=d(a);t.push({type:i.attr("type"),jid:i.attr("jid")})}.bind(this)),b.data_form=u.extend(this.account.parseDataForm(e.find("x[xmlns=\""+l.NS.DATAFORM+"\"]")),{addresses:t})}if(r&&(r=o.slice_pretty_body(r,S)),b.forwarded_message||""!==r.removeEmoji()||(b.only_emoji=Array.from(r).length),b.message=r,t.echo_msg&&(i=e.children("time")),i.length&&(b.time=i.attr("stamp")),(b.carbon_copied||c==this.account.get("jid")&&(t.is_archived||t.synced_msg))&&(b.state=n.MSG_SENT),t.synced_msg&&(b.synced_from_server=!0),t.missed_history&&(b.missed_msg=!0),t.echo_msg&&(b.state=n.MSG_DELIVERED,b.timestamp=+p(b.time),b.from_jid=this.account.get("jid")),(t.context_message||t.participant_message||t.searched_message||t.is_searched)&&(b.state=n.MSG_ARCHIVED),t.pinned_message)return this.account.pinned_messages.create(b);if(t.participant_message)return this.account.participant_messages.create(b);if(t.searched_message)return this.account.searched_messages.create(b);if(t.context_message)return this.account.context_messages.create(b);if(!((t.echo_msg||t.replaced&&f)&&(f.set(b),t.replaced))){if(t.is_searched){let t=l.getBareJidFromJid(e.attr("from"));return t===this.account.get("jid")&&(t=l.getBareJidFromJid(e.attr("to"))),f=a.all_searched_messages.create(b),f.contact=this.account.contacts.mergeContact(t),f.account=this.account,f}return f=this.create(b),f}},getFilename:function(e){let t=e.lastIndexOf("/");return e.substr(t+1,e.length-1)},getFileType:function(e){let t=-1<e.indexOf("/")?e.indexOf("/"):e.length,a=e.slice(0,t);return a},createSystemMessage:function(e){return this.create(u.extend({type:"system",silent:!0,state:n.MSG_DISPLAYED},e))}}),a.JingleMessage=Backbone.Model.extend({defaults:{duration:0,contact_full_jid:"",session_id:0,audio:!0,volume_on:!0,video_in:!1,video_screen:!1,state:0},initialize:function(e,t){e=e||{},e.video_live=e.video_live||!1,e.video=e.video_live,this.contact=t.contact,this.account=this.contact.account,this.registerIqHandler(),this.audio_notifiation=a.playAudio("call",!0),this.modal_view=new a.JingleMessageView({model:this}),this.conn=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}],sdpSemantics:"unified-plan"}),this.$remote_video_el=d("<video autoplay class=\"webrtc-remote-video\"/>"),this.$remote_audio_el=d("<audio autoplay class=\"webrtc-remote-audio hidden\"/>"),this.$local_video=this.modal_view.$el.find(".webrtc-local-video"),this.current_timer=0,this.conn.onconnectionstatechange=this.onChangeConnectionState.bind(this),this.set(e),this.get("in")&&this.updateStatus("Calling..."),this.onChangedMediaType(),this.conn.ontrack=function(e){this.remote_stream=e.streams[0],this.modal_view.$el.find(".webrtc-remote-audio")[0].srcObject=e.streams[0]}.bind(this),this._waiting_timeout=setTimeout(function(){this.get("state")||"calling"!==this.get("status")||this.get("call_initiator")!==this.account.get("jid")||this.reject()}.bind(this),1e3*n.JINGLE_WAITING_TIME),this.conn.onicecandidate=this.onIceCandidate.bind(this),this.conn.oniceconnectionstatechange=this.onChangeIceConnectionState.bind(this),this.on("change:audio",this.setEnabledAudioTrack,this),this.on("change:video",this.onChangedVideoValue,this),this.on("change:video_live",this.setEnabledVideoTrack,this),this.on("change:video_screen",this.setEnabledScreenShareVideoTrack,this),this.on("change:video_in",this.onChangedRemoteVideo,this),this.on("change:volume_on",this.onChangedVolume,this),this.on("destroy",this.onDestroy,this)},registerIqHandler:function(){this.account.connection.deleteHandler(this.iq_handler),this.iq_handler=this.account.connection.addHandler(function(e){return this.onIQ(e),!0}.bind(this),null,"iq","set")},updateStatus:function(e){this.modal_view.updateStatusText(e)},updateTimer:function(){this.updateStatus(o.pretty_duration(++this.current_timer))},startTimer:function(){this.updateTimer(),clearInterval(this.call_timer),this.call_timer=setInterval(function(){this.updateTimer()}.bind(this),1e3)},onConnected:function(){this.get("video_live")&&this.onChangedVideoValue(),a.stopAudio(this.audio_notifiation),setTimeout(function(){this.set("status","connected"),this.updateStatus(),this.startTimer()}.bind(this),1e3)},onChangeConnectionState:function(e){let t=e.target,i=t.connectionState;"connected"===i?this.onConnected():(this.updateStatus(o.pretty_name(i)+"..."),"failed"===i&&(clearTimeout(this._timeout_failed),this._timeout_failed=setTimeout(function(){("failed"===t.connectionState||"disconnected"===t.connectionState)&&(this.set("status",i),this.reject(),this.destroy(),this.updateStatus("Network error..."),a.current_voip_call=null)}.bind(this),4e4),t.restartIce()),"disconnected"===i&&(this.set("status",i),this.destroy(),a.current_voip_call=null))},onIceCandidate:function(e){e&&e.candidate&&e.candidate.candidate&&this.sendCandidate(e.candidate)},onChangeIceConnectionState:function(e){let t=e.target,i=t.iceConnectionState;"failed"===i&&(clearTimeout(this._timeout_failed),this._timeout_failed=setTimeout(function(){("failed"===t.iceConnectionState||"disconnected"===t.connectionState)&&(this.set("status",i),this.reject(),this.destroy(),this.updateStatus("Network error..."),a.current_voip_call=null)}.bind(this),4e4),t.restartIce()),"connected"!==i||this.conn.connectionState||this.onConnected()},onChangedMediaType:function(){this.$local_video.switchClass("hidden",!this.get("video"))},onChangedRemoteVideo:function(){let e=this.get("video_in");e?(this.$remote_video_el[0].srcObject=this.remote_stream,this.modal_view.$el.find(".webrtc-remote-audio").replaceWith(this.$remote_video_el)):(this.$remote_audio_el[0].srcObject=this.remote_stream,this.modal_view.$el.find(".webrtc-remote-video").replaceWith(this.$remote_audio_el)),this.modal_view.$el.find(".default-screen").switchClass("hidden",e),this.onChangedVolume()},onChangedVolume:function(){this.get("volume_on")?(this.modal_view.$el.find(".webrtc-remote-audio")[0]&&(this.modal_view.$el.find(".webrtc-remote-audio")[0].muted=!1),this.modal_view.$el.find(".webrtc-remote-video")[0]&&(this.modal_view.$el.find(".webrtc-remote-video")[0].muted=!1)):(this.modal_view.$el.find(".webrtc-remote-audio")[0]&&(this.modal_view.$el.find(".webrtc-remote-audio")[0].muted=!0),this.modal_view.$el.find(".webrtc-remote-video")[0]&&(this.modal_view.$el.find(".webrtc-remote-video")[0].muted=!0))},setEnabledAudioTrack:function(){this.local_stream.getAudioTracks()[0].enabled=this.get("audio")},setEnabledVideoTrack:function(){let e=this.get("video_live"),t=this.conn.getSenders().find(e=>e.track&&(e.track.default||e.track.screen));e&&this.set("video_screen",!1),t&&e&&this.createVideoStream(),!t&&this.local_stream&&(this.local_stream.getVideoTracks()[0].enabled=e),this.set("video",e||this.get("video_screen"))},onDestroy:function(){clearTimeout(this._waiting_timeout),clearInterval(this.call_timer),clearTimeout(this._timeout_failed),a.stopAudio(this.audio_notifiation),this.account.connection.deleteHandler(this.iq_handler),this.stopTracks(),this.conn.close()},setEnabledScreenShareVideoTrack:function(){let e=this.get("video_screen"),t=this.conn.getSenders().find(e=>e.track&&!e.track.screen);e&&this.set("video_live",!1),t&&e&&this.createScreenShareVideoStream(),!t&&this.local_stream&&(this.local_stream.getVideoTracks()[0].enabled=e),this.set("video",e||this.get("video_live"))},onChangedVideoValue:function(){let e=this.get("video")?"enable":"disable";this.sendVideoStreamState(e),this.onChangedMediaType()},createScreenShareVideoStream:function(){navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(e){this.$local_video[0].srcObject=e,e.getVideoTracks().forEach(function(e){u.extend(e,{screen:!0}),this.local_stream.addTrack(e),this.conn.addTrack(e,this.local_stream),this.conn.getSenders().find(e=>!e.track||e.track&&"video"===e.track.kind).replaceTrack(e)}.bind(this))}.bind(this))},sendVideoStreamState:function(e){let t=c({from:this.account.get("jid"),to:this.get("contact_full_jid"),type:"set"}).c("query",{xmlns:l.NS.JINGLE_MSG}).c("video",{state:e,id:this.get("session_id")});this.account.sendIQ(t)},onIQ:function(e){let t=d(e),a=t.find("jingle[action=\"session-initiate\"]"),i=t.find("jingle[action=\"session-accept\"]"),n=t.find("jingle[action=\"session-info\"]"),s=t.find("query[xmlns=\""+l.NS.JINGLE_MSG+"\"] video"),o=t.attr("from"),r=c({from:this.account.get("jid"),to:o,type:"result",id:t.attr("id")});if(a.length){if(a.attr("sid")!==this.get("session_id"))return;let e=a.find("description[xmlns=\""+l.NS.JINGLE_RTP+"\"]").text();e&&this.conn.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:e})),this.acceptSession(e),this.account.sendIQ(r)}if(i.length){if(i.attr("sid")!==this.get("session_id"))return;let e=i.find("description[xmlns=\""+l.NS.JINGLE_RTP+"\"]").text();e&&this.conn.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e})),this.account.sendIQ(r)}if(n.length){if(n.attr("sid")!==this.get("session_id"))return;let e=n.find("candidate");e.length&&this.conn.addIceCandidate(new RTCIceCandidate({candidate:e.text(),sdpMLineIndex:e.attr("sdpMLineIndex"),sdpMid:e.attr("sdpMid")})),this.account.sendIQ(r)}if(s.length){let e=s.attr("id");if(e===this.get("session_id")){let e=s.attr("state");"enable"===e&&this.set("video_in",!0),"disable"===e&&this.set("video_in",!1)}this.account.sendIQ(r)}},startCall:function(){this.set("call_initiator",this.account.get("jid")),this.createAudioStream(),this.get("video_live")&&this.createVideoStream(),this.propose()},createAudioStream:function(){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){this.local_stream=e,this.$local_video[0].srcObject=e;let t=this.initVideoTrack();this.local_stream.addTrack(t),this.conn.addTrack(t,this.local_stream),e.getAudioTracks().forEach(e=>this.conn.addTrack(e,this.local_stream))}.bind(this))},createVideoStream:function(){navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){this.$local_video[0].srcObject=e,e.getVideoTracks().forEach(function(e){this.local_stream.addTrack(e),this.conn.addTrack(e,this.local_stream),this.conn.getSenders().find(e=>!e.track||e.track&&"video"===e.track.kind).replaceTrack(e)}.bind(this))}.bind(this))},stopTracks:function(){this.local_stream&&this.local_stream.getTracks().forEach(function(e){e.stop(),this.local_stream.removeTrack(e)}.bind(this))},propose:function(){this.updateStatus("Search...");let e=r({from:this.account.get("jid"),type:"chat",to:this.contact.get("jid")}).c("propose",{xmlns:l.NS.JINGLE_MSG,id:this.get("session_id")}).c("description",{xmlns:l.NS.JINGLE_RTP,media:"audio"}).up().up().c("store",{xmlns:l.NS.HINTS}).up().c("markable").attrs({xmlns:l.NS.CHAT_MARKERS}).up().c("body").t("You have received a voice call. If your are seing this, your client probably does not support this functionality. For more information, see https://xabber.com/voice/").up().c("origin-id",{id:m(),xmlns:"urn:xmpp:sid:0"});this.account.sendMsg(e)},accept:function(){let e=r({from:this.account.get("jid"),type:"chat",to:this.get("contact_full_jid")||this.contact.get("jid")}).c("accept",{xmlns:l.NS.JINGLE_MSG,id:this.get("session_id")}).up().c("store",{xmlns:l.NS.HINTS}).up().c("markable").attrs({xmlns:l.NS.CHAT_MARKERS}).up().c("origin-id",{id:m(),xmlns:"urn:xmpp:sid:0"});this.set("jingle_start",p.now()),this.account.sendMsg(e),a.stopAudio(this.audio_notifiation),this.set("status","connecting"),this.updateStatus("Connecting..."),this.audio_notifiation=a.playAudio("connecting",!0)},reject:function(){if("disconnected"!==this.get("status")&&"disconnecting"!==this.get("status")){let t=r({from:this.account.get("jid"),type:"chat",to:this.contact.get("jid")}).c("reject",{xmlns:l.NS.JINGLE_MSG,id:this.get("session_id")});if(this.get("jingle_start")){let a=p.now(),i=e((a-this.get("jingle_start"))/1e3);t.c("call",{initiator:this.get("call_initiator"),start:p(this.get("jingle_start")).format(),end:p(a).format(),duration:i}).up()}t.up().c("store",{xmlns:l.NS.HINTS}).up().c("markable").attrs({xmlns:l.NS.CHAT_MARKERS}).up().c("origin-id",{id:m(),xmlns:"urn:xmpp:sid:0"}),this.account.sendMsg(t),this.createSystemMessage(t),this.set("status","disconnected"),this.destroy(),a.current_voip_call=null}},createSystemMessage:function(e){let t=d(e.nodeTree),a=this.account.chats.getChat(this.contact),i=t.find("call").attr("end");if(i){let e=t.find("call").attr("duration"),i=t.find("call").attr("initiator");a.messages.createSystemMessage({from_jid:this.account.get("jid"),session_id:t.find("reject").attr("id"),message:(i&&i===this.account.get("jid")?"Outgoing":"Incoming")+" call ("+o.pretty_duration(e)+")"})}else a.messages.createSystemMessage({from_jid:this.account.get("jid"),session_id:t.find("reject").attr("id"),message:"Cancelled call"})},initVideoTrack:function(){let e=Object.assign(document.createElement("canvas"),{width:320,height:240}),t=e.getContext("2d");t.fillRect(0,0,e.width,e.height);let a=t.getImageData(0,0,e.width,e.height);return requestAnimationFrame(function e(){for(var n=0;n<a.data.length;n++)a.data[n++]=a.data[n++]=a.data[n++]=1;t.putImageData(a,0,0),requestAnimationFrame(e)}),u.extend(e.captureStream(60).getTracks()[0],{default:!0})},initSession:function(){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){this.local_stream=e,this.$local_video[0].srcObject=e;let t=this.initVideoTrack();return this.local_stream.addTrack(t),this.conn.addTrack(t,this.local_stream),e.getAudioTracks().forEach(e=>this.conn.addTrack(e,this.local_stream)),this.conn.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})}.bind(this)).then(function(e){this.set("session_initiator",this.account.get("jid")),this.conn.setLocalDescription(e).then(function(){let t=e.sdp,a=c({from:this.account.get("jid"),to:this.get("contact_full_jid"),type:"set"}).c("jingle",{xmlns:l.NS.JINGLE,action:"session-initiate",initiator:this.account.get("jid"),sid:this.get("session_id")}).c("content",{creator:"initiator",name:"voice"}).c("description",{xmlns:l.NS.JINGLE_RTP,media:"audio"}).c("sdp").t(t).up().up().c("security",{xmlns:l.NS.JINGLE_SECURITY_STUB});this.account.sendIQ(a)}.bind(this))}.bind(this))},sendCandidate:function(e){let t=c({from:this.account.get("jid"),to:this.get("contact_full_jid"),type:"set"}).c("jingle",{xmlns:l.NS.JINGLE,action:"session-info",initiator:this.get("session_initiator"),sid:this.get("session_id")}).c("content",{creator:"initiator",name:"voice"}).c("description",{xmlns:l.NS.JINGLE_RTP,media:"audio"}).up().c("transport",{xmlns:l.NS.JINGLE_TRANSPORTS_ICE}).c("candidate",{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid}).t(e.candidate);this.account.sendIQ(t)},acceptSession:async function(){this.set("session_initiator",this.contact.get("jid")),this.conn.createAnswer().then(function(e){this.conn.setLocalDescription(e).then(function(){let t=e.sdp,a=c({from:this.account.get("jid"),to:this.get("contact_full_jid"),type:"set"}).c("jingle",{xmlns:l.NS.JINGLE,action:"session-accept",initiator:this.contact.get("jid"),sid:this.get("session_id")}).c("content",{creator:"initiator",name:"voice"}).c("description",{xmlns:l.NS.JINGLE_RTP,media:"audio"}).c("sdp").t(t).up().up().c("security",{xmlns:l.NS.JINGLE_SECURITY_STUB});this.account.sendIQ(a)}.bind(this))}.bind(this))}}),a.Chat=Backbone.Model.extend({defaults:{opened:!0,active:!1,display:!1,displayed_sent:!1,last_displayed_id:0,last_delivered_id:0,unread:0,timestamp:0,const_unread:0},initialize:function(e,t){this.contact=t.contact,this.account=this.contact.account;var i=this.contact.get("jid");this.set({id:this.contact.hash_id,jid:i}),this.message_retraction_version=0,this.contact.set("muted",u.contains(this.account.chat_settings.get("muted"),i)),this.contact.set("archived",u.contains(this.account.chat_settings.get("archived"),i)),this.messages=new a.Messages(null,{account:this.account}),this.messages_unread=new a.Messages(null,{account:this.account}),this.item_view=new a.ChatItemView({model:this}),this.contact.on("destroy",this.onContactDestroyed,this),this.on("get_retractions_list",this.getAllMessageRetractions,this)},recountUnread:function(){this.set("unread",this.messages_unread.length),this.contact.get("archived")&&this.contact.get("muted")||a.toolbar_view.recountAllMessageCounter()},onContactDestroyed:function(){this.resetUnread(),this.destroy()},resetUnread:function(){var e=this.get("unread");0<e&&(this.set("unread",0),a.recountAllMessageCounter(e),a.toolbar_view.recountAllMessageCounter(e))},searchMessages:function(e){this.contact.messages_view=new a.SearchedMessagesView({contact:this.contact,query_text:e,model:this}),this.contact.messages_view.messagesRequest({},function(){a.body.setScreen("all-chats",{right:"searched_messages",contact:this.contact})}.bind(this))},sendDataForm:function(e,t){let a=e.get("data_form");if(!a)return;let i=r({type:"chat"});a.fields.forEach(function(e){"boolean"===e.type&&(e.var===t?e.values=[!0]:e.values=[!1])}.bind(this)),i=this.account.addDataFormToStanza(i,a),a.addresses.forEach(function(e){"replyto"===e.type&&d(i.nodeTree).attr("to",e.jid),this.account.sendMsg(i)}.bind(this))},setStanzaId:function(e,t){let a=this.messages.get(e);a.set("stanza_id",t),a.get("origin_id")||this.item_view.content.$(".chat-message[data-uniqueid=\""+t+"\"]").data("uniqueid",t)[0].setAttribute("data-uniqueid",t)},getCallingAvailability:function(e,t,a){let i=c({from:this.account.get("jid"),to:e,type:"get"}).c("query",{xmlns:l.NS.JINGLE_MSG}).c("session",{id:t});this.account.sendIQ(i,a)},sendReject:function(e){e||(e={});let t=e.to||this.contact.get("jid"),a=r({type:"chat",to:t}).c("reject",{xmlns:l.NS.JINGLE_MSG,id:e.session_id}).up().c("store",{xmlns:l.NS.HINTS}).up().c("markable").attrs({xmlns:l.NS.CHAT_MARKERS}).up().c("origin-id",{id:m(),xmlns:"urn:xmpp:sid:0"});this.account.sendMsg(a)},initIncomingCall:function(e,t){return a.get("audio")?void(a.current_voip_call=new a.JingleMessage({contact_full_jid:e,session_id:t},{contact:this.contact}),a.current_voip_call.modal_view.show({status:"in"}),a.current_voip_call.set("call_initiator",this.contact.get("jid"))):void this.messages.createSystemMessage({from_jid:this.account.get("jid"),message:"Incoming call. You have no required devices to answer"})},endCall:function(e){e&&a.current_voip_call.set("status",e),a.current_voip_call.destroy(),a.current_voip_call=null},getAllMessageRetractions:function(){var e=c({from:this.account.connection.jid,type:"set",to:this.contact.get("jid")}).c("activate",{xmlns:l.NS.REWRITE,version:this.message_retraction_version});this.account.sendIQ(e)},receiveMessage:function(e,t){var i=l.getBareJidFromJid(e.attr("from")),s=t.carbon_copied,r=e.children("[xmlns=\""+l.NS.CHAT_MARKERS+"\"]"),m=e.children("request[xmlns=\""+l.NS.RECEIPTS+"\"]"),g=e.children("received[xmlns=\""+l.NS.RECEIPTS+"\"]"),h=e.children("propose[xmlns=\""+l.NS.JINGLE_MSG+"\"]"),v=e.children("accept[xmlns=\""+l.NS.JINGLE_MSG+"\"]"),A=e.children("reject[xmlns=\""+l.NS.JINGLE_MSG+"\"]");if(h.length){if(s&&i==this.account.get("jid"))return void(a.current_voip_call&&this.sendReject({to:l.getBareJidFromJid(e.attr("to")),session_id:h.attr("id")}));if(t.is_archived||t.synced_msg)return;else{let t=h.attr("id"),i=e.attr("from");this.getCallingAvailability(i,t,function(){return a.current_voip_call?(this.sendReject({session_id:t}),void this.messages.createSystemMessage({from_jid:this.account.get("jid"),message:"Cancelled call"})):void this.initIncomingCall(i,t)}.bind(this))}}if(v.length){if(t.is_archived||t.synced_msg)return;if(a.current_voip_call&&a.current_voip_call.get("session_id")===v.attr("id"))if(s)this.endCall();else{a.current_voip_call.get("state")||a.current_voip_call.set("state",n.JINGLE_MSG_ACCEPT);let t=v.find("time").attr("stamp");t=t?+p(t):p.now(),a.current_voip_call.set("jingle_start",t),a.current_voip_call.get("contact_full_jid")||a.current_voip_call.set("contact_full_jid",e.attr("from")),a.stopAudio(a.current_voip_call.audio_notifiation),a.current_voip_call.set("status","connecting"),a.current_voip_call.updateStatus("Connecting..."),a.current_voip_call.audio_notifiation=a.playAudio("connecting")}}if(A.length){if(this.messages.filter(e=>e.get("session_id")===A.attr("id")).length)return;let i=t.delay&&t.delay.attr("stamp")||e.find("delay").attr("stamp")||e.find("time").attr("stamp"),n="",s;if(A.children("call").length){let e=A.children("call").attr("duration"),t=A.children("call").attr("initiator");n=(t&&t===this.account.get("jid")?"Outgoing":"Incoming")+" call ("+o.pretty_duration(e)+")"}else n="Cancelled call";if(s=this.messages.createSystemMessage({from_jid:this.account.get("jid"),time:i,session_id:A.attr("id"),stanza_id:t.stanza_id,message:n}),t.is_archived||t.synced_msg)return s;if(a.current_voip_call&&a.current_voip_call.get("session_id")===A.attr("id")){a.stopAudio(a.current_voip_call.audio_notifiation);let e=a.playAudio("busy");setTimeout(function(){a.stopAudio(e)}.bind(this),1500),this.endCall("disconnected")}return s}if(!t.is_archived){var f,b;e.children("stanza-id").each(function(t,a){a=d(a),e.children("x[xmlns=\""+l.NS.GROUP_CHAT+"\"]").length?a.attr("by")===i?(!f&&(f=a),b=a):f=a:a.attr("by")===i?b=a:f=a}.bind(this)),f&&(t.stanza_id=f.attr("id")),b&&(t.contact_stanza_id=b.attr("id"))}if(r.length){var x=r[0].tagName.toLowerCase();if("markable"!==x||t.is_mam||t.is_archived||s||t.synced_msg&&(!t.synced_msg||!t.is_unread)||this.sendMarker(e.attr("id"),"received",t.stanza_id,t.contact_stanza_id),"markable"!==x&&!s)return void this.receiveMarker(e,x,s);"displayed"===x&&s&&this.receiveCarbonsMarker(r)}if(!m.length||t.is_mam||t.is_archived||s||t.synced_msg&&(!t.synced_msg||!t.is_unread)||this.sendDeliveryReceipt(e),g.length&&this.receiveDeliveryReceipt(e),!e.find("body").length||h.length||v.length||A.length){var w=a.chats_view.child(this.contact.hash_id);return void(w&&w.content&&w.content.receiveNoTextMessage(e,s))}if(e.find("invite").length){if(i===this.account.get("jid"))return;let a=e.find("invite").attr("jid")||e.find("message").attr("from"),n=this.account.contacts.get(a);if(n&&"both"==n.get("subscription"))return;var C=c({type:"get"}).c("blocklist",{xmlns:l.NS.BLOCKING});this.account.sendIQ(C,function(i){var n=d(i).find("item"),s=+p(e.find("delay").attr("stamp")||e.find("time").attr("stamp")||t.delay&&+p(t.delay.attr("stamp"))||p.now()),o=!1,c;if(0<n.length&&n.each(function(e,t){let i=d(t),n=i.attr("jid"),s="";if(-1<n.indexOf(a)){if(o=!0,s=n.substr(n.lastIndexOf("/")+1,n.length-a.length),!s)return c="",!1;(!c||c<s)&&(c=s)}}.bind(this)),u.isUndefined(c)||c&&c<s)return this.messages.createInvitationFromStanza(e,t)}.bind(this),function(){return this.messages.createInvitationFromStanza(e,t)}.bind(this))}else return this.messages.createFromStanza(e,t)},getMessageContext:function(e,t){t=t||{};let i=t.mention&&this.account.messages||t.seached_messages&&this.account.searched_messages||t.message&&a.all_searched_messages||this.account.messages,n=i.get(e);if(n){let e=n.get("stanza_id");this.contact.messages_view=new a.MessageContextView({contact:this.contact,mention_context:t.mention,model:this,stanza_id_context:e}),this.account.context_messages.add(n),this.contact.messages_view.messagesRequest({after:e},function(){t.mention?a.body.setScreen("mentions",{right:"message_context",contact:this.contact}):t.message?a.body.setScreen(a.body.screen.get("name"),{right:"message_context",contact:this.contact}):a.body.setScreen("all-chats",{right:"message_context",contact:this.contact})}.bind(this))}},sendDeliveryReceipt:function(e){var t=r({from:this.account.get("jid"),to:this.contact.get("jid"),type:"chat",id:m()}).c("received",{xmlns:l.NS.RECEIPTS,id:e.attr("id")});this.account.sendMsg(t)},sendMarker:function(e,t,a,i){t||(t="displayed");let n=r({from:this.account.jid,to:this.get("jid"),type:"chat",id:m()}).c(t).attrs({xmlns:l.NS.CHAT_MARKERS,id:e||a||i||""});a&&n.c("stanza-id",{xmlns:"urn:xmpp:sid:0",id:a,by:this.account.get("jid")}).up(),i&&n.c("stanza-id",{xmlns:"urn:xmpp:sid:0",id:i,by:this.contact.get("jid")}).up(),this.account.sendMsg(n)},receiveMarker:function(e){var t=e.find("displayed"),a=e.find("received"),i="error"===e.attr("type");if(!i&&(t.length||a.length)){var s=t.attr("id")||a.attr("id"),d=t.find("stanza-id[by=\""+this.account.get("jid")+"\"]").attr("id")||a.find("stanza-id[by=\""+this.account.get("jid")+"\"]").attr("id"),c=this.account.messages.find(e=>e.get("stanza_id")===d||e.get("contact_stanza_id")===d||e.get("msgid")===s);if(c)if(!c.isSenderMe())c.set("is_unread",!1);else if(a.length){let e=c.get("state");if(e!==n.MSG_DISPLAYED){let e=a.children("time").attr("stamp");e&&(c.set("time",o.pretty_datetime(e)),c.set("timestamp",+e))}this.setMessagesDelivered(c.get("timestamp"))}else this.setMessagesDisplayed(c.get("timestamp"))}},setMessagesDelivered:function(e){e||(e=p.now());let t=this.messages.filter(t=>t.isSenderMe()&&t.get("timestamp")<=e&&t.get("state")>n.MSG_PENDING&&t.get("state")<n.MSG_DELIVERED);t.forEach(e=>e.set("state",n.MSG_DELIVERED))},setMessagesDisplayed:function(e){e||(e=p.now());let t=this.messages.filter(t=>t.isSenderMe()&&t.get("timestamp")<=e&&t.get("state")>n.MSG_PENDING&&t.get("state")<n.MSG_DISPLAYED);t.forEach(e=>e.set("state",n.MSG_DISPLAYED))},receiveCarbonsMarker:function(e){let t=e.children("stanza-id[by=\""+this.account.get("jid")+"\"]").attr("id"),a=e.attr("id"),n=this.messages.find(e=>e.get("stanza_id")===t||e.get("contact_stanza_id")===t||e.get("msgid")===a),s;if(n&&(s=this.messages.indexOf(n)),-1<s){this.set("const_unread",0);for(var o=s;0<=o;o--){let e=this.messages.models[o];e.set("is_unread",!1)}}else{let e=this.messages_unread.find(e=>e.get("stanza_id")===t||e.get("contact_stanza_id")===t||e.get("msgid")===a);e&&e.set("is_unread",!1)}},receiveDeliveryReceipt:function(e){var t=e.find("received"),a=t.attr("id"),i=t.children("stanza-id[by=\""+this.account.get("jid")+"\"]").attr("id"),s=this.account.messages.get(a||i);!s||s.isSenderMe()&&s.set("state",n.MSG_DELIVERED)},onPresence:function(e){var t=this.get("jid");this.contact.get("group_chat")||("subscribe_from"===e?this.messages.createSystemMessage({from_jid:this.account.get("jid"),message:"Subscription request sent"}):"subscribe"===e?this.messages.createSystemMessage({from_jid:t,auth_request:!0,message:"Incoming subscription request"}):"subscribed"==e&&this.messages.createSystemMessage({from_jid:t,message:this.contact.get("name")+" added to your contacts"}))},onRosterPush:function(e){let t=this.get("jid");"remove"===e&&this.messages.createSystemMessage({from_jid:t,silent:!1,message:"Contact deleted"})},retractMessages:function(e,t,a){let i=0,n=e.length,s=new d.Deferred;s.done(function(t){0===t?o.dialogs.error("You have no permission to delete messages"):t!==e.length&&o.dialogs.error("You have no permission to delete some messages")}.bind(this)),d(e).each(function(o,r){let p=r.get("stanza_id"),u=r.get("contact_stanza_id");if(p||u){let o=c({type:"set",from:this.account.get("jid"),to:t?this.contact.get("jid"):this.account.get("jid")}).c("retract-message",{id:this.contact.get("group_chat")&&u||p,xmlns:l.NS.REWRITE,symmetric:a,by:this.account.get("jid")});this.account.sendIQ(o,function(){this.item_view.content.removeMessage(r),i++,i===e.length&&s.resolve(n)}.bind(this),function(t){i++,d(t).find("not-allowed").length&&n--,i===e.length&&s.resolve(n)}.bind(this))}}.bind(this))},retractMessagesByUser:function(e){var t=c({type:"set",to:this.contact.get("jid")}).c("retract-user",{id:e,xmlns:l.NS.REWRITE,symmetric:!0});this.account.sendIQ(t,function(){var t=this.messages.filter(t=>t.get("user_info")&&t.get("user_info").id==e);d(t).each(function(e,t){this.item_view.content.removeMessage(t)}.bind(this))}.bind(this),function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to delete user messages")}.bind(this))},retractAllMessages:function(e,t,a){let i=this.contact.get("group_chat"),n=c({type:"set",from:this.account.get("jid"),to:i?this.contact.get("jid"):this.account.get("jid")}),s={xmlns:l.NS.REWRITE,symmetric:e};i||(s.conversation=this.contact.get("jid")),n.c("retract-all",s),this.account.sendIQ(n,function(){var e=this.messages.models;d(e).each(function(e,t){this.item_view.content.removeMessage(t)}.bind(this)),t&&t()}.bind(this),function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to clear message archive"),a&&a()}.bind(this))},showBlockedRequestMessage:function(){this.messages.length&&this.messages.createSystemMessage({from_jid:this.account.get("jid"),message:"Contact blocked",time:this.messages.last().get("time")})},deleteFromSynchronization:function(e,t){let a=c({from:this.account.get("jid"),type:"set",to:this.account.get("jid")}).c("delete",{xmlns:l.NS.SYNCHRONIZATION}).c("conversation",{jid:this.get("jid")});this.account.sendIQ(a,function(t){e&&e(t)}.bind(this),function(e){t&&t(e)})}}),a.ChatItemView=a.BasicView.extend({className:"chat-item list-item",template:s.chat_item,avatar_size:n.AVATAR_SIZES.CHAT_ITEM,events:{click:"openByClick"},_initialize:function(){this.account=this.model.account,this.contact=this.model.contact,this.$el.attr("data-id",this.model.id),this.content=new a.ChatContentView({chat_item:this}),this.updateName(),this.updateStatus(),this.updateCounter(),this.updateAvatar(),this.updateMutedState(),this.updateArchivedState(),this.updateColorScheme(),this.updateIcon(),this.model.on("change:active",this.updateActiveStatus,this),this.model.on("change:unread",this.updateCounter,this),this.model.on("change:const_unread",this.updateCounter,this),this.model.on("open",this.open,this),this.model.on("remove_opened_chat",this.onClosed,this),this.model.messages.on("destroy",this.onMessageRemoved,this),this.contact.on("change:name",this.updateName,this),this.contact.on("change:status",this.updateStatus,this),this.contact.on("change:private_chat",this.updateIcon,this),this.contact.on("change:incognito_chat",this.updateIcon,this),this.contact.on("change:image",this.updateAvatar,this),this.contact.on("change:blocked",this.onBlocked,this),this.contact.on("change:muted",this.updateMutedState,this),this.contact.on("change:archived",this.updateArchivedState,this),this.contact.on("change:group_chat",this.updateGroupChats,this),this.contact.on("change:in_roster",this.updateAcceptedStatus,this),this.contact.on("remove_invite",this.removeInvite,this),this.account.settings.on("change:color",this.updateColorScheme,this)},updateName:function(){this.$(".chat-title").text(this.contact.get("name"))},updateStatus:function(){var e=this.contact.get("status");this.$(".status").attr("data-status",e),this.$(".chat-icon").attr("data-status",e)},updateActiveStatus:function(){this.$el.switchClass("active",this.model.get("active"))},updateAcceptedStatus:function(){let e=this.contact.get("in_roster");e&&this.model.set("is_accepted",!0)},onBlocked:function(){this.updateIcon(),this.$el.switchClass("blocked",this.contact.get("blocked"))},updateCounter:function(){var e=this.model.get("unread")+this.model.get("const_unread");this.$(".msg-counter").showIf(e).text(e||"")},updateAvatar:function(){var e=this.contact.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateIcon:function(){this.$(".chat-icon").addClass("hidden");let e=this.contact.getIcon();e&&this.$(".chat-icon").removeClass("hidden").children("svg").html(i.templates.svg[e]())},updateMutedState:function(){let e=this.contact.get("muted");this.$(".msg-counter").switchClass("muted-chat-counter",e),this.$(".muted-icon").showIf(e)},updateArchivedState:function(){let e=this.contact.get("archived");(e||!e&&a.toolbar_view.$(".active").hasClass("archive-chats"))&&this.$el.detach(),(e&&a.toolbar_view.$(".active").hasClass("archive-chats")||!e&&!a.toolbar_view.$(".active").hasClass("archive-chats"))&&a.chats_view.updateChatPosition(this.model)},updateGroupChats:function(){var e=this.contact.get("group_chat");this.$(".status").hideIf(e),this.$(".chat-icon").showIf(e),this.updateIcon(),e&&(this.$el.addClass("group-chat"),this.$(".chat-title").css("color","#424242"),this.model.set("group_chat",!0))},updateColorScheme:function(){var e=this.account.settings.get("color");this.$el.attr("data-color",e),this.content.$el.attr("data-color",e),this.content.head.$el.attr("data-color",e),this.content.bottom.$el.attr("data-color",e)},onMessageRemoved:function(e){if(this.model.last_message===e){for(var t=this.model.messages.length-1,a;0<=t&&(a=this.model.messages.at(t),!!a.get("silent"));t--);this.model.last_message=a,this.updateLastMessage()}},updateEmptyChat:function(){let e=this.model.get("timestamp");this.$(".last-msg").html("No messages".italics()),this.$(".last-msg-date").text(o.pretty_short_datetime(e)).attr("title",o.pretty_datetime(e))},updateLastMessage:function(e){if(e||(e=this.model.last_message),!e)return void(this.model.messages.length||this.$(".last-msg").html("No messages".italics()));let t=e.get("time"),a=e.get("timestamp"),i="",s=e.get("forwarded_message"),c=e.get("files")||[],r=e.get("images")||[],l=s?e.get("message")||(1<s.length?s.length+" forwarded messages":"Forwarded message").italics():e.getText(),p=e.get("user_info")||e.isSenderMe()&&this.contact.my_info&&this.contact.my_info.attributes||{};if(this.model.set({timestamp:a}),this.contact.get("group_chat")&&(i=p.nickname||p.jid||(e.isSenderMe()?this.account.get("name"):e.get("from_jid"))||""),i&&(i=d("<span class=text-color-700/>").text(i+": ")),c.length||r.length){let e=d("<span class=\"text-color-500\"/>");c.length&&r.length?l=e.text(c.length+r.length+" files"):(1<c.length&&(l=e.text(c.length+" files")),1==c.length&&(l=e.text(c[0].is_audio||c[0].voice?"Voice message, "+o.pretty_duration(c[0].duration):c[0].name)),1<r.length&&(l=e.text(r.length+" images")),1==r.length&&(l=e.text(r[0].name))),this.$(".last-msg").html("").append(i).append(l)}else{if("system"==e.get("type"))i="",e.get("invite")&&(l="Invitation to group chat"),e.get("private_invite")&&(l="Invitation to private chat"),l=this.contact.get("group_chat")?d("<i/>").text(l):d("<span class=text-color-500/>").text(l),this.$(".last-msg").html(l);else if(!s)l=e.getText(),this.$(".last-msg").text(l);else if(e.get("message"))l=e.get("message"),this.$(".last-msg").text(l);else{let e=s[0];if(e.get("message")){let t=e.get("user_info")||{};i=t.nickname||t.jid||"",l=e.get("message"),this.$(".last-msg").text(l),i&&(i=d("<span class=text-color-700/>").text(i+": "))}else l=d("<i/>").text(1<s.length?s.length+" forwarded messages":"Forwarded message"),this.$(".last-msg").html(l)}this.$(".last-msg").prepend(i)}this.$el.emojify(".last-msg",{emoji_size:16}).hyperlinkify({decode_uri:!0}),this.$(".last-msg-date").text(o.pretty_short_datetime_recent_chat(t)).attr("title",o.pretty_datetime(t)),this.$(".msg-delivering-state").showIf("system"!==e.get("type")&&e.isSenderMe()&&e.get("state")!==n.MSG_ARCHIVED).attr("data-state",e.getState())},openByClick:function(){this.open()},open:function(e){e||(e={clear_search:!1}),a.chats_view.openChat(this,e)},removeInvite:function(e){e||(e={});let t=u.clone(this.model.messages.models);this.model.set({last_archive_id:void 0,first_archive_id:void 0}),t.forEach(function(e){if(e.get("invite")){let t=c({type:"set",from:this.account.get("jid"),to:this.account.get("jid")}).c("retract-message",{id:this.contact.get("group_chat")&&e.get("contact_stanza_id")||e.get("stanza_id"),xmlns:l.NS.REWRITE,symmetric:!1,by:this.account.get("jid")});this.account.sendIQ(t),e&&this.content.removeMessage(e)}}.bind(this)),this.model.recountUnread(),delete this.contact.attributes.invitation,this.updateIcon()},onClosed:function(){this.parent.onChatRemoved(this.model,{soft:!0})}}),a.MessagesView=a.BasicView.extend({template:s.chat_content,ps_selector:".chat-content",ps_settings:{wheelPropagation:!0},avatar_size:n.AVATAR_SIZES.CHAT_MESSAGE,_initialize:function(e){this.model=e.model,this.contact=e.contact,this.account=this.contact.account,this.chat=this.account.chats.get(this.contact.hash_id);let t=this.account.settings.get("color");this.$el.attr("data-color",t),this.$search_form=this.$(".search-form-header"),this.loading_history=!1,this.history_loaded=!1,this.first_msg_id=0,this.last_msg_id=0,this._scrolltop=this.getScrollTop(),this.ps_container.on("ps-scroll-up ps-scroll-down",this.onScroll.bind(this)),this.chat_content=e.chat_content||this.account.chats.get(this.contact.hash_id).item_view.content;let a=this.defineMouseWheelEvent();this.$el.on(a,this.onMouseWheel.bind(this)),this.$(".back-to-bottom").click(this.backToBottom.bind(this))},defineMouseWheelEvent:function(){return u.isUndefined(window.onwheel)?u.isUndefined(window.onmousewheel)?"MozMousePixelScroll":"mousewheel":"wheel"},keyupSearch:function(e){if(e.keyCode===n.KEY_ENTER){let e=this.$search_form.find("input").val();this.chat.searchMessages(e,function(){}.bind(this))}e.keyCode===n.KEY_ESCAPE&&this.chat_content.head.renderSearchPanel()},onMouseWheel:function(){this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onClickMessage:function(e){this.chat_content.onClickMessage(e)},onClickLink:function(e){this.chat_content.onClickLink(e)},onScroll:function(){this.$(".back-to-bottom").hideIf(this.isScrolledToBottom()),this._prev_scrolltop=this._scrolltop||0,this._scrolltop=this.getScrollTop(),!this.history_loaded&&!this.loading_history&&this._scrolltop<this._prev_scrolltop&&(100>this._scrolltop||.1>this.getPercentScrolled())&&(this.loading_history=!0,this.messagesRequest({before:this.first_msg_id},function(){this.loading_history=!1}.bind(this)))},backToBottom:function(){this.scrollToBottom(),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},messagesRequest:function(){},emptyChat:function(){this.$(".chat-content").html(d("<span class=\"error\"/>").text("No messages"))},openChat:function(){this.contact.trigger("open_chat",this.contact)},addMessageHTML:function(e,t,a){let i=this.getScrollBottom(),n;0===t?e.prependTo(this.$(".chat-content")):e.insertAfter(this.$(".chat-message").eq(t-1)),t===a&&(n=this.getScrollTop());let s=e.nextAll(".chat-message").first();return this.chat_content.updateMessageInChat(e[0]),s.length&&this.chat_content.updateMessageInChat(s[0]),this.chat_content.initPopup(e),n?this.scrollTo(n):this.scrollTo(this.ps_container[0].scrollHeight-this.ps_container[0].offsetHeight-i),e}}),a.MessageContextView=a.MessagesView.extend({className:"chat-content-wrap messages-context-wrap",events:{"click .chat-message":"onClickMessage","click .mdi-link-variant":"onClickLink","keyup .messages-search-form":"keyupSearch"},__initialize:function(e){e=e||{},this.stanza_id=e.stanza_id_context,this.mention_context=e.mention_context,this.$history_feedback=this.$(".load-history-feedback"),this.account.context_messages=new a.Messages(null,{account:this.account}),this.account.context_messages.on("change:last_replace_time",this.chat_content.updateMessage,this),this.account.context_messages.on("add",this.addMessage,this)},render:function(){this.scrollToTop(),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onMouseWheel:function(e){this.loading_history||(0>e.originalEvent.deltaY?!this.first_history_loaded&&(this.loading_history=!0,this.messagesRequest({before:this.first_msg_id},function(){this.loading_history=!1}.bind(this))):!this.last_history_loaded&&(this.loading_history=!0,this.messagesRequest({after:this.last_msg_id},function(){this.loading_history=!1}.bind(this)))),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onScroll:function(){this.$(".back-to-bottom").hideIf(this.isScrolledToBottom()),this._prev_scrolltop=this._scrolltop||0,this._scrolltop=this.getScrollTop(),this._scrollbottom=this.getScrollBottom(),this.loading_history||(!this.first_history_loaded&&this._scrolltop<this._prev_scrolltop&&(100>this._scrolltop||.1>this.getPercentScrolled())?(this.loading_history=!0,this.showHistoryFeedback(),this.messagesRequest({before:this.first_msg_id},function(){this.loading_history=!1,this.hideHistoryFeedback()}.bind(this))):!this.last_history_loaded&&this._scrolltop>this._prev_scrolltop&&(100>this._scrollbottom||.9<this.getPercentScrolled())&&(this.loading_history=!0,this.showHistoryFeedback(),this.messagesRequest({after:this.last_msg_id},function(){this.loading_history=!1,this.hideHistoryFeedback()}.bind(this))))},showHistoryFeedback:function(){this.$history_feedback.text("Loading history...").removeClass("hidden")},hideHistoryFeedback:function(){this.$history_feedback.addClass("hidden")},messagesRequest:function(e,t){let i=[],n=e||{},s=m();n.max||(n.max=a.settings.mam_messages_limit),n.after||n.before||(n.before="");let o=this.account.connection.addHandler(function(e){let t=d(e);return t.find("result").attr("queryid")===s&&i.push(e),!0}.bind(this),l.NS.MAM);this.chat_content.MAMRequest(n,function(e,a,i){this.account.connection.deleteHandler(o),i&&(this.first_msg_id=i.first)&&(this.last_msg_id=i.last),n.after&&a.length<n.max&&(this.last_history_loaded=!0),n.before&&a.length<n.max&&(this.first_history_loaded=!0),d(a).each(function(e,t){let a=d(t);this.account.chats.receiveChatMessage(a,{context_message:!0})}.bind(this)),t&&t()}.bind(this),function(){this.account.connection.deleteHandler(o)}.bind(this))},addMessage:function(e){if(e.get("auth_request"))return;this.mention_context&&e.get("stanza_id")===this.stanza_id||e.set("is_archived",!0);let t=this.chat_content.buildMessageHtml(e).addClass("context-message"),a=this.account.context_messages.indexOf(e);e.get("stanza_id")===this.stanza_id&&(t.addClass("message-from-context"),setTimeout(function(){t.removeClass("message-from-context")}.bind(this),3e3)),this.addMessageHTML(t,a,this.account.context_messages.findLastIndex())}}),a.SearchedMessagesView=a.MessagesView.extend({className:"chat-content-wrap searched-messages-wrap",events:{"click .chat-message":"onClickMessage","click .mdi-link-variant":"onClickLink","click .btn-cancel-searching":"openChat","keyup .messages-search-form":"keyupSearch"},__initialize:function(e){return this.query_text=e.query_text,this.account.searched_messages=new a.Messages(null,{account:this.account}),this.account.searched_messages.on("change:last_replace_time",this.chat_content.updateMessage,this),this.account.searched_messages.on("add",this.addMessage,this),this},render:function(){this.$search_form.find("input").val(this.query_text),this.$search_form.slideToggle(10,function(){"none"!==this.$search_form.css("display")&&this.$search_form.find("input").focus(),this.scrollToBottom()}.bind(this)),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},messagesRequest:function(e,t){let i=[],n=e||{},s=m();u.extend(n,{max:a.settings.mam_messages_limit,before:e.before||"",var:[{var:"withtext",value:this.query_text}]});let o=this.account.connection.addHandler(function(e){let t=d(e);return t.find("result").attr("queryid")===s&&i.push(e),!0}.bind(this),l.NS.MAM);this.chat_content.MAMRequest(n,function(e,a,i){this.account.connection.deleteHandler(o),i&&(this.first_msg_id=i.first),a.length||this.account.searched_messages.length||this.emptyChat(),a.length<n.max&&(this.history_loaded=!0),d(a).each(function(e,t){let a=d(t);this.account.chats.receiveChatMessage(a,{searched_message:!0})}.bind(this)),t&&t()}.bind(this),function(){this.account.connection.deleteHandler(o)}.bind(this))},addMessage:function(e){if(!e.get("auth_request")){e.set("is_archived",!0);let t=this.chat_content.buildMessageHtml(e).addClass("searched-message"),a=this.account.searched_messages.indexOf(e);this.addMessageHTML(t,a)}}}),a.ParticipantMessagesView=a.MessagesView.extend({className:"chat-content-wrap participant-messages-wrap",events:{"click .chat-message":"onClickMessage","click .mdi-link-variant":"onClickLink","click .btn-cancel-selection":"openChat","click .btn-retract-messages":"retractMessages","keyup .messages-search-form":"keyupSearch"},__initialize:function(e){return this.participant=e.model,this.member_jid=this.participant.jid,this.member_id=this.participant.id,this.member_nickname=this.participant.nickname,this.account.participant_messages=new a.Messages(null,{account:this.account}),this.account.participant_messages.on("add",this.addMessage,this),this.account.participant_messages.on("change:last_replace_time",this.chat_content.updateMessage,this),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this)),this},render:function(){this.$(".chat-content").css("height","calc(100% - 32px)"),this.$(".participant-messages-header .messages-by-header .participant-nickname").text(this.member_nickname),this.$(".participant-messages-header").removeClass("hidden"),this.scrollToBottom(),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onScrollY:function(){},retractMessages:function(){o.dialogs.ask("Delete user messages","Delete all <span class=\""+this.account.settings.get("color")+"-text\">"+(this.member_nickname||this.member_jid||this.member_id)+"</span> messages in this group chat?",null,{ok_button_text:"delete"}).done(function(e){e&&this.member_id&&this.chat_content.model.retractMessagesByUser(this.member_id,function(){this.emptyChat()}.bind(this))}.bind(this))},messagesRequest:function(e,t){let i=[],n=e||{},s=this.member_id,o=m();u.extend(n,{max:a.settings.mam_messages_limit,before:e.before||"",var:[{var:"with",value:s}]});let c=this.account.connection.addHandler(function(e){let t=d(e);return t.find("result").attr("queryid")===o&&i.push(e),!0}.bind(this),l.NS.MAM);this.chat_content.MAMRequest(n,function(e,a,i){this.account.connection.deleteHandler(c),i&&(this.first_msg_id=i.first),a.length||this.account.participant_messages.length||this.emptyChat(),a.length<n.max&&(this.history_loaded=!0),d(a).each(function(e,t){let a=d(t);this.account.chats.receiveChatMessage(a,{participant_message:!0})}.bind(this)),t&&t()}.bind(this),function(){this.account.connection.deleteHandler(c)}.bind(this))},addMessage:function(e){if(!e.get("auth_request")){e.set("is_archived",!0);let t=this.chat_content.buildMessageHtml(e).addClass("participant-message"),a=this.account.participant_messages.indexOf(e);this.addMessageHTML(t,a)}}}),a.SubscriptionButtonsView=a.BasicView.extend({template:s.subscription_buttons,events:{"click .btn-decline":"declineSubscription","click .btn-allow":"allowSubscription","click .btn-add":"addContact","click .btn-subscribe":"addContact","click .btn-block":"blockContact"},_initialize:function(e){this.$el.html(this.template()),this.contact=e.contact,this.contact.on("change:subscription",this.render,this),this.contact.on("change:blocked",this.render,this),this.contact.on("change:subscription_request_in",this.render,this),this.contact.on("change:subscription_request_out",this.render,this)},render:function(){if(!this.contact.get("group_chat")){let e=this.contact.get("subscription"),t=this.contact.get("subscription_request_in"),a=this.contact.get("subscription_request_out");if(this.$(".button").removeClass("hidden"),this.$(".subscription-info").text(""),this.$el.addClass("hidden"),!("both"===e||this.contact.get("blocked"))){if("to"===e&&t||!e&&t&&a)this.$(".subscription-info").text("Contact asks permission to see your presence information"),this.$(".button:not(.btn-allow)").addClass("hidden");else if(!a&&!t&&("from"===e||u.isNull(e)))this.$(".subscription-info").text("Subscribe to see contact status information"),this.$(".button:not(.btn-subscribe)").addClass("hidden");else if(void 0===e||!e&&t)this.$(".button:not(.btn-add):not(.btn-block)").addClass("hidden");else return;this.$el.removeClass("hidden")}}},declineSubscription:function(){this.contact.declineSubscribe(),this.$el.addClass("hidden")},allowSubscription:function(){this.contact.acceptRequest(),this.$el.addClass("hidden")},addContact:function(){void 0===this.contact.get("subscription")?this.contact.pushInRoster(function(){this.sendAndAskSubscription()}.bind(this)):this.sendAndAskSubscription(),this.$el.addClass("hidden")},sendAndAskSubscription:function(){this.contact.acceptRequest(),this.contact.askRequest()},blockContact:function(){this.contact.blockRequest(),this.$el.addClass("hidden")}}),a.ChatContentView=a.BasicView.extend({className:"chat-content-wrap",template:s.chat_content,ps_selector:".chat-content",ps_settings:{wheelPropagation:!0},avatar_size:n.AVATAR_SIZES.CHAT_MESSAGE,events:{"mousedown .chat-message":"onTouchMessage","click .chat-message":"onClickMessage","click .mdi-link-variant":"onClickLink","click .pinned-message":"showPinnedMessage","keyup .messages-search-form":"keyupSearch","click .btn-cancel-searching":"cancelSearch","click .back-to-bottom":"backToBottom","click .btn-retry-send-message":"retrySendMessage"},_initialize:function(e){this.chat_item=e.chat_item,this.current_day_indicator=null,this.prev_audio_message,this._pending_avatars=[],this.account=this.chat_item.account,this.model=this.chat_item.model,this.contact=this.model.contact,this.head=new a.ChatHeadView({content:this}),this.bottom=new a.ChatBottomView({content:this}),this.subscription_buttons=new a.SubscriptionButtonsView({contact:this.contact,el:this.$(".subscription-buttons-wrap")[0]}),this.$history_feedback=this.$(".load-history-feedback"),this.$pinned_message=this.$(".pinned-message"),this.$search_form=this.$(".search-form-header"),this.$el.attr("data-id",this.model.id),this._scrolltop=this.getScrollTop();let t=this.defineMouseWheelEvent();return this.$el.on(t,this.onMouseWheel.bind(this)),this.ps_container.on("ps-scroll-up ps-scroll-down",this.onScroll.bind(this)),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this)),this.model.on("change:active",this.onChangedActiveStatus,this),this.model.on("load_last_history",this.loadLastHistory,this),this.model.on("get_missed_history",this.requestMissedMessages,this),this.model.messages.on("add",this.onMessage,this),this.model.messages.on("change:state",this.onChangedMessageState,this),this.model.messages.on("change:is_unread",this.onChangedReadState,this),this.model.messages.on("change:timestamp",this.onChangedMessageTimestamp,this),this.model.messages.on("change:last_replace_time",this.updateMessage,this),this.contact.on("change:blocked",this.updateBlockedState,this),this.contact.on("change:group_chat",this.updateGroupChat,this),this.contact.on("remove_from_blocklist",this.loadLastHistory,this),this.account.contacts.on("change:name",this.updateName,this),this.account.contacts.on("change:image",this.updateAvatar,this),this.account.on("change",this.updateMyInfo,this),this.account.dfd_presence.done(function(){this.account.connection.do_synchronization||this.loadLastHistory()}.bind(this)),this},defineMouseWheelEvent:function(){return u.isUndefined(window.onwheel)?u.isUndefined(window.onmousewheel)?"MozMousePixelScroll":"mousewheel":"wheel"},updateMyInfo:function(){let e=this.account.changed;u.has(e,"name")&&this.updateMyName(),u.has(e,"status")&&this.updateMyStatus(),u.has(e,"image")&&this.updateMyAvatar()},updateGroupChat:function(){this._loading_history=!1,this.model.set("history_loaded",!1)},render:function(){this.cancelSearch(),this.scrollToBottom(),this.onScroll(),this.updateContactStatus(),this.updatePinnedMessage(),this.subscription_buttons.render()},cancelSearch:function(){this.$search_form.hide().find("input").val("")},updateContactStatus:function(){if("offline"==this.head.$(".contact-status").attr("data-status")&&this.contact.get("last_seen")){var e=(p.now()-this.contact.get("last_seen"))/1e3,t=o.pretty_last_seen(e);this.contact.set({status_message:t})}},updatePinnedMessage:function(){let e=this.contact.get("pinned_message");this.contact.renderPinnedMessage(e,this.$pinned_message)},onChangedVisibility:function(){this.isVisible()?(this.model.set({display:!0,active:!0}),this.readMessages()):this.model.set({display:!1})},onChangedActiveStatus:function(){this.sendChatState(this.model.get("active")?"active":"inactive"),this.contact.get("group_chat")&&(this.model.get("active")?this.contact.sendPresent():this.contact.sendNotPresent())},updateName:function(e){var t=e.get("name"),a=e.get("jid");e===this.contact?this.$(".chat-message.with-author[data-from=\""+a+"\"]").each(function(){d(this).find(".chat-msg-author").text(t)}):this.$(".fwd-message.with-author[data-from=\""+a+"\"]").each(function(){d(this).find(".fwd-msg-author").text(t)})},updateAvatar:function(e){var t=e.cached_image,a=e.get("jid");e===this.contact?this.$(".chat-message.with-author[data-from=\""+a+"\"]").each(function(){d(this).find(".left-side .circle-avatar").setAvatar(t,this.avatar_size)}):this.$(".fwd-message.with-author[data-from=\""+a+"\"]").each(function(){d(this).find(".fwd-left-side .circle-avatar").setAvatar(t,this.avatar_size)})},updateMyStatus:function(){let e;this.account.isOnline()||(e="You are offline"),this.bottom.showChatNotification(e||"",!0)},updateMyName:function(){var e=this.account.get("name"),t=this.account.get("jid");this.$(".chat-message.with-author[data-from=\""+t+"\"]").each(function(){d(this).find(".chat-msg-author").text(e)}),this.$(".fwd-message.with-author[data-from=\""+t+"\"]").each(function(){d(this).find(".fwd-msg-author").text(e)})},updateMyAvatar:function(){var e=this.account.cached_image,t=this.account.get("jid");this.$(".chat-message.with-author[data-from=\""+t+"\"]").each(function(){d(this).find(".left-side .circle-avatar").setAvatar(e,this.avatar_size)}),this.$(".fwd-message.with-author[data-from=\""+t+"\"]").each(function(){d(this).find(".fwd-left-side .circle-avatar").setAvatar(e,this.avatar_size)})},updateBlockedState:function(){this.contact.get("blocked")&&this.model.showBlockedRequestMessage(),this.isVisible()&&(a.body.setScreen(a.body.screen.get("name"),{right:"chat",chat_item:this.chat_item,blocked:this.contact.get("blocked")}),this.updateScrollBar())},readMessages:function(e){var t=u.clone(this.model.messages_unread.models);if(t.length){let e=t[t.length-1];this.model.sendMarker(e.get("msgid"),"displayed",e.get("stanza_id"),e.get("contact_stanza_id"))}this.model.set("const_unread",0),u.each(t,function(t){(!e||t.get("timestamp")<=e)&&t.set("is_unread",!1)}.bind(this))},onMouseWheel:function(e){0>e.originalEvent.deltaY&&this.loadPreviousHistory(),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},keyupSearch:function(e){if(e.keyCode===n.KEY_ENTER){let e=this.$search_form.find("input").val();this.model.searchMessages(e,function(){}.bind(this))}e.keyCode===n.KEY_ESCAPE&&this.head.renderSearchPanel()},onScrollY:function(){0===this._scrolltop&&(this.$(".fixed-day-indicator-wrap").css("opacity",1),this.current_day_indicator=o.pretty_date(parseInt(this.$(".chat-content").children().first().data("time"))),this.showDayIndicator(this.current_day_indicator)),this.$(".back-to-bottom").hideIf(this.isScrolledToBottom())},onScroll:function(){if(!this.isVisible())return;this.$(".back-to-bottom").hideIf(this.isScrolledToBottom());let e=this.$(".chat-day-indicator"),t=this.$(".chat-message"),a,i;this._prev_scrolltop=this._scrolltop||0,this._scrolltop=this.getScrollTop(),e.each(function(e,t){if(this._scrolltop<this._prev_scrolltop){if(t.offsetTop<=this._scrolltop&&t.offsetTop>=this._scrolltop-30)return a=e,i=0,!1;if(t.offsetTop>=this._scrolltop&&t.offsetTop<=this._scrolltop-30)return a=e&&e-1,i=1,!1}else{if(t.offsetTop<=this._scrolltop+30&&t.offsetTop>=this._scrolltop)return a=e&&e-1,i=0,!1;if(t.offsetTop>=this._scrolltop-30&&t.offsetTop<=this._scrolltop)return a=e,i=1,!1}}.bind(this)),a?(this.$(".fixed-day-indicator-wrap").css("opacity",i),this.current_day_indicator=o.pretty_date(parseInt(d(e[a]).attr("data-time")))):(t.each(function(e,t){if(t.offsetTop+d(t).height()>this._scrolltop&&t.offsetTop<this._scrolltop)return a=e,i=1,!1}.bind(this)),a&&(this.$(".fixed-day-indicator-wrap").css("opacity",i),this.current_day_indicator=o.pretty_date(parseInt(d(t[a]).attr("data-time"))))),null!==this.current_day_indicator&&this.showDayIndicator(this.current_day_indicator),this._scrolltop<this._prev_scrolltop&&(100>this._scrolltop||.1>this.getPercentScrolled())&&this.loadPreviousHistory()},backToBottom:function(){this.scrollToBottom()},MAMRequest:function(e,t,i){var n=this.account,s=this.contact,o=[],r=m(),p=s.get("group_chat"),u=!0,g;g=p?c({type:"set",to:s.get("jid")}):c({type:"set"}),g.c("query",{xmlns:l.NS.MAM,queryid:r}).c("x",{xmlns:l.NS.DATAFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(l.NS.MAM).up().up(),p||g.c("field",{var:"with"}).c("value").t(this.model.get("jid")).up().up(),e.var&&e.var.forEach(function(e){g.c("field",{var:e.var}).c("value").t(e.value).up().up()}.bind(this)),g.up().cnode(new l.RSM(e).toXML());var h=new d.Deferred;n.chats.onStartedMAMRequest(h),h.done(function(){var e=n.connection.addHandler(function(e){if(p==s.get("group_chat")){var t=d(e);t.find("result").attr("queryid")===r&&o.push(e)}else o=[],u=!1;return!0},l.NS.MAM);n.sendIQ(g,function(a){n.connection.deleteHandler(e),n.chats.onCompletedMAMRequest(h);var i=d(a).find("fin[xmlns=\""+l.NS.MAM+"\"]");if(i.length&&i.attr("queryid")===r){var s=new l.RSM({xml:i.find("set")[0]});s.complete="true"===i.attr("complete"),t&&t(u,o,s)}},function(t){n.connection.deleteHandler(e),a.error("MAM error"),a.error(t),n.chats.onCompletedMAMRequest(h),i&&i(t)})})},getMessageArchive:function(e,t){if(t.previous_history){if(this._loading_history||this.model.get("history_loaded"))return;this._loading_history=!0,clearTimeout(this._load_history_timeout),this._load_history_timeout=setTimeout(function(){this._loading_history=!1}.bind(this),6e4),this.showHistoryFeedback()}var i=this.model.account,n=0;this.MAMRequest(e,function(s,o,d){clearTimeout(this._load_history_timeout),this._loading_history=!1,this.hideHistoryFeedback(),t.missed_history&&!d.complete&&d.count>o.length&&this.getMessageArchive({after:d.last},{missed_history:!0}),this.contact.get("group_chat")?!this.contact.my_info&&this.contact.getMyInfo():!this.contact.get("last_seen")&&!this.contact.get("is_server")&&this.contact.getLastSeen(),o.length<e.max&&s&&this.model.set("history_loaded",!0),(t.previous_history||!this.model.get("first_archive_id"))&&d.first&&this.model.set("first_archive_id",d.first),(t.last_history||!this.model.get("last_archive_id"))&&d.last&&this.model.set("last_archive_id",d.last),u.each(o,function(e){var a=i.chats.receiveChatMessage(e,u.extend({is_archived:!0},t));a&&n++}),0===n&&t.last_history&&!this.model.get("history_loaded")&&this.getMessageArchive(u.extend(e,{max:a.settings.mam_messages_limit,before:this.model.get("first_archive_id")||""}),{previous_history:!0})}.bind(this),function(){t.previous_history&&(this._loading_history=!1,this.showHistoryFeedback(!0))}.bind(this))},requestMissedMessages:function(e){if(e){let t={};t.var=[{var:"start",value:p(e).format()}],this.getMessageArchive(t,{missed_history:!0})}},loadLastHistory:function(){if(a.settings.load_history){var e=this.model.get("last_archive_id"),t={};e?t.after=e:(t.before="",t.max=a.settings.mam_messages_limit_start),this.getMessageArchive(t,{last_history:!0})}},loadPreviousHistory:function(){a.settings.load_history&&this.getMessageArchive({max:a.settings.mam_messages_limit,before:this.model.get("first_archive_id")||""},{previous_history:!0})},showHistoryFeedback:function(e){this._load_history_feedback_timeout&&(clearTimeout(this._load_history_feedback_timeout),this._load_history_feedback_timeout=null);var t=e?"Error while loading archived messages":"Loading messages...";this.$history_feedback.text(t).removeClass("hidden"),e&&(this._load_history_feedback_timeout=setTimeout(this.hideHistoryFeedback.bind(this),5e3))},showDayIndicator:function(e){this.$(".fixed-day-indicator").text(e),this.$(".fixed-day-indicator-wrap").removeClass("hidden")},showPinnedMessage:function(e){if(d(e.target).hasClass("close"))this.unpinMessage();else{var t=this.contact.get("pinned_message"),i=this.buildMessageHtml(t),n=new a.ExpandedMessagePanel({account:this.account,chat_content:this});n.$el.attr("data-color",this.account.settings.get("color")),this.updateMessageInChat(i),this.initPopup(i),n.open(i)}},imageOnload:function(e){let t=e.find(".img-content"),a=e.find(".mdi-link-variant");t.css("background-image","none"),a.attr({"data-image":"true"})},unpinMessage:function(){var e=c({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("update",{xmlns:l.NS.GROUP_CHAT}).c("pinned-message");this.account.sendIQ(e,function(){},function(e){d(e).find("error not-allowed").length&&o.dialogs.error("You have no permission to pin/unpin message")})},hideHistoryFeedback:function(){this.$history_feedback.addClass("hidden")},receiveNoTextMessage:function(e){var t=l.getBareJidFromJid(e.attr("from")),a=l.getBareJidFromJid(e.attr("to")),i=t===this.account.get("jid"),n=e.find("[xmlns=\""+l.NS.CHATSTATES+"\"]");if(n.length&&!i){let e=n.children("subtype");this.showChatState(n[0].tagName.toLowerCase(),e.attr("type"),e.attr("mime-type"))}},showChatState:function(e,t,a){clearTimeout(this._chatstate_show_timeout);var i=this.contact.get("name"),s;if("composing"===e){if(!t)this._current_composing_msg=void 0,s="typing...",this._chatstate_show_timeout=setTimeout(function(){this.showChatState()}.bind(this),n.CHATSTATE_TIMEOUT_PAUSED);else if(this._current_composing_msg={type:t},"upload"===t){let e=a?o.pretty_file_type_with_article(a):"file";a&&(this._current_composing_msg.mime_type=a),s="sending "+e,this._chatstate_show_timeout=setTimeout(function(){this.showChatState()}.bind(this),n.CHATSTATE_TIMEOUT_PAUSED_AUDIO)}else"voice"==t&&(s="recording a voice message..."),"video"==t&&(s="recording a video message..."),this._chatstate_show_timeout=setTimeout(function(){this.showChatState("paused",t)}.bind(this),n.CHATSTATE_TIMEOUT_PAUSED_AUDIO);}else if("paused"===e)this.showChatState();else return this.bottom.showChatNotification(""),void this.chat_item.updateLastMessage();s?this.bottom.showChatNotification(i+" is "+s):this.bottom.showChatNotification(),this.chat_item.$(".last-msg").text(s),this.chat_item.$(".last-msg-date").text(o.pretty_short_datetime()).attr("title",o.pretty_datetime()),this.chat_item.$(".msg-delivering-state").addClass("hidden")},updateMentions:function(e){e.get("mentions")&&e.get("mentions").forEach(function(t){let a=t.target||"";if(this.contact.get("group_chat")||e.get("groupchat_jid")){let e=a.match(/\?id=\w*/),i=a.match(/\?jid=.*/);e&&this.contact.my_info?(a=e[0].slice(4),a===this.contact.my_info.get("id")&&(t.me=!0)):i&&(a=i[0].slice(5),a===this.account.get("jid")&&(t.me=!0))}else a=a.slice(5),a===this.account.get("jid")&&(t.me=!0)}.bind(this))},onMessage:function(e){this.updateMentions(e);let t=this.getScrollBottom();this.account.messages.add(e),u.isUndefined(e.get("is_accepted"))||this.model.set("is_accepted",!1),this.model.set("opened",!0),!e.get("is_archived")&&e.get("stanza_id")&&this.model.set("last_archive_id",e.get("stanza_id")),e.get("participants_version")&&this.contact.participants&&this.contact.participants.version<e.get("participants_version")&&this.contact.trigger("update_participants");let i=this.isScrolledToBottom(),s=this.addMessage(e);"file_upload"===e.get("type")&&this.startUploadFile(e,s),i||e.get("submitted_here")?this.scrollToBottom():(this.updateScrollBar(),this.scrollTo(this.ps_container[0].scrollHeight-this.ps_container[0].offsetHeight-t)),e.get("synced_from_server")||e.get("is_archived")||(!(e.isSenderMe()||e.get("silent")||"system"===e.get("type")&&!e.get("auth_request"))&&(e.set("is_unread",!(this.model.get("display")&&a.get("focused"))),!e.get("is_unread")&&this.model.sendMarker(e.get("msgid"),"displayed",e.get("stanza_id"),e.get("contact_stanza_id")),!a.get("focused")&&(this.contact.get("muted")?e.set("muted",!0):this.notifyMessage(e)),this.model.setMessagesDisplayed(e.get("timestamp"))),this.contact.get("archived")&&(this.contact.get("muted")?e.set("archived",!0):(this.head.archiveChat(),this.contact.set("archived",!1)))),e.get("attention")&&this.attentionMessage(e),e.isSenderMe()&&(!e.get("is_archived")&&!e.get("missed_msg")&&this.readMessages(e.get("timestamp")),this.model.get("last_displayed_id")>=e.get("stanza_id")&&e.get("stanza_id")!==e.get("origin_id")?e.set("state",n.MSG_DISPLAYED):e.get("stanza_id")!==e.get("origin_id")&&(this.model.get("last_delivered_id")>=e.get("stanza_id")||e.get("is_archived"))&&e.set("state",n.MSG_DELIVERED)),(e.get("private_invite")||e.get("invite"))&&(!(this.contact.invitation&&this.contact.invitation.message.get("timestamp")>e.get("timestamp"))&&(this.contact.invitation=new a.GroupchatInvitationView({model:this.contact,message:e})),this.model.contact.set("invitation",!0),this.model.get("active")&&this.model.contact.trigger("open_chat",this.model.contact));let o=this.model.last_message;(!o||e.get("timestamp")>=o.get("timestamp"))&&(this.model.last_message=e,this.chat_item.updateLastMessage()),e.get("mentions")&&e.get("mentions").forEach(function(t){let a=t.target||"",i=a.match(/\?id=\w*/),n=a.match(/\?jid=.*/);a=i?i[0].slice(4):n?n[0].slice(5):"",this.contact.my_info?a===this.contact.my_info.get("id")&&this.account.mentions.create(null,{message:e,contact:this.contact}):this.contact.get("group_chat")&&(this._pending_my_info?this._pending_my_info.done(function(){a===this.contact.my_info.get("id")&&this.account.mentions.create(null,{message:e,contact:this.contact}),this._pending_my_info=null}.bind(this)):(this._pending_my_info=new d.Deferred,this.contact.getMyInfo(function(){a===this.contact.my_info.get("id")&&this.account.mentions.create(null,{message:e,contact:this.contact}),this._pending_my_info.resolve()}.bind(this)))),(a===this.account.get("jid")||""===a)&&this.account.mentions.create(null,{message:e,contact:this.contact})}.bind(this))},addMessage:function(e){e.get("auth_request");var t=this.buildMessageHtml(e),a=this.model.messages.indexOf(e);0===a?t.prependTo(this.$(".chat-content")):t.insertAfter(this.$(".chat-message").eq(a-1));var i=t.nextAll(".chat-message").first();return this.updateMessageInChat(t[0]),i.length&&this.updateMessageInChat(i[0]),this.initPopup(t),this.bottom.showChatNotification(),t},initPopup:function(e){var t=e.find(".uploaded-img"),a=e.find(".uploaded-img-for-collage");t.length&&t.each(function(e,t){this.initMagnificPopup(d(t))}.bind(this)),a.length&&this.initZoomGallery(e)},initMagnificPopup:function(e){e.magnificPopup({type:"image",closeOnContentClick:!0,fixedContentPos:!0,mainClass:"mfp-no-margins mfp-with-zoom",image:{verticalFit:!0},zoom:{enabled:!0,duration:300}})},initZoomGallery:function(e){var t=this;e.find(".zoom-gallery").magnificPopup({delegate:"img",type:"image",closeOnContentClick:!1,closeBtnInside:!1,mainClass:"mfp-with-zoom mfp-img-mobile",image:{verticalFit:!0,titleSrc:function(e){return"<a class=\"image-source-link\" href=\""+e.el.attr("src")+"\" target=\"_blank\">"+t.model.messages.getFilename(e.el.attr("src"))+"</a>"}},gallery:{enabled:!0},zoom:{enabled:!0,duration:300,opener:function(e){return e}}})},updateMessage:function(e){let t=e.get("images"),i=e.get("only_emoji"),n=e.get("files"),c;if(e instanceof a.Message)c=this.$(".chat-message[data-uniqueid=\""+e.get("unique_id")+"\"]");else return;if(c.children(".msg-wrap").children(".chat-msg-content").html(o.markupBodyMessage(e).emojify({tag_name:"div",emoji_size:o.emoji_size(i)})),t){if(1<t.length){let t=this.createImageGrid(e.attributes);c.find(".chat-msg-media-content").html(t)}if(1==t.length){let e=this.createImage(t[0]),a=this.createImageContainer(t[0]);e.onload=function(){this.imageOnload(c)}.bind(this),c.find(".chat-msg-media-content").html(d(a).html(e)),this.updateScrollBar()}}if(n&&0<n.length){let e=u.clone(n),t,a;d(e).each(function(i,n){n.type&&(n.voice?t=!0:t=!1);let r=o.file_type_icon(n.type);u.extend(e[i],{is_audio:t,duration:o.pretty_duration(e[i].duration),mdi_icon:r,size:o.pretty_size(e[i].size)}),a=t?d(s.messages.audio_file(e[i])):d(s.messages.file(e[i])),c.find(".chat-msg-media-content").append(a)}.bind(this))}if(e.get("data_form")){let t=o.render_data_form(e.get("data_form"));c.find(".chat-msg-content").append(t)}let r=o.pretty_short_datetime(e.get("last_replace_time")),l=p(e.get("last_replace_time")).format("D MMMM, YYYY HH:mm:ss"),m=o.pretty_datetime(e.get("time"))+", edited "+(p(e.get("timestamp")).startOf("day").isSame(p(e.get("last_replace_time")).startOf("day"))?r:l);c.find(".msg-time").prop("title",m),c.find(".edited-info").removeClass("hidden").text("edited").prop("title",m),c.hyperlinkify({selector:".chat-text-content"})},removeMessage:function(e){var t,i,n;if(e instanceof a.Message)t=e,n=this.$(".chat-message[data-uniqueid=\""+e.get("unique_id")+"\"]"),this.bottom.content_view&&(i=this.bottom.content_view.$(".chat-message[data-uniqueid=\""+e.get("unique_id")+"\"]"));else{if(i=e,!i.length)return;t=this.model.messages.get(i.data("uniqueid"))}t&&t.destroy(),this.removeMessageFromDOM(n),i&&i!==n&&this.removeMessageFromDOM(i)},removeMessageFromDOM:function(e){if(e.hasClass("with-author")&&!e.next().hasClass("with-author")){var t=e.find(".circle-avatar")[0];e.next().addClass("with-author"),e.next().find(".circle-avatar").replaceWith(t)}e.prev(".chat-day-indicator").remove(),e.remove(),this._clearing_history||this.updateScrollBar()},clearHistory:function(){let e=[];this._clearing_history=!0,this.account.server_features.get(l.NS.REWRITE)?(!this.contact.get("group_chat")&&a.servers.get(this.contact.domain).server_features.get(l.NS.REWRITE)&&(e=[{name:"symmetric_deletion",checked:!1,text:"Delete for all"}]),o.dialogs.ask("Clear message archive","Are you sure you want to <b>delete all message history</b> for this chat?",e,{ok_button_text:"delete"}).done(function(e){if(!e)return void(this._clearing_history=!1);let t=!!this.contact.get("group_chat")||!!e.symmetric_deletion;this.model.retractAllMessages(t,function(){this._clearing_history=!1,this.chat_item.updateLastMessage(),this.updateScrollBar()}.bind(this),function(){this._clearing_history=!1}.bind(this))}.bind(this))):o.dialogs.ask("Clear message archive","Are you sure you want to <b>delete all message history</b> for this chat?"+("\nWarning! <b>"+this.account.domain+"</b> server does not support message deletion. Only local message history will be deleted.").fontcolor("#E53935"),e,{ok_button_text:"delete locally"}).done(function(e){if(!e)return void(this._clearing_history=!1);let t=u.clone(this.model.messages.models);t.forEach(function(e){this.removeMessage(e)}.bind(this))}.bind(this))},renderVoiceMessage:function(t,a){let i=t.innerHTML,n="waveform"+p.now(),c=d(t),r=c.closest(".link-file");c.addClass("voice-message-rendering").html(d(s.messages.audio_file_waveform({waveform_id:n})));let l=this.createAudio(a,n);return l.on("ready",function(){let t=e(l.getDuration());c.find(".voice-msg-total-time").text(o.pretty_duration(t)),l.play()}.bind(this)),l.on("error",function(){c.removeClass("voice-message-rendering"),t.innerHTML=i,l.unAll(),c.find(".voice-message-play").get(0).remove(),o.callback_popup_message("This type of audio isn't supported in Your browser",3e3)}.bind(this)),l.on("play",function(){r.addClass("playing");let t=setInterval(function(){let a=e(l.getCurrentTime());l.isPlaying()?c.find(".voice-msg-current-time").text(o.pretty_duration(a)):clearInterval(t)},100)}.bind(this)),l.on("finish",function(){r.removeClass("playing")}),l.on("pause",function(){r.removeClass("playing")}),this.$(".voice-message-volume")[0].onchange=function(){l.setVolume(this.$(".voice-message-volume").val()/100)}.bind(this),l},createImageGrid:function(e){if(6<e.images.length){var t="template-for-6",a=e.images.length-5,i=d(s.messages[t](e));i.find(".last-image").addClass("hidden-images"),i.find(".image-counter").text("+"+a)}else var t="template-for-"+e.images.length,i=d(s.messages[t](e));return i},buildMessageHtml:function(e){var t=u.clone(e.attributes),i=!!(e instanceof a.Message)&&e.isSenderMe(),n=t.user_info||{},c=l.xmlescape(n.nickname||(t.from_jid===this.contact.get("jid")?this.contact.get("name"):i?this.contact.my_info?this.contact.my_info.get("nickname"):this.account.get("name"):this.account.contacts.get(t.from_jid)?this.account.contacts.get(t.from_jid).get("name"):t.from_jid)),r=t.images,p=e.get("only_emoji"),m=t.files,g=!u.isUndefined(r),h=!!m,v=!1,A=n.avatar,f=n.role,b=n.badge,x=n.id,w;if(i&&this.contact.get("group_chat")&&this.contact.my_info&&(f=this.contact.my_info.get("role"),b=this.contact.my_info.get("badge")),u.extend(t,{username:c,state:e instanceof a.Message?e.getState():"sent",verbose_state:e instanceof a.Message?e.getVerboseState():"sent",time:o.pretty_datetime(t.time),short_time:o.pretty_time(t.time),avatar_id:A,is_image:g,is_file:h,files:m,role:o.pretty_name(f),badge:b,from_id:x}),"file_upload"===t.type)return d(s.messages.file_upload(t));if("system"===t.type){let e=t.invite?"group_request":"system";return d(s.messages[e](t))}g&&1<r.length&&(w=this.createImageGrid(t));var C=[t.forwarded_message&&"forwarding"];let S=o.markupBodyMessage(e);var k=d(s.messages.main(u.extend(t,{is_sender:i,message:S,classlist:C.join(" ")})));if(g&&(1<r.length&&k.find(".chat-msg-media-content").html(w),1==r.length)){let e=this.createImage(r[0]),t=this.createImageContainer(r[0]);e.onload=function(){this.imageOnload(k)}.bind(this),k.find(".chat-msg-media-content").html(d(t).html(e)),this.updateScrollBar()}if(h&&0<m.length){let e=u.clone(m),t;d(e).each(function(a,i){i.type&&(i.voice?v=!0:v=!1),1===e.length&&v&&(i.name="Voice message");let n=o.file_type_icon(i.type);u.extend(e[a],{is_audio:v,duration:o.pretty_duration(e[a].duration),mdi_icon:n,size:o.pretty_size(e[a].size)}),t=v?d(s.messages.audio_file(e[a])):d(s.messages.file(e[a])),k.find(".chat-msg-media-content").append(t)}.bind(this))}if(e.get("data_form")){let t=o.render_data_form(e.get("data_form"));k.find(".chat-msg-content").append(t)}return t.forwarded_message?(d(t.forwarded_message).each(function(e,a){i=a.isSenderMe(),t=u.clone(a.attributes);var n=t.images&&t.images.length,r=n?u.clone(t.images):void 0,p=!!t.files,m=t.user_info||{},g=m.avatar,h=o.pretty_name(m.role),A=m.badge,f=m.id,b=t.from_jid,x,C;c=i?l.xmlescape(m.nickname||this.account.get("name")):l.xmlescape(m.nickname||m.id||this.account.contacts.mergeContact({jid:b}).get("name"));let S=o.markupBodyMessage(a);var E=d(s.messages.forwarded(u.extend(t,{time:o.pretty_datetime(t.time),short_time:o.pretty_short_month_date(t.time),username:c,avatar_id:g,message:S,is_file:p,is_audio:C,role:h,badge:A,from_id:f})));if(a.get("forwarded_message")){var T=a.get("forwarded_message").length,I=T+" forwarded message"+(1<T?"s":"");E.children(".msg-wrap").children(".fwd-msgs-block").append(d("<a/>",{class:"collapsed-forwarded-message","data-uniqueid":t.unique_id}).text(I))}if(n&&(1<r.length&&(w=this.createImageGrid(t),E.find(".chat-msg-media-content").html(w)),1==r.length)){x=this.createImage(r[0]),x.onload=function(){this.imageOnload(k)}.bind(this);let e=this.createImageContainer(r[0]);E.find(".chat-msg-media-content").html(d(e).html(x))}if(p&&0<t.files.length){var M=u.clone(t.files),N;n||d(M).each(function(e,t){t.type&&(t.voice?v=!0:v=!1),1===M.length&&v&&(t.name="Voice message");let a=o.file_type_icon(t.type);u.extend(M[e],{is_audio:v,duration:o.pretty_duration(M[e].duration),mdi_icon:a,size:o.pretty_size(M[e].size)}),N=v?d(s.messages.audio_file(M[e])):d(s.messages.file(M[e])),E.find(".chat-msg-media-content").append(N)}.bind(this))}k.children(".msg-wrap").children(".fwd-msgs-block").append(E)}.bind(this)),this.updateScrollBar()):k.find(".fwd-msgs-block").remove(),k.hyperlinkify({selector:".chat-text-content"}).emojify(".chat-text-content",{tag_name:"div",emoji_size:o.emoji_size(p)}).emojify(".chat-msg-author-badge",{emoji_size:16})},getDateIndicator:function(e){var t=p(e).startOf("day");return d("<div class=\"chat-day-indicator one-line noselect\" data-time=\""+t.format("x")+"\">"+o.pretty_date(t)+"</div>")},hideMessageAuthor:function(e){e.removeClass("with-author")},showMessageAuthor:function(e){if(e.hasClass("system"))return;e.addClass("with-author");let t=e.find(".left-side .circle-avatar"),a=e.data("from"),i;if(a===this.account.get("jid"))this.contact.get("group_chat")&&this.contact.my_info&&(i=this.contact.my_info.get("b64_avatar"),i=i?g.getCachedImage(i):g.getDefaultAvatar(this.contact.my_info.get("nickname"))),i||(i=this.account.cached_image);else if(this.contact.get("group_chat")){var n=e.find(".msg-wrap .chat-msg-author").text();i=g.getDefaultAvatar(n)}else{var n=this.account.contacts.get(e.data("from"))||e.find(".msg-wrap .chat-msg-author").text()||e.data("from");i=n.cached_image||g.getDefaultAvatar(n)}if(t.setAvatar(i,this.avatar_size),e.data("avatar")&&e.data("from-id"))if(this.account.chat_settings.getHashAvatar(e.data("from-id"))==e.data("avatar")&&this.account.chat_settings.getB64Avatar(e.data("from-id")))t.setAvatar(this.account.chat_settings.getB64Avatar(e.data("from-id")),this.avatar_size);else{let a=this._pending_avatars.find(t=>t.hash==e.data("avatar"));if(a)a.dfd.done(function(e){t.setAvatar(e,this.avatar_size);let i=this._pending_avatars.indexOf(a);-1<i&&this._pending_avatars.splice(i,1)}.bind(this));else{var s=l.NS.PUBSUB_AVATAR_DATA+"#"+e.data("from-id"),o=new d.Deferred;this._pending_avatars.push({hash:e.data("avatar"),dfd:o}),this.contact.getAvatar(e.data("avatar"),s,function(a){t.setAvatar(a,this.avatar_size),this.account.chat_settings.updateCachedAvatars(e.data("from-id"),e.data("avatar"),a),o.resolve(a)}.bind(this))}}},hideFwdMessageAuthor:function(e){e.removeClass("with-author")},showFwdMessageAuthor:function(e){if(e.length){e.addClass("with-author");var t=e.find(".circle-avatar"),a=e.data("from"),i=a===this.account.get("jid"),n=this.account.contacts.get(a)||a,s;if(i?(this.contact.get("group_chat")&&this.contact.my_info&&(s=this.contact.my_info.get("b64_avatar"),s=s?g.getCachedImage(s):this.account.cached_image||g.getDefaultAvatar(this.contact.my_info.get("nickname"))),!s&&(s=this.account.cached_image)):n&&(s=n.cached_image||(this.contact.get("group_chat")?g.getDefaultAvatar(e.find(".msg-wrap .fwd-msg-author").text()):g.getDefaultAvatar(n))),t.setAvatar(s,this.avatar_size),t.removeClass("hidden"),e.data("avatar")&&e.data("from-id"))if(this.account.chat_settings.getHashAvatar(e.data("from-id"))==e.data("avatar")&&this.account.chat_settings.getB64Avatar(e.data("from-id")))t.setAvatar(this.account.chat_settings.getB64Avatar(e.data("from-id")),this.avatar_size);else{var o=l.NS.PUBSUB_AVATAR_DATA+"#"+e.data("from-id");this.contact.getAvatar(e.data("avatar"),o,function(a){t.setAvatar(a,this.avatar_size),this.account.chat_settings.updateCachedAvatars(e.data("from-id"),e.data("avatar"),a)}.bind(this))}}},updateMessageInChat:function(e){var t=d(e);t.prev(".chat-day-indicator").remove();var a=t.prevAll(".chat-message").first();if(!a.length)return this.getDateIndicator(t.data("time")).insertBefore(t),this.showMessageAuthor(t),void t.find(".fwd-message").each(function(e,t){this.showFwdMessageAuthor(d(t))}.bind(this));if(t.find(".data-form").length)return void this.showMessageAuthor(t);var i=a.hasClass("system"),n=t.data("from")===a.data("from"),s=p(t.data("time")).startOf("day").isSame(p(a.data("time")).startOf("day"));if(s?i||!n?this.showMessageAuthor(t):this.hideMessageAuthor(t):(this.getDateIndicator(t.data("time")).insertBefore(t),this.showMessageAuthor(t)),t.hasClass("forwarding")){var o=t.find(".fwd-message");o.each(function(e,a){var i=d(a),n=0<e?i.prev():[];if(i.switchClass("hide-date",s&&n.length),i.removeClass("hide-time"),n.length){var o=i.data("from")===n.data("from");o?this.hideFwdMessageAuthor(i):this.showFwdMessageAuthor(i)}else this.showMessageAuthor(t),this.showFwdMessageAuthor(i)}.bind(this))}},notifyMessage:function(e){this.model.get("jid");if(a.settings.notifications){var t=a.popupNotification({title:this.contact.get("name"),text:a.settings.message_preview?e.getText():"sent you a message",icon:this.contact.cached_image.url});t.onclick=function(){window.focus(),this.model.trigger("open")}.bind(this)}if(a.settings.sound){var i;i=e.get("auth_request")?a.settings.sound_on_auth_request:a.settings.sound_on_message,a.playAudio(i)}a.recountAllMessageCounter()},attentionMessage:function(){var e=a.popupNotification({title:this.contact.get("name"),text:"Attention",icon:this.contact.cached_image.url});e.onclick=function(){window.focus(),this.model.trigger("open")}.bind(this);let t=a.settings.sound_on_attention;a.playAudio(t)},sendMessage:function(e){let t=e.get("message"),a="",i=[],s=e.get("forwarded_message"),o=e.get("unique_id"),c=e.get("msgid"),m=r({from:this.account.jid,to:this.model.get("jid"),type:"chat",id:c});if(s&&(a=[],d(s).each(function(e,n){let o=Array.from(u.escape(u.unescape(this.bottom.createTextMessage([n],">")))+(e!==s.length-1||t.length?"\n":"")),d=a.length,c=a.concat(o).length;m.c("reference",{xmlns:l.NS.REFERENCE,type:"mutable",begin:d,end:c}).c("forwarded",{xmlns:"urn:xmpp:forward:0"}).c("delay",{xmlns:"urn:xmpp:delay",stamp:n.get("time")}).up().cnode(n.get("xml")).up().up().up(),a=a.concat(o),i.push({start:d,end:c,type:"forward"})}.bind(this)),t=u.unescape(a.join(""))+t),e.get("mentions")&&e.get("mentions").length&&e.get("mentions").forEach(function(e){let t={xmlns:l.NS.MARKUP};e.is_gc&&(t.node=l.NS.GROUP_CHAT),m.c("reference",{xmlns:l.NS.REFERENCE,begin:e.start+a.length,end:e.end+a.length,type:"decoration"}).c("mention",t).t(e.target).up().up()}.bind(this)),e.get("markups")&&e.get("markups").forEach(function(e){for(let t in m.c("reference",{xmlns:l.NS.REFERENCE,begin:e.start+a.length,end:e.end+a.length,type:"decoration"}),e.markup)m.c(e.markup[t],{xmlns:l.NS.MARKUP}).up();m.up()}.bind(this)),e.get("blockquotes")&&e.get("blockquotes").forEach(function(e){m.c("reference",{xmlns:l.NS.REFERENCE,begin:e.start+a.length,end:e.end+a.length,type:"decoration"}).c("quote",{xmlns:l.NS.MARKUP}).up().up()}.bind(this)),"file_upload"==e.get("type")){t="";let n=e.get("files")||[],s=e.get("images")||[],o=n.concat(s);o.forEach(function(e,n){a=e.sources[0]+(n==o.length-1?"":"\n");let s=t.length,d=(t+a).length;m.c("reference",{xmlns:l.NS.REFERENCE,type:"mutable",begin:s,end:d}),e.voice&&m.c("voice-message",{xmlns:l.NS.VOICE_MESSAGE}),m.c("file-sharing",{xmlns:l.NS.OTB}).c("file"),e.type&&m.c("media-type").t(e.type).up(),e.name&&m.c("name").t(e.name).up(),e.size&&m.c("size").t(e.size).up(),e.height&&m.c("height").t(e.height).up(),e.width&&m.c("width").t(e.width).up(),e.duration&&m.c("duration").t(e.duration).up(),e.description&&m.c("desc").t(e.description).up(),m.up().c("sources"),e.sources.forEach(function(e){m.c("uri").t(e).up()}.bind(this)),m.up().up().up(),e.voice&&m.up(),t+=a,i.push({start:s,end:d})}.bind(this)),e.set({type:"main"})}i.length&&e.set({mutable_content:i}),this.account._pending_messages.push({chat_hash_id:this.contact.hash_id,unique_id:o}),e.set("original_message",t),t&&m.c("body").t(t).up(),m.c("markable").attrs({xmlns:l.NS.CHAT_MARKERS}).up().c("origin-id",{id:c,xmlns:"urn:xmpp:sid:0"}).up(),e.get("state")===n.MSG_ERROR&&(m.c("retry",{xmlns:l.NS.DELIVERY}).up(),e.set("state",n.MSG_PENDING)),e.set({xml:m.tree()});let g=p.now();this.account.sendMsg(m,function(){if(!this.contact.get("group_chat")&&!this.account.server_features.get(l.NS.DELIVERY))setTimeout(function(){this.account.last_stanza_timestamp>g&&e.get("state")===n.MSG_PENDING?e.set("state",n.MSG_SENT):(this.account.connection.ping.ping(this.account.get("jid"),function(){e.get("state")===n.MSG_PENDING&&e.set("state",n.MSG_SENT)}.bind(this)),setTimeout(function(){this.account.last_stanza_timestamp<g&&e.get("state")===n.MSG_PENDING&&e.set("state",n.MSG_ERROR)}.bind(this),5e3))}.bind(this),1e3);else{let t=5,a=setInterval(function(){this.account.last_stanza_timestamp<g&&60<t&&e.get("state")===n.MSG_PENDING||60<t?(e.set("state",n.MSG_ERROR),clearInterval(a)):e.get("state")!==n.MSG_PENDING&&clearInterval(a),t+=10}.bind(this),1e4)}}.bind(this))},isImageType:function(e){return-1!=e.indexOf("image")},initJingleMessage:function(e){a.current_voip_call&&a.current_voip_call.destroy(),e=e||{},e=e.video?"video":"audio";let t=m();a.current_voip_call=new a.JingleMessage({session_id:t,video_live:"video"===e},{contact:this.contact}),a.current_voip_call.startCall(),a.current_voip_call.modal_view.show({status:n.JINGLE_MSG_PROPOSE})},saveForwardedMessage:function(e){var t=null;return d(e).get("forwarded_message")&&(t=d(e).get("forwarded_message"),0>this.account.forwarded_messages.indexOf(t)&&(t=this.saveForwardedMessage(t))),e=this.account.forwarded_messages.create(u.extend({is_forwarded:!0,forwarded_message:t},e.attributes)),e},onSubmit:function(e,t,i){i=i||{};let n={from_jid:this.account.get("jid"),message:e,mentions:i.mentions,blockquotes:i.blockquotes,markups:i.markup_references,submitted_here:!0,forwarded_message:null};if(t.length||""!==e.removeEmoji()||(n.only_emoji=Array.from(e).length),t.length){var s=[];u.each(t,function(e){0>this.account.forwarded_messages.indexOf(e)&&(e=this.saveForwardedMessage(e)),s.push(e)}.bind(this)),n.forwarded_message=s;var o=this.model.messages.create(n);this.sendMessage(o)}else if(e){var o=this.model.messages.create(n);this.sendMessage(o)}this.contact.get("archived")&&!this.contact.get("muted")&&(o.set("muted",!1),this.head.archiveChat(),this.contact.set("archived",!1),a.chats_view.updateScreenAllChats()),this.contact.get("group_chat")&&a.toolbar_view.$(".active").hasClass("chats")&&!this.contact.get("muted")&&!this.contact.get("archived")&&a.chats_view.updateScreenAllChats(),a.chats_view.scrollToTop(),a.chats_view.clearSearch()},addFileMessage:function(e){let t=[],a=0;if(this.contact.messages_view&&this.contact.messages_view.data.get("visible")&&this.contact.messages_view.openChat(),10<e.length)return void o.dialogs.error("You can`t upload more than 10 files");var i=this.account.server_features.get(l.NS.HTTP_UPLOAD);if(!i)return void o.dialogs.error(this.account.domain+" server does not seem to support file transfer. This may happen because Xabber didn't yet receive server capabilities, or because of some glitch.\n\nRefresh server info in Account settings&nbsp;&rarr;&nbsp;Server info. If that does not help, consider using a server that definitely does support file transfer. One such server is xabber.org");var n=new d.Deferred;n.done(function(e){this.model.messages.create({from_jid:this.account.get("jid"),type:"file_upload",files:e,upload_service:i.get("from"),message:"Uploading file",submitted_here:!0})}.bind(this)),d(e).each(function(i,s){if(this.isImageType(s.type)){var o=new FileReader,c=new d.Deferred;g.compressImage(s).done(function(i){o.readAsDataURL(i),c.done(function(s){s&&(i.height=s.height,i.width=s.width),t.push(i),a++,a===e.length&&n.resolve(t)}.bind(this))}.bind(this)),o.onload=function(t){if("image/svg+xml"===s.type)c.resolve();else{var e=new Image;e.onload=function(){var e=this.height,t=this.width;c.resolve({height:e,width:t})},e.src=t.target.result}}}else t.push(s),a++,a===e.length&&n.resolve(t)}.bind(this))},startUploadFile:function(e,t){t.emojify(".chat-msg-author-badge",{emoji_size:16}),t.find(".cancel-upload").show(),t.find(".repeat-upload").hide(),t.find(".status").hide(),t.find(".progress").show();var a=0;d(e.get("files")).each(function(i,s){var r=c({type:"get",to:e.get("upload_service")}).c("request",{xmlns:l.NS.HTTP_UPLOAD}).c("filename").t(s.name).up().c("size").t(s.size).up().c("content-type").t(s.type).up(),u=new d.Deferred,m=this;this.account.sendIQ(r,function(e){var t=d(e).find("slot[xmlns=\""+l.NS.HTTP_UPLOAD+"\"]");u.resolve({get_url:t.find("get").text(),put_url:t.find("put").text()})},function(a){var i=d(a).find("error text").text();m.onFileNotUploaded(e,t,i)});let g=p.now(),h=10,v=setInterval(function(){this.account.last_stanza_timestamp<g&&60<h&&e.get("state")===n.MSG_PENDING||60<h?(e.set("state",n.MSG_ERROR),clearInterval(v)):e.get("state")!==n.MSG_PENDING&&clearInterval(v),h+=10}.bind(this),1e4);u.done(function(n){clearInterval(v);var d=new XMLHttpRequest,c=t.find(".progress");t.find(".cancel-upload").click(function(){d.abort()}.bind(this)),d.onabort=function(){this.removeMessage(t)}.bind(this),d.upload.onprogress=function(e){var a=e.loaded/e.total;c.find(".determinate").attr("style","width: "+100*a+"%"),t.find(".filesize").text(o.pretty_size(e.loaded)+" of "+o.pretty_size(e.total))},d.onload=d.onerror=function(){201===this.status?(e.get("files")[i].url=n.get_url,a++,a==e.get("files").length&&m.onFileUploaded(e,t)):m.onFileNotUploaded(e,t,this.responseText)},t.data("cancel")?d.abort():(d.open("PUT",n.put_url,!0),d.send(s))}.bind(this))}.bind(this))},onFileUploaded:function(e,t){var a=e.get("files"),i=this,n=!1,c=[],r=[],l="";if(d(a).each(function(e,t){var a={name:t.name,type:t.type,size:t.size,sources:[t.url]};t.voice&&(a.voice=!0),l+=a.sources[0]+"\n",this.isImageType(t.type)?(u.extend(a,{width:t.width,height:t.height}),c.push(a)):(u.extend(a,{duration:t.duration}),r.push(a))}.bind(this)),e.set("message",l.trim()),t.find(".chat-msg-content").addClass("chat-msg-media-content").html(),0<c.length)if(1<c.length){if(6<c.length){var p="template-for-6",m=c.length-5;g=d(s.messages[p]({images:c})),g.find(".last-image").addClass("hidden-images"),g.find(".image-counter").text("+"+m)}else var p="template-for-"+c.length,g=d(s.messages[p]({images:c}));t.removeClass("file-upload noselect"),t.find(".chat-msg-content").removeClass("chat-file-content").html(g)}else{var h=this.createImage(c[0]),v=i.createImageContainer(c[0]);h.onload=function(){this.imageOnload(t)}.bind(this),t.removeClass("file-upload noselect"),t.find(".chat-msg-content").removeClass("chat-file-content").html(v),t.find(".img-content").html(h)}0<r.length&&(t.removeClass("file-upload noselect"),d(r).each(function(e,a){e||c.length||t.find(".chat-msg-content").removeClass("chat-file-content").html(""),a.type&&(a.voice?n=!0:n=!1);let i={name:a.name,type:a.type,sources:a.sources},l=o.file_type_icon(a.type),p;1===r.length&&n&&(i.name="Voice message"),u.extend(i,{size:o.pretty_size(a.size),is_audio:n,duration:o.pretty_duration(a.duration),mdi_icon:l}),p=n?d(s.messages.audio_file(i)):d(s.messages.file(i)),t.find(".chat-msg-content").append(p)}.bind(this))),this.initPopup(t),e.set("images",c),e.set("files",r),this.sendMessage(e),this.scrollToBottom()},createAudio:function(e,t){var a=WaveSurfer.create({container:"#"+t,scrollParent:!1,barWidth:3,height:48,barHeight:48,cursorColor:"rgba(211,47,47,0.8)",autoCenter:!1,normalize:!0,hideScrollBar:!0,progressColor:"#757575"});return a.load(e),a.setVolume(.5),a},createImage:function(e){var t=new Image;return maxHeight=400,maxWidth=.7*(.715*a.main_panel.$el.width()-176),e.height&&(t.height=e.height),e.width&&(t.width=e.width),t.src=e.sources[0],d(t).addClass("uploaded-img popup-img"),d(t).attr("data-mfp-src",e.sources[0]),t.height&&t.width&&(t.width>maxWidth&&(t.height*=maxWidth/t.width,t.width=maxWidth),t.height>maxHeight&&(t.width*=maxHeight/t.height,t.height=maxHeight)),t},createImageContainer:function(){return d("<div class=\"img-content\"/>")[0]},onFileNotUploaded:function(e,t,a){var i=a?"Error: "+a:"File uploading error";e.set("state",n.MSG_ERROR),t.find(".cancel-upload").hide(),t.find(".repeat-upload").show(),t.find(".status").text(i).show(),t.find(".progress").hide(),t.find(".repeat-upload").click(function(){this.startUploadFile(e,t)}.bind(this))},sendChatState:function(e,t){clearTimeout(this._chatstate_timeout),clearTimeout(this._chatstate_send_timeout),this.chat_state=!1;let a=r({to:this.model.get("jid"),type:"chat"}).c(e,{xmlns:l.NS.CHATSTATES});t&&a.c("subtype",{xmlns:l.NS.EXTENDED_CHATSTATES,type:t}),"composing"===e&&(this.chat_state=!0),this.account.sendMsg(a),"composing"===e&&(this._chatstate_timeout=setTimeout(function(){this.chat_state=!1}.bind(this),n.CHATSTATE_TIMEOUT_PAUSED),this._chatstate_send_timeout=setTimeout(function(){this.chat_state||this.sendChatState("paused")}.bind(this),2*n.CHATSTATE_TIMEOUT_PAUSED))},onChangedMessageState:function(e){e.get("state")===n.MSG_DISPLAYED&&this.model.get("last_displayed_id")<e.get("stanza_id")?(this.model.set("last_displayed_id",e.get("stanza_id")),this.model.set("last_delivered_id",e.get("stanza_id"))):e.get("state")===n.MSG_DELIVERED&&this.model.get("last_delivered_id")<e.get("stanza_id")&&this.model.set("last_delivered_id",e.get("stanza_id"));var t=this.$(".chat-message[data-uniqueid=\""+e.get("unique_id")+"\"]"),a=t.find(".msg-delivering-state");a.attr({"data-state":e.getState(),title:e.getVerboseState()}),a.attr("data-state")===n.MSG_STATE[n.MSG_ERROR]&&a.dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"}),e===this.model.last_message&&this.chat_item.updateLastMessage()},onChangedMessageTimestamp:function(e){var t=this.$(".chat-message[data-uniqueid=\""+e.get("unique_id")+"\"]"),a=t.next(),i=t.prev();t.attr({"data-time":e.get("timestamp")}),t.detach(),t.children(".right-side").find(".msg-time").attr({title:o.pretty_datetime(e.get("time"))}).text(o.pretty_time(e.get("time"))),e.get("user_info")&&t.attr("data-from-id",e.get("user_info").id),this.model.messages.sort();var n=this.model.messages.indexOf(e);if(0===n)i.hasClass("chat-day-indicator")?i.after(t):t.prependTo(this.$(".chat-content"));else{let s=this.$(".chat-message").eq(n-1),o=t.data("from")===s.data("from"),d=p(t.data("time")).startOf("day").isSame(p(s.data("time")).startOf("day"));i.data("from")!==t.data("from")&&a.data("from")===t.data("from")&&("delivered"===a.children(".right-side").find(".msg-delivering-state").attr("data-state")||"displayed"===a.children(".right-side").find(".msg-delivering-state").attr("data-state"))&&this.showMessageAuthor(a),s.next().hasClass("chat-day-indicator")&&p(s.next().data("time")).format("DD.MM.YY")===p(e.get("timestamp")).format("DD.MM.YY")?(t.insertAfter(s.next()),this.showMessageAuthor(t)):t.insertAfter(s),e.get("data_form")||e.get("forwarded_message")||!d||!o||s.hasClass("system")?this.showMessageAuthor(t):this.hideMessageAuthor(t)}let s=this.model.last_message;(!s||e.get("timestamp")>s.get("timestamp"))&&(this.model.last_message=e,this.chat_item.updateLastMessage())},onChangedReadState:function(e){var t=e.get("is_unread");t?(this.model.messages_unread.add(e),this.model.recountUnread()):(this.model.messages_unread.remove(e),this.model.recountUnread(),!e.get("muted")&&a.recountAllMessageCounter())},onTouchMessage:function(e){if(3!==e.which){var t=d(e.target),a=t.parents(".fwd-message").first(),i=0<a.length,n;n=t.hasClass("chat-message")?t:t.parents(".chat-message"),0!=window.getSelection()&&(o.clearSelection(),n.attr("data-no-select-on-mouseup","1"))}},onClickLink:function(e){let t=d(e.target),a=t.closest(".chat-message"),i=this.model.messages.get(a.data("uniqueid"));i||(i=this.account.participant_messages.get(a.data("uniqueid")));let n=i.get("files"),s=i.get("images"),c=[],r="";i.get("forwarded_message")&&i.get("forwarded_message").forEach(function(e){e.get("images")&&c.push(e.get("images"))}.bind(this)),d(n).each(function(e,t){0<e&&(r+="\n"),r+=t.sources[0]}),d(s).each(function(e,t){0<e&&(r+="\n"),r+=t.sources[0]}),d(c).each(function(e,t){d(t).each(function(e,t){""!=r&&(r+="\n"),r+=t.sources[0]})}),o.copyTextToClipboard(r,"Link copied to clipboard","ERROR: Link not copied to clipboard")},showParticipantProperties:function(e){let t=this.contact.participants.get(e);t&&(this.contact.my_info&&this.contact.my_info.get("id")===e&&(e=""),this.contact.participants.participant_properties_panel=new a.ParticipantPropertiesView({model:this.contact.details_view.participants}),this.contact.membersRequest({id:e},function(e){let a=this.account.parseDataForm(d(e).find("x[xmlns=\""+l.NS.DATAFORM+"\"]"));this.contact.participants.participant_properties_panel.open(t,a)}.bind(this)))},onClickMessage:function(e){let t=d(e.target);if((t.hasClass("file-link-download")&&(e.preventDefault(),a.openWindow(t.attr("href"))),!t.hasClass("msg-delivering-state"))&&!t.hasClass("mdi-link-variant")&&!t.hasClass("btn-retry-send-message")&&!t.hasClass("file-link-download")&&!t.is("canvas")&&!t.hasClass("voice-message-volume")){var i=t.closest(".chat-message"),n=t.parents(".fwd-message").first(),s=0<n.length,c=i.attr("data-no-select-on-mouseup"),r;if(i.attr("data-no-select-on-mouseup",""),t.hasClass("data-form-field"))return r=this.model.messages.get(i.data("uniqueid")),void(r&&this.model.sendDataForm(r,t.attr("id")));if(0!=window.getSelection())return;if(t.hasClass("collapsed-forwarded-message")){let e=this.buildMessageHtml(this.account.forwarded_messages.get(t.data("uniqueid"))),i=new a.ExpandedMessagePanel({account:this.account,chat_content:this});return i.$el.attr("data-color",this.account.settings.get("color")),this.updateMessageInChat(e),this.initPopup(e),void i.open(e)}if(t.hasClass("chat-msg-author")||t.hasClass("fwd-msg-author")){let e=s?n.data("from"):i.data("from"),a=s?n.data("fromId"):i.data("fromId");if(this.contact.get("group_chat")){this.bottom.quill.focus();let i=this.bottom.quill.getSelection(),n={jid:e,id:a,nickname:t.text()};i&&(i=i.index),n.position=i||0,this.bottom.insertMention(n)}else if(e===this.account.get("jid"))this.account.showSettings();else if(e===this.model.get("jid"))this.contact.showDetails("all-chats");else{var l=this.account.contacts.mergeContact(e);l.showDetails()}return}if(t.hasClass("circle-avatar")){let e=s?n.data("from"):i.data("from");if(this.contact.get("group_chat")){let e=s?n.attr("data-from-id"):i.attr("data-from-id");return void(e&&this.showParticipantProperties(e))}if(e===this.account.get("jid"))this.account.showSettings();else if(e===this.model.get("jid"))this.contact.showDetails("all-chats");else{let t=this.account.contacts.mergeContact(e);t.showDetails()}return}if(t.hasClass("mention")){let e=t.data("target");if(this.contact.get("group_chat")){if(e&&!this.contact.participants.get(e)){let t=this.contact.participants.find(t=>t.get("jid")===e);t&&(e=t.get("id"))}e&&this.showParticipantProperties(e)}else if(e===this.account.get("jid"))this.account.showSettings();else if(e===this.model.get("jid"))this.contact.showDetails("all-chats");else{let t=this.account.contacts.mergeContact(e);t.showDetails()}return}if(t.hasClass("voice-message-play")||t.hasClass("no-uploaded")){let e=t.closest(".link-file"),a=e.find(".file-link-download").attr("href");return e.find(".mdi-play").removeClass("no-uploaded"),e[0].voice_message=this.renderVoiceMessage(e.find(".file-container")[0],a),this.prev_audio_message&&this.prev_audio_message.voice_message.pause(),void(this.prev_audio_message=e[0])}if(t.hasClass("mdi-play")){let e=t.closest(".link-file");return this.prev_audio_message.voice_message.pause(),this.prev_audio_message=e[0],void e[0].voice_message.play()}if(t.hasClass("mdi-pause"))return void this.prev_audio_message.voice_message.pause();if(t.hasClass("msg-hyperlink")){e&&e.preventDefault();let a=t.attr("href");return void o.dialogs.ask("","Open this link?\n\n<b class='link'>"+decodeURI(a)+"</b>",null,{ok_button_text:"open"}).done(function(e){e&&o.openWindow(a)})}if(t.hasClass("uploaded-img")||t.hasClass("img-content")||t.hasClass("uploaded-img-for-collage"))return void(t.hasClass("img-content")&&t.children("img").click());if(t.hasClass("last-image"))return void t.find("img")[0].click();if(t.hasClass("image-counter"))return void t.closest(".last-image").find("img")[0].click();if(i.hasClass("searched-message"))return void this.model.getMessageContext(i.data("uniqueid"),{seached_messages:!0});let d=function(){c||(i.switchClass("selected",!i.hasClass("selected")),this.bottom.manageSelectedMessages())}.bind(this);if(i.hasClass("participant-message")||i.hasClass("context-message"))return i.hasClass("system")?void 0:void d();if(r=this.model.messages.get(i.data("uniqueid")),!r)return;var p=r.get("type");if("file_upload"===p)return;if("system"===p)return;if(s){var u=this.account.forwarded_messages.get(n.data("uniqueid"));if(!u)return;d()}else d()}},retrySendMessage:function(e){let t=d(e.target).closest(".chat-message"),a=this.model.messages.get(t.data("uniqueid"));"file_upload"===a.get("type")?(a.set("state",n.MSG_PENDING),this.startUploadFile(a,t)):this.sendMessage(a),e.preventDefault()}}),a.ExpandedMessagePanel=a.BasicView.extend({className:"modal expanded-message",template:s.group_chats.pinned_message_panel,ps_selector:".modal-content",ps_settings:{theme:"item-list"},events:{"click .collapsed-forwarded-message":"expandFwdMessage","click .chat-message":"onClickPinnedMessage"},_initialize:function(e){this.account=e.account,this.chat_content=e.chat_content},open:function(e){this.$el.css("width",60>=e.find(".chat-text-content").text().length?540:.715*a.main_panel.$el.width()),this.$el.openModal({ready:function(){this.updateScrollBar(),this.$(".modal-content").css("height",this.$el.height()-12)}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1)}.bind(this)}),e.find(".right-side .msg-delivering-state").remove(),this.$(".modal-content").html(e),this.$(".msg-copy-link").remove()},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},onClickPinnedMessage:function(e){let t=d(e.target);if(t.hasClass("msg-hyperlink")){e&&e.preventDefault();let a=t.attr("href");return void o.dialogs.ask("","Open this link?\n\n<b>"+a+"</b>",null,{ok_button_text:"open"}).done(function(e){e&&o.openWindow(a)})}},expandFwdMessage:function(e){var t=d(e.target),i=t.data("uniqueid"),n=this.chat_content.buildMessageHtml(this.account.forwarded_messages.get(i)),s=new a.ExpandedMessagePanel({account:this.account,chat_content:this.chat_content});s.$el.attr("data-color",this.account.settings.get("color")),this.chat_content.updateMessageInChat(n),this.chat_content.initPopup(n),s.open(n)}}),a.ChatsBase=Backbone.Collection.extend({model:a.Chat}),a.Chats=a.ChatsBase.extend({initialize:function(){this.collections=[],this.on("add",u.bind(this.updateInCollections,this,"add")),this.on("change",u.bind(this.updateInCollections,this,"change"))},addCollection:function(e){this.collections.push(e)},updateInCollections:function(e,t){u.each(this.collections,function(a){a.update(t,e)})},registerQuillEmbeddedsTags:function(){let e=Quill.import("blots/inline"),t=Quill.import("formats/image");class a extends e{static create(e){let t=super.create(),a=JSON.parse(e),i=a.jid?"?jid="+a.jid:a.id?"?id="+a.id:"";return t.innerHTML=a.nickname,a.is_me&&t.classList.add("ground-color-100"),t.setAttribute("data-target",i),t}static value(e){return e.innerHTML}}a.blotName="mention",a.tagName="mention",a.prototype.optimize=function(){};class i extends t{static create(e){if("string"==typeof e){var t=d(e.emojify({tag_name:"img"}))[0];return t.style.display="none",t.onload=function(){this.style.display="unset"},t}return e}static value(e){return e}}i.blotName="emoji",i.className="emoji",i.tagName="img",i.prototype.optimize=function(){},Quill.register(i),Quill.register(a)}}),a.OpenedChats=a.ChatsBase.extend({comparator:function(e,t){var a=e.get("timestamp"),i=t.get("timestamp");return a>i?-1:a<i?1:0},initialize:function(){this.on("change:timestamp",this.sort,this)},update:function(e){var t=e.get("opened");t?!this.get(e)&&(this.add(e),e.trigger("add_opened_chat",e)):this.get(e)&&(this.remove(e),e.trigger("remove_opened_chat",e))}}),a.ClosedChats=a.ChatsBase.extend({update:function(e){var t=!e.get("opened");t?!this.get(e)&&(this.add(e),e.trigger("add_closed_chat",e)):this.get(e)&&(this.remove(e),e.trigger("remove_closed_chat",e))}}),a.AccountChats=a.ChatsBase.extend({initialize:function(e,t){this.account=t.account,this.mam_requests=0,this.deferred_mam_requests=[],this.account.contacts.on("add_to_roster",this.getChat,this),this.account.contacts.on("open_chat",this.openChat,this),this.account.contacts.on("open_mention",this.openMention,this),this.account.contacts.on("presence",this.onPresence,this),this.account.contacts.on("roster_push",this.onRosterPush,this)},getChat:function(e){var t=this.get(e.hash_id);return t||(t=a.chats.create(null,{contact:e}),this.add(t),e.set("known",!0)),t},openChat:function(e,t){t=t||{},u.isUndefined(t.clear_search)&&(t.clear_search=!0);var a=this.getChat(e);a.trigger("open",{clear_search:t.clear_search})},openMention:function(e,t){var i=this.getChat(e);a.body.setScreen("mentions",{right:"mentions",chat_item:i.item_view}),t&&i.getMessageContext(t,{mention:!0})},registerMessageHandler:function(){this.account.connection.deleteHandler(this._msg_handler),this._msg_handler=this.account.connection.addHandler(function(e){return this.receiveMessage(e),!0}.bind(this),null,"message")},onStartedMAMRequest:function(e){this.deferred_mam_requests.push(e),this.runMAMRequests()},onCompletedMAMRequest:function(){this.mam_requests--,this.runMAMRequests()},runMAMRequests:function(){for(;this.mam_requests<a.settings.mam_requests_limit;){var e=this.deferred_mam_requests.shift();if(!e)break;this.mam_requests++,e.resolve()}},parsePubSubNode:function(e){if(!e)return null;var t=e.indexOf("#");return-1===t?null:e.slice(t+1,e.length)},receivePubsubMessage:function(e){var t=e.find("info").attr("id"),i=l.getBareJidFromJid(e.attr("from")),s=e.find("items").attr("node"),o=this.parsePubSubNode(s),d=this.account.contacts.get(i);if(d){if(o){if(d.my_info&&o==d.my_info.get("id")&&t==d.my_info.get("avatar"))return void d.trigger("update_my_info");if(t&&this.account.chat_settings.getHashAvatar(o)!=t){let e=l.NS.PUBSUB_AVATAR_DATA+"#"+o;d.getAvatar(t,e,function(e){this.account.chat_settings.updateCachedAvatars(o,t,e),d.my_info&&o==d.my_info.id&&(d.my_info.set({avatar:t,b64_avatar:e}),d.trigger("update_my_info"));let a=d.participants&&d.participants.get(o);a&&(a.set({avatar:t,b64_avatar:e}),this.account.groupchat_settings.updateParticipant(d.get("jid"),a.attributes))}.bind(this))}}else if(!this.get("avatar_priority")||this.get("avatar_priority")<=n.AVATAR_PRIORITIES.PUBSUB_AVATAR){if(!t){let e=g.getDefaultAvatar(d.get("name"));return d.cached_image=g.getCachedImage(e),a.cached_contacts_info.putContactInfo({jid:d.get("jid"),hash:"",avatar:e,name:d.get("name"),avatar_priority:n.AVATAR_PRIORITIES.PUBSUB_AVATAR}),d.set("avatar_priority",n.AVATAR_PRIORITIES.PUBSUB_AVATAR),d.set("photo_hash",null),void d.set("image",e)}if(""!==t&&d.get("photo_hash")===t)return;d.getAvatar(t,l.NS.PUBSUB_AVATAR_DATA,function(e){d.cached_image=g.getCachedImage(e),a.cached_contacts_info.putContactInfo({jid:d.get("jid"),hash:t,avatar:e,name:d.get("name"),avatar_priority:n.AVATAR_PRIORITIES.PUBSUB_AVATAR}),d.set("avatar_priority",n.AVATAR_PRIORITIES.PUBSUB_AVATAR),d.set("photo_hash",t),d.set("image",e)}.bind(this))}}else if(i===this.account.get("jid")){if(!t){let e=g.getDefaultAvatar(this.account.get("name"));this.account.cached_image=g.getCachedImage(e);let t={avatar_priority:n.AVATAR_PRIORITIES.PUBSUB_AVATAR,image:e};return this.account.set(t),void this.account.save(t)}this.account.getAvatar(t,function(e){this.account.cached_image=g.getCachedImage(e);let t={avatar_priority:n.AVATAR_PRIORITIES.PUBSUB_AVATAR,image:e};this.account.set(t),this.account.save(t)}.bind(this))}},receiveMessage:function(e){let t=d(e),a=t.attr("type");if(this.account.connection.do_synchronization&&l.getBareJidFromJid(d(e).attr("from"))!==this.account.get("jid")){let e=t.children("time").attr("stamp")||t.children("delay").attr("stamp"),a=+p(e);a>this.account.last_msg_timestamp&&(this.account.last_msg_timestamp=a)}return"headline"===a?this.receiveHeadlineMessage(e):"chat"===a||"normal"===a?this.receiveChatMessage(e):"error"===a?this.receiveErrorMessage(e):void 0},receiveHeadlineMessage:function(e){var t=d(e),i=l.getBareJidFromJid(t.attr("from")),s=t.find("received[xmlns=\""+l.NS.DELIVERY+"\"]"),o=t.children("x[xmlns=\""+l.NS.GROUP_CHAT+"#system-message\"][type=\"echo\"]").children("message");if(s.length){let e=s.children("stanza-id").attr("id"),t=s.children("origin-id").first().attr("id");if(t){let a=this.account.messages.get(t||e),i=s.children("time").attr("stamp")||p(e/1e3).format();if(!a)return;a.set({state:n.MSG_SENT,time:i,timestamp:+p(i)});let o=this.account._pending_messages.find(a=>a.unique_id==(t||e));o&&(this.account.chats.get(o.chat_hash_id).setStanzaId(o.unique_id,e),this.account._pending_messages.splice(this.account._pending_messages.indexOf(o),1))}return}if(o.length)return this.receiveChatMessage(o[0],{echo_msg:!0,stanza_id:o.children("stanza-id").attr("id")});let c=t.children("revoke[xmlns=\""+l.NS.AUTH_TOKENS+"\"]");if(c.length)return c.children("token-uid").each(function(e,t){let a=d(t),i=a.text();if(i&&this.account.x_tokens_list){let e=this.account.x_tokens_list.find(e=>e.token_uid==i),t=e?this.account.x_tokens_list.indexOf(e):-1;-1<t&&this.account.x_tokens_list.splice(t,1)}}.bind(this)),void this.account.settings_right.updateXTokens();if(t.find("event[xmlns=\""+l.NS.PUBSUB+"#event\"]").length)return void this.receivePubsubMessage(t);let r=this.account.contacts.get(i),u;if(r&&(u=this.account.chats.getChat(r)),t.children("attention[xmlns=\""+l.NS.ATTENTION+"\"]").length&&a.settings.call_attention)return u?u.messages.createSystemMessage({from_jid:i,message:"Attention was requested",attention:!0}):void 0;if(t.children("x[xmlns=\""+l.NS.GROUP_CHAT+"#system-message\"]").length){if(!r)return;let e=t.children("x[xmlns=\""+l.NS.GROUP_CHAT+"#user-updated\"]").attr("version");e&&r.participants&&r.participants.version<e&&r.trigger("update_participants")}if(t.find("replace[xmlns=\""+l.NS.REWRITE+"#notify\"]").length){if(!r&&(r=this.account.contacts.get(t.find("replace").attr("conversation")))&&(u=this.account.chats.getChat(r)),!u)return;let e=t.find("replace").attr("id"),i=u.messages.find(t=>t.get("stanza_id")==e||t.get("contact_stanza_id")==e),n=a.body.screen.get("right"),s="participant_messages"===n&&this.account.participant_messages||"message_context"===n&&this.account.context_messages||"searched_messages"===n&&this.account.searched_messages||[],o=s.find(t=>t.get("stanza_id")==e);this.receiveChatMessage(t,{replaced:!0}),o&&o.set("last_replace_time",t.find("replaced").attr("stamp")),i&&(i.set("last_replace_time",t.find("replaced").attr("stamp")),r.get("pinned_message")&&r.get("pinned_message").get("unique_id")===i.get("unique_id")&&(r.get("pinned_message").set("message",new_text),u.item_view.content.updatePinnedMessage()),u&&u.item_view.updateLastMessage(u.last_message))}if(t.find("retract-message").length){if(!r&&(r=this.account.contacts.get(t.find("retract-message").attr("conversation")))&&(u=this.account.chats.getChat(r)),!u)return;let e=t.find("retract-message"),a=e.attr("id"),i=u.messages.find(e=>e.get("stanza_id")==a||e.get("contact_stanza_id")==a);i&&(i.set("is_unread",!1),u.item_view.content.removeMessage(i),u.item_view.updateLastMessage(u.last_message)),e.attr("version")>u.message_retraction_version&&(u.message_retraction_version=e.attr("version"))}if(t.find("retract-user").length){var m=t.find("retract-user"),g=m.attr("id"),h=u.messages.filter(e=>e.get("user_info")&&e.get("user_info").id==g);h&&d(h).each(function(e,t){t.set("is_unread",!1),u.item_view.content.removeMessage(t)}.bind(this)),u.item_view.updateLastMessage(u.last_message)}if(t.find("retract-all").length){if(!r&&(r=this.account.contacts.get(t.find("retract-all").attr("conversation")))&&(u=this.account.chats.getChat(r)),!u)return;var v=u.messages.models;d(v).each(function(e,t){u.item_view.content.removeMessage(t)}.bind(this)),u.item_view.updateLastMessage()}if(t.find("confirm[xmlns=\""+l.NS.HTTP_AUTH+"\"]").length){let i=t.find("confirm").attr("id");if(t.attr("from")==this.account.xabber_auth.api_jid&&t.attr("id")==this.account.xabber_auth.request_id)this.account.verifyXabberAccount(i,function(e){this.account.get("auto_login_xa")&&(a.api_account.save("token",e),a.api_account.login_by_token())}.bind(this));else return this.receiveChatMessage(e)}},receiveStanzaId:function(e,t){t.replaced&&(e=e.children("replace").children("message"));let a={},i=t.from_bare_jid,n,s;return e.children("stanza-id").each(function(t,a){a=d(a),e.children("x[xmlns=\""+l.NS.GROUP_CHAT+"\"]").length?a.attr("by")===i?(n=a,s=a):n=a:a.attr("by")===this.account.get("jid")?n=a:s=a}.bind(this)),n&&(a.stanza_id=n.attr("id")),s&&(a.contact_stanza_id=s.attr("id")),a},receiveChatMessage:function(e,t){t=t||{};var i=d(e),n=i.find("forwarded"),s=t.delay,o=i.attr("to"),c=l.getBareJidFromJid(o),r=o&&l.getResourceFromJid(o),p=i.attr("from")||t.from_jid;if(i.find("invite").length&&t.forwarded)return;if(!p)return a.warn("Message without \"from\" attribute"),void a.warn(e);let m=l.getBareJidFromJid(p),g=m===this.account.get("jid");if(t.forwarded&&(!n.length||t.xml))return this.account.forwarded_messages.createFromStanza(i,{is_forwarded:!0,forwarded_message:t.forwarded_message||null,delay:s,replaced:t.replaced,from_jid:p,xml:t.xml});if(n.length&&!t.xml){var h=i.find("result[xmlns=\""+l.NS.MAM+"\"]");if(h.length){n=h.children("forwarded"),n.length&&(i=n.children("message"),s=n.children("delay"));let e=this.receiveStanzaId(i,{from_bare_jid:m});return this.receiveChatMessage(i[0],u.extend(t,{is_mam:!0,delay:s,stanza_id:e.stanza_id||h.attr("id"),contact_stanza_id:e.contact_stanza_id}))}let e=i.find("[xmlns=\""+l.NS.CARBONS+"\"]");if(e.length)return i.find("invite").length&&"sent"===e[0].tagName?void 0:(n=e.children("forwarded"),n.length&&(i=n.children("message")),e.find("request[xmlns=\""+l.NS.DELIVERY+"\"][to=\""+c+"\"]").length?void 0:this.receiveChatMessage(i[0],u.extend(t,{carbon_copied:!0})));let a=[];return n=i.children("reference[type=\"mutable\"][xmlns=\""+l.NS.REFERENCE+"\"]").children("forwarded[xmlns=\""+l.NS.FORWARD+"\"]"),n.each(function(e,i){var n=d(i),s=n.children("message"),o=n.children("delay"),c=this.receiveChatMessage(s[0],{forwarded:!0,pinned_message:t.pinned_message,participant_message:t.participant_message,searched_message:t.searched_message,is_searched:t.is_searched,context_message:t.context_message,from_jid:p,delay:o});a.push(c)}.bind(this)),this.receiveChatMessage(i[0],u.extend({forwarded_message:a.length?a:null,xml:i[0]},t))}!t.is_mam&&r&&r!==this.account.resource&&(a.warn("Message to another resource"),a.warn(e));let v=g?c:m;if(t.replaced&&(v=i.children("replace").attr("conversation")),v===this.account.get("jid"))return a.warn("Message from me to me"),void a.warn(e);var A=this.account.contacts.mergeContact(v),f=this.account.chats.getChat(A),b=this.receiveStanzaId(i,{from_bare_jid:m,carbon_copied:t.carbon_copied,replaced:t.replaced});return i.find("x[xmlns=\""+l.NS.AUTH_TOKENS+"\"]").length&&!t.is_archived&&(this.account.getAllXTokens(),!A.get("in_roster")&&A.pushInRoster()),f.receiveMessage(i,u.extend(t,{is_sender:g,stanza_id:b.stanza_id,contact_stanza_id:b.contact_stanza_id}))},receiveErrorMessage:function(e){var t=e.getAttribute("id"),a=d(e).children("origin-id").attr("id");if(t){var i=d(e).find("error").attr("code"),s=this.account.messages.get(a||t);s&&("405"===i&&s.set("state",n.MSG_BLOCKED),"406"===i&&s.set("state",n.MSG_ERROR))}},onPresence:function(e,t){var a=this.getChat(e);a.onPresence(t)},onRosterPush:function(e,t){var a=this.getChat(e);a.onRosterPush(t)}}),a.AddGroupChatView=a.SearchView.extend({className:"modal dialog-modal main-modal add-group-chat-modal add-contact-modal",template:s.group_chats.add_group_chat,avatar_size:n.AVATAR_SIZES.ACCOUNT_ITEM,ps_selector:".rich-textarea",ps_settings:{theme:"item-list"},events:{"click .account-field .dropdown-content":"selectAccount","click .btn-add":"addGroupChat","keyup .input-group-chat-name input":"updateGroupJid","keyup .rich-textarea":"showPlaceholder","keyup .input-group-chat-jid input":"fixJid","click .btn-cancel":"close","click .property-variant":"changePropertyValue"},render:function(e){if(!a.accounts.connected.length)return void o.dialogs.error("No connected accounts found.");e||(e={}),this.setDefaultSettings();var t=e.account?[e.account]:a.accounts.connected;this.$(".single-acc").showIf(1===t.length),this.$(".multiple-acc").hideIf(1===t.length),this.$(".account-field .dropdown-content").empty(),u.each(t,function(e){this.$(".account-field .dropdown-content").append(this.renderAccountItem(e))}.bind(this)),this.bindAccount(t[0]),this.$(".btn-cancel").text(this.is_login?"Skip":"Cancel"),this.$el.openModal({ready:function(){let e={inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"};Materialize.updateTextFields(),this.$(".account-field .dropdown-button").dropdown(e),this.$(".property-field .dropdown-button").dropdown(e),this.$(".property-field .select-xmpp-server .caret").dropdown(e),this.$(".property-field .select-xmpp-server .xmpp-server-item-wrap").dropdown(e)}.bind(this),complete:this.hide.bind(this)})},setDefaultSettings:function(){this.$("input[name=chat_jid]").removeClass("fixed-jid").val(""),this.$("#new_chat_domain").val(""),this.$("input[name=chat_name]").val(""),this.$(".description-field .rich-textarea").text(""),this.$(".btn-add").addClass("non-active"),this.showPlaceholder(),this.$("span.errors").text("").addClass("hidden");let e=this.$(".incognito-dropdown-wrap"),t=e.find(".dropdown-content .default-value");e.find(".incognito-item-wrap .property-value").attr("data-value",t.attr("data-value")).text(t.text());let a=this.$(".global-dropdown-wrap"),i=a.find(".dropdown-content .default-value");a.find(".global-item-wrap .property-value").attr("data-value",i.attr("data-value")).text(i.text());let n=this.$(".membership-dropdown-wrap"),s=n.find(".dropdown-content .default-value");n.find(".membership-item-wrap .property-value").attr("data-value",s.attr("data-value")).text(s.text())},bindAccount:function(e){this.account=e,this.$(".input-group-chat-domain").addClass("hidden"),this.$el.attr("data-color",this.account.settings.get("color")),this.$(".account-field .dropdown-button .account-item-wrap").replaceWith(this.renderAccountItem(e));let t=this.account.get("groupchat_servers_list");t.length?this.$(".xmpp-server-dropdown-wrap .field-jid").text(t[0]):this.setCustomDomain(this.$(".property-field.xmpp-server-dropdown-wrap .property-value")),this.$(".modal-content .jid-field .set-default-domain").remove();for(var a=0;a<t.length;a++)d("<div/>",{class:"field-jid property-variant set-default-domain"}).text(t[a]).insertBefore(this.$(".modal-content .jid-field .set-custom-domain"))},renderAccountItem:function(e){let t=d(s.add_chat_account_item({jid:e.get("jid")}));return t},selectAccount:function(e){let t=d(e.target).closest(".account-item-wrap"),i=a.accounts.get(t.data("jid"));this.bindAccount(i)},setCustomDomain:function(e){this.$("#new_chat_domain").val(""),e.text(""),this.$(".input-group-chat-domain").removeClass("hidden")},changePropertyValue:function(e){let t=d(e.target),a=t.closest(".property-field").find(".property-value");return t.hasClass("set-custom-domain")?void this.setCustomDomain(a):void(t.hasClass("set-default-domain")&&(this.$(".input-group-chat-domain").addClass("hidden"),this.$("#new_chat_domain").val("")),a.text(t.text()),a.attr("data-value",t.attr("data-value")))},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},updateGroupJid:function(){let e=this.$("input[name=chat_jid]");if(!e.hasClass("fixed-jid")){let e=slug(this.$(".input-group-chat-name input").get(0).value,{lower:!0});this.$("label[for=new_chat_jid]").addClass("active"),this.$(".input-field #new_chat_jid").get(0).value=e}this.$(".btn-add").switchClass("non-active",!this.$(".input-group-chat-name input").get(0).value)},showPlaceholder:function(){let e=""===this.$(".rich-textarea ").text();this.$(".rich-textarea-wrap .placeholder").hideIf(!e)},fixJid:function(){let e=this.$("input[name=chat_jid]");e.hasClass("fixed-jid")||e.addClass("fixed-jid"),""==e.get(0).value&&e.removeClass("fixed-jid")},createGroupChat:function(){var e=this.account.resources.connection.jid,t=this.$("input[name=chat_name]").val(),i=this.$("input[name=chat_jid]").val()?this.$("input[name=chat_jid]").val():void 0,n=this.$(".incognito-field .property-value").attr("data-value"),s=this.$("#new_chat_domain").val()||this.$(".xmpp-server-dropdown-wrap .property-value").text(),o=this.$(".global-field .property-value").attr("data-value"),r=this.$(".description-field .rich-textarea").text()||"",u=this.$(".membership-field .property-value").attr("data-value"),m=c({from:e,type:"set",to:s}).c("query",{xmlns:l.NS.GROUP_CHAT+"#create"}).c("name").t(t).up().c("privacy").t(n).up().c("index").t(o).up().c("description").t(r).up().c("membership").t(u).up();i&&m.c("localpart").t(i),this.account.sendIQ(m,function(e){let t=d(e).find("query localpart").text().trim()+"@"+d(e).attr("from").trim(),i=this.account.contacts.mergeContact(t);i.set("group_chat",!0),i.pres("subscribed"),i.pushInRoster(null,function(){i.pres("subscribe"),i.getMyInfo(),this.close(),a.chats_view.updateScreenAllChats(),i.sendPresent(),i.trigger("open_chat",i);let e=c({type:"set"}).c("block",{xmlns:l.NS.BLOCKING}).c("item",{jid:t+"/"+p.now()});this.account.sendIQ(e)}.bind(this))}.bind(this),function(){this.$(".modal-footer .errors").removeClass("hidden").text("Jid is already in use")}.bind(this))},addGroupChat:function(e){if(d(e.target).closest(".button-wrap").hasClass("non-active"))return void d(e.target).blur();var t=this.$("#new_chat_domain").val()||this.$(".xmpp-server-dropdown-wrap .property-value").text(),a=this.$("input[name=chat_jid]").val();if(""==this.$("input[name=chat_name]").val())this.$(".modal-footer .errors").text("Enter group chat name").removeClass("hidden");else if(""==a||-1==a.search(/[-]/)&&-1==a.search(/\s/)&&""!=a){this.$(".modal-footer .errors").text("").addClass("hidden");var i=c({type:"get",to:t}).c("query",{xmlns:l.NS.DISCO_INFO}),n;this.account.sendIQ(i,function(e){d(e).children("query").children("feature").each(function(e,t){d(t).attr("var")==l.NS.GROUP_CHAT&&(n=!0)}.bind(this)),n&&this.createGroupChat()}.bind(this),function(){this.$(".modal-footer .errors").removeClass("hidden").text("Invalid domain")}.bind(this))}else this.$(".modal-footer .errors").removeClass("hidden").text("Invalid jid")}}),a.ChatsView=a.SearchPanelView.extend({className:"recent-chats-container container",ps_selector:".chat-list-wrap",ps_settings:{theme:"item-list"},main_container:".chat-list",template:s.chats_panel,_initialize:function(){this.active_chat=null,this.model.on("add",this.onChatAdded,this),this.model.on("destroy",this.onChatRemoved,this),this.model.on("change:active",this.onChangedActiveStatus,this),this.model.on("change:unread",this.onChangedReadStatus,this),this.model.on("change:const_unread",this.onChangedReadStatus,this),this.model.on("change:timestamp",this.updateChatPosition,this),a.accounts.on("list_changed",this.updateLeftIndicator,this);let e=this.defineMouseWheelEvent();this.$el.on(e,this.onMouseWheel.bind(this)),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this)),this.ps_container.on("ps-scroll-down",this.onScroll.bind(this)),this.$(".read-all-button").click(this.readAllMessages.bind(this)),a.on("update_screen",this.onUpdatedScreen,this),a.on("update_layout",this.onWindowResized,this),this.$("input").on("input",this.updateSearch.bind(this))},render:function(e){void 0===e.right&&(this.active_chat=null),this.$(".chat-list-wrap").switchClass("with-padding",a.toolbar_view.$(".toolbar-item.unread").length),("chat"!==e.right&&"contact_details"!==e.right&&"searched_messages"!==e.right&&"message_context"!==e.right&&"participant_messages"!==e.right||e.clear_search)&&(this.clearSearch(),a.toolbar_view.$(".active").hasClass("all-chats")&&this.showAllChats())},readAllMessages:function(){let e=this.model,t=a.toolbar_view.$(".active");if(t.hasClass("chats")){let t=e.filter(e=>!e.contact.get("group_chat")&&e.get("timestamp")&&!e.contact.get("archived")&&(e.get("unread")||e.get("const_unread")));t.forEach(function(e){e.item_view.content.readMessages()}.bind(this))}if(t.hasClass("all-chats")){let t=e.filter(e=>e.get("timestamp")&&!e.contact.get("archived")&&(e.get("unread")||e.get("const_unread")));t.forEach(function(e){e.item_view.content.readMessages()}.bind(this))}if(t.hasClass("group-chats")){let t=e.filter(e=>e.contact.get("group_chat")&&e.get("timestamp")&&!e.contact.get("archived")&&(e.get("unread")||e.get("const_unread")));t.forEach(function(e){e.item_view.content.readMessages()}.bind(this))}},onUpdatedScreen:function(){this.$(".read-all-button").switchClass("hidden",!a.toolbar_view.$(".toolbar-item.active.unread").length)},onWindowResized:function(e){e.size_changed&&this.onScroll()},defineMouseWheelEvent:function(){return u.isUndefined(window.onwheel)?u.isUndefined(window.onmousewheel)?"MozMousePixelScroll":"mousewheel":"wheel"},onMouseWheel:function(e){0<e.originalEvent.deltaY&&this.onScroll()},hideChatsFeedback:function(){clearTimeout(this._load_chats_timeout),this.$(".load-chats-feedback").addClass("hidden"),this.updateScrollBar(),this._load_chats_timeout=null},onScroll:function(){if(12>this.getScrollBottom()&&!this._load_chats_timeout){this._load_chats_timeout=setTimeout(function(){this.hideChatsFeedback()}.bind(this),5e3);let e=a.accounts.connected.filter(e=>!e.roster.conversations_loaded&&e.connection&&e.connection.do_synchronization);e.length&&(this.$(".load-chats-feedback").text("Loading...").removeClass("hidden"),this.updateScrollBar()),e.forEach(function(e){let t={max:a.settings.mam_messages_limit};e.roster.last_chat_msg_id&&(t.after=e.roster.last_chat_msg_id),e.roster.syncFromServer(t)}.bind(this))}},updateLeftIndicator:function(e){this.$el.attr("data-indicator",1<e.connected.length)},onChatAdded:function(e){this.addChild(e.id,e.item_view),this.updateChatPosition(e)},onChatRemoved:function(e,t){this.active_chat===this.child(e.id)&&(this.active_chat=null,a.body.setScreen(null,{chat_item:null},{silent:!a.body.isScreen("all-chats")})),this.removeChild(e.id,t),this.updateScrollBar()},onChangedActiveStatus:function(e){if(e.get("active")){var t=this.active_chat;this.active_chat=this.child(e.id),t&&t.model.set("active",!1)}},onChangedReadStatus:function(e){let t=this.child(e.id),i=a.toolbar_view.$(".active");!t||!i.hasClass("unread")||i.hasClass("unread")&&(e.get("unread")||e.get("const_unread"))||(t.detach(),!this.$(".chat-item").length&&i.hasClass("unread")&&i.click())},replaceChatItem:function(e,t){let a=this.child(e.id);if(a&&e.get("timestamp")){a.$el.detach();let i=t.indexOf(e);0===i?this.$(".chat-list").prepend(a.$el):this.$(".chat-item").eq(i-1).after(a.$el)}},updateChatPosition:function(e){let t=this.child(e.id),i=a.toolbar_view.$(".active");t&&(!i.hasClass("unread")||e.get("unread")||e.get("const_unread"))&&(i.hasClass("group-chats")&&t.contact.get("group_chat")&&this.replaceChatItem(e,this.model.filter(e=>e.contact.get("group_chat")&&!e.contact.get("archived"))),i.hasClass("chats")&&!t.contact.get("group_chat")&&this.replaceChatItem(e,this.model.filter(e=>!e.contact.get("group_chat")&&!e.contact.get("archived"))),i.hasClass("all-chats")&&!t.contact.get("archived")&&this.replaceChatItem(e,this.model.filter(e=>!e.contact.get("archived"))),i.hasClass("archive-chats")&&t.contact.get("archived")&&this.replaceChatItem(e,this.model.filter(e=>e.contact.get("archived"))),i.hasClass("account-item")&&t.account.get("jid")===i.attr("data-jid")&&this.replaceChatItem(e,this.model.filter(e=>e.account.get("jid")===i.attr("data-jid")&&!e.contact.get("archived"))))},onEnterPressed:function(e){let t;e.closest(".searched-lists-wrap").length?(this.clearSearch(),this.$(".list-item.active").removeClass("active"),e.hasClass("chat-item")&&(t=this.child(e.data("id")),t&&t.open(),e.addClass("active")),e.hasClass("roster-contact")&&(t=a.accounts.get(e.data("account")).chats.get(a.accounts.get(e.data("account")).contacts.get(e.data("jid")).hash_id),t&&(t=t.item_view),t&&a.chats_view.openChat(t,{clear_search:!1,screen:a.body.screen.get("name")}),e.addClass("active")),e.hasClass("message-item")&&e.click()):(t=this.child(e.data("id")),t&&t.open())},openChat:function(e,t){t=t||{},this.$(".list-item.active").removeClass("active"),e.updateActiveStatus();let i=a.chats_view.getScrollTop();if(t.clear_search&&this.clearSearch(),!e.contact.get("in_roster")&&!1==e.model.get("is_accepted"))e.model.set("display",!0),e.model.set("active",!0),a.body.setScreen("all-chats",{right:"group_invitation",contact:e.contact});else{if(a.toolbar_view.$(".active").hasClass("contacts")&&this.updateScreenAllChats(),!e.model.get("history_loaded")&&20>e.model.messages.length&&e.content.loadPreviousHistory(),!e.model.get("displayed_sent")&&e.model.messages.length){let t=e.model.messages.models[e.model.messages.length-1];t&&!t.isSenderMe()&&(e.model.get("unread")||e.model.get("const_unread"))&&(e.model.sendMarker(t.get("msgid"),"displayed",t.get("stanza_id"),t.get("contact_stanza_id")),e.model.set("displayed_sent",!0))}a.body.setScreen(t.screen||"all-chats",{right:"chat",clear_search:t.clear_search,chat_item:e,blocked:e.contact.get("blocked")}),(!e.contact.get("vcard_updated")||e.contact.get("vcard_updated")&&p(e.contact.get("vcard_updated")).startOf("hour").isSame(p().startOf("hour")))&&e.contact.getVCard()}a.chats_view.scrollTo(i)},showGroupChats:function(){this.$(".chat-item").detach();let e=this.model,t=a.toolbar_view.$(".active.unread").length,i=[];t&&(i=e.filter(e=>e.contact.get("group_chat")&&e.get("timestamp")&&!e.contact.get("archived")&&(e.get("unread")||e.get("const_unread")))),i.length||(i=e.filter(e=>e.contact.get("group_chat")&&e.get("timestamp")&&!e.contact.get("archived")),a.toolbar_view.$(".toolbar-item.unread").removeClass("unread"),this.onUpdatedScreen()),i.forEach(function(e){this.$(".chat-list").append(e.item_view.$el)})},showChats:function(){this.$(".chat-item").detach();let e=this.model,t=a.toolbar_view.$(".active.unread").length,i=[];t&&(i=e.filter(e=>!e.contact.get("group_chat")&&e.get("timestamp")&&!e.contact.get("archived")&&(e.get("unread")||e.get("const_unread")))),i.length||(i=e.filter(e=>!e.contact.get("group_chat")&&e.get("timestamp")&&!e.contact.get("archived")),a.toolbar_view.$(".toolbar-item.unread").removeClass("unread"),this.onUpdatedScreen()),i.forEach(function(e){this.$(".chat-list").append(e.item_view.$el)})},showChatsByAccount:function(e){a.body.setScreen("all-chats"),this.$(".chat-item").detach();let t=this.model,i=t.filter(t=>t.account.get("jid")===e.get("jid")&&t.get("timestamp")&&!t.contact.get("archived"));i.forEach(function(e){this.$(".chat-list").append(e.item_view.$el)})},showArchiveChats:function(){this.$(".chat-item").detach();let e=this.model,t=e.filter(e=>e.contact.get("archived"));t.forEach(function(e){this.$(".chat-list").append(e.item_view.$el)})},showAllChats:function(){this.$(".chat-item").detach();let e=this.model,t=a.toolbar_view.$(".active.unread").length,i=[];t&&(i=e.filter(e=>e.get("timestamp")&&!e.contact.get("archived")&&(e.get("unread")||e.get("const_unread")))),i.length||(i=e.filter(e=>e.get("timestamp")&&!e.contact.get("archived")),a.toolbar_view.$(".toolbar-item.unread").removeClass("unread"),this.onUpdatedScreen()),i.forEach(function(e){this.$(".chat-list").append(e.item_view.$el)})},updateScreenAllChats:function(){a.toolbar_view.$(".toolbar-item").removeClass("active").filter(".all-chats").addClass("active"),this.showAllChats()}}),a.MessageItemView=a.BasicView.extend({className:"message-item list-item",template:s.message_item,avatar_size:n.AVATAR_SIZES.CHAT_ITEM,events:{click:"openByClick"},_initialize:function(){this.contact=this.model.contact,this.account=this.contact.account,this.$el.attr("data-id",this.model.id+"-"+this.cid),this.$el.attr("data-contact-jid",this.contact.get("jid")),this.updateName(),this.updateLastMessage(),this.updateAvatar(),this.updateColorScheme(),this.updateGroupChats(),this.updateIcon(),this.account.settings.on("change:color",this.updateColorScheme,this),this.contact.on("change:name",this.updateName,this)},updateName:function(){this.$(".chat-title").text(this.contact.get("name"))},updateAvatar:function(){var e=this.contact.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},updateGroupChats:function(){var e=this.contact.get("group_chat");this.$(".status").hideIf(e),this.updateIcon(),e&&(this.$el.addClass("group-chat"),this.$(".chat-title").css("color","#424242"),this.model.set("group_chat",!0))},updateIcon:function(){this.$(".chat-icon").addClass("hidden");let e=this.contact.getIcon();e&&this.$(".chat-icon").removeClass("hidden").children("svg").html(i.templates.svg[e]())},updateColorScheme:function(){var e=this.account.settings.get("color");this.$el.attr("data-color",e)},updateLastMessage:function(e){if(e||(e=this.model),!e)return;let t=e.get("time"),a=e.get("timestamp"),i=e.get("forwarded_message"),s=e.get("files")||[],c=e.get("images")||[],r=i?e.get("message")||(1<i.length?i.length+" forwarded messages":"Forwarded message").italics():e.getText(),l=e.get("user_info")||e.isSenderMe()&&this.contact.my_info&&this.contact.my_info.attributes||{},p="";if(this.model.set({timestamp:a}),this.contact.get("group_chat")&&(p=l.nickname||l.jid||(e.isSenderMe()?this.account.get("name"):e.get("from_jid"))||""),s.length||c.length){let e=d("<span class=\"text-color-500\"/>");s.length&&c.length?r=e.text(s.length+c.length+" files"):(1<s.length&&(r=e.text(s.length+" files")),1==s.length&&(r=e.text(s[0].is_audio||s[0].voice?"Voice message, "+o.pretty_duration(s[0].duration):s[0].name)),1<c.length&&(r=e.text(c.length+" images")),1==c.length&&(r=e.text(c[0].name))),this.$(".last-msg").html("").append(p).append(r)}else this.$(".last-msg").text("").append(r),p&&this.$(".last-msg").prepend(d("<span class=text-color-700>"+p+": </span>"));this.$el.emojify(".last-msg",{emoji_size:16}).hyperlinkify({decode_uri:!0}),this.$(".last-msg-date").text(o.pretty_short_datetime_recent_chat(t)).attr("title",o.pretty_datetime(t)),this.$(".msg-delivering-state").showIf(e.isSenderMe()&&e.get("state")!==n.MSG_ARCHIVED).attr("data-state",e.getState())},openByClick:function(){let e=this.account.chats.getChat(this.contact);this.$el.closest(".left-panel-list-wrap").find(".list-item").removeClass("active"),this.$el.addClass("active"),a.body.setScreen(a.body.screen.get("name"),{right:"message_context",chat_item:e.item_view}),this.model.get("unique_id")&&e.getMessageContext(this.model.get("unique_id"),{message:!0})}}),a.ForwardPanelView=a.SearchView.extend({className:"modal dialog-modal forward-panel-modal",template:s.forward_panel,ps_selector:".chat-list-wrap",ps_settings:{theme:"item-list"},open:function(e,t){this.messages=e,this.account=t,this.$(".chat-list-wrap").html(""),a.chats_view.$(".chat-list .chat-item").each(function(e,t){let a=this.account.chats.get(d(t).data("id"));a&&this.$(".chat-list-wrap").append(d(t).clone().removeClass("hidden"))}.bind(this)),this.$(".chat-list-wrap").prepend(d("<div/>",{class:"forward-panel-list-title recent-chats-title hidden"}).text("Recent chats")),this.$(".chat-list-wrap").append(d("<div/>",{class:"forward-panel-list-title contacts-title hidden"}).text("Contacts")),this.$(".chat-item").removeClass("active"),this.clearSearch(),this.data.set("visible",!0),this.$el.openModal({ready:function(){this.updateScrollBar(),this.$(".search-input").focus()}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1)}.bind(this)})},close:function(){var e=new d.Deferred;return this.$el.closeModal({complete:function(){this.$el.detach(),this.data.set("visible",!1),e.resolve()}.bind(this)}),e.promise()},onClickItem:function(e){let t=d(e.target).closest(".list-item");this.onEnterPressed(t)},search:function(e){let t=!1,i=!1,n=!1,s,o;e=e.toLowerCase(),this.$(".roster-contact.list-item").remove(),e&&this.account.roster.forEach(function(t){let i=t.get("jid"),s=t.hash_id,o=t.get("name").toLowerCase(),d=!!(0>o.indexOf(e)&&0>i.indexOf(e));if(!d)if(!this.$(".chat-list-wrap .chat-item[data-id=\""+s+"\"]").length){let e=a.contacts_view.$(".account-roster-wrap[data-jid=\""+this.account.get("jid")+"\"] .roster-contact[data-jid=\""+i+"\"]").first().clone();e.find(".muted-icon").hide(),this.$(".chat-list-wrap").append(e)}else d=!0;d||(n=!0)}.bind(this)),this.$(".contacts-title").switchClass("hidden",!n),this.$(".chat-item").each(function(a,n){let c=this.account.chats.get(d(n).data("id"));return c?void(s=c.get("jid"),o=c.contact.get("name").toLowerCase(),t=!!(0>o.indexOf(e)&&0>s.indexOf(e)),d(n).hideIf(t),!t&&(i=!0)):void d(n).addClass("hidden")}.bind(this)),this.$(".recent-chats-title").switchClass("hidden",!i),this.$(".modal-content .error").showIf(!n&&!i),this.scrollToTop()},onEmptyQuery:function(){this.$(".roster-contact.list-item").remove(),this.$(".contacts-title").addClass("hidden"),this.$(".recent-chats-title").addClass("hidden")},onEnterPressed:function(e){let t;e.hasClass("roster-contact")&&(t=a.chats_view.child(this.account.contacts.get(e.data("jid")).hash_id)),e.hasClass("chat-item")&&(t=a.chats_view.child(e.data("id"))),t&&this.forwardTo(t)},forwardTo:function(e){e.content.bottom.setForwardedMessages(this.messages),this.messages=[],this.close().done(function(){e.open({clear_search:!0})})}}),a.InvitationPanelView=a.SearchView.extend({className:"modal dialog-modal add-user-group-chat",template:s.group_chats.invitation_panel_view,ps_selector:".contacts-list-wrap",ps_settings:{theme:"item-list"},_initialize:function(){this.registerClickEvents()},open:function(e,t){this.selected_contacts=[],this.account=e,this.contact=t,this.clearPanel(),a.contacts_view.$(".account-roster-wrap[data-jid=\""+this.account.get("jid")+"\"] .roster-group").each(function(e,t){let a=d(t).clone();d(a).find(".list-item").each(function(e,t){let a=this.account.contacts.get(d(t).attr("data-jid"));a.get("group_chat")&&t.remove()}.bind(this)),a.children(".list-item").length&&(this.$(".contacts-list-wrap").append(a),a.find(".arrow").click(function(e){this.toggleContacts(e)}.bind(this)),a.find(".group-head").click(function(e){this.selectAllGroup(e)}.bind(this)))}.bind(this)),this.data.set("visible",!0),this.$el.openModal({ready:function(){this.updateScrollBar(),this.$(".search-input").focus()}.bind(this),complete:function(){this.$el.detach(),this.data.set("visible",!1),this.selected_contacts=[]}.bind(this)})},addSelectedUsers:function(){return this.selected_contacts.length?void(d(this.selected_contacts).each(function(e,t){this.sendInvite(t)}.bind(this)),this.close()):void this.$(".modal-footer button").blur()},clearPanel:function(){this.$(".modal-footer .errors").text(""),this.$(".counter").text(""),this.$(".contacts-list-wrap").empty(),this.clearSearch()},registerClickEvents:function(){this.$(".btn-cancel").click(function(){this.close()}.bind(this)),this.$(".btn-add").click(function(){this.addSelectedUsers()}.bind(this))},addUser:function(e){var t=d(e.target).closest(".list-item"),a=t.attr("data-jid");t.toggleClass("click-selected");let i=this.selected_contacts.indexOf(a);-1<i?this.selected_contacts.splice(i,1):this.selected_contacts.push(a),this.updateCounter()},sendInvite:function(e){let t="member-only"===this.contact.get("group_info").model,a=c({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("invite",{xmlns:l.NS.GROUP_CHAT+"#invite"}).c("jid").t(e).up().c("send").t(t).up().c("reason").t("incognito"===this.contact.get("group_info").anonymous?"You are invited to incognito group chat. If you join it, you won't see real XMPP IDs of other participants":"You are invited to group chat. If you accept, "+e+" username shall be visible to group chat participants");this.account.sendIQ(a,function(){t||this.sendInviteMessage(e),this.close()}.bind(this),function(e){this.onInviteError(e)}.bind(this))},onInviteError:function(e){var t;0<d(e).find("not-allowed").length&&(t=d(e).find("text").text()||"You have no permission"),0<d(e).find("conflict").length&&(t=d(e).find("text").text()||d(e).find("invite").find("jid").text()+" already invited in group chat"),this.$(".modal-footer .errors").removeClass("hidden").text(t)},sendInviteMessage:function(e){var t="Add "+this.contact.get("jid")+" to the contacts to join a group chat",a=r({from:this.account.get("jid"),to:e,type:"chat",id:m()}).c("invite",{xmlns:l.NS.GROUP_CHAT+"#invite",jid:this.contact.get("jid")}).c("reason").t("incognito"===this.contact.get("group_info").anonymous?"You are invited to incognito group chat. If you join it, you won't see real XMPP IDs of other participants":"You are invited to group chat. If you accept, "+e+" username shall be visible to group chat participants").up().up().c("x",{xmlns:l.NS.GROUP_CHAT}).c("privacy").t(this.contact.get("group_info").anonymous).up().up().c("body").t(t).up();this.account.sendMsg(a)},search:function(e){e=e.toLowerCase(),e&&this.$(".list-item").each(function(t,a){let i=d(a).attr("data-jid"),n=this.account.contacts.get(i).get("name").toLowerCase(),s=1<this.$(".list-item[data-jid=\""+i+"\"]").length&&!this.$(".list-item[data-jid=\""+i+"\"]").first().is(d(a));d(a).hideIf(0>n.indexOf(e)&&0>i.indexOf(e)||s)}.bind(this)),this.$(".group-head").addClass("hidden"),this.$(".modal-content .error").switchClass("hidden",this.$(".list-item").length!==this.$(".list-item.hidden").length),this.scrollToTop()},onEmptyQuery:function(){this.$(".list-item").removeClass("hidden"),this.$(".group-head").removeClass("hidden")},onClickItem:function(e){this.addUser(e)},onEnterPressed:function(e){let t=e.attr("data-jid"),a=this.selected_contacts.indexOf(t);-1<a&&this.selected_contacts.splice(a,1),this.selected_contacts.push(t),this.updateCounter(),this.addSelectedUsers()},close:function(){this.$el.closeModal({complete:this.hide.bind(this)})},toggleContacts:function(e){var t=d(e.target).hasClass("mdi-chevron-down");if(t){var a=d(e.target).closest(".roster-group");a.find(".list-item").each(function(e,t){d(t).addClass("hidden")}.bind(this))}else{var a=d(e.target).closest(".roster-group");a.find(".list-item").each(function(e,t){d(t).removeClass("hidden")}.bind(this))}d(e.target).switchClass("mdi-chevron-right",t),d(e.target).switchClass("mdi-chevron-down",!t),this.updateScrollBar()},selectAllGroup:function(e){if(!d(e.target).hasClass("arrow")){var t=d(e.target).closest(".roster-group");t.hasClass("click-selected")?(t.removeClass("click-selected"),t.find(".list-item").each(function(e,t){var a=d(t).attr("data-jid"),i=this.selected_contacts.indexOf(a);-1<i&&(this.selected_contacts.splice(i,1),d(t).removeClass("click-selected"))}.bind(this))):(t.addClass("click-selected"),t.find(".list-item").each(function(e,t){var a=d(t).attr("data-jid"),i=this.selected_contacts.indexOf(a);-1<i||(this.selected_contacts.push(a),d(t).addClass("click-selected"))}.bind(this))),this.updateCounter()}},updateCounter:function(){var e=this.$(".list-item.click-selected").length;e?this.$(".counter").removeClass("hidden").text(e):this.$(".counter").text("")}}),a.ChatHeadView=a.BasicView.extend({className:"chat-head-wrap",template:s.chat_head,avatar_size:n.AVATAR_SIZES.CHAT_HEAD,events:{"click .contact-name":"showContactDetails","click .circle-avatar":"showContactDetails","click .btn-notifications":"changeNotifications","click .btn-contact-details":"showContactDetails","click .btn-clear-history":"clearHistory","click .btn-invite-users":"inviteUsers","click .btn-delete-chat":"deleteChat","click .btn-delete-contact":"deleteContact","click .btn-block-contact":"blockContact","click .btn-unblock-contact":"unblockContact","click .btn-export-history":"exportHistory","click .btn-archive-chat":"archiveChat","click .btn-call-attention":"callAttention","click .btn-search-messages":"renderSearchPanel","click .btn-jingle-message":"sendJingleMessage","click .btn-set-status":"setStatus"},_initialize:function(e){this.content=e.content,this.contact=this.content.contact,this.model=this.content.model,this.account=this.model.account,this.updateName(),this.updateStatus(),this.updateAvatar(),this.updateNotifications(),this.updateArchiveButton(),this.model.on("close_chat",this.closeChat,this),this.contact.on("change",this.onContactChanged,this),this.contact.on("archive_chat",this.archiveChat,this),this.contact.on("change:name",this.updateName,this),this.contact.on("change:status_updated",this.updateStatus,this),this.contact.on("change:image",this.updateAvatar,this),this.contact.on("change:blocked",this.onChangedBlocked,this),this.contact.on("change:muted",this.updateNotifications,this),this.contact.on("change:group_chat",this.updateGroupChatHead,this),this.contact.on("change:in_roster",this.updateMenu,this),a.on("change:audio",this.updateGroupChatHead,this)},render:function(){return this.$(".tooltipped").tooltip("remove"),this.$(".tooltipped").tooltip({delay:50}),this.$(".btn-more").dropdown({inDuration:100,outDuration:100,hover:!1}),this.$(".chat-head-menu").hide(),this.updateMenu(),this.updateStatusMsg(),this.updateGroupChatHead(),this},updateName:function(){this.$(".contact-name").text(this.contact.get("name"))},updateStatus:function(){var e=this.contact.get("status"),t=this.contact.getStatusMessage();this.$(".contact-status").attr("data-status",e),this.$(".chat-icon").attr("data-status",e),this.contact.get("blocked")?this.$(".contact-status-message").text("Contact blocked"):this.$(".contact-status-message").text(t)},updateStatusMsg:function(){this.$(".contact-status-message").text(this.contact.getStatusMessage())},updateAvatar:function(){var e=this.contact.cached_image;this.$(".circle-avatar").setAvatar(e,this.avatar_size)},onContactChanged:function(){let e=this.contact.changed;(u.has(e,"subscription_request_in")||u.has(e,"subscription_request_out")||u.has(e,"subscription")||u.has(e,"status_message"))&&this.updateStatusMsg(),(u.has(e,"private_chat")||u.has(e,"incognito_chat"))&&this.updateIcon()},onChangedBlocked:function(){this.updateMenu(),this.updateStatusMsg(),this.updateIcon()},updateMenu:function(){var e=this.contact.get("group_chat");this.$(".btn-invite-users").showIf(e),this.$(".btn-call-attention").hideIf(e),this.$(".btn-retract-own-messages").showIf(e),this.$(".btn-block-contact").hideIf(this.contact.get("blocked")),this.$(".btn-unblock-contact").showIf(this.contact.get("blocked")),this.$(".btn-delete-contact").showIf(this.contact.get("in_roster"))},renderSearchPanel:function(){let e;this.content.isVisible()&&(e=this.content),this.contact.messages_view&&this.contact.messages_view.isVisible()&&(e=this.contact.messages_view),e.$search_form.slideToggle(200,function(){"none"!==e.$search_form.css("display")&&e.$search_form.find("input").focus()}.bind(this))},showContactDetails:function(){this.contact.showDetails("all-chats")},updateNotifications:function(){var e=this.contact.get("muted");this.$(".btn-notifications .muted-icon").switchClass("mdi-bell",!e).switchClass("mdi-bell-off",e)},changeNotifications:function(){var e=!this.contact.get("muted");this.contact.set("muted",e),this.account.chat_settings.updateMutedList(this.contact.get("jid"),e)},callAttention:function(){let e=r({type:"headline",to:this.contact.get("jid")}).c("attention",{xmlns:l.NS.ATTENTION});this.account.sendMsg(e),this.model.messages.createSystemMessage({from_jid:this.account.get("jid"),message:"Call attention was sent"})},archiveChat:function(e){if(e&&(d(e.target).hasClass("mdi-package-down")||d(e.target).hasClass("mdi-package-up"))){for(var t=this.model.item_view.$el,a=t,i=null,n;null==i&&0<a.length;)if(a=a.next(),a&&!a.hasClass("hidden")){var s=a.attr("data-id");i=this.account.chats.get(s)}null==i?this.getActiveScreen():(n=i.contact,n.trigger("open_chat",n))}var o=!this.contact.get("archived"),c=!!o;this.contact.set("archived",o),this.model.messages.length||this.model.item_view.updateLastMessage(),this.$(".btn-archive-chat .mdi").switchClass("mdi-package-up",c),this.$(".btn-archive-chat .mdi").switchClass("mdi-package-down",!c),this.account.chat_settings.updateArchiveChatsList(this.contact.get("jid"),o)},sendJingleMessage:function(){return a.current_voip_call?void o.callback_popup_message("Voice call is already in progress",1e3):void this.content.initJingleMessage()},setStatus:function(){let e=new a.SetGroupchatStatusView;e.open(this.contact)},getActiveScreen:function(){var e=a.toolbar_view.$(".active");return e.hasClass("archive-chats")?void a.toolbar_view.showArchive():e.hasClass("all-chats")?void a.toolbar_view.showAllChats():e.hasClass("chats")?void a.toolbar_view.showChats():e.hasClass("group-chats")?void a.toolbar_view.showGroupChats():e.hasClass("account-item")?void a.toolbar_view.showChatsByAccount():void 0},updateArchiveButton:function(){var e=this.contact.get("archived"),t=!!e;this.contact.set("archived",e),this.$(".btn-archive-chat .mdi").switchClass("mdi-package-up",t),this.$(".btn-archive-chat .mdi").switchClass("mdi-package-down",!t)},updateGroupChatHead:function(){var e=this.contact.get("group_chat");this.updateIcon(),this.$(".btn-jingle-message").showIf(!e&&a.get("audio")),this.$(".btn-set-status").showIf(e),this.$(".contact-status").hideIf(e)},updateIcon:function(){this.$(".chat-icon").addClass("hidden");let e=this.contact.getIcon();e&&this.$(".chat-icon").removeClass("hidden").children("svg").html(i.templates.svg[e]())},inviteUsers:function(){a.invite_panel.open(this.account,this.contact)},clearHistory:function(){this.content.clearHistory(),a.chats_view.clearSearch()},leaveGroupChat:function(){this.contact.declineSubscription(),this.contact.removeFromRoster(),this.contact.set("in_roster",!1)},closeChat:function(){this.model.set({opened:!1,display:!1,active:!1}),a.chats_view.clearSearch()},deleteChat:function(){if(this.contact.get("group_chat"))o.dialogs.ask("Delete chat","If you delete a group chat, you won't receive messages from it",null,{ok_button_text:"delete"}).done(function(e){e&&(this.account.connection&&this.account.connection.do_synchronization&&this.model.deleteFromSynchronization(),this.leaveGroupChat(),this.closeChat())}.bind(this));else{let e=this.account.server_features.get(l.NS.REWRITE);o.dialogs.ask("Delete chat","Are you sure you want to <b>delete all message history</b> for this chat?"+(e?"":("\nWarning! <b>"+this.account.domain+"</b> server does not support message deletion. Only local message history will be deleted.").fontcolor("#E53935")),null,{ok_button_text:e?"delete":"delete locally"}).done(function(t){if(t){if(this.account.connection&&this.account.connection.do_synchronization&&this.model.deleteFromSynchronization(),e)this.model.retractAllMessages(!1);else{let e=this.model.messages.models;d(e).each(function(e,t){this.model.item_view.content.removeMessage(t)}.bind(this))}this.closeChat()}}.bind(this))}},deleteContact:function(){this.contact.details_view.deleteContact()},blockContact:function(){this.contact.details_view.blockContact()},unblockContact:function(){this.contact.details_view.unblockContact()},exportHistory:function(){o.callback_popup_message("History export is not implemented yet",2e3)}}),a.ChatBottomView=a.BasicView.extend({className:"chat-bottom-wrap",template:s.chat_bottom,avatar_size:n.AVATAR_SIZES.CHAT_BOTTOM,mention_avatar_size:n.AVATAR_SIZES.MENTION_ITEM,events:{click:"onClickBottom","click .my-avatar":"showAccountSettings","keyup .input-message .rich-textarea":"keyUp","keydown .input-message .rich-textarea":"keyDown","change .attach-file input":"onFileInputChanged","mouseup .attach-voice-message":"writeVoiceMessage","mouseup .message-input-panel":"stopWritingVoiceMessage","mousedown .attach-voice-message":"writeVoiceMessage","click .close-forward":"unsetForwardedMessages","click .send-message":"submit","click .markup-text":"onShowMarkupPanel","click .reply-message":"replyMessages","click .forward-message":"forwardMessages","click .pin-message":"pinMessage","click .copy-message":"copyMessages","click .edit-message":"showEditPanel","click .btn-save":"submit","click .delete-message":"deleteMessages","click .close-message-panel":"resetSelectedMessages","click .mention-item":"inputMention","click .format-text":"updateMarkupPanel"},_initialize:function(e){let t=this.$(".rich-textarea-wrap"),s={enter:{key:13,handler:function(e){"enter"!==a.settings.hotkeys&&this.quill.insertText(e.index,"\n")}},arrow_up:{key:n.KEY_ARROW_UP,handler:function(){if("none"!==this.$(".mentions-list").css("display")){let e=this.$(".mentions-list").children(".active.mention-item");if(e.length){let t=e.prev(".mention-item");e.removeClass("active"),t.length||(t=this.$(".mentions-list").children(".mention-item").last().addClass("active"),this.$(".mentions-list")[0].scrollTop=this.$(".mentions-list")[0].scrollHeight),t.addClass("active"),t.length&&t[0].offsetTop<=this.$(".mentions-list")[0].scrollTop&&(this.$(".mentions-list")[0].scrollTop=t[0].offsetTop)}else this.$(".mentions-list")[0].scrollTop=this.$(".mentions-list")[0].scrollHeight,this.$(".mentions-list").children(".mention-item").last().addClass("active");return!1}return!0}.bind(this)},arrow_down:{key:n.KEY_ARROW_DOWN,handler:function(){if("none"!==this.$(".mentions-list").css("display")){let e=this.$(".mentions-list").children(".active.mention-item");if(e.length){let t=e.next(".mention-item");e.removeClass("active"),t.length||(t=this.$(".mentions-list").children(".mention-item").first(),this.$(".mentions-list")[0].scrollTop=0),t.addClass("active"),t.length&&t[0].offsetTop+t[0].clientHeight>=this.$(".mentions-list")[0].scrollTop+this.$(".mentions-list")[0].clientHeight&&(this.$(".mentions-list")[0].scrollTop=t[0].offsetTop-this.$(".mentions-list")[0].clientHeight+t[0].clientHeight)}else this.$(".mentions-list")[0].scrollTop=0,this.$(".mentions-list").children(".mention-item").first().addClass("active");return!1}return!0}.bind(this)},arrow_left:{key:n.KEY_ARROW_LEFT,handler:function(){return"none"===this.$(".mentions-list").css("display")}.bind(this)},arrow_right:{key:n.KEY_ARROW_RIGHT,handler:function(){return"none"===this.$(".mentions-list").css("display")}.bind(this)}};this.quill=new Quill(t[0],{modules:{keyboard:{bindings:s},toolbar:[["bold","italic","underline","strike","blockquote"],["clean"]]},formats:["bold","italic","underline","strike","blockquote","clean","emoji","mention"],placeholder:"Write a message...",scrollingContainer:".rich-textarea",theme:"snow"}),this.quill.container.firstChild.classList.add("rich-textarea"),this.view=e.content,this.model=this.view.model,this.contact=this.view.contact,this.account=this.view.account,this.fwd_messages=[],this.edit_message=null,this.$(".account-jid").text(this.account.get("jid")),this.updateAvatar(),this.quill.on("text-change",this.onChangedText,this),this.account.on("change:image",this.updateAvatar,this),this.contact.on("change:blocked",this.onBlockedUpdate,this),this.contact.on("reply_selected_messages",this.replyMessages,this),this.contact.on("forward_selected_messages",this.forwardMessages,this),this.contact.on("copy_selected_messages",this.copyMessages,this),this.contact.on("delete_selected_messages",this.deleteMessages,this),this.contact.on("edit_selected_message",this.showEditPanel,this),this.contact.on("pin_selected_message",this.pinMessage,this),this.contact.on("update_my_info",this.updateInfoInBottom,this),this.contact.on("reset_selected_messages",this.resetSelectedMessages,this);var o=this.$(".input-message .rich-textarea"),c=o[0],r=o.parent(".rich-textarea-wrap"),l=o.siblings(".placeholder");c.onpaste=this.onPaste.bind(this),c.oncut=this.onCut.bind(this),c.ondragenter=function(e){e.preventDefault(),l.text("Drop files here to send"),r.addClass("file-drop")},c.ondragover=function(e){e.preventDefault()},c.ondragleave=function(e){d(e.relatedTarget).closest(".rich-textarea").length||(e.preventDefault(),l.text("Write a message..."),r.removeClass("file-drop"))},c.ondrop=function(e){e.preventDefault(),e.stopPropagation(),l.text("Write a message..."),r.removeClass("file-drop");var t=e.dataTransfer.files||[];this.view.addFileMessage(t)}.bind(this);var p=this.$(".insert-emoticon"),m=this.$(".emoticons-panel-wrap"),g=this.$(".emoticons-panel"),v;let A=0,f=0,b=Object.keys(h.all).length;for(var x in h.all){let e=d(`<div class="emoji-list-wrap"/>`),t=x.replace(/ /g,"_");d(`<div id=${t} class="emoji-list-header">${n.EMOJI_LIST_NAME(x)}</div>`).appendTo(e),u.each(h.all[x],function(a){d("<div class=\"emoji-wrap\"/>").html(a.emojify({emoji_size:24,sprite:t})).appendTo(e)}),e.appendTo(g),g.siblings(".emoji-menu").append(h.all[x][0].emojify({href:t,title:n.EMOJI_LIST_NAME(x),tag_name:"a",emoji_size:20}));let a=new Image;a.onload=function(){A++,A===b&&m.find(".uploading-emoticons").detach()}.bind(this),a.src="./images/emoji/spritesheet"+f++ +".png"}var w=function(e){d(e.target).closest(".emoticons-panel-wrap").length||d(e.target).closest(".insert-emoticon").length||(m.removeClass("opened"),window.removeEventListener("click",w))};g.perfectScrollbar(u.extend({theme:"item-list"},a.ps_settings)),this.$(".emoji-menu .emoji").click(function(e){g[0].scrollTop=this.$(".emoji-list-wrap "+e.target.attributes.href.value)[0].offsetTop-4}.bind(this)),p.click(function(e){v&&clearTimeout(v),e&&e.preventDefault&&e.preventDefault(),m.hasClass("opened")?(m.removeClass("opened"),window.removeEventListener("click",w)):(m.addClass("opened"),window.addEventListener("click",w)),g.perfectScrollbar("update")}.bind(this)),m.hover(null,function(e){e&&e.preventDefault&&e.preventDefault(),v&&clearTimeout(v),v=setTimeout(function(){m.removeClass("opened")},200)}.bind(this)),m.mousedown(function(e){if(e&&e.preventDefault&&e.preventDefault(),v&&clearTimeout(v),!e.button){var t=d(e.target),a=t.closest(".emoji-wrap").find(".emoji");t.closest(".emoji-menu").length||a.length&&this.typeEmoticon(a.data("emoji"))}}.bind(this)),this.renderLastEmoticons()},render:function(e){this.$(".message-input-panel").hideIf(e.blocked),this.$(".blocked-msg").showIf(e.blocked),this.$el.switchClass("chat-bottom-blocked-wrap",e.blocked),this.updateAvatar();var t=this.account.server_features.get(l.NS.HTTP_UPLOAD);return this.content_view=(this.view.data.get("visible")?this.view:this.contact.messages_view)||this.view,this.messages_arr=this.content_view.$el.hasClass("participant-messages-wrap")&&this.account.participant_messages||this.content_view.$el.hasClass("messages-context-wrap")&&this.account.context_messages||this.model.messages,this.renderLastEmoticons(),this.$(".attach-file").showIf(t),this.contact.get("group_chat")?this.updateInfoInBottom():(this.$(".account-nickname").hide(),this.$(".account-badge").hide(),this.$(".account-role").hide()),this.focusOnInput(),a.chat_body.updateHeight(),this.manageSelectedMessages(),this},onBlockedUpdate:function(){if(this.isVisible()){let e=this.contact.get("blocked");this.$(".message-input-panel").hideIf(e),this.$(".blocked-msg").showIf(e),this.$el.switchClass("chat-bottom-blocked-wrap",e)}},onClickBottom:function(e){this.$el.hasClass("chat-bottom-blocked-wrap")&&!d(e.target).closest(".message-actions-panel").length&&this.contact.showDetails(a.body.screen.get("name"))},updateInfoInBottom:function(){if(this.contact.my_info){var e=this.contact.my_info.get("nickname"),t=this.contact.my_info.get("badge"),a=this.contact.my_info.get("b64_avatar"),i=this.contact.my_info.get("role");e?(this.$(".account-jid").hide(),this.$(".account-nickname").show().text(e)):this.$(".account-nickname").hide(),t?this.$(".account-badge").show().text(t):this.$(".account-badge").hide(),i&&"member"!=i?this.$(".account-role").show().text(o.pretty_name(i)):this.$(".account-role").hide(),this.$(".input-toolbar").emojify(".account-badge",{emoji_size:16}),a||(a=g.getDefaultAvatar(e)),this.$(".my-avatar.circle-avatar").setAvatar(a,this.avatar_size)}else this.$(".account-jid").show(),this.$(".account-nickname").hide(),this.$(".account-badge").hide(),this.$(".account-role").hide()},updateAvatar:function(){let e;this.contact.get("group_chat")?(this.contact.my_info&&this.contact.my_info.get("b64_avatar")&&(e=this.contact.my_info.get("b64_avatar")),!e&&(e=g.getDefaultAvatar(this.contact.my_info&&this.contact.my_info.nickname||this.account.get("jid")))):e=this.account.cached_image,this.$(".my-avatar.circle-avatar").setAvatar(e,this.avatar_size)},focusOnInput:function(){return this.quill.focus(),this},keyDown:function(e){if($rich_textarea=this.$(".input-message .rich-textarea"),e.keyCode!==n.KEY_ESCAPE&&e.keyCode!==n.KEY_BACKSPACE&&e.keyCode!==n.KEY_DELETE){if(e.keyCode===n.KEY_ENTER||10===e.keyCode){if("none"!==this.$(".mentions-list").css("display")){let t=this.$(".mentions-list").children(".active.mention-item");return t.length&&t.click(),void e.preventDefault()}let t="enter"===a.settings.hotkeys;if(t&&e.keyCode===n.KEY_ENTER&&!e.shiftKey||!t&&e.ctrlKey)return e.preventDefault(),void this.submit()}!$rich_textarea.getTextFromRichTextarea().trim()||this.view.chat_state||this.view.edit_message||this.view.sendChatState("composing")}},displayMicrophone:function(){this.$(".mdi-send").addClass("hidden"),this.$(".attach-voice-message").removeClass("hidden"),this.$(".btn-save").addClass("hidden")},displaySend:function(){this.$(".mdi-send").removeClass("hidden"),this.$(".attach-voice-message").addClass("hidden"),this.$(".btn-save").addClass("hidden")},displaySaveButton:function(){this.$(".btn-save").removeClass("hidden"),this.$(".mdi-send").addClass("hidden"),this.$(".attach-voice-message").addClass("hidden")},updateMarkupPanel:function(e){let t=d(e.target).closest(".format-text");t.toggleClass("active"),t.hasClass("active")?(this.$(".ql-toolbar.ql-snow").show(),this.$(".last-emoticons").hide()):(this.$(".ql-toolbar.ql-snow").hide(),this.$(".last-emoticons").show())},getParticipantsList:function(){let e=[];return this.contact.participants.each(function(t){e.push(t.get("nickname")||t.get("jid")||t.get("id"))}.bind(this)),e.join(", ")},onChangedText:function(){let e=this.$el.height();e!==this.bottom_height&&(this.bottom_height=e,this.view.scrolled_to_bottom=this.view.isScrolledToBottom())},updateMentionsList:function(e){e=(e||"").toLowerCase(),this.contact.searchByParticipants(e,function(t){if(t.length||-1<"everyone".indexOf(e)||"*"===e||-1<"all".indexOf(e)||-1<"\u0432\u0441\u0435".indexOf(e)){this.$(".mentions-list").html("").show().perfectScrollbar({theme:"item-list"}),this.$(".mentions-list")[0].scrollTop=0,t.forEach(function(t){let a=u.clone(t.attributes);a.nickname=a.nickname?l.xmlescape(a.nickname):a.id;let i=d(s.group_chats.mention_item(a));i.find(".circle-avatar").setAvatar(t.get("b64_avatar")||o.images.getDefaultAvatar(t.get("nickname")||t.get("jid")||t.get("id")),this.mention_avatar_size),i.find(".nickname").text().replace(e,e.bold()),this.$(".mentions-list").append(i)}.bind(this));let a=d(s.group_chats.mention_item({jid:"",nickname:"Everyone",id:""}));a.find(".circle-avatar").setAvatar(this.contact.cached_image,this.mention_avatar_size),a.find(".one-line.jid").text(this.getParticipantsList()),this.$(".mentions-list").append(a),this.$(".mentions-list").children(".mention-item").first().addClass("active")}else this.$(".mentions-list").html("").hide()}.bind(this))},inputMention:function(e){e&&e.preventDefault();let a=this.$(".rich-textarea"),i=d(e.target).closest(".mention-item"),n=i.data("nickname"),s=i.data("id")||"",o=!this.contact.get("incognito_chat")&&i.data("jid")||"",c=a.getTextFromRichTextarea().replace(/\n$/,""),r=this.quill.selection.lastRange&&this.quill.selection.lastRange.index,l=Array.from(c).slice(0,r).join("").replaceEmoji(),p=l&&Array.from(l.matchAll(/(^|\s)@(\w+)?/g))||[],u=l&&Array.from(l.matchAll(/(^|\s)[+](\w+)?/g))||[],m=p.length?p.slice(-1)[0].index:-1,g=u.length?u.slice(-1)[0].index:-1,h=t(m,g),v=Array.from(l).slice(h,r).join("");if(v.length&&v[0].match(/\s/)&&h++,v=v.replace(/\s?(@|[+])/,""),this.$(".mentions-list").hide(),this.quill.deleteText(h,++v.length),!n.length)if(s.length)n=s;else return;this.insertMention({jid:o,id:s,nickname:n,position:h}),this.focusOnInput()},insertMention:function(e){if(e){let t=e.id,a=e.jid,i=e.nickname,n=!t&&!a||this.account.get("jid")===a||this.contact.my_info&&this.contact.my_info.get("id")===t,s={jid:a,id:t,nickname:l.xmlescape(i),is_me:n},o=e.position;this.quill.insertEmbed(o,"mention",JSON.stringify(s)),this.quill.pasteHTML(o+i.length,"<text> </text>"),this.quill.setSelection(o+i.length+1,0)}},showAccountSettings:function(){this.contact.get("group_chat")?(this.contact.participants.participant_properties_panel=new a.ParticipantPropertiesView({model:this.contact.details_view.participants}),this.contact.my_info&&this.contact.my_rights?this.contact.participants.participant_properties_panel.open(this.contact.my_info,this.contact.my_rights):this.contact.getMyInfo(function(){this.contact.participants.participant_properties_panel.open(this.contact.my_info,this.contact.my_rights)}.bind(this))):this.account.showSettings()},keyUp:function(e){let i=d(e.target).closest(".rich-textarea"),s=i.getTextFromRichTextarea().replace(/\n$/,"");if(e.keyCode===n.KEY_ARROW_UP&&!s){let e=this.view.$(".chat-message[data-from=\""+this.account.get("jid")+"\"]").last();!e.length&&this.contact.participants&&(e=this.view.$(".chat-message[data-from=\""+this.contact.participants.find(e=>e.get("jid")===this.account.get("jid")).get("id")+"\"]").last());let t=this.messages_arr.get(e.data("uniqueid"));this.edit_message=t,this.setEditedMessage(t)}if(s&&"\n"!=s||this.edit_message?this.displaySend():this.displayMicrophone(),e.keyCode===n.KEY_ESCAPE)e.preventDefault(),this.unsetForwardedMessages();else{if(e.keyCode===n.KEY_ARROW_UP||e.keyCode===n.KEY_ARROW_DOWN)return;if((e.keyCode===n.KEY_ARROW_LEFT||e.keyCode===n.KEY_ARROW_RIGHT)&&"none"!==this.$(".mentions-list").css("display"))return void this.$(".mentions-list").hide();if(e.keyCode!==n.KEY_BACKSPACE&&e.keyCode!==n.KEY_DELETE||this.edit_message||s&&"\n"!=s||(this.$(".fwd-messages-preview").hasClass("hidden")?this.displayMicrophone():this.displaySend(),i.flushRichTextarea(),this.view.sendChatState("active")),e.keyCode===n.KEY_SPACE){let e=this.quill.selection.lastRange&&this.quill.selection.lastRange.index,t=Array.from(s).slice(0,e).join("").replaceEmoji();if(t[e-2]&&t[e-2].match(/@|[+]/))return void this.$(".mentions-list").hide()}if(this.contact.get("group_chat")){let e=this.quill.selection.lastRange&&this.quill.selection.lastRange.index,a=Array.from(s).slice(0,e).join("").replace(/\n$/,"").replaceEmoji(),i=Array.from(a.matchAll(/(^|\s)@(\w+)?/g)),n=Array.from(a.matchAll(/(^|\s)[+](\w+)?/g)),o=i.length?i.slice(-1)[0].index:-1,d=n.length?n.slice(-1)[0].index:-1,c=t(o,d);if(this.quill.selection.lastRange&&"mention"===this.quill.getLeaf(this.quill.selection.lastRange.index)[0].parent.domNode.tagName.toLowerCase())return void this.$(".mentions-list").hide();if(-1<e&&-1!==c||this.$(".mentions-list").hide(),-1<c){let t=Array.from(a).slice(c,e).join("").replace(/\s?(@|[+])/,"");this.contact.participants.length&&0<this.contact.participants.version?this.updateMentionsList(t):this.contact.details_view.participants.participantsRequest(function(){this.updateMentionsList(t)}.bind(this))}else this.$(".mentions-list").hide()}}i.updateRichTextarea(),this.focusOnInput(),a.chat_body.updateHeight()},onCut:function(){this.$(".fwd-messages-preview").hasClass("hidden")?this.displayMicrophone():this.displaySend()},onPaste:function(e){e.preventDefault();var t=d(e.target),i=e.clipboardData;if(i)if(0<i.files.length){var n=i.files[i.files.length-1],s=window.URL.createObjectURL(new Blob([n]));o.dialogs.ask("Send Image from Clipboard","Do you want to send Image from Clipboard?",{blob_image_from_clipboard:s},{ok_button_text:"send"}).done(function(e){e&&(n.name="clipboard.png",this.view.addFileMessage([n]))}.bind(this))}else if(0<i.items.length){var n=i.items[i.items.length-1];if("file"===n.kind){var c=n.getAsFile(),r=new FileReader,l=new d.Deferred;r.onload=function(e){var t={blob_image_from_clipboard:e.target.result};o.dialogs.ask("Send Image from Clipboard","Do you want to send Image from Clipboard?",t,{ok_button_text:"send"}).done(function(e){e&&l.resolve()}.bind(this))},l.done(function(){c.name="clipboard.png",this.view.addFileMessage([c])}.bind(this)),r.readAsDataURL(c)}else{let e=u.escape(i.getData("text")),t=Array.from(e);t.forEach(function(e,a){"\n"==e&&t.splice(a,1,"<br>")}.bind(this)),e="<p>"+t.join("").emojify({tag_name:"span"})+"</p>",window.document.execCommand("insertHTML",!1,e)}}else{let e=u.escape(i.getData("text")),t=Array.from(e);t.forEach(function(e,a){"\n"==e&&t.splice(a,1,"<br>")," "==e&&t.splice(a,1,"&nbsp")}.bind(this)),e="<p>"+t.join("").emojify({tag_name:"span"})+"</p>",window.document.execCommand("insertHTML",!1,e)}!t.getTextFromRichTextarea().replace(/\n$/,"")||this.view.chat_state||this.view.edit_message||this.view.sendChatState("composing"),this.focusOnInput(),a.chat_body.updateHeight()},onFileInputChanged:function(e){for(var t=e.target,a=[],n=0;n<t.files.length;n++)a.push(t.files[n]);a&&(this.view.addFileMessage(a),d(t).val(""))},stopWritingVoiceMessage:function(){let e=this.$(".message-input-panel");if(0<e.find(".recording").length)return void e.find(".recording").removeClass("recording")},writeVoiceMessage:function(e){var t=d(e.target);t.hasClass("recording")?t.removeClass("recording"):(t.addClass("recording ground-color-50"),this.initAudio())},initAudio:function(){if(navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia){let t=[],a=this.$(".send-area .attach-voice-message"),i=function(i){let s=new MediaRecorder(i),d=1,c=!0,r,l;s.start(),s.onstart=function(){this.view.sendChatState("composing","voice"),this._chatstate_send_timeout=setInterval(function(){this.view.sendChatState("composing","voice")}.bind(this),n.CHATSTATE_INTERVAL_COMPOSING_AUDIO),r=p.now();let e=this.$(".message-input-panel"),t=this.$(".input-voice-message .timer"),i=this.$(".input-voice-message .voice-msg-status"),l=this.$(".input-voice-message .voice-visualizer");t.text("0:00"),i.css("color","#9E9E9E").text("Release outside this form to cancel"),e.addClass("voice-message-recording");let u=setInterval(function(){a.hasClass("recording")&&d<n.VOICE_MSG_TIME?(0==d%1&&t.text(o.pretty_duration(d)),d=(10*d+2)/10,c=e.is(":hover"),c?i.css("color","#9E9E9E").text("Release outside this form to cancel"):i.css("color","#D32F2F").text("Release to cancel record")):(c=e.is(":hover"),s.stop(),a.removeClass("recording ground-color-50"),e.removeClass("voice-message-recording"),clearInterval(u))}.bind(this),200),m=!1,g=setInterval(function(){a.hasClass("recording")?(m?l.css("background-color","#FFF"):l.css("background-color","#D32F2F"),m=!m):clearInterval(g)},500)}.bind(this),s.onstop=function(){if(clearInterval(this._chatstate_send_timeout),this.view.sendChatState("paused"),l=p.now(),c&&1.5<=(l-r)/1e3){let a="voice message "+p().format("YYYY-MM-DD HH:mm:ss")+".ogg",i=new Blob(t,{type:"audio/ogg; codecs=opus"}),n=new File([i],a,{type:"audio/ogg; codecs=opus"});n.voice=!0,n.duration=e((l-r)/1e3),this.view.addFileMessage([n])}t=[]}.bind(this),s.ondataavailable=function(a){t.push(a.data),i.getTracks().forEach(e=>e.stop())}}.bind(this);window.navigator.getUserMedia({audio:!0},i,function(e){console.log("The following error occured: "+e),a.removeClass("recording ground-color-50")})}},typeEmoticon:function(e){"number"==typeof e&&(e=(+e).toString());let t=-1;this.quill.selection.lastRange?t=this.quill.selection.lastRange.index:this.quill.selection.savedRange&&(t=this.quill.selection.savedRange.index),this.quill.focus(),this.edit_message||this.displaySend(),this.view.chat_state||this.view.sendChatState("composing"),this.quill.insertEmbed(t,"emoji",e),this.quill.getFormat(t,1).mention&&this.quill.formatText(t,1,"mention",!1),this.quill.setSelection(t+1),a.chat_body.updateHeight()},renderLastEmoticons:function(){var e=this.account.chat_settings.getLastEmoji(),t=this.$(".last-emoticons").empty(),a;if(7>e.length)for(var i=0;7>i;i++)a=h.getByIndex(i),this.account.chat_settings.updateLastEmoji(a);e=this.account.chat_settings.getLastEmoji();for(var i=0;7>i;i++)d("<div class=\"emoji-wrap\"/>").html(e[i]&&e[i].emojify({tag_name:"div",emoji_size:20})).appendTo(t);t.find(".emoji-wrap").mousedown(function(e){if(e&&e.preventDefault&&e.preventDefault(),!e.button){var t=d(e.target).closest(".emoji-wrap").find(".emoji");this.typeEmoticon(t.data("emoji"))}}.bind(this))},submit:function(){var e=this.$(".input-message .rich-textarea"),t=[],i=[],s=[],o=e.getTextFromRichTextarea().trim();e.find(".emoji").each(function(e,t){var a=t.innerText;this.account.chat_settings.updateLastEmoji(a)}.bind(this));let c=[];return this.quill.getContents().forEach(function(a){if(a.attributes){let r=[],l=c.length,p=l+(a.insert&&a.insert.emoji?1:u.escape(a.insert).length);for(let e in a.attributes)"alt"!=e&&"blockquote"!==e&&r.push(e);if(-1<r.indexOf("mention")){let a=r.indexOf("mention"),i=this.contact.get("group_chat"),n=d(e.find("mention")[t.length]).attr("data-target");r.splice(a,a+1),n=i?"xmpp:"+this.contact.get("jid")+n:"xmpp:"+n,t.push({start:l,end:p,target:n,is_gc:i})}a.attributes.blockquote&&c.length&&Array.from(a.insert).forEach(function(e){let t=0>c.lastIndexOf("\n")?0:c.lastIndexOf("\n")+1,a=c.length;s.push({marker:n.QUOTE_MARKER,start:t,end:a+n.QUOTE_MARKER.length}),o=Array.from(u.escape(o)),t===a?(o[t-1]+=n.QUOTE_MARKER,c[t]=n.QUOTE_MARKER):(o[t]=n.QUOTE_MARKER+o[t],c[t]=n.QUOTE_MARKER+c[t]),a>o.length&&(a=o.length),o[a-1]+="\n",o=u.unescape(o.join("")),c=Array.from(c.join("")),i.forEach(function(e){e.start>=t&&(e.start+=n.QUOTE_MARKER.length,e.end+=n.QUOTE_MARKER.length)}.bind(this)),c=c.concat(Array.from(u.escape(e)))}.bind(this)),r.length&&i.push({start:l,end:p,markup:r})}a.insert&&a.insert.emoji?c=c.concat(Array.from(d(a.insert.emoji).data("emoji"))):a.attributes&&a.attributes.blockquote||(c=c.concat(Array.from(u.escape(a.insert))))}.bind(this)),e.flushRichTextarea(),this.quill.focus(),this.displayMicrophone(),this.edit_message?void this.editMessage(o,{mentions:t,markup_references:i,blockquotes:s}):void((o||this.fwd_messages.length)&&this.view.onSubmit(o,this.fwd_messages,{mentions:t,markup_references:i,blockquotes:s}),this.unsetForwardedMessages(),this.view.sendChatState("active"),a.chats_view.clearSearch(),this.contact.messages_view&&this.contact.messages_view.data.get("visible")&&a.chats_view.openChat(this.model.item_view,{clear_search:!0,screen:a.body.screen.get("name")}))},setEditedMessage:function(e){let t=e.get("message")||"";this.$(".fwd-messages-preview").showIf(this.edit_message),this.$(".fwd-messages-preview .msg-author").text("Edit message"),this.$(".fwd-messages-preview .msg-text").html(l.xmlescape(t)),this.$(".fwd-messages-preview").emojify(".msg-text",{emoji_size:18}),this.displaySaveButton(),a.chat_body.updateHeight();let i=o.markupBodyMessage(e),n=i.emojify({tag_name:"div"}),s=Array.from(n);s.forEach(function(e,t){"\n"==e&&(s[t]="<br>")}.bind(this)),n=s.join(""),this.quill.setText(""),this.quill.pasteHTML(0,n,"user"),this.focusOnInput()},setForwardedMessages:function(e){if(this.fwd_messages=e||[],this.$(".fwd-messages-preview").showIf(e.length),e.length){var t=e[0],i,n,s,o;if(1<e.length)n=e.length+" messages";else if(t.get("forwarded_message"))n="Forwarded message";else{n=(t.get("message")||t.get("original_message")).emojify();var d=t.get("images"),c=t.get("files");if(d&&c)n=t.get("images").length+t.get("files").length+" files";else if(d&&(1<d.length?n=d.length+" images":(s=u.clone(t.get("images")[0]),o=this.createPreviewImage(s))),c)if(1<t.get("files").length)n=t.get("files").length+" files";else{var r=t.get("files")[0].size;n=r?t.get("files")[0].name+",   "+r:t.get("files")[0].name}}let a=t.get("from_jid");i=t.isSenderMe()?this.account.get("name"):t.get("user_info")&&t.get("user_info").nickname||(this.account.contacts.get(a)?this.account.contacts.get(a).get("name"):a),this.$(".fwd-messages-preview .msg-author").text(i),u.isUndefined(s)?this.$(".fwd-messages-preview .msg-text").html(n):this.$(".fwd-messages-preview .msg-text").html(o)}a.chat_body.updateHeight(),this.displaySend()},onShowMarkupPanel:function(e){let t=d(e.target),a=t.hasClass("opened");this.$(".last-emoticons").showIf(a),this.$(".markup-panel").showIf(!a),t.switchClass("opened",!a)},createPreviewImage:function(e){var t=new Image;return t.src=e.sources[0],d(t).addClass("fwd-img-preview"),t},unsetForwardedMessages:function(e){e&&e.preventDefault&&e.preventDefault(),$rich_textarea=this.$(".input-message .rich-textarea"),this.fwd_messages=[],this.edit_message&&$rich_textarea.flushRichTextarea(),this.edit_message=null,this.$(".fwd-messages-preview").addClass("hidden");let t=$rich_textarea.getTextFromRichTextarea();t&&"\n"!=t?this.displaySend():this.displayMicrophone(),a.chat_body.updateHeight(),this.focusOnInput()},resetSelectedMessages:function(){this.content_view.$(".chat-message.selected").removeClass("selected"),this.manageSelectedMessages()},manageSelectedMessages:function(){var e=this.content_view.$(".chat-message.selected"),t=this.$(".message-input-panel"),a=this.$(".message-actions-panel");if(length=e.length,t.hideIf(this.contact.get("blocked")||length),a.showIf(length),this.contact.get("blocked")&&this.$(".blocked-msg").hideIf(length),length){var i=!1;1===length&&(e.first().data("from")===this.account.get("jid")&&(i=!0),this.contact.my_info&&e.first().data("from")===this.contact.my_info.get("id")&&(i=!0)),a.find(".pin-message-wrap").showIf(this.contact.get("group_chat")).switchClass("non-active",1!==length&&this.contact.get("group_chat")),a.find(".reply-message-wrap").switchClass("non-active",this.contact.get("blocked")),a.find(".edit-message-wrap").switchClass("non-active",!(1===length&&i)||this.contact.get("blocked")),this.view.$(".chat-notification").removeClass("hidden").addClass("msgs-counter").text(length+" message"+(1<length?"s selected":" selected"))}else this.view.$(".chat-notification").addClass("hidden").removeClass("msgs-counter").text(""),this.focusOnInput()},pinMessage:function(){if(!this.$(".pin-message-wrap").hasClass("non-active")){let e=this.content_view.$(".chat-message.selected").first(),t=this.messages_arr.get(e.data("uniqueid")),a=t.get("stanza_id");this.resetSelectedMessages();let i=c({from:this.account.get("jid"),type:"set",to:this.contact.get("jid")}).c("update",{xmlns:l.NS.GROUP_CHAT}).c("pinned-message").t(a);this.account.sendIQ(i,function(){},function(e){d(e).find("not-allowed").length&&o.dialogs.error("You have no permission to pin/unpin message")})}},copyMessages:function(){let e=this.content_view.$(".chat-message.selected"),t=[];e.each(function(e,a){var i=this.messages_arr.get(a.dataset.uniqueid);i&&t.push(i)}.bind(this)),this.resetSelectedMessages(),this.pushMessagesToClipboard(t)},editMessage:function(e,t){let a=l.xmlescape(this.edit_message.get("original_message")||""),i="",n=this.edit_message.get("mutable_content"),s=n&&n.find(e=>"groupchat"===e.type),o=this.edit_message.get("stanza_id"),d=n&&n.filter(e=>"forward"===e.type),r=t.markup_references||[],p=t.blockquotes||[],u=t.mentions||[],m=c({from:this.account.get("jid"),type:"set",to:this.contact.get("group_chat")?this.contact.get("jid"):this.account.get("jid")}).c("replace",{xmlns:l.NS.REWRITE,id:o}).c("message");d&&d.forEach(function(e,t){let n=this.edit_message.get("forwarded_message")[t],o=s&&s.start+s.end;m.c("reference",{xmlns:l.NS.REFERENCE,begin:s?e.start-o:e.start,end:s?e.end-o:e.end,type:"mutable"}).c("forwarded",{xmlns:"urn:xmpp:forward:0"}).c("delay",{xmlns:"urn:xmpp:delay",stamp:n.get("time")}).up().cnode(n.get("xml")).up().up().up(),i+=a.slice(e.start,e.end)}.bind(this)),r.forEach(function(e){for(let t in m.c("reference",{xmlns:l.NS.REFERENCE,begin:e.start+i.length,end:e.end+i.length,type:"decoration"}),e.markup)m.c(e.markup[t],{xmlns:l.NS.MARKUP}).up();m.up()}.bind(this)),p.forEach(function(e){m.c("reference",{xmlns:l.NS.REFERENCE,begin:e.start+i.length,end:e.end+i.length,type:"decoration"}).c("quote",{xmlns:l.NS.MARKUP}).up().up()}.bind(this)),u.forEach(function(e){let t={xmlns:l.NS.MARKUP};e.is_gc&&(t=l.NS.GROUP_CHAT),m.c("reference",{xmlns:l.NS.REFERENCE,begin:e.start+i.length,end:e.end+i.length,type:"decoration"}).c("mention",t).t(e.target).up().up()}.bind(this)),m.c("body").t(l.xmlunescape(i)+e).up(),this.unsetForwardedMessages(),this.account.sendIQ(m)},showEditPanel:function(){if(!this.$(".edit-message-wrap").hasClass("non-active")){let e=this.content_view.$(".chat-message.selected").first(),t=this.messages_arr.get(e.data("uniqueid"));this.edit_message=t,this.resetSelectedMessages(),this.setEditedMessage(t)}},deleteMessages:function(){let e=this.content_view.$(".chat-message.selected"),t=[],i=0,n=[];e.each(function(e,a){let n=this.messages_arr.get(a.dataset.uniqueid);n&&t.push(n),n.isSenderMe()&&i++}.bind(this)),this.account.server_features.get(l.NS.REWRITE)||this.contact.get("group_chat")?(!this.contact.get("group_chat")&&a.servers.get(this.contact.domain).server_features.get(l.NS.REWRITE)&&(n=[{name:"symmetric_deletion",checked:!1,text:"Delete for all"}]),o.dialogs.ask("Delete messages","Are you sure you want to <b>delete "+t.length+" message"+(1<t.length?"s":"")+"</b>?",n,{ok_button_text:"delete"}).done(function(e){if(!e)return void(this._clearing_history=!1);let a=!!this.contact.get("group_chat")||!!e.symmetric_deletion;this.resetSelectedMessages(),this.model.retractMessages(t,this.contact.get("group_chat"),a)}.bind(this))):o.dialogs.ask("Delete messages","Are you sure you want to <b>delete "+t.length+" message"+(1<t.length?"s":"")+"</b>?"+("\nWarning! <b>"+this.account.domain+"</b> server does not support message deletion. Message"+(1<t.length)?"s":" will be deleted only locally.").fontcolor("#E53935"),n,{ok_button_text:"delete locally"}).done(function(e){return e?void t.forEach(function(e){this.view.removeMessage(e)}.bind(this)):void(this._clearing_history=!1)}.bind(this))},pushMessagesToClipboard:function(e){let t=this.createTextMessage(e,"");o.copyTextToClipboard(u.unescape(t))},createTextMessage:function(e,t){let a="";for(var n=0;n<e.length;n++){let i=e[n],s=p(i.get("timestamp")).startOf("day"),d=n?p(e[n-1].get("timestamp")).startOf("day"):p(0),c="";d.format("x")!=s.format("x")&&(a+=(t.length?t+" ":"")+o.pretty_date(s)+"\n"),c=i.isSenderMe()?this.account.get("name"):i.get("user_info")&&i.get("user_info").nickname||(this.account.contacts.get(i.get("from_jid"))?this.account.contacts.get(i.get("from_jid")).get("name"):i.get("from_jid")),a+=(t.length?t+" ":"")+"["+o.pretty_time(i.get("timestamp"))+"] "+c+":\n",t.length&&(a+=t);let r=u.unescape(i.get("mutable_content")&&i.get("mutable_content").find(e=>"groupchat"===e.type)?i.get("original_message").slice(i.get("mutable_content").find(e=>"groupchat"===e.type).end):i.get("original_message"));t.length&&(r=r.replace(/\n/g,"\n&gt; ")),t.length&&0!==r.indexOf("&gt;")&&(a+=" "),r=u.unescape(r.replace(/\n&gt; &gt;/g,"\n&gt;&gt;")),a+=u.escape(r)+"\n"}return a.trim()},replyMessages:function(){let e=this.content_view.$(".chat-message.selected"),t=[];e.each(function(e,a){let i=this.messages_arr.get(a.dataset.uniqueid);i&&t.push(i)}.bind(this)),this.resetSelectedMessages(),this.setForwardedMessages(t)},forwardMessages:function(){let e=this.content_view.$(".chat-message.selected"),t=[];e.each(function(e,a){let i=this.messages_arr.get(a.dataset.uniqueid);i&&t.push(i)}.bind(this)),this.resetSelectedMessages(),a.forward_panel.open(t,this.account)},showChatNotification:function(e,t){this.view.$(".chat-notification").hasClass("msgs-counter")||this.view.$(".chat-notification").switchClass("hidden",!e).text(e).switchClass("text-color-300",t)}}),a.ChatHeadContainer=a.Container.extend({className:"chat-head-container panel-head noselect"}),a.ChatBodyContainer=a.Container.extend({className:"chat-body-container",updateHeight:function(){var e=a.chat_bottom.$el.height();e&&(this.$el.css({bottom:e}),this.view&&(this.view.updateScrollBar(),this.view.scrolled_to_bottom&&this.view.scrollToBottom()))}}),a.ChatBottomContainer=a.Container.extend({className:"chat-bottom-container"}),a.ChatPlaceholderView=a.BasicView.extend({className:"placeholder-wrap chat-placeholder-wrap noselect",template:s.chat_placeholder}),a.ChatSettings=Backbone.ModelWithStorage.extend({defaults:{last_emoji:[],muted:[],archived:[],group_chat:[],cached_avatars:[],group_chat_members_lists:[]},getLastEmoji:function(){return u.clone(this.get("last_emoji"))},updateLastEmoji:function(e){var t=u.clone(this.get("last_emoji"));if(0<t.length){var a=t.indexOf(e);for(-1!=a&&t.splice(a,1),t.push(e);7<t.length;)t.shift()}else t.push(e);this.save("last_emoji",t)},updateMutedList:function(e,t){var a=u.clone(this.get("muted")),i=a.indexOf(e);t&&0>i&&a.push(e),!t&&0<=i&&a.splice(i,1),this.save("muted",a)},updateArchiveChatsList:function(e,t){var a=u.clone(this.get("archived")),i=a.indexOf(e);t&&0>i&&a.push(e),!t&&0<=i&&a.splice(i,1),this.save("archived",a)},updateGroupChatsList:function(e,t){var a=u.clone(this.get("group_chat")),i=a.indexOf(e);t&&0>i&&a.push(e),!t&&0<=i&&a.splice(i,1),this.save("group_chat",a)},updateCachedAvatars:function(e,t,a){var i=u.clone(this.get("cached_avatars")),n=i.indexOf(i.find(t=>t.id===e));-1!=n&&i.splice(n,1),i.push({id:e,avatar_hash:t,avatar_b64:a}),this.save("cached_avatars",i)},getAvatarInfoById:function(e){var t=u.clone(this.get("cached_avatars")),a=t.find(t=>t.id===e);return a},getB64Avatar:function(e){var t=this.getAvatarInfoById(e);return t?t.avatar_b64:void 0},getHashAvatar:function(e){var t=this.getAvatarInfoById(e);if(t)return t.avatar_hash}}),a.Account.addInitPlugin(function(){this.chat_settings=new a.ChatSettings({id:"chat-settings"},{account:this,storage_name:a.getStorageName()+"-chat-settings-"+this.get("jid"),fetch:"after"}),this.messages=new a.Messages(null,{account:this}),this.forwarded_messages=new a.Messages(null,{account:this}),this.pinned_messages=new a.Messages(null,{account:this}),this.chats=new a.AccountChats(null,{account:this})}),a.Account.addConnPlugin(function(){let e=this.last_msg_timestamp||this.disconnected_timestamp;this.chats.registerMessageHandler(),this.chats.each(function(t){this.connection.do_synchronization||(t.messages.length?t.trigger("get_missed_history",e):t.trigger("load_last_history"))}.bind(this)),this.trigger("ready_to_get_roster"),this.connection.deleteTimedHandler(this._get_msg_handler),this._get_msg_handler=this.connection.addTimedHandler(6e4,function(){if(this.connection&&!this.connection.handlers.find(e=>!e.ns&&"message"===e.name)){let e=this.last_msg_timestamp;this.chats.registerMessageHandler(),this.roster&&this.roster.syncFromServer({stamp:1e3*e})}return!0}.bind(this))},!0,!0),a.once("start",function(){this.chats=new this.Chats,this.chats.addCollection(this.opened_chats=new this.OpenedChats),this.chats.addCollection(this.closed_chats=new this.ClosedChats),this.chats.registerQuillEmbeddedsTags(),this.chats_view=this.left_panel.addChild("chats",this.ChatsView,{model:this.opened_chats}),this.chat_head=this.right_panel.addChild("chat_head",this.ChatHeadContainer),this.chat_body=this.right_panel.addChild("chat_body",this.ChatBodyContainer),this.chat_bottom=this.right_panel.addChild("chat_bottom",this.ChatBottomContainer),this.chat_placeholder=this.right_panel.addChild("chat_placeholder",this.ChatPlaceholderView),this.forward_panel=new this.ForwardPanelView({model:this.opened_chats}),this.invite_panel=new this.InvitationPanelView({model:this.opened_chats}),this.add_group_chat_view=new this.AddGroupChatView,this.on("add_group_chat",function(){this.add_group_chat_view.show()},this),this.on("change:focused",function(){if(this.get("focused")){var e=this.chats_view.active_chat;e&&e.model.get("display")&&(e.content.readMessages(),!1!==e.model.get("is_accepted")&&e.content.bottom.focusOnInput())}},this),this.on("show_group_chats",function(){this.chats_view.showGroupChats()},this),this.on("show_chats",function(){this.chats_view.showChats()},this),this.on("show_account_chats",function(e,t){this.chats_view.showChatsByAccount(t)},this),this.on("show_archive_chats",function(){this.chats_view.showArchiveChats()},this),this.on("clear_search",function(){this.contacts_view.clearSearch(),this.chats_view.clearSearch()},this)},a),a}}),define("xabber-searching",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.searching,n=t.utils,s=t.$,o=t.$iq,d=t.Strophe,c=t._,r=n.images;return e.DiscoveringView=e.BasicView.extend({className:"searching-main noselect",template:i.searching_wide,ps_selector:".chats-list-wrap",ps_settings:{wheelPropagation:!0,theme:"existing-chats-list"},avatar_size:a.AVATAR_SIZES.SYNCHRONIZE_ACCOUNT_ITEM,events:{"click .account-field .dropdown-content":"selectAccount","click .btn-cancel":"close","click .btn-search":"search","click .existing-chat-wrap":"getChatProperties","keyup .search-input":"keyUp"},_initialize:function(){this.data.on("change:color",this.colorUpdated,this),this.$(".searching-properties-field .dropdown-button").on("click",function(){this.toggleProperties()}.bind(this))},render:function(t){this.endDiscovering(),this.data.set("color","#9E9E9E"),t||(t={});var a=e.accounts.connected,i=t.jid||"";return this.$(".single-acc").showIf(1===a.length),this.$(".multiple-acc").hideIf(1===a.length),this.$(".account-field .dropdown-content").empty(),c.each(a,function(e){this.$(".account-field .dropdown-content").append(this.renderAccountItem(e))}.bind(this)),a.length&&this.bindAccount(a[0]),this.$("#select-searching-properties .account-field .dropdown-button").dropdown({inDuration:100,outDuration:100,constrainWidth:!1,hover:!1,alignment:"left"}),this},toggleProperties:function(){var e=this.isPropertiesVisible();this.$("#select-searching-properties").slideToggle("fast"),this.$(".arrow").switchClass("mdi-chevron-up",!e),this.$(".arrow").switchClass("mdi-chevron-down",e)},isPropertiesVisible:function(){return"none"!==this.$("#select-searching-properties").css("display")},discover:function(){var e=c.escape(this.$(".search-input.simple-input-field").val());if(e){this.isPropertiesVisible()&&this.toggleProperties(),this.$(".searching-more").html("");var t=this.$("#searching_property_title").val(),a=this.$("#searching_property_sort_by").val();this.$(".searching-result-wrap .preloader-wrapper").show(),this.searchExistingGroupChats(e)}},setColor:function(){if(this.account){var e=this.account.settings.get("color");this.data.set("color",e)}},colorUpdated:function(){var e=this.data.get("color");this.$el.attr("data-color",e)},keyUp:function(e){""===this.$(".search-input").val()?this.$(".btn-search").addClass("none-active"):this.$(".btn-search").removeClass("none-active"),e.keyCode===a.KEY_ENTER&&this.discover()},searchExistingGroupChats:function(e){this.account.connection.disco.items(e,null,this.getGroupchatService.bind(this),this.onDiscoveringError.bind(this))},onDiscoveringError:function(e){this.endDiscovering(),this.$(".chats-list").html(""),this.$(".result-string").text("No matches for \""+s(e).attr("from")+"\"")},endDiscovering:function(){this.$(".searching-result-wrap .preloader-wrapper").hide()},getGroupchatService:function(e){s(e).find("query item").each(function(e,t){if(s(t).attr("node")===d.NS.GROUP_CHAT){var a=s(t).attr("jid");this.getGroupchatFeatures(a)}}.bind(this)),this.endDiscovering()},getGroupchatFeatures:function(e){var t=o({type:"get",to:e}).c("query",{xmlns:d.NS.DISCO_INFO,node:d.NS.GROUP_CHAT});this.account.sendIQ(t,this.getServerInfo.bind(this),this.onDiscoveringError.bind(this))},getServerInfo:function(e){s(e).find("query identity").each(function(t,a){var i=s(a);if("conference"===i.attr("category")&&"server"===i.attr("type")){var n=s(e).attr("from");this.getChatsFromSever(n)}}.bind(this))},getChatsFromSever:function(e){var t=o({type:"get",to:e}).c("query",{xmlns:d.NS.DISCO_ITEMS,node:d.NS.GROUP_CHAT});this.account.sendIQ(t,function(e){this.$(".chats-list").html(""),s(e).find("query item").each(function(e,t){var a=s(t),n=a.attr("name"),o=a.attr("jid"),d=s(i.existing_groupchat_item({name:n,jid:o,color:this.account.settings.get("color")})),c=r.getDefaultAvatar(n);d.find(".circle-avatar").setAvatar(c,32),d.appendTo(this.$(".searching-result-wrap .chats-list"))}.bind(this)),this.$(".result-string").text("Discovered "+s(e).find("query item").length+" group chats by "+this.account.get("jid"))}.bind(this))},bindAccount:function(e){this.account=e,this.$(".account-field .dropdown-button .account-item-wrap").replaceWith(this.renderAccountItem(e)),this.setColor()},renderAccountItem:function(e){var t=s(i.searching_account_item({jid:e.get("jid")}));return t},selectAccount:function(t){var a=s(t.target).closest(".account-item-wrap"),i=e.accounts.get(a.data("jid"));this.bindAccount(i)},getChatProperties:function(t){var a=s(t.target).closest(".existing-chat-wrap"),i=a.data("jid"),n=a.data("name"),c=o({type:"get",to:i}).c("query",{xmlns:d.NS.DISCO_INFO});this.account.sendIQ(c,function(t){var a=s(t),o=a.find("field[var=\"description\"] value").text(),d=a.find("field[var=\"anonymous\"] value").text(),c=a.find("field[var=\"model\"] value").text();this.more_info_view=this.addChild("groupchat_properties",e.MoreInfoView,{model:this,chat_properties:{jid:i,name:n,anonymous:d,description:o,membership:c},el:this.$(".searching-more")[0]})}.bind(this))}}),e.MoreInfoView=e.BasicView.extend({className:"searching-main noselect",template:i.existing_groupchat_details_view,events:{"click .btn-join-chat":"joinChat"},_initialize:function(e){this.account=this.model.account,this.chat_properties=e.chat_properties,this.$el.html(this.template(this.chat_properties))},render:function(){},joinChat:function(){let e=this.account.contacts.mergeContact(this.chat_properties.jid);e.set("group_chat",!0),e.invitation.joinGroupChat()}}),e.Searching=Backbone.Model.extend({initialize:function(e){this.account=e.account},getSearchingFields:function(){let e=o({from:this.account.get("jid"),type:"get",to:"index.xabber.com"}).c("query",{xmlns:d.NS.INDEX+"#groupchat"});this.account.sendIQ(e,this.parseSearchingFields)},parseSearchingFields:function(e){let t=s(e),a=t.find("x[xmlns = \""+d.NS.XDATA+"\"] field"),i=[];a.each(function(e,t){let a=s(t);"hidden"!==a.attr("type")&&i.push({var:a.attr("var"),label:a.attr("label")})}.bind(this))}}),e.LocalSearchingView=e.BasicView.extend({className:"",events:{},_initialize:function(e){this.account=e.account},render:function(){},search:function(){}}),e.GlobalSearchingView=e.BasicView.extend({className:"",events:{},_initialize:function(e){this.account=e.account,this.indexed_chats=[]},render:function(){},search:function(e){this.indexed_chats=[];let t=o({to:"index.xabber.com",type:"set",from:this.account.get("jid")}).c("query",{xmlns:d.NS.INDEX+"#groupchat"}).c("x",{xmlns:d.NS.XDATA,type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(d.NS.INDEX+"#groupchat").up().up();e.description&&t.c("field",{var:"description"}).c("value").t(e.description).up().up(),e.name&&t.c("field",{var:"name"}).c("value").t(e.name).up().up(),e.model&&t.c("field",{var:"model"}).c("value").t(e.model).up().up(),e.anywhere&&t.c("field",{var:"anywhere"}).c("value").t(e.anywhere).up().up(),this.account.sendIQ(t,this.onSearched.bind(this))},onSearched:function(e){let t=s(e),a=s(t.find("query item groupchat"));a.each(function(e,t){let a=s(t),i=a.attr("jid"),n={jid:i},o=a.children();o.each(function(e,t){let a=s(t),i=a[0].tagName.replace(/-/g,"_"),o=a.text();c.extend(n,{[i]:o})}.bind(this)),this.indexed_chats.push(n)}.bind(this))}}),e.once("start",function(){this.discovering=this.wide_panel.addChild("discovering_main",this.DiscoveringView)},e),e}}),define("xabber-mentions",[],function(){return function(e){var t=e.env,a=t.constants,i=t.templates.mentions,n=t.utils,s=t.$,o=t.Strophe,d=t._,c=n.images;return e.Mention=Backbone.Model.extend({defaults:{active:!1,display:!1,timestamp:0},initialize:function(t,a){this.contact=a.contact,this.message=a.message,this.id=this.message.get("unique_id"),this.set("timestamp",this.message.get("timestamp")),this.account=this.contact.account,this.item_view=new e.MentionItemView({model:this}),this.contact.on("destroy",this.destroy,this)}}),e.MentionsBase=Backbone.Collection.extend({model:e.Mention}),e.AccountMentions=e.MentionsBase.extend({initialize:function(e,t){this.account=t.account,this.on("add",this.onMentionAdded,this)},onMentionAdded:function(t){e.mentions.add(t)}}),e.Mentions=e.MentionsBase.extend({comparator:"timestamp",initialize:function(){this.collections=[],this.on("add",d.bind(this.updateInCollections,this,"add")),this.on("change",d.bind(this.updateInCollections,this,"change"))},addCollection:function(e){this.collections.push(e)},updateInCollections:function(e,t){d.each(this.collections,function(a){a.update(t,e)})}}),e.MentionsView=e.SearchPanelView.extend({className:"mentions-container container",ps_selector:".mentions-list-wrap",main_container:".mentions-list",ps_settings:{theme:"item-list"},template:i.mentions_panel,_initialize:function(){this.active_mention=null,this.keyup_timeout=null,this.model.on("add",this.onMentionAdded,this),this.model.on("change:active",this.onChangedActiveStatus,this),this.model.on("destroy",this.onMentionRemoved,this),e.accounts.on("list_changed",this.updateLeftIndicator,this),this.ps_container.on("ps-scroll-y",this.onScrollY.bind(this)),this.$("input").on("input",this.updateSearch.bind(this))},render:function(e){!e.right&&this.active_mention&&(this.active_mention.model.set("active",!1),this.active_mention=null),("chat"!==e.right&&"contact_details"!==e.right&&"message_context"!==e.right&&"participant_messages"!==e.right||e.clear_search&&"chat"===e.right)&&this.clearSearch()},onMentionAdded:function(e){this.addChild(e.id,e.item_view),this.updateMentionPosition(e)},onMentionRemoved:function(e,t){t=t||{},this.active_mention===this.child(e.id)&&(this.active_mention=null),this.removeChild(e.id,t),this.updateScrollBar()},selectItem:function(e){this.clearSearchSelection();var t=this.$(".list-item[data-id=\""+e+"\"]");t.length?this.selection_id=e:(t=this.$(".list-item:visible").first(),this.selection_id=t.data("id")),t.find(".mention-info-wrap").addClass("selected")},clearSearchSelection:function(){this.selection_id=null,this.$(".list-item.selected").removeClass("selected"),this.$(".list-item .selected").removeClass("selected")},onEnterPressed:function(t){let a;t.closest(".searched-lists-wrap").length?(this.clearSearch(),this.$(".list-item.active").removeClass("active"),t.hasClass("chat-item")&&(a=e.chats_view.child(t.data("id")),a&&a.open({screen:e.body.screen.get("name"),clear_search:!1}),t.addClass("active")),t.hasClass("roster-contact")&&(a=e.accounts.get(t.data("account")).chats.get(e.accounts.get(t.data("account")).contacts.get(t.data("jid")).hash_id),a&&(a=a.item_view),a&&e.chats_view.openChat(a,{clear_search:!1,screen:e.body.screen.get("name")}),t.addClass("active")),t.hasClass("message-item")&&t.click()):t.find(".mention-info-wrap").click()},replaceMentionItem:function(e,t){let a=this.child(e.id);if(a&&e.get("timestamp")){a.$el.detach();let i=t.indexOf(e);0===i?this.$(".mentions-list").append(a.$el):this.$(".mention-item").eq(-i).before(a.$el);let n=a.$el.prev(".mention-item"),s=a.$el.next(".mention-item"),o=a.$el.data("contact-jid");if(n.length){let e=n.data("contact-jid");e!==o&&a.$el.find(".group-chat-title-wrap").removeClass("hidden")}else a.$el.find(".group-chat-title-wrap").removeClass("hidden");if(s.length){let e=s.data("contact-jid");e===o?s.find(".group-chat-title-wrap").addClass("hidden"):s.find(".group-chat-title-wrap").removeClass("hidden")}else a.$el.find(".group-chat-title-wrap").removeClass("hidden")}},readAllMentions:function(){e.accounts.connected.forEach(function(e){let t=d.clone(e.unreaded_mentions.models);d.each(t,function(t){let a=t.message.get("msgid"),i=t.message.get("archive_id"),n=t.message.get("contact_archive_id"),s=e.chats.getChat(t.contact);t.message.set("is_unread",!1),s.sendMarker(a,"displayed",i,n)}.bind(this))}.bind(this))},updateLeftIndicator:function(e){this.$el.attr("data-indicator",1<e.connected.length)},updateMentionPosition:function(e){let t=this.child(e.id);t&&this.replaceMentionItem(e,this.model)},onChangedActiveStatus:function(e){if(e.get("active")){var t=this.active_mention;this.active_mention=this.child(e.id),t&&t.model.set("active",!1)}}}),e.MentionItemView=e.BasicView.extend({className:"mention-item list-item",template:i.mention_item,avatar_size:a.AVATAR_SIZES.CHAT_ITEM,events:{"click .mention-info-wrap":"openByClick"},_initialize:function(){this.account=this.model.account,this.contact=this.model.contact,this.$el.attr("data-id",this.model.id),this.$el.attr("data-contact-jid",this.contact.get("jid")),this.updateContactName(),this.updateGroupChat(),this.updateName(),this.updateLastMessage(),this.updateAvatar(),this.updateColorScheme(),this.updateCounter(),this.updateIcon(),this.model.on("change:active",this.updateActiveStatus,this),this.account.settings.on("change:color",this.updateColorScheme,this),this.contact.on("change:name",this.updateContactName,this),this.contact.on("change:group_chat",this.updateGroupChat,this),this.model.message.on("change:is_unread",this.updateCounter,this)},updateName:function(){let e=this.model.message,t=e.get("user_info")||e.isSenderMe()&&this.contact.my_info&&this.contact.my_info.attributes,a=this.contact.get("name");t&&(a=t.nickname||t.jid||t.id||this.model.message.get("from_jid")),this.$(".chat-title").text(a)},updateIcon:function(){this.$(".contact-icon .group-chat-icon").hideIf(!this.contact.get("group_chat")&&this.contact.get("jid")===this.account.domain),this.$(".contact-icon .server-icon").hideIf(this.contact.get("jid")!==this.account.domain)},updateContactName:function(){let e=this.contact.get("name");if(this.$(".group-chat-name").text(e),!this.contact.get("group_chat")&&(this.updateName(),!this.contact.get("photo_hash"))){let t=c.getDefaultAvatar(e);this.$(".circle-avatar").setAvatar(t,this.avatar_size)}},updateGroupChat:function(){this.updateIcon()},updateCounter:function(){let t=this.model.message.get("is_unread");this.$(".msg-counter").switchClass("hidden",!t),t?this.account.unreaded_mentions.add(this.model):this.account.unreaded_mentions.remove(this.model),e.toolbar_view.recountAllMessageCounter()},updateLastMessage:function(){let e=this.model.message;if(!e)return;let t=e.get("time"),a=e.get("timestamp"),i=e.get("forwarded_message"),o=e.get("files"),d=e.get("images"),c=i?e.get("message")||(1<i.length?i.length+" forwarded messages":"Forwarded message").italics():e.getText();if(this.model.set({timestamp:a}),o||d){let e=s("<span class=\"text-color-500\"/>");o&&d&&(o=0<o.length?o:void 0,d=0<d.length?d:void 0),o&&d?c=e.text(o.length+d.length+" files"):(o&&(1<o.length&&(c=e.text(o.length+" files")),1==o.length&&(c=e.text(o[0].name))),d&&(1<d.length&&(c=e.text(d.length+" images")),1==d.length&&(c=e.text(d[0].name)))),this.$(".last-msg").text("").append(c)}else this.$(".last-msg").text(c);this.$el.emojify(".last-msg",{emoji_size:16}),this.$(".last-msg-date").text(n.pretty_short_datetime(t)).attr("title",n.pretty_datetime(t))},updateActiveStatus:function(){this.$el.find(".mention-info-wrap").switchClass("active",this.model.get("active"))},updateAvatar:function(){let e=this.model.message,t=e.get("user_info")||e.isSenderMe()&&this.contact.my_info&&this.contact.my_info.attributes,a;if(!t)a=this.contact.cached_image,this.$(".circle-avatar").setAvatar(a,this.avatar_size);else if(!t.avatar){let e=c.getDefaultAvatar(t.nickname||t.jid||t.id);this.$(".circle-avatar").setAvatar(e,this.avatar_size)}else if(a=t.b64_avatar||this.account.chat_settings.getB64Avatar(t.id),a)this.$(".circle-avatar").setAvatar(a,this.avatar_size);else{var i=o.NS.PUBSUB_AVATAR_DATA+"#"+t.id;this.contact.getAvatar(t.avatar,i,function(e){a=e,this.account.chat_settings.updateCachedAvatars(t.id,t.avatar,e),this.$(".circle-avatar").setAvatar(a,this.avatar_size)}.bind(this),function(){let e=c.getDefaultAvatar(t.nickname||t.jid||t.id);this.$(".circle-avatar").setAvatar(e,this.avatar_size)}.bind(this))}},openByClick:function(){let e=this.model.message,t=this.account.chats.getChat(this.contact);this.model.message.set("is_unread",!1),t.sendMarker(e.get("origin_id"),"displayed",e.get("stanza_id"),e.get("contact_stanza_id")),this.model.set("active",!0),this.contact.trigger("open_mention",this.contact,e.get("unique_id"))},updateColorScheme:function(){var e=this.account.settings.get("color");this.$el.attr("data-color",e)}}),e.MentionsPlaceholderView=e.BasicView.extend({className:"placeholder-wrap mentions-placeholder-wrap noselect",template:i.mentions_placeholder}),e.Account.addInitPlugin(function(){this.mentions=new e.AccountMentions(null,{account:this}),this.unreaded_mentions=new e.Mentions(null,{account:this})}),e.once("start",function(){this.mentions=new this.Mentions,this.mentions_view=this.left_panel.addChild("mentions",this.MentionsView,{model:this.mentions}),this.mentions_placeholder=this.right_panel.addChild("mentions_placeholder",this.MentionsPlaceholderView)},e),e}}),define("xabber-ui",[],function(){return function(e){var t=e.env,a=t.constants,i=t.$;return e.once("start",function(){i(window).on("keydown",function(t){let i=e.body.screen.attributes;if(t.keyCode===a.KEY_ESCAPE){if(e.body.$el.siblings("#modals").children().length)return;"all-chats"===i.name&&"contact_details"===i.right&&i.contact.trigger("open_chat",i.contact)}if(i.chat_item&&("mentions"===i.name||"contacts"===i.name||"all-chats"===i.name)&&("chat"===i.right||"participant_messages"===i.right||"message_context"===i.right||"searched_messages"===i.right)&&!window.$(".message-actions-panel").hasClass("hidden")&&!t.ctrlKey&&!t.metaKey){switch(t.keyCode){case 67:i.chat_item.contact.trigger("copy_selected_messages");break;case 68:i.chat_item.contact.trigger("delete_selected_messages");break;case 69:i.chat_item.contact.trigger("edit_selected_message");break;case 70:i.chat_item.contact.trigger("forward_selected_messages");break;case 80:i.chat_item.contact.trigger("pin_selected_message");break;case 82:i.chat_item.contact.trigger("reply_selected_messages");break;case a.KEY_ESCAPE:i.chat_item.contact.trigger("reset_selected_messages");}t.preventDefault()}}.bind(this)),this.updateLayout=function(t){t||(t={}),this.roster_view.isVisible()&&this.updateRosterLayout(t),e.trigger("update_css",t),this.body.$(".ps-container").perfectScrollbar("update")},this.updateRosterLayout=function(){var e=this.body.$el.width(),t=e>=a.WIDTH_MEDIUM,i=e<a.WIDTH_NARROW,n=e<a.WIDTH_TINY,s=this.roster_view.data.get("expanded"),o=this.roster_view.data.get("pinned");if(this.roster_view.$(".collapsed-wrap").hideIf(s),this.roster_view.$(".expanded-wrap").showIf(s),this.roster_view.$(".btn-pin").hideIf(i).text(o?"unpin":"pin"),i&&o)return void this.roster_view.data.set({expanded:!1,pinned:!1});if(!i&&!o&&this.settings.roster.pinned)return void this.roster_view.data.set({expanded:!0,pinned:!0});var d="",c,r;t||!(i||o)?(r=1050,c=300):i?(r=e-50-20-44,1038<r?(r=1038,c=288):(c=250,d=60)):(r=7*(e-50-20)/9,c=2*(e-50-20)/9,d=60),s||(c=t?48:44);var l=(e-r)/2,p=l-50,u=l-c;this.roster_view.$(".expanded-wrap").switchClass("solid",!o&&(!t||0>u)),o&&!d&&3*u<p&&(d=50+.75*(p+u)),this.main_panel.setCustomCss({width:r,"margin-left":d}),this.roster_view.setCustomCss({width:c})},this.on("update_layout",this.updateLayout,this),this.body.addScreen("blank",{}),this.body.addScreen("login",{login:{xmpp_login:null}}),this.body.addScreen("settings",{toolbar:null,main:{wide:{settings:null}},roster:null}),this.body.addScreen("add_account",{toolbar:null,login:null}),this.body.addScreen("about",{toolbar:null,main:{wide:{about:null}},roster:null});var t=new this.ViewPath("account.settings_left"),n=new this.ViewPath("account.settings_right"),s=new this.ViewPath("account.vcard_edit");this.body.addScreen("account_settings",{toolbar:null,main:{wide:{account_settings:{left:t,right:n}}},roster:null}),this.account_settings.patchTree=function(e,a){if("vcard_edit"===a.right)return{left:t,right:s}};var o=new this.ViewPath("chat_item.content.head"),d=new this.ViewPath("chat_item.content"),c=new this.ViewPath("chat_item.content.bottom"),r=new this.ViewPath("contact.invitation"),l=new this.ViewPath("contact.details_view"),p=new this.ViewPath("contact.messages_view"),u=new this.ViewPath("contact.details_view.participants");this.body.addScreen("contacts",{toolbar:null,main:{left:{contacts:null},right:{contact_placeholder:null}},roster:null}),this.body.addScreen("search",{toolbar:null,main:{wide:{discovering_main:null}},roster:null}),this.body.addScreen("mentions",{toolbar:null,main:{left:{mentions:null},right:{mentions_placeholder:null}},roster:null}),this.body.addScreen("all-chats",{toolbar:null,main:{left:{chats:null},right:{chat_placeholder:null}},roster:null}),this.right_panel.patchTree=function(e,t){return void 0===t.right?void 0:"message_context"===t.right||"participant_messages"===t.right||"searched_messages"===t.right?{chat_head:o,chat_body:p,chat_bottom:c}:"group_invitation"===t.right?{details:r}:"contact_details"===t.right?{details:l}:"participants"===t.details_content?{details_content:u}:t.chat_item?{chat_head:o,chat_body:d,chat_bottom:c}:void 0},this.body.setScreen("blank"),this.api_account.once("settings_result",function(e){null!==e||this.accounts.length?this.body.isScreen("blank")&&this.body.setScreen("all-chats"):this.body.setScreen("login")},this),this.api_account.ready.then(this.api_account.start.bind(this.api_account))},e),e}}),define("xabber",["xabber-core","xabber-views","xabber-api-service","xabber-strophe","xabber-vcard","xabber-accounts","xabber-discovery","xabber-contacts","xabber-chats","xabber-searching","xabber-mentions","xabber-ui"],function(e,t,a,i,n,s,o,d,c,r,l,p){return e.extendWith(t,a,i,n,s,o,d,c,r,l,p)});